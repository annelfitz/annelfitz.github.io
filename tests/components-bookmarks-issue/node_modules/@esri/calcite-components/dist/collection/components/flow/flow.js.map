{"version":3,"file":"flow.js","sourceRoot":"","sources":["../../../../src/components/flow/flow.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAS,MAAM,eAAe,CAAC;AAC1F,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AAEvD,OAAO,EAAE,GAAG,EAAE,MAAM,aAAa,CAAC;AAClC,OAAO,EACL,kBAAkB,EAElB,kBAAkB,EAClB,sBAAsB,GACvB,MAAM,sBAAsB,CAAC;AAE9B;;GAEG;AAMH,MAAM,OAAO,IAAI;;QA4Ef,yBAAoB,GAAG,cAAc,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;QAyChF,qBAAgB,GAAG,CAAC,gBAAwB,EAAE,gBAAwB,EAAwB,EAAE;YAC9F,MAAM,wBAAwB,GAAG,gBAAgB,GAAG,CAAC,CAAC;YACtD,MAAM,uBAAuB,GAAG,gBAAgB,IAAI,gBAAgB,GAAG,CAAC,CAAC;YAEzE,IAAI,CAAC,uBAAuB,IAAI,CAAC,wBAAwB,EAAE;gBACzD,OAAO,IAAI,CAAC;aACb;YAED,OAAO,gBAAgB,GAAG,gBAAgB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,WAAW,CAAC;QAC1E,CAAC,CAAC;QAEF,oBAAe,GAAG,GAAS,EAAE;YAC3B,MAAM,EAAE,mBAAmB,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;YAEhD,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CACzB,EAAE,CAAC,gBAAgB,CACjB,oBAAoB,mBAAmB,CAAC,CAAC,CAAC,IAAI,mBAAmB,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAC3E,CACF,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,CAAC;YAEhE,MAAM,YAAY,GAAG,KAAK,CAAC,MAAM,CAAC;YAClC,MAAM,YAAY,GAAG,QAAQ,CAAC,MAAM,CAAC;YACrC,MAAM,UAAU,GAAG,QAAQ,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;YAC9C,MAAM,YAAY,GAAG,QAAQ,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC;YAEhD,IAAI,YAAY,IAAI,UAAU,EAAE;gBAC9B,QAAQ,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;oBAC5B,QAAQ,CAAC,cAAc,GAAG,QAAQ,KAAK,UAAU,IAAI,YAAY,GAAG,CAAC,CAAC;oBACtE,QAAQ,CAAC,MAAM,GAAG,QAAQ,KAAK,UAAU,CAAC;gBAC5C,CAAC,CAAC,CAAC;aACJ;YAED,IAAI,YAAY,EAAE;gBAChB,YAAY,CAAC,QAAQ,GAAG,KAAK,CAAC;aAC/B;YAED,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC;YAEtB,IAAI,YAAY,KAAK,YAAY,EAAE;gBACjC,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;gBACxE,IAAI,CAAC,SAAS,GAAG,YAAY,CAAC;gBAC9B,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;aACpC;QACH,CAAC,CAAC;;6BA1FsC,IAAI;yBAEvB,CAAC;qBAEkB,EAAE;;IAzE1C,6EAA6E;IAC7E,EAAE;IACF,kBAAkB;IAClB,EAAE;IACF,6EAA6E;IAE7E;;OAEG;IAEH,KAAK,CAAC,IAAI;QACR,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;QAEvB,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAEzC,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO;SACR;QAED,MAAM,UAAU,GAAG,QAAQ,CAAC,UAAU;YACpC,CAAC,CAAC,QAAQ,CAAC,UAAU;YACrB,CAAC,CAAC,GAAkB,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QAE3C,IAAI;YACF,MAAM,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SACjC;QAAC,OAAO,MAAM,EAAE;YACf,iBAAiB;YACjB,OAAO;SACR;QAED,QAAQ,CAAC,MAAM,EAAE,CAAC;QAElB,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED;;OAEG;IAEH,KAAK,CAAC,QAAQ;QACZ,MAAM,kBAAkB,CAAC,IAAI,CAAC,CAAC;QAE/B,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC;QACvB,MAAM,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE3C,OAAO,UAAU,EAAE,QAAQ,EAAE,CAAC;IAChC,CAAC;IA+BD,6EAA6E;IAC7E,EAAE;IACF,aAAa;IACb,EAAE;IACF,6EAA6E;IAE7E,iBAAiB;QACf,IAAI,CAAC,oBAAoB,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QAChF,IAAI,CAAC,eAAe,EAAE,CAAC;IACzB,CAAC;IAED,KAAK,CAAC,iBAAiB;QACrB,sBAAsB,CAAC,IAAI,CAAC,CAAC;IAC/B,CAAC;IAED,gBAAgB;QACd,kBAAkB,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAED,oBAAoB;QAClB,IAAI,CAAC,oBAAoB,EAAE,UAAU,EAAE,CAAC;IAC1C,CAAC;IAED,6EAA6E;IAC7E,EAAE;IACF,mBAAmB;IACnB,EAAE;IACF,6EAA6E;IAG7E,KAAK,CAAC,mBAAmB,CAAC,KAAkB;QAC1C,IAAI,KAAK,CAAC,gBAAgB,EAAE;YAC1B,OAAO;SACR;QAED,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;QAClB,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;IACzB,CAAC;IA+CD,6EAA6E;IAC7E,EAAE;IACF,kBAAkB;IAClB,EAAE;IACF,6EAA6E;IAE7E,MAAM;QACJ,MAAM,EAAE,aAAa,EAAE,GAAG,IAAI,CAAC;QAE/B,MAAM,qBAAqB,GAAG;YAC5B,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,IAAI;YACjB,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,aAAa,KAAK,WAAW;YACnD,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,aAAa,KAAK,YAAY;SACtD,CAAC;QAEF,OAAO,CACL,WAAK,KAAK,EAAE,qBAAqB;YAC/B,eAAQ,CACJ,CACP,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Element, h, Listen, Method, Prop, State, VNode } from \"@stencil/core\";\nimport { createObserver } from \"../../utils/observers\";\nimport { FlowDirection, FlowItemLikeElement } from \"./interfaces\";\nimport { CSS } from \"./resources\";\nimport {\n  componentFocusable,\n  LoadableComponent,\n  setComponentLoaded,\n  setUpLoadableComponent,\n} from \"../../utils/loadable\";\n\n/**\n * @slot - A slot for adding `calcite-flow-item` elements to the component.\n */\n@Component({\n  tag: \"calcite-flow\",\n  styleUrl: \"flow.scss\",\n  shadow: true,\n})\nexport class Flow implements LoadableComponent {\n  // --------------------------------------------------------------------------\n  //\n  //  Public Methods\n  //\n  // --------------------------------------------------------------------------\n\n  /**\n   * Removes the currently active `calcite-flow-item`.\n   */\n  @Method()\n  async back(): Promise<HTMLCalciteFlowItemElement | FlowItemLikeElement> {\n    const { items } = this;\n\n    const lastItem = items[items.length - 1];\n\n    if (!lastItem) {\n      return;\n    }\n\n    const beforeBack = lastItem.beforeBack\n      ? lastItem.beforeBack\n      : (): Promise<void> => Promise.resolve();\n\n    try {\n      await beforeBack.call(lastItem);\n    } catch (_error) {\n      // back prevented\n      return;\n    }\n\n    lastItem.remove();\n\n    return lastItem;\n  }\n\n  /**\n   * Sets focus on the component.\n   */\n  @Method()\n  async setFocus(): Promise<void> {\n    await componentFocusable(this);\n\n    const { items } = this;\n    const activeItem = items[items.length - 1];\n\n    return activeItem?.setFocus();\n  }\n\n  // --------------------------------------------------------------------------\n  //\n  //  Public Properties\n  //\n  // --------------------------------------------------------------------------\n\n  /**\n   * This property enables the component to consider other custom elements implementing flow-item's interface.\n   *\n   * @internal\n   */\n  @Prop() customItemSelectors: string;\n\n  // --------------------------------------------------------------------------\n  //\n  //  Private Properties\n  //\n  // --------------------------------------------------------------------------\n\n  @Element() el: HTMLCalciteFlowElement;\n\n  @State() flowDirection: FlowDirection = null;\n\n  @State() itemCount = 0;\n\n  @State() items: FlowItemLikeElement[] = [];\n\n  itemMutationObserver = createObserver(\"mutation\", () => this.updateFlowProps());\n\n  // --------------------------------------------------------------------------\n  //\n  //  Lifecycle\n  //\n  // --------------------------------------------------------------------------\n\n  connectedCallback(): void {\n    this.itemMutationObserver?.observe(this.el, { childList: true, subtree: true });\n    this.updateFlowProps();\n  }\n\n  async componentWillLoad(): Promise<void> {\n    setUpLoadableComponent(this);\n  }\n\n  componentDidLoad(): void {\n    setComponentLoaded(this);\n  }\n\n  disconnectedCallback(): void {\n    this.itemMutationObserver?.disconnect();\n  }\n\n  // --------------------------------------------------------------------------\n  //\n  //  Private Methods\n  //\n  // --------------------------------------------------------------------------\n\n  @Listen(\"calciteFlowItemBack\")\n  async handleItemBackClick(event: CustomEvent): Promise<void> {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    await this.back();\n    return this.setFocus();\n  }\n\n  getFlowDirection = (oldFlowItemCount: number, newFlowItemCount: number): FlowDirection | null => {\n    const allowRetreatingDirection = oldFlowItemCount > 1;\n    const allowAdvancingDirection = oldFlowItemCount && newFlowItemCount > 1;\n\n    if (!allowAdvancingDirection && !allowRetreatingDirection) {\n      return null;\n    }\n\n    return newFlowItemCount < oldFlowItemCount ? \"retreating\" : \"advancing\";\n  };\n\n  updateFlowProps = (): void => {\n    const { customItemSelectors, el, items } = this;\n\n    const newItems = Array.from<FlowItemLikeElement>(\n      el.querySelectorAll(\n        `calcite-flow-item${customItemSelectors ? `,${customItemSelectors}` : \"\"}`,\n      ),\n    ).filter((flowItem) => flowItem.closest(\"calcite-flow\") === el);\n\n    const oldItemCount = items.length;\n    const newItemCount = newItems.length;\n    const activeItem = newItems[newItemCount - 1];\n    const previousItem = newItems[newItemCount - 2];\n\n    if (newItemCount && activeItem) {\n      newItems.forEach((itemNode) => {\n        itemNode.showBackButton = itemNode === activeItem && newItemCount > 1;\n        itemNode.hidden = itemNode !== activeItem;\n      });\n    }\n\n    if (previousItem) {\n      previousItem.menuOpen = false;\n    }\n\n    this.items = newItems;\n\n    if (oldItemCount !== newItemCount) {\n      const flowDirection = this.getFlowDirection(oldItemCount, newItemCount);\n      this.itemCount = newItemCount;\n      this.flowDirection = flowDirection;\n    }\n  };\n\n  // --------------------------------------------------------------------------\n  //\n  //  Render Methods\n  //\n  // --------------------------------------------------------------------------\n\n  render(): VNode {\n    const { flowDirection } = this;\n\n    const frameDirectionClasses = {\n      [CSS.frame]: true,\n      [CSS.frameAdvancing]: flowDirection === \"advancing\",\n      [CSS.frameRetreating]: flowDirection === \"retreating\",\n    };\n\n    return (\n      <div class={frameDirectionClasses}>\n        <slot />\n      </div>\n    );\n  }\n}\n"]}