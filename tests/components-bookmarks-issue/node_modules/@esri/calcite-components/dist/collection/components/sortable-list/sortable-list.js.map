{"version":3,"file":"sortable-list.js","sourceRoot":"","sources":["../../../../src/components/sortable-list/sortable-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, h, Listen, Prop, VNode } from \"@stencil/core\";\nimport Sortable from \"sortablejs\";\nimport {\n  connectInteractive,\n  disconnectInteractive,\n  InteractiveComponent,\n  InteractiveContainer,\n  updateHostInteraction,\n} from \"../../utils/interactive\";\nimport { createObserver } from \"../../utils/observers\";\nimport { HandleNudge } from \"../handle/interfaces\";\nimport { Layout } from \"../interfaces\";\nimport { CSS } from \"./resources\";\nimport {\n  DragDetail,\n  connectSortableComponent,\n  disconnectSortableComponent,\n  SortableComponent,\n  dragActive,\n} from \"../../utils/sortableComponent\";\nimport { focusElement } from \"../../utils/dom\";\n\n/**\n * @slot - A slot for adding sortable items.\n */\n@Component({\n  tag: \"calcite-sortable-list\",\n  styleUrl: \"sortable-list.scss\",\n  shadow: true,\n})\nexport class SortableList implements InteractiveComponent, SortableComponent {\n  // --------------------------------------------------------------------------\n  //\n  //  Properties\n  //\n  // --------------------------------------------------------------------------\n\n  /**\n   * When provided, the method will be called to determine whether the element can  move from the list.\n   */\n  @Prop() canPull: (detail: DragDetail) => boolean;\n\n  /**\n   * When provided, the method will be called to determine whether the element can be added from another list.\n   */\n  @Prop() canPut: (detail: DragDetail) => boolean;\n\n  /**\n   * Specifies which items inside the element should be draggable.\n   */\n  @Prop({ reflect: true }) dragSelector?: string;\n\n  /**\n   * The list's group identifier.\n   *\n   * To drag elements from one list into another, both lists must have the same group value.\n   */\n  @Prop({ reflect: true }) group?: string;\n\n  /**\n   * The selector for the handle elements.\n   */\n  @Prop({ reflect: true }) handleSelector = \"calcite-handle\";\n\n  /**\n   * Indicates the horizontal or vertical orientation of the component.\n   */\n  @Prop({ reflect: true }) layout: Layout = \"vertical\";\n\n  /**\n   * When true, disabled prevents interaction. This state shows items with lower opacity/grayed.\n   */\n  @Prop({ reflect: true }) disabled = false;\n\n  /**\n   * When true, content is waiting to be loaded. This state shows a busy indicator.\n   */\n  @Prop({ reflect: true }) loading = false;\n\n  // --------------------------------------------------------------------------\n  //\n  //  Private Properties\n  //\n  // --------------------------------------------------------------------------\n\n  @Element() el: HTMLCalciteSortableListElement;\n\n  items: Element[] = [];\n\n  mutationObserver = createObserver(\"mutation\", () => {\n    this.setUpSorting();\n  });\n\n  sortable: Sortable;\n\n  dragEnabled = true;\n\n  // --------------------------------------------------------------------------\n  //\n  //  Lifecycle\n  //\n  // --------------------------------------------------------------------------\n\n  connectedCallback(): void {\n    if (dragActive(this)) {\n      return;\n    }\n\n    this.setUpSorting();\n    this.beginObserving();\n    connectInteractive(this);\n  }\n\n  disconnectedCallback(): void {\n    if (dragActive(this)) {\n      return;\n    }\n\n    disconnectInteractive(this);\n    disconnectSortableComponent(this);\n    this.endObserving();\n  }\n\n  componentDidRender(): void {\n    updateHostInteraction(this);\n  }\n\n  // --------------------------------------------------------------------------\n  //\n  //  Events\n  //\n  // --------------------------------------------------------------------------\n\n  /**\n   * Emitted when the order of the list has changed.\n   */\n  @Event({ cancelable: false }) calciteListOrderChange: EventEmitter<void>;\n\n  @Listen(\"calciteHandleNudge\")\n  calciteHandleNudgeNextHandler(event: CustomEvent<HandleNudge>): void {\n    this.handleNudgeEvent(event);\n  }\n\n  // --------------------------------------------------------------------------\n  //\n  //  Private Methods\n  //\n  // --------------------------------------------------------------------------\n\n  onGlobalDragStart(): void {\n    this.endObserving();\n  }\n\n  onGlobalDragEnd(): void {\n    this.beginObserving();\n  }\n\n  onDragEnd(): void {}\n\n  onDragStart(): void {}\n\n  onDragSort(): void {\n    this.items = Array.from(this.el.children);\n    this.calciteListOrderChange.emit();\n  }\n\n  handleNudgeEvent(event: CustomEvent<HandleNudge>): void {\n    const { direction } = event.detail;\n\n    const handle = event\n      .composedPath()\n      .find((el: HTMLElement) => el.matches(this.handleSelector)) as HTMLElement;\n\n    const sortItem = this.items.find((item) => {\n      return item.contains(handle) || event.composedPath().includes(item);\n    });\n\n    const lastIndex = this.items.length - 1;\n    const startingIndex = this.items.indexOf(sortItem);\n    let appendInstead = false;\n    let buddyIndex: number;\n\n    if (direction === \"up\") {\n      if (startingIndex === 0) {\n        appendInstead = true;\n      } else {\n        buddyIndex = startingIndex - 1;\n      }\n    } else {\n      if (startingIndex === lastIndex) {\n        buddyIndex = 0;\n      } else if (startingIndex === lastIndex - 1) {\n        appendInstead = true;\n      } else {\n        buddyIndex = startingIndex + 2;\n      }\n    }\n\n    this.endObserving();\n\n    if (appendInstead) {\n      sortItem.parentElement.appendChild(sortItem);\n    } else {\n      sortItem.parentElement.insertBefore(sortItem, this.items[buddyIndex]);\n    }\n\n    this.items = Array.from(this.el.children);\n\n    this.beginObserving();\n    requestAnimationFrame(() => focusElement(handle));\n\n    if (\"selected\" in handle) {\n      handle.selected = true;\n    }\n  }\n\n  setUpSorting(): void {\n    this.items = Array.from(this.el.children);\n    connectSortableComponent(this);\n  }\n\n  beginObserving(): void {\n    this.mutationObserver?.observe(this.el, { childList: true, subtree: true });\n  }\n\n  endObserving(): void {\n    this.mutationObserver?.disconnect();\n  }\n\n  // --------------------------------------------------------------------------\n  //\n  //  Render Methods\n  //\n  // --------------------------------------------------------------------------\n\n  render(): VNode {\n    const { disabled, layout } = this;\n    const horizontal = layout === \"horizontal\" || false;\n\n    return (\n      <InteractiveContainer disabled={disabled}>\n        <div\n          class={{\n            [CSS.container]: true,\n            [CSS.containerVertical]: !horizontal,\n            [CSS.containerHorizontal]: horizontal,\n          }}\n        >\n          <slot />\n        </div>\n      </InteractiveContainer>\n    );\n  }\n}\n"]}