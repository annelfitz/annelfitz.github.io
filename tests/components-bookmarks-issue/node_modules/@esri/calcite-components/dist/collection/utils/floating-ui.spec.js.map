{"version":3,"file":"floating-ui.spec.js","sourceRoot":"","sources":["../../../src/utils/floating-ui.spec.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,qBAAqB,EAAE,MAAM,gBAAgB,CAAC;AACvD,OAAO,KAAK,UAAU,MAAM,eAAe,CAAC;AAG5C,MAAM,EACJ,UAAU,EACV,iBAAiB,EACjB,qBAAqB,EACrB,oBAAoB,EACpB,mBAAmB,EACnB,wBAAwB,EACxB,qBAAqB,EACrB,UAAU,EACV,kBAAkB,EAClB,UAAU,EACV,yBAAyB,GAC1B,GAAG,UAAU,CAAC;AAEf,EAAE,CAAC,sDAAsD,EAAE,GAAG,EAAE;IAC9D,MAAM,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IAEzC,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC1D,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACtE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAClE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC5D,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACxE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAEpE,EAAE,CAAC,GAAG,GAAG,KAAK,CAAC;IAEf,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC3D,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACvE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IACnE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC3D,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IACvE,MAAM,CAAC,qBAAqB,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AACrE,CAAC,CAAC,CAAC;AAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;IAC7B,IAAI,uBAA4C,CAAC;IACjD,IAAI,UAA0B,CAAC;IAC/B,IAAI,WAA8B,CAAC;IACnC,IAAI,eAAyD,CAAC;IAE9D,SAAS,6BAA6B;QACpC,OAAO;YACL,IAAI,EAAE,KAAK;YACX,UAAU,EAAE,KAAK,IAAI,EAAE;gBACrB,UAAU;YACZ,CAAC;YACD,kBAAkB,EAAE,UAAU;YAC9B,SAAS,EAAE,MAAM;SAClB,CAAC;IACJ,CAAC;IAED,UAAU,CAAC,GAAG,EAAE;QACd,uBAAuB,GAAG,6BAA6B,EAAE,CAAC;QAE1D,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC3C,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAE/C,eAAe,GAAG;YAChB,UAAU;YACV,WAAW;YACX,kBAAkB,EAAE,uBAAuB,CAAC,kBAAkB;YAC9D,SAAS,EAAE,uBAAuB,CAAC,SAAS;YAC5C,IAAI,EAAE,SAAS;SAChB,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,SAAS,wBAAwB,CAAC,UAAuB;QACvD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC5C,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QACtC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACzC,CAAC;IAED,SAAS,qBAAqB,CAAC,UAAuB;QACpD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAChD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACvC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC1C,CAAC;IAED,EAAE,CAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;QACpD,MAAM,UAAU,CAAC,uBAAuB,EAAE,eAAe,CAAC,CAAC;QAC3D,wBAAwB,CAAC,UAAU,CAAC,CAAC;QAErC,uBAAuB,CAAC,IAAI,GAAG,IAAI,CAAC;QAEpC,MAAM,UAAU,CAAC,uBAAuB,EAAE,eAAe,CAAC,CAAC;QAC3D,qBAAqB,CAAC,UAAU,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;QAClD,uBAAuB,CAAC,IAAI,GAAG,IAAI,CAAC;QAEpC,UAAU,CAAC,uBAAuB,EAAE,eAAe,CAAC,CAAC;QAErD,wBAAwB,CAAC,UAAU,CAAC,CAAC;QAErC,MAAM,qBAAqB,EAAE,CAAC;QAC9B,qBAAqB,CAAC,UAAU,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;QAC5C,uBAAuB,CAAC,IAAI,GAAG,IAAI,CAAC;QAEpC,UAAU,CAAC,uBAAuB,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;QAE3D,wBAAwB,CAAC,UAAU,CAAC,CAAC;QAErC,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,yBAAyB,CAAC,CAAC,CAAC;QACrF,qBAAqB,CAAC,UAAU,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,4BAA4B,EAAE,GAAG,EAAE;QAC1C,EAAE,CAAC,wDAAwD,EAAE,GAAG,EAAE;YAChE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC3C,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC7C,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAEhD,iBAAiB,CAAC,uBAAuB,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;YAEpE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3D,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACnD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAEpD,oBAAoB,CAAC,uBAAuB,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;YAEvE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEnD,uBAAuB,CAAC,kBAAkB,GAAG,OAAO,CAAC;YACrD,iBAAiB,CAAC,uBAAuB,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;YAEpE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3D,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAChD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACnD,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAEpD,oBAAoB,CAAC,uBAAuB,EAAE,WAAW,EAAE,UAAU,CAAC,CAAC;YAEvE,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC5D,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAClD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;QAClD,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,oBAAoB,CAAC,CAAC;QACjE,uBAAuB,CAAC,IAAI,GAAG,IAAI,CAAC;QAEpC,MAAM,8BAA8B,GAAG,6BAA6B,EAAE,CAAC;QACvE,8BAA8B,CAAC,IAAI,GAAG,IAAI,CAAC;QAE3C,UAAU,CAAC,UAAU,CAAC,uBAAuB,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;QACtE,MAAM,CAAC,WAAW,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAE7C,UAAU,CAAC,UAAU,CAAC,8BAA8B,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;QAC7E,MAAM,CAAC,WAAW,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAE7C,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,yBAAyB,CAAC,CAAC,CAAC;QACrF,MAAM,CAAC,WAAW,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;IAC/C,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,EAAE,CAAC,qDAAqD,EAAE,GAAG,EAAE;IAC7D,MAAM,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACxC,CAAC,CAAC,CAAC;AAEH,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;IAC3C,MAAM,CAAC,IAAI,GAAG,CAAC,wBAAwB,CAAC,CAAC,GAAG,UAAU,CAAC,EAAE,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAC/F,IAAI,GAAG,CAAC,mBAAmB,CAAC,CAC7B,CAAC;AACJ,CAAC,CAAC,CAAC","sourcesContent":["import { waitForAnimationFrame } from \"../tests/utils\";\nimport * as floatingUI from \"./floating-ui\";\nimport { FloatingUIComponent } from \"./floating-ui\";\n\nconst {\n  cleanupMap,\n  connectFloatingUI,\n  defaultOffsetDistance,\n  disconnectFloatingUI,\n  effectivePlacements,\n  filterComputedPlacements,\n  getEffectivePlacement,\n  placements,\n  positionFloatingUI,\n  reposition,\n  repositionDebounceTimeout,\n} = floatingUI;\n\nit(\"should set calcite placement to FloatingUI placement\", () => {\n  const el = document.createElement(\"div\");\n\n  expect(getEffectivePlacement(el, \"leading\")).toBe(\"left\");\n  expect(getEffectivePlacement(el, \"leading-start\")).toBe(\"left-start\");\n  expect(getEffectivePlacement(el, \"leading-end\")).toBe(\"left-end\");\n  expect(getEffectivePlacement(el, \"trailing\")).toBe(\"right\");\n  expect(getEffectivePlacement(el, \"trailing-start\")).toBe(\"right-start\");\n  expect(getEffectivePlacement(el, \"trailing-end\")).toBe(\"right-end\");\n\n  el.dir = \"rtl\";\n\n  expect(getEffectivePlacement(el, \"leading\")).toBe(\"right\");\n  expect(getEffectivePlacement(el, \"leading-start\")).toBe(\"right-start\");\n  expect(getEffectivePlacement(el, \"leading-end\")).toBe(\"right-end\");\n  expect(getEffectivePlacement(el, \"trailing\")).toBe(\"left\");\n  expect(getEffectivePlacement(el, \"trailing-start\")).toBe(\"left-start\");\n  expect(getEffectivePlacement(el, \"trailing-end\")).toBe(\"left-end\");\n});\n\ndescribe(\"repositioning\", () => {\n  let fakeFloatingUiComponent: FloatingUIComponent;\n  let floatingEl: HTMLDivElement;\n  let referenceEl: HTMLButtonElement;\n  let positionOptions: Parameters<typeof positionFloatingUI>[1];\n\n  function createFakeFloatingUiComponent(): FloatingUIComponent {\n    return {\n      open: false,\n      reposition: async () => {\n        /* noop */\n      },\n      overlayPositioning: \"absolute\",\n      placement: \"auto\",\n    };\n  }\n\n  beforeEach(() => {\n    fakeFloatingUiComponent = createFakeFloatingUiComponent();\n\n    floatingEl = document.createElement(\"div\");\n    referenceEl = document.createElement(\"button\");\n\n    positionOptions = {\n      floatingEl,\n      referenceEl,\n      overlayPositioning: fakeFloatingUiComponent.overlayPositioning,\n      placement: fakeFloatingUiComponent.placement,\n      type: \"popover\",\n    };\n  });\n\n  function assertPreOpenPositioning(floatingEl: HTMLElement): void {\n    expect(floatingEl.style.transform).toBe(\"\");\n    expect(floatingEl.style.top).toBe(\"\");\n    expect(floatingEl.style.left).toBe(\"\");\n  }\n\n  function assertOpenPositioning(floatingEl: HTMLElement): void {\n    expect(floatingEl.style.transform).not.toBe(\"\");\n    expect(floatingEl.style.top).toBe(\"0\");\n    expect(floatingEl.style.left).toBe(\"0\");\n  }\n\n  it(\"repositions only for open components\", async () => {\n    await reposition(fakeFloatingUiComponent, positionOptions);\n    assertPreOpenPositioning(floatingEl);\n\n    fakeFloatingUiComponent.open = true;\n\n    await reposition(fakeFloatingUiComponent, positionOptions);\n    assertOpenPositioning(floatingEl);\n  });\n\n  it(\"repositions immediately by default\", async () => {\n    fakeFloatingUiComponent.open = true;\n\n    reposition(fakeFloatingUiComponent, positionOptions);\n\n    assertPreOpenPositioning(floatingEl);\n\n    await waitForAnimationFrame();\n    assertOpenPositioning(floatingEl);\n  });\n\n  it(\"can reposition after a delay\", async () => {\n    fakeFloatingUiComponent.open = true;\n\n    reposition(fakeFloatingUiComponent, positionOptions, true);\n\n    assertPreOpenPositioning(floatingEl);\n\n    await new Promise<void>((resolve) => setTimeout(resolve, repositionDebounceTimeout));\n    assertOpenPositioning(floatingEl);\n  });\n\n  describe(\"connect/disconnect helpers\", () => {\n    it(\"has connectedCallback and disconnectedCallback helpers\", () => {\n      expect(cleanupMap.has(fakeFloatingUiComponent)).toBe(false);\n      expect(floatingEl.style.position).toBe(\"\");\n      expect(floatingEl.style.visibility).toBe(\"\");\n      expect(floatingEl.style.pointerEvents).toBe(\"\");\n\n      connectFloatingUI(fakeFloatingUiComponent, referenceEl, floatingEl);\n\n      expect(cleanupMap.has(fakeFloatingUiComponent)).toBe(true);\n      expect(floatingEl.style.position).toBe(\"absolute\");\n      expect(floatingEl.style.visibility).toBe(\"hidden\");\n      expect(floatingEl.style.pointerEvents).toBe(\"none\");\n\n      disconnectFloatingUI(fakeFloatingUiComponent, referenceEl, floatingEl);\n\n      expect(cleanupMap.has(fakeFloatingUiComponent)).toBe(false);\n      expect(floatingEl.style.position).toBe(\"absolute\");\n\n      fakeFloatingUiComponent.overlayPositioning = \"fixed\";\n      connectFloatingUI(fakeFloatingUiComponent, referenceEl, floatingEl);\n\n      expect(cleanupMap.has(fakeFloatingUiComponent)).toBe(true);\n      expect(floatingEl.style.position).toBe(\"fixed\");\n      expect(floatingEl.style.visibility).toBe(\"hidden\");\n      expect(floatingEl.style.pointerEvents).toBe(\"none\");\n\n      disconnectFloatingUI(fakeFloatingUiComponent, referenceEl, floatingEl);\n\n      expect(cleanupMap.has(fakeFloatingUiComponent)).toBe(false);\n      expect(floatingEl.style.position).toBe(\"fixed\");\n    });\n  });\n\n  it(\"debounces positioning per instance\", async () => {\n    const positionSpy = jest.spyOn(floatingUI, \"positionFloatingUI\");\n    fakeFloatingUiComponent.open = true;\n\n    const anotherFakeFloatingUiComponent = createFakeFloatingUiComponent();\n    anotherFakeFloatingUiComponent.open = true;\n\n    floatingUI.reposition(fakeFloatingUiComponent, positionOptions, true);\n    expect(positionSpy).toHaveBeenCalledTimes(1);\n\n    floatingUI.reposition(anotherFakeFloatingUiComponent, positionOptions, true);\n    expect(positionSpy).toHaveBeenCalledTimes(2);\n\n    await new Promise<void>((resolve) => setTimeout(resolve, repositionDebounceTimeout));\n    expect(positionSpy).toHaveBeenCalledTimes(2);\n  });\n});\n\nit(\"should have correct value for defaultOffsetDistance\", () => {\n  expect(defaultOffsetDistance).toBe(6);\n});\n\nit(\"should filter computed placements\", () => {\n  expect(new Set(filterComputedPlacements([...placements], document.createElement(\"div\")))).toEqual(\n    new Set(effectivePlacements),\n  );\n});\n"]}