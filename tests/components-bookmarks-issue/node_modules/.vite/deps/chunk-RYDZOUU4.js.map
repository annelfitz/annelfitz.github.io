{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/interactive/editingTools/dragEventPipeline3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport\"../../../../geometry.js\";import{screenPointObjectToArray as e,castScreenPointArray as n,createScreenPointArray as r}from\"../../../../core/screenUtils.js\";import{l as t,c as o,b as l,f as s,k as c,h as i,g as a}from\"../../../../chunks/vec32.js\";import{create as u}from\"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{projectPoint as p}from\"../../../../geometry/projection.js\";import{intersectRay as m,create as d,getNormal as f,fromPositionAndNormal as g}from\"../../../../geometry/support/plane.js\";import{create as y}from\"../../../../geometry/support/ray.js\";import{projectPoint as E}from\"../../../../geometry/support/vector.js\";import{sv2d as S}from\"../../../../geometry/support/vectorStacks.js\";import{getZForElevationMode as j}from\"../../../../support/elevationInfoUtils.js\";import{fromScreen as R}from\"../../support/geometryUtils/ray.js\";import{newIntersector as v}from\"../../webgl-engine/lib/Intersector.js\";import{StoreResults as x,IntersectorType as b}from\"../../webgl-engine/lib/IntersectorInterfaces.js\";import{terrainId as w}from\"../../webgl-engine/lib/verticalOffsetUtils.js\";import{EventPipeline as I}from\"../../../interactive/dragEventPipeline.js\";import H from\"../../../../geometry/Point.js\";function U(e,n){return C(e,(()=>n))}function O(e){return C(e,(e=>e.plane))}function C(r,t){const o=u(),l=u();let s=!1;return c=>{const i=t(c);if(\"start\"===c.action){const t=e(c.screenStart,n(S.get())),l=R(r.state.camera,t,B);null!=l&&(s=m(i,l,o))}if(!s)return null;const a=e(c.screenEnd,n(S.get())),u=R(r.state.camera,a,B);return null==u?null:m(i,u,l)?{...c,renderStart:o,renderEnd:l,plane:i,ray:u}:null}}function P(e,n,t=0,o=null,l=null){let s=null;return c=>{if(\"start\"===c.action&&(s=e.sceneIntersectionHelper.intersectElevationFromScreen(r(c.screenStart.x,c.screenStart.y),n,t,l),null!=s&&null!=o&&!p(s,s,o)))return null;if(null==s)return null;const i=e.sceneIntersectionHelper.intersectElevationFromScreen(r(c.screenEnd.x,c.screenEnd.y),n,t,l);return null!=i&&(null==o||p(i,i,o))?{...c,mapStart:s,mapEnd:i}:null}}function T(e,n,r,t=null,o=null){return P(e,r,j(n,e,r),t,o)}function D(e,n,r,t){const o=r.toMap(e.screenStart);return null!=o?T(n,o,r.elevationInfo,t):null}function M(e,n){const r=q,t=z,o=d();e.renderCoordsHelper.worldUpAtPosition(n,r);const c=l(f(o),r,s(t,n,e.state.camera.eye));return l(c,c,r),g(n,c,o)}function N(e,n,r){let t=null;const o=new I;return o.next(U(e,M(e,n))).next(h(e,n)).next(k(e,r)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,t=e})),e=>(t=null,o.execute(e),t)}function h(e,n){const r=u(),l=t(n);e.renderCoordsHelper.worldUpAtPosition(n,r);const p=u(),m=u(),d=o=>{if(s(o,o,n),E(r,o,o),\"global\"===e.viewingMode){t(o)*Math.sign(c(r,o))<.001-l&&s(o,i(o,r,.001),n)}return a(o,o,n),o};return e=>(e.renderStart=d(o(p,e.renderStart)),e.renderEnd=d(o(m,e.renderEnd)),e)}function k(e,n){const r=e.renderCoordsHelper;return e=>{const t=r.fromRenderCoords(e.renderStart,new H({spatialReference:n})),o=r.fromRenderCoords(e.renderEnd,new H({spatialReference:n}));return null!=t&&null!=o?{...e,mapStart:t,mapEnd:o}:null}}var G;function A(e){let n=null;return r=>{switch(r.action){case\"start\":n=e.disableDisplay();break;case\"end\":case\"cancel\":null!=n&&(n.remove(),n=null)}return r}}function F(n,t=null){const o=v(n.state.viewingMode);o.options.selectionMode=!0,o.options.store=x.MIN,o.options.hud=!1;const l=r(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=u(),i=t??n.spatialReference,a=r=>{n.map.ground&&n.map.ground.opacity<1?s.exclude.add(w):s.exclude.delete(w),n.sceneIntersectionHelper.intersectIntersectorScreen(e(r,l),o,s);const t=o.results.min;let a;if(t.getIntersectionPoint(c))a=t.intersector===b.TERRAIN?G.GROUND:G.OTHER;else{if(!o.results.ground.getIntersectionPoint(c))return null;a=G.GROUND}return{location:n.renderCoordsHelper.fromRenderCoords(c,new H({spatialReference:i})),surfaceType:a}};let p;return e=>{if(\"start\"===e.action){const n=a(e.screenStart);p=null!=n?n.location:null}if(null==p)return null;const n=a(e.screenEnd);return null!=n?.location?{...e,mapStart:p,mapEnd:n.location,surfaceType:n.surfaceType}:null}}!function(e){e[e.GROUND=0]=\"GROUND\",e[e.OTHER=1]=\"OTHER\"}(G||(G={}));const q=u(),z=u(),B=y();export{G as SurfaceType,k as convertToMapCoordinates,A as hideManipulatorWhileDragging,h as projectToWorldUp,F as screenToMap3D,T as screenToMapXYAtLocation,D as screenToMapXYForManipulatedObject,U as screenToRenderPlane,O as screenToRenderPlaneFromEvent,N as screenToZConstrained};\n"],
  "mappings": "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",
  "names": ["e", "n", "r", "t", "l", "s", "i", "g", "u", "P", "T", "w", "d", "F", "a"]
}
