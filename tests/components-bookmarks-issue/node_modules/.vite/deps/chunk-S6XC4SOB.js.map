{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/cim/CIMSymbolRasterizer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import{OverrideHelper as a}from\"./OverrideHelper.js\";import{mapCIMSymbolToGeometryType as s}from\"./utils.js\";const n=96/72;class o{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,o,l,c,m,g){if(!e)return null;const{data:y}=e;if(!y||\"CIMSymbolReference\"!==y.type||!y.symbol)return null;const{symbol:u}=y;l||(l=s(u));const d=await a.resolveSymbolOverrides(y,t,this._spatialReference,o,l,c,m),w=this._cimResourceManager,p=[];r.fetchResources(d,w,p),r.fetchFonts(d,w,p),p.length>0&&await Promise.all(p);const{width:b,height:f}=i,M=h(l,b,f,n),C=r.getEnvelope(d,M,w);if(!C)return null;let R=1,v=0,I=0;switch(u.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>f&&(t=f/C.height),\"preview\"===n&&(C.width<b&&(e=b/C.width),C.height<f&&(t=f/C.height)),R=Math.min(e,t),v=C.x+C.width/2,I=C.y+C.height/2}break;case\"CIMLineSymbol\":{(g||C.height>f)&&(R=f/C.height),I=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,{paths:i}=M;i[0][0][0]-=e/R,i[0][2][0]-=(t-b)/R}break;case\"CIMPolygonSymbol\":{v=C.x+C.width/2,I=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,i=C.y*R+f/2,r=(C.y+C.height)*R+f/2,{rings:a}=M;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>b&&(a[0][1][0]-=t-b,a[0][2][0]-=t-b),r>f&&(a[0][2][1]+=r-f,a[0][3][1]+=r-f)}}const S={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:d}};return this.rasterize(S,b,f,v,I,R,l,1,M)}rasterize(e,r,a,o,l,c,m,g=0,y=null){const{data:u}=e;if(!u||\"CIMSymbolReference\"!==u.type||!u.symbol)return null;const{symbol:d}=u,w=this._canvas,p=(window.devicePixelRatio||1)*n;w.width=r*p,w.height=a*p,m||(m=s(d)),y||(y=h(m,r,a,\"legend\")),w.width+=2*g,w.height+=2*g;const b=w.getContext(\"2d\",{willReadFrequently:!0}),f=t.createIdentity();f.translate(-o,-l),f.scale(c*p,-c*p),f.translate(r*p/2+g,a*p/2+g),b.clearRect(0,0,w.width,w.height);return new i(b,this._cimResourceManager,f,!0).drawSymbol(d,y),b.getImageData(0,0,w.width,w.height)}}function h(e,t,i,r){const a=1,s=-t/2+a,n=t/2-a,o=i/2-a,h=-i/2+a;switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[n,0]]]};default:return\"legend\"===r?{rings:[[[s,o],[n,0],[n,h],[s,h],[s,o]]]}:{rings:[[[s,o],[n,o],[n,h],[s,h],[s,o]]]}}}export{o as CIMSymbolRasterizer};\n"],
  "mappings": "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",
  "names": ["i", "n", "o", "K", "f", "e", "t", "V", "h"]
}
