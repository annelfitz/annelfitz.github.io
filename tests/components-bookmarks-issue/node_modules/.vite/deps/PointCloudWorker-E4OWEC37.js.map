{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/PointCloudWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/arrayUtils.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{conjugate as e}from\"../../../core/libs/gl-matrix-2/math/quat.js\";import{create as o}from\"../../../core/libs/gl-matrix-2/factories/quatf64.js\";import{u as a}from\"../../../chunks/vec32.js\";import{clone as i,create as f}from\"../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import n from\"../../../geometry/SpatialReference.js\";import{projectBuffer as s}from\"../../../geometry/projection/projectBuffer.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as m,filterInPlace as b}from\"./i3s/PointCloudWorkerUtil.js\";import{Obb as p}from\"../support/orientedBoundingBox.js\";class c{transform(t){const e=this._transform(t),o=[e.points.buffer,e.rgb.buffer];null!=e.pointIdFilterMap&&o.push(e.pointIdFilterMap.buffer);for(const a of e.attributes)\"buffer\"in a.values&&r(a.values.buffer)&&a.values.buffer!==e.rgb.buffer&&o.push(a.values.buffer);return Promise.resolve({result:e,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let o=e.length/3,a=null;const i=new Array,f=l(r.primaryAttributeData,e,o);null!=r.primaryAttributeData&&f&&i.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:f});const s=l(r.modulationAttributeData,e,o);null!=r.modulationAttributeData&&s&&i.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:s});let c=m(r.rendererInfo,f,s,o);if(r.filterInfo&&r.filterInfo.length>0&&null!=r.filterAttributesData){const f=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,o),a={attributeInfo:t.attributeInfo,values:r};return i.push(a),a}));a=new Uint32Array(o),o=b(e,c,a,r.filterInfo,f)}for(const t of r.userAttributesData){const r=l(t,e,o);i.push({attributeInfo:t.attributeInfo,values:r})}3*o<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*o))),I(e,o,r.elevationOffset);const A=h(e,o,p.fromData(r.obbData),n.fromJSON(r.inSR),n.fromJSON(r.outSR));return{obbData:r.obbData,points:A,rgb:c,attributes:i,pointIdFilterMap:a}}}function h(t,r,o,n,u){if(!s(t,n,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=i(o.center),m=f(),b=f(),p=i(o.halfSize);e(A,o.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++){let r=3*e;m[0]=t[r]-l[0],m[1]=t[r+1]-l[1],m[2]=t[r+2]-l[2],a(b,m,A),p[0]=Math.max(p[0],Math.abs(b[0])),p[1]=Math.max(p[1],Math.abs(b[1])),p[2]=Math.max(p[2],Math.abs(b[2])),c[r++]=m[0],c[r++]=m[1],c[r]=m[2]}return o.halfSize=p,c}function I(t,r,e){if(0!==e)for(let o=0;o<r;o++)t[3*o+2]+=e}const A=o();function g(){return new c}export{g as default};\n"],
  "mappings": "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",
  "names": ["c", "t", "e", "i", "f", "r", "a", "I", "A", "n", "u"]
}
