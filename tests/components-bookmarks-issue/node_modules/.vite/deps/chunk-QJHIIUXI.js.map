{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/applyEditsUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from\"../../Graphic.js\";import e from\"../../core/Error.js\";import a from\"../../core/Logger.js\";import{getMetersPerCartesianUnitForSR as r}from\"../../core/unitUtils.js\";import{parseData as s}from\"../../core/urlUtils.js\";import{projectWithoutEngine as o}from\"../../geometry/projection.js\";import{fromJSON as n}from\"../../geometry/support/jsonUtils.js\";import{equals as l,isWGS84 as i,isWebMercator as u}from\"../../geometry/support/spatialReferenceUtils.js\";import{isFeatureIdentifierArrayWithGlobalId as d,isFeatureIdentifierArrayWithObjectId as c}from\"./editingSupport.js\";async function p(t,e,a){const{geometry:s}=e,n={...e.attributes};if(null!=a&&\"mesh\"===s?.type){const{transformFieldRoles:e}=a,{origin:d,spatialReference:c,transform:p,vertexSpace:m}=s,f=\"local\"===m.type,g=t.spatialReference,b=g.isGeographic,R=l(g,c),y=R||i(g)&&(i(c)||u(c));if(!(f&&b&&y||!f&&!b&&R))return null;const I=o(d,c,g);if(null==I)return null;if(n[e.originX]=I.x,n[e.originY]=I.y,n[e.originZ]=I.z??0,null!=p){const{translation:t,scale:a,rotation:s}=p,o=f?1:r(c)/r(g);n[e.translationX]=t[0]*o,n[e.translationY]=t[2]*o,n[e.translationZ]=-t[1]*o,n[e.scaleX]=a[0],n[e.scaleY]=a[2],n[e.scaleZ]=a[1],n[e.rotationX]=s[0],n[e.rotationY]=s[2],n[e.rotationZ]=-s[1],n[e.rotationDeg]=s[3]}return{attributes:n}}return null==s?{attributes:n}:\"mesh\"===s.type||\"extent\"===s.type?null:{geometry:s.toJSON(),attributes:n}}async function m(t,e){const a=await Promise.all((e.addAttachments??[]).map((e=>f(t,e)))),r=await Promise.all((e.updateAttachments??[]).map((e=>f(t,e)))),s=e.deleteAttachments??[];return a.length||r.length||s.length?{adds:a,updates:r,deletes:[...s]}:null}async function f(t,e){const{feature:a,attachment:r}=e,{globalId:o,name:n,contentType:l,data:i,uploadId:u}=r,d={globalId:o};if(a&&(\"attributes\"in a?d.parentGlobalId=a.attributes?.[t.globalIdField]:a.globalId&&(d.parentGlobalId=a.globalId)),u)d.uploadId=u;else if(i){const t=await s(i);t&&(d.contentType=t.mediaType,d.data=t.data),i instanceof File&&(d.name=i.name)}return n&&(d.name=n),l&&(d.contentType=l),d}function g(t,e,a){if(!e||0===e.length)return[];if(a&&d(e))return e.map((t=>t.globalId));if(c(e))return e.map((t=>t.objectId));const r=a?t.globalIdField:t.objectIdField;return r?e.map((t=>t.getAttribute(r))):[]}function b(t){const e=t?.assetMaps;if(e){for(const t of e.addResults)t.success||a.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${t.globalId}.`);for(const t of e.updateResults)t.success||a.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${t.globalId}.`)}const r=t?.attachments,s={addFeatureResults:t?.addResults?.map(R)??[],updateFeatureResults:t?.updateResults?.map(R)??[],deleteFeatureResults:t?.deleteResults?.map(R)??[],addAttachmentResults:r?.addResults?r.addResults.map(R):[],updateAttachmentResults:r?.updateResults?r.updateResults.map(R):[],deleteAttachmentResults:r?.deleteResults?r.deleteResults.map(R):[]};return t?.editMoment&&(s.editMoment=t.editMoment),s}function R(t){const a=!0===t.success?null:t.error||{code:void 0,description:void 0};return{objectId:t.objectId,globalId:t.globalId,error:a?new e(\"feature-layer-source:edit-failure\",a.description,{code:a.code}):null}}function y(e,a){return new t({attributes:e.attributes,geometry:n({...e.geometry,spatialReference:a})})}function I(t,e){return{adds:t?.adds?.map((t=>y(t,e)))||[],updates:t?.updates?.map((t=>({original:y(t[0],e),current:y(t[1],e)})))||[],deletes:t?.deletes?.map((t=>y(t,e)))||[],spatialReference:e}}function h(t){const e=t.details.raw,a=+e.code,r=+e.extendedCode;return 500===a&&(-2147217144===r||-2147467261===r)}export{I as createEditedFeatures,R as createFeatureEditResult,m as getAttachmentEditsJSON,g as getFeatureIds,p as getFeatureJSON,h as isProtectedOrPrivateVersionError,b as unpackEditResultData};\n"],
  "mappings": "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",
  "names": ["s", "n", "e", "p", "m", "f", "g", "b", "R", "y", "I", "t", "a"]
}
