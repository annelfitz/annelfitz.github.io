{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import e from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import r from\"../../../../renderers/PointCloudStretchRenderer.js\";import o from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as t,createTypedView as n,readBinaryAttribute as l}from\"./I3SBinaryReader.js\";import{decodeXYZ as s}from\"./LEPCC.js\";function i(t,n,l,s){const{rendererJSON:i,isRGBRenderer:u}=t;let c=null,a=null;if(n&&u)c=n;else if(n&&\"pointCloudUniqueValueRenderer\"===i?.type){a=o.fromJSON(i);const e=a.colorUniqueValueInfos;c=new Uint8Array(3*s);const r=d(a.fieldTransformType);for(let o=0;o<s;o++){const t=(r?r(n[o]):n[o])+\"\";for(let r=0;r<e.length;r++)if(e[r].values.includes(t)){c[3*o]=e[r].color.r,c[3*o+1]=e[r].color.g,c[3*o+2]=e[r].color.b;break}}}else if(n&&\"pointCloudStretchRenderer\"===i?.type){a=r.fromJSON(i);const e=a.stops;c=new Uint8Array(3*s);const o=d(a.fieldTransformType);for(let r=0;r<s;r++){const t=o?o(n[r]):n[r],l=e.length-1;if(t<e[0].value)c[3*r]=e[0].color.r,c[3*r+1]=e[0].color.g,c[3*r+2]=e[0].color.b;else if(t>=e[l].value)c[3*r]=e[l].color.r,c[3*r+1]=e[l].color.g,c[3*r+2]=e[l].color.b;else for(let o=1;o<e.length;o++)if(t<e[o].value){const n=(t-e[o-1].value)/(e[o].value-e[o-1].value);c[3*r]=e[o].color.r*n+e[o-1].color.r*(1-n),c[3*r+1]=e[o].color.g*n+e[o-1].color.g*(1-n),c[3*r+2]=e[o].color.b*n+e[o-1].color.b*(1-n);break}}}else if(n&&\"pointCloudClassBreaksRenderer\"===i?.type){a=e.fromJSON(i);const r=a.colorClassBreakInfos;c=new Uint8Array(3*s);const o=d(a.fieldTransformType);for(let e=0;e<s;e++){const t=o?o(n[e]):n[e];for(let o=0;o<r.length;o++)if(t>=r[o].minValue&&t<=r[o].maxValue){c[3*e]=r[o].color.r,c[3*e+1]=r[o].color.g,c[3*e+2]=r[o].color.b;break}}}else c=new Uint8Array(3*s).fill(255);if(l&&a?.colorModulation){const e=a.colorModulation.minValue,r=a.colorModulation.maxValue,o=.3;for(let t=0;t<s;t++){const n=l[t],s=n>=r?1:n<=e?o:o+(1-o)*(n-e)/(r-e);c[3*t]=s*c[3*t],c[3*t+1]=s*c[3*t+1],c[3*t+2]=s*c[3*t+2]}}return c}function u(e,r){if(null==e.encoding||\"\"===e.encoding){const o=t(r,e);if(null==o.vertexAttributes.position)return;const l=n(r,o.vertexAttributes.position),s=o.header.fields,i=[s.offsetX,s.offsetY,s.offsetZ],u=[s.scaleX,s.scaleY,s.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*u[0]+i[0],a[3*e+1]=l[3*e+1]*u[1]+i[1],a[3*e+2]=l[3*e+2]*u[2]+i[2];return a}if(\"lepcc-xyz\"===e.encoding)return s(r).result}function c(e,r,o){return e?.attributeInfo.useElevation?r?a(r,o):null:e?.attributeInfo.storageInfo?l(e.attributeInfo.storageInfo,e.buffer,o):null}function a(e,r){const o=new Float64Array(r);for(let t=0;t<r;t++)o[t]=e[3*t+2];return o}function f(e,r,o,t,n){const l=e.length/3;let s=0;for(let i=0;i<l;i++){let l=!0;for(let e=0;e<t.length&&l;e++){const{filterJSON:r}=t[e],o=n[e].values[i];switch(r.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===r.mode;r.values.includes(o)===e&&(l=!1);break}case\"pointCloudBitfieldFilter\":{const e=p(r.requiredSetBits),t=p(r.requiredClearBits);((o&e)!==e||o&t)&&(l=!1);break}case\"pointCloudReturnFilter\":{const e=15&o,t=o>>>4&15,n=t>1,s=1===e,i=e===t;let u=!1;for(const o of r.includedReturns)if(\"last\"===o&&i||\"firstOfMany\"===o&&s&&n||\"lastOfMany\"===o&&i&&n||\"single\"===o&&!n){u=!0;break}u||(l=!1);break}}}l&&(o[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],r[3*s]=r[3*i],r[3*s+1]=r[3*i+1],r[3*s+2]=r[3*i+2],s++)}return s}function d(e){switch(e){default:case null:case\"none\":return e=>e;case\"low-four-bit\":return e=>15&e;case\"high-four-bit\":return e=>(240&e)>>4;case\"absolute-value\":return e=>Math.abs(e);case\"modulo-ten\":return e=>e%10}}function p(e){let r=0;for(const o of e||[])r|=1<<o;return r}export{a as elevationFromPositions,i as evaluateRenderer,f as filterInPlace,c as getAttributeValues,u as readGeometry};\n"],
  "mappings": "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",
  "names": ["l", "i", "u", "c", "a", "d", "t", "r", "o", "n", "s", "e"]
}
