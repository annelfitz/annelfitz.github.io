{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/support/previewCIMSymbol.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as r}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as n}from\"../cim/utils.js\";import{SymbolSizeDefaults as a}from\"./previewUtils.js\";import{renderSymbol as o}from\"./renderUtils.js\";const s=new l(null),c=e(a.size),m=e(a.maxSize),u=e(a.lineWidth),f=1;async function h(e,t,i){const l=t?.size;let r=null!=l&&\"object\"==typeof l&&\"width\"in l?l.width:l,n=null!=l&&\"object\"==typeof l&&\"height\"in l?l.height:l;if(null==r||null==n)if(\"esriGeometryPolygon\"===i)r=c,n=c;else{const l=await y(e,t,i);l&&(r=l.width,n=l.height),\"esriGeometryPolyline\"===i&&(r=u),r=null!=r&&isFinite(r)?Math.min(r,m):c,n=null!=n&&isFinite(n)?Math.max(Math.min(n,m),f):c}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(r=u),{width:r,height:n}}async function y(e,t,l){const{feature:n,fieldMap:a,viewParams:o}=t.cimOptions||t,c=await r.resolveSymbolOverrides(e.data,n,null,a,l,null,o);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const m=[];return i.fetchResources(c,s.resourceManager,m),i.fetchFonts(c,s.resourceManager,m),m.length>0&&await Promise.all(m),i.getEnvelope(c,null,s.resourceManager)}async function p(e,i={}){const{node:l,opacity:r,symbolConfig:a}=i,c=null!=a&&\"object\"==typeof a&&\"isSquareFill\"in a&&a.isSquareFill,m=i.cimOptions||i,u=m.geometryType||n(e?.data?.symbol),f=await h(e,i,u),{feature:y,fieldMap:p}=m,d=c||\"esriGeometryPolygon\"!==u?\"preview\":\"legend\",g=await s.rasterizeCIMSymbolAsync(e,y,f,d,p,u,null,m.viewParams,m.allowScalingUp);if(!g)return null;const{width:w,height:b}=g,v=document.createElement(\"canvas\");v.width=w,v.height=b;v.getContext(\"2d\").putImageData(g,0,0);const M=t(f.width),j=t(f.height),S=new Image(M,j);S.src=v.toDataURL(),S.ariaLabel=i.ariaLabel??null,S.alt=i.ariaLabel??\"\",null!=r&&(S.style.opacity=`${r}`);let C=S;if(null!=i.effectView){const e={shape:{type:\"image\",x:0,y:0,width:M,height:j,src:S.src},fill:null,stroke:null,offset:[0,0]};C=o([[e]],[M,j],{effectView:i.effectView,ariaLabel:i.ariaLabel})}return l&&C&&l.appendChild(C),C}export{p as previewCIMSymbol};\n"],
  "mappings": "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",
  "names": ["u", "f", "e", "t", "l", "o", "c", "m", "y", "p"]
}
