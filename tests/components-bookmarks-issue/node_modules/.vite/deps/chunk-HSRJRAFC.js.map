{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../../core/handleUtils.js\";import{Milliseconds as e}from\"../../../../../core/time.js\";import{imageTypeToCanvas as r}from\"../../../../../geometry/support/meshUtils/exporters/gltf/imageutils.js\";import{AnimatedSymbolRepeatType as i}from\"../../../../../symbols/cim/enums.js\";import{getRandomValue as a}from\"../grouping.js\";function n(t){return e(t.frameDurations.reduce(((t,e)=>t+e),0))}function o(t){const{width:e,height:r}=t,i=t.frameDurations.reverse(),a=e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)};return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:a,width:e,height:r}}function s(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map((t=>e(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}function m(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}function u(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class h{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=0;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.None:this._currentFrame-=this._direction;break;case i.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,r,c,f){let l,{repeatType:d}=r;if(null==d&&(d=i.Loop),!0===r.reverseAnimation&&(t=o(t)),null!=r.duration&&(t=s(t,e(1e3*r.duration))),null!=r.repeatDelay){const a=1e3*r.repeatDelay;d===i.Loop?t=u(t,e(a)):d===i.Oscillate&&(t=m(u(t,e(a/2)),e(a/2)))}if(null!=r.startTimeOffset)l=e(1e3*r.startTimeOffset);else if(null!=r.randomizeStartTime){const i=82749913,o=null!=r.randomizeStartSeed?r.randomizeStartSeed:i,s=a(c,o);l=e(s*n(t))}else l=e(0);return new h(t,l,d,f)}function f(e,r,i,a){const n=null==r.playAnimation||r.playAnimation,o=c(e,r,i,a);let s,m=o.timeToFrame;function u(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,u()}),m):void 0}return u(),t((()=>n&&clearTimeout(s)))}let l,d;function g(){return l??=document.createElement(\"canvas\"),d??=l.getContext(\"2d\"),{canvas:l,ctx:d}}function F(t,e,i){const{canvas:a,ctx:n}=g();a.width=e,a.height=i;const o=[],s=t.frameDurations.length;for(let m=0;m<s;m++){const a=t.getFrame(m);n.clearRect(0,0,e,i),a instanceof ImageData?n.drawImage(r(a),0,0,e,i):n.drawImage(a,0,0,e,i),o.push(n.getImageData(0,0,e,i))}return{width:e,height:i,frameDurations:t.frameDurations,getFrame:t=>o[t],frameCount:t.frameCount,duration:t.duration}}export{h as Player,s as adjustDuration,u as appendDelay,c as createPlayer,n as getDuration,f as play,m as prependDelay,F as resize,o as reverse};\n"],
  "mappings": ";;;;;;;;;;;;;;AAIqW,SAASA,GAAE,GAAE;AAAC,SAAO,EAAE,EAAE,eAAe,OAAQ,CAACC,IAAEC,OAAID,KAAEC,IAAG,CAAC,CAAC;AAAC;AAAC,SAASC,GAAE,GAAE;AAAC,QAAK,EAAC,OAAMD,IAAE,QAAO,EAAC,IAAE,GAAE,IAAE,EAAE,eAAe,QAAQ,GAAE,IAAE,CAAAA,OAAG;AAAC,UAAME,KAAE,EAAE,eAAe,SAAO,IAAEF;AAAE,WAAO,EAAE,SAASE,EAAC;AAAA,EAAC;AAAE,SAAM,EAAC,YAAW,EAAE,YAAW,UAAS,EAAE,UAAS,gBAAe,GAAE,UAAS,GAAE,OAAMF,IAAE,QAAO,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAM,GAAE,QAAO,GAAE,UAASF,GAAC,IAAE,GAAEG,KAAE,IAAE,EAAE,UAASE,KAAE,EAAE,eAAe,IAAK,CAAAJ,OAAG,EAAEA,KAAEE,EAAC,CAAE;AAAE,SAAM,EAAC,YAAW,EAAE,YAAW,UAAS,EAAE,UAAS,gBAAeE,IAAE,UAASL,IAAE,OAAM,GAAE,QAAO,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAM,GAAE,QAAO,GAAE,UAASA,GAAC,IAAE,GAAEG,KAAE,EAAE,eAAe,MAAM,GAAEE,KAAEF,GAAE,MAAM;AAAE,SAAOA,GAAE,QAAQ,EAAEE,KAAE,CAAC,CAAC,GAAE,EAAC,YAAW,EAAE,YAAW,UAAS,EAAE,WAAS,GAAE,gBAAeF,IAAE,UAASH,IAAE,OAAM,GAAE,QAAO,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAM,GAAE,QAAO,GAAE,UAASA,GAAC,IAAE,GAAEG,KAAE,EAAE,eAAe,MAAM,GAAEE,KAAEF,GAAE,IAAI;AAAE,SAAOA,GAAE,KAAK,EAAEE,KAAE,CAAC,CAAC,GAAE,EAAC,YAAW,EAAE,YAAW,UAAS,EAAE,WAAS,GAAE,gBAAeF,IAAE,UAASH,IAAE,OAAM,GAAE,QAAO,EAAC;AAAC;AAAC,IAAM,IAAN,MAAO;AAAA,EAAC,YAAY,GAAEE,IAAE,GAAE,GAAE;AAAC,SAAK,aAAW,GAAE,KAAK,cAAY,GAAE,KAAK,eAAa,GAAE,KAAK,aAAW,GAAE,KAAK,gBAAc,GAAE,KAAK,cAAY,KAAK,WAAW,eAAe,KAAK,aAAa;AAAE,QAAI,IAAE;AAAE,WAAKA,KAAE;AAAG,WAAG,KAAK,aAAY,KAAK,UAAU;AAAE,UAAMF,KAAE,KAAK,WAAW,SAAS,KAAK,aAAa;AAAE,SAAK,aAAaA,EAAC;AAAA,EAAC;AAAA,EAAC,YAAW;AAAC,QAAG,KAAK,iBAAe,KAAK,YAAW,KAAK,aAAW,GAAE;AAAC,UAAG,KAAK,kBAAgB,KAAK,WAAW,eAAe;AAAO,gBAAO,KAAK,aAAY;AAAA,UAAC,KAAK,EAAE;AAAK,iBAAK,iBAAe,KAAK;AAAW;AAAA,UAAM,KAAK,EAAE;AAAK,iBAAK,gBAAc;AAAE;AAAA,UAAM,KAAK,EAAE;AAAU,iBAAK,iBAAe,KAAK,YAAW,KAAK,aAAW;AAAA,QAAE;AAAA,IAAC,WAAS,OAAK,KAAK;AAAc,cAAO,KAAK,aAAY;AAAA,QAAC,KAAK,EAAE;AAAK,eAAK,iBAAe,KAAK;AAAW;AAAA,QAAM,KAAK,EAAE;AAAK,eAAK,gBAAc,KAAK,WAAW,eAAe,SAAO;AAAE;AAAA,QAAM,KAAK,EAAE;AAAU,eAAK,iBAAe,KAAK,YAAW,KAAK,aAAW;AAAA,MAAC;AAAC,SAAK,cAAY,KAAK,WAAW,eAAe,KAAK,aAAa;AAAE,UAAM,IAAE,KAAK,WAAW,SAAS,KAAK,aAAa;AAAE,SAAK,aAAa,CAAC;AAAA,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAEM,IAAEC,IAAE;AAAC,MAAI,GAAE,EAAC,YAAWC,GAAC,IAAE;AAAE,MAAG,QAAMA,OAAIA,KAAE,EAAE,OAAM,SAAK,EAAE,qBAAmB,IAAEL,GAAE,CAAC,IAAG,QAAM,EAAE,aAAW,IAAE,EAAE,GAAE,EAAE,MAAI,EAAE,QAAQ,CAAC,IAAG,QAAM,EAAE,aAAY;AAAC,UAAM,IAAE,MAAI,EAAE;AAAY,IAAAK,OAAI,EAAE,OAAK,IAAE,EAAE,GAAE,EAAE,CAAC,CAAC,IAAEA,OAAI,EAAE,cAAY,IAAE,EAAE,EAAE,GAAE,EAAE,IAAE,CAAC,CAAC,GAAE,EAAE,IAAE,CAAC,CAAC;AAAA,EAAE;AAAC,MAAG,QAAM,EAAE;AAAgB,QAAE,EAAE,MAAI,EAAE,eAAe;AAAA,WAAU,QAAM,EAAE,oBAAmB;AAAC,UAAM,IAAE,UAASL,KAAE,QAAM,EAAE,qBAAmB,EAAE,qBAAmB,GAAEE,KAAEH,GAAEI,IAAEH,EAAC;AAAE,QAAE,EAAEE,KAAEL,GAAE,CAAC,CAAC;AAAA,EAAC;AAAM,QAAE,EAAE,CAAC;AAAE,SAAO,IAAI,EAAE,GAAE,GAAEQ,IAAED,EAAC;AAAC;AAAC,SAAS,EAAEL,IAAE,GAAE,GAAE,GAAE;AAAC,QAAMF,KAAE,QAAM,EAAE,iBAAe,EAAE,eAAcG,KAAE,EAAED,IAAE,GAAE,GAAE,CAAC;AAAE,MAAIG,IAAEI,KAAEN,GAAE;AAAY,WAASO,KAAG;AAAC,IAAAL,KAAEL,KAAE,WAAY,MAAI;AAAC,MAAAG,GAAE,UAAU,GAAEM,KAAEN,GAAE,aAAYO,GAAE;AAAA,IAAC,GAAGD,EAAC,IAAE;AAAA,EAAM;AAAC,SAAOC,GAAE,GAAE,EAAG,MAAIV,MAAG,aAAaK,EAAC,CAAE;AAAC;",
  "names": ["n", "t", "e", "o", "r", "s", "c", "f", "d", "m", "u"]
}
