{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import{whenOnce as r}from\"../../../core/reactiveUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{projectDatasetExtent as a}from\"../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{LayerView3D as n}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import{RasterTile as o}from\"../terrain/RasterTile.js\";import m from\"../../layers/ImageryTileLayerView.js\";import p from\"../../layers/LayerView.js\";import h from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as c}from\"../../support/drapedUtils.js\";import{getWebGLCapabilities as d}from\"../../webgl/capabilities.js\";let y=class extends(m(h(l(n(p))))){constructor(){super(...arguments),this.type=\"imagery-tile-3d\",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new t(\"layerview:spatial-reference-incompatible\",\"The layer extent cannot be projected to the view's spatial reference\",{layer:this.layer})));const e=r((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this.layer.tileInfo,r=[\"png\",\"png24\",\"png32\",\"jpg\",\"mixed\"].includes(t.format)&&e.compatibleWith(t);this.isAlignedMapTile=r;const i=r?t:e.toTileInfo();this.tileInfo=i,this._updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition,this.layer.multidimensionalSubset,this.layer.rasterFunction,this.timeExtent]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement(\"canvas\"),t=e.getContext(\"2d\"),[r,i]=this.tileInfo.size;return e.width=r,e.height=i,t.clearRect(0,0,r,i),t.getImageData(0,0,r,i)}get imageFormatIsOpaque(){return\"jpg\"===this.layer.tileInfo.format}get hasMixedImageFormats(){return\"mixed\"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.layer.tileInfo,t=this.tileInfo.lodAt(0)?.scale,r=this.layer.tileInfo.lodAt(e.lods.length-1)?.scale;return this.levelRangeFromScaleRange(t,r)}_getfullExtent(){return a(this.layer.serviceRasterInfo,null!=this.view.basemapTerrain?.spatialReference?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,t,r,i){const s=this.tileInfo,a=this._canSymbolizeInWebGL(),n={tileInfo:s,requestRawData:a,signal:i.signal,timeExtent:this.timeExtent,requestAsImageElement:this.isAlignedMapTile,noClip:!1},{layer:l}=this,m=await l.fetchTile(e,t,r,n);if(m instanceof HTMLImageElement)return m;let p=m?.pixelBlock;if(null==p)return this._blankTile;if(!a&&(p=await l.applyRenderer(m),null==p))return this._blankTile;const h=new o([e,t,r],p,s.size[0],s.size[1]);return a?(h.symbolizerRenderer=l.symbolizer.rendererJSON,h.symbolizerParameters=l.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),h.transformGrid=m.transformGrid,h.bandIds=l.bandIds):(h.isRendereredSource=!0,h.bandIds=null),h.interpolation=l.interpolation,h}_getSymbolizerOptions(e){const t=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:null!=this.view.basemapTerrain?.spatialReference?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return c(e,t,this.view)}refresh(){this.emit(\"data-changed\")}async doRefresh(){this.suspended||this.emit(\"data-changed\")}_canSymbolizeInWebGL(){const e=d(),{symbolizer:t}=this.layer,r=t.lookup?.colormapLut?.indexedColormap,i=!!this.layer.rasterFunction?.hasClipFunction,s=r&&r.length>4*(e.maxTextureSize||4906);return t.canRenderInWebGL&&!s&&!i}};e([i({readOnly:!0})],y.prototype,\"_blankTile\",null),e([i({readOnly:!0})],y.prototype,\"imageFormatIsOpaque\",null),e([i({readOnly:!0})],y.prototype,\"hasMixedImageFormats\",null),e([i({readOnly:!0})],y.prototype,\"dataLevelRange\",null),y=e([s(\"esri.views.3d.layers.ImageryTileLayerView3D\")],y);const u=y;export{u as default};\n"],
  "mappings": "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",
  "names": ["y", "e", "t", "r", "i", "s", "a", "n", "m", "p", "u"]
}
