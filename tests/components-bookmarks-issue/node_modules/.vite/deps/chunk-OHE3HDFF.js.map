{
  "version": 3,
  "sources": ["../../@arcgis/core/versionManagement/support/versionManagementUtils.js", "../../@arcgis/core/layers/mixins/EditBusLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../request.js\";import{generateLowercaseBracedUUID as r}from\"../../core/uuid.js\";const t=r(),n=new Map,o=new Map,s=new Map;async function a(r,t,o){if(!r||!o)return!1;if(!t)return!0;const s=new URL(r).host;let a=n.get(s);if(!a){const t=r.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\");a=(await e(t,{responseType:\"json\",query:{f:\"json\"}})).data.defaultVersionName}return a===t}async function i(e,r,n=!1){if(!e||!r)return!0;const s=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),a=o.get(s)?.entries();if(a)for(const[o,i]of a)if(i.name===r){const e=!i.stack?.hasForwardEdits();if(!e&&n){const[{deleteForwardEdits:e},{default:r}]=await Promise.all([import(\"../../rest/versionManagement/gdbVersion/deleteForwardEdits.js\"),import(\"../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js\")]);return e(s,o,new r({sessionId:t,moment:i.moment}))}return e}return!0}function c(e,r){if(!e)return!1;const t=e.replace(/\\/FeatureServer/i,\"/VersionManagementServer\").replace(/\\/\\d*$/,\"\"),n=o.get(t)?.entries();if(n)for(const[o,s]of n)if(s.name===r){return\"edit\"===s.lockType}return!1}export{t as currentSessionId,n as defaultVersionNameLookup,a as isHistoricVersion,i as isSafeToEditVersion,c as isVersionInEditSession,o as versionCollection,s as versionCollectionCount};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Evented.js\";import{clone as i}from\"../../core/lang.js\";import{createResolver as s}from\"../../core/promiseUtils.js\";import\"../../core/Logger.js\";import\"../../core/has.js\";import\"../../core/Error.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{defaultVersionNameLookup as r,isVersionInEditSession as n}from\"../../versionManagement/support/versionManagementUtils.js\";const o=new t.EventEmitter;function l(e){return o.on(\"apply-edits\",new WeakRef(e))}function a(e){return o.on(\"update-moment\",new WeakRef(e))}function h(e,t,i=null,d=!1){const r=s();return d=null==t||d,o.emit(\"apply-edits\",{serviceUrl:e,layerId:t,gdbVersion:i,mayReceiveServiceEdits:d,result:r.promise}),r}function c(e,t,i=null,s){o.emit(\"update-moment\",{serviceUrl:e,layerId:t,gdbVersion:i,moment:s})}const u=Symbol();function m(e){return null!=e&&\"object\"==typeof e&&u in e}function p(e){return null!=e&&\"object\"==typeof e&&\"gdbVersion\"in e}function b(e,t,i){const s=new URL(e).host,d=r.get(s),n=e=>!e||e===d;return n(t)&&n(i)||t===i}const g=t=>{var s;let r=class extends t{constructor(...e){super(...e),this[s]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:s,gdbVersion:d,mayReceiveServiceEdits:r,result:o}=e,l=t===this.url,a=null!=s&&null!=this.layerId&&s===this.layerId,h=p(this),c=p(this)&&b(t,d,this.gdbVersion);if(!l||h&&!c||!a&&!r)return;const u=o.then((e=>{if(a&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit(\"edits\",i(e)),e;const t=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(t){const{adds:s,updates:d,deletes:r}=t.editedFeatures,n={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:s?s.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:r?r.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:d?d.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:i(e.editedFeatures),exceededTransferLimit:!1,historicMoment:i(e.historicMoment)};return this.emit(\"edits\",n),n}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:i(e.editedFeatures),exceededTransferLimit:!1,historicMoment:i(e.historicMoment)}})).then((e=>(\"historicMoment\"in this&&this.historicMoment!==e.historicMoment&&n(t,d)&&(this.historicMoment=e.historicMoment),e)));this.emit(\"apply-edits\",{result:u})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:i,moment:s}=e,d=t===this.url,r=p(this),n=p(this)&&b(t,i,this.gdbVersion),o=p(this)&&!b(t,this.gdbVersion,null);d&&r&&n&&o&&\"historicMoment\"in this&&this.historicMoment!==s&&(this.historicMoment=s)},this.when().then((()=>{this.addHandles(l(this._applyEditsHandler)),\"historicMoment\"in this&&this.addHandles(a(this._updateMomentHandler))}),(()=>{}))}};return s=u,r=e([d(\"esri.layers.mixins.EditBusLayer\")],r),r};export{g as EditBusLayer,h as emitApplyEditsEvent,c as emitUpdateMomentEvent,m as isEditBusLayer,p as isLayerWithGDBVersion,l as onApplyEditsEvent,a as onUpdateMomentEvent,b as versionMatches};\n"],
  "mappings": "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",
  "names": ["o", "a", "t", "s", "e", "n", "i", "r", "o", "e", "a", "t", "i", "c", "s", "n", "r", "l", "h", "u", "d"]
}
