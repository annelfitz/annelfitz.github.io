{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/terrain/RasterTile.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t}from\"../../../core/maybe.js\";import{C as e}from\"../../../chunks/RasterColorizer.glsl.js\";import{TextureSamplingMode as r}from\"../../webgl/enums.js\";import{createTransformTexture as s,getCommonUniforms as i,getColormapUniforms as o,getStretchUniforms as a,getShadedReliefUniforms as l,createRasterTexture as h,createColormapTexture as n}from\"../../webgl/rasterUtils.js\";const u={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:\"none\",type:\"stretch\"};class m{constructor(t,e,r=null,s=null){this.lij=t,this.type=\"raster-tile\",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.opacity=1,this.source=e,this.width=r||e.width,this.height=s||e.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=t(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...u,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||u}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){if(null!=t&&t.length>0){this._bandIds&&t.every(((t,e)=>!!this._bandIds?.[e]&&t===this._bandIds[e]))||(this._bandIds=t,this._dirty=!0)}else this._bandIds=null}get interpolation(){return this._interpolation||\"nearest\"}set interpolation(t){if(this._interpolation=t,null!=this._rasterTexture){const e=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(\"bilinear\"===e?r.LINEAR:r.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=t(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(t,this.bandIds),null!=this._rasterTexture&&(this._updateColormapTexture(t),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=s(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:s,height:h,opacity:n}=this,u=i(r,[s,h],[this.source.width,this.source.height],n),m=o(t.colormap,t.colormapOffset),d=\"stretch\"===this.symbolizerParameters.type?a(this.symbolizerParameters):null,_=\"hillshade\"===this.symbolizerParameters.type?l(this.symbolizerParameters):null;return new e(u,m,d||_,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:t}=this;return\"bilinear\"===this.interpolation&&null!=t.colormap&&\"stretch\"===t.type}get memoryUsage(){if(null==this._memoryUsed){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map((t=>null!=t?t.descriptor.width*t.descriptor.height*4:0)).reduce(((t,e)=>t+e),0)}return this._memoryUsed}release(){return this._rasterTexture=t(this._rasterTexture),this._transformGridTexture=t(this._transformGridTexture),this._colormapTexture=t(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const s=this.source?this.source.extractBands(r):null;if(!(s&&s.pixels&&s.pixels.length>0))return void(this._rasterTexture=t(this._rasterTexture));const i=null==r&&null==this.bandIds||null!=r&&null!=this.bandIds&&r.join(\"\")===this.bandIds.join(\"\");if(null!=this._rasterTexture&&i)return;this._rasterTexture=t(this._rasterTexture);const o=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=h(e,s,o,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return\"stretchType\"in this.symbolizerParameters&&\"none\"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&\"u8\"===this.source.pixelType}_getRasterTextureInterpolation(t){return\"lut\"===this.symbolizerParameters.type||\"nearest\"===t||\"majority\"===t||this.isBilinearWithStretchColorRamp?\"nearest\":\"bilinear\"}_updateColormapTexture(e){const r=this._colormap,s=this.symbolizerParameters.colormap;return s?r?s.length!==r.length||s.some(((t,e)=>t!==r[e]))?(this._colormapTexture=t(this._colormapTexture),this._colormapTexture=n(e,s),void(this._colormap=s)):void 0:(this._colormapTexture=n(e,s),void(this._colormap=s)):(this._colormapTexture=t(this._colormapTexture),void(this._colormap=null))}}export{m as RasterTile};\n"],
  "mappings": "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",
  "names": ["m", "r", "t", "u", "_", "e"]
}
