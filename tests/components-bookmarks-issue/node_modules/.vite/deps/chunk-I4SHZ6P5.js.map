{
  "version": 3,
  "sources": ["../../@arcgis/core/core/support/UpdatingHandles.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import e from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends e{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(s,e,t={}){return this._installWatch(s,e,t,i)}addWhen(s,e,t={}){return this._installWatch(s,e,t,n)}addOnCollectionChange(s,e,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(s,\"after-changes\",this._createSyncUpdatingCallback(),a),d(s,\"change\",e,{onListenerAdd:i?s=>e({added:s.toArray(),removed:[]}):void 0,onListenerRemove:n?s=>e({added:[],removed:s.toArray()}):void 0})],r),t((()=>this.removeHandles(r)))}addPromise(s){if(null==s)return s;const e=++this._handleId;this.addHandles(t((()=>{this._pendingPromises.delete(s)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))})),e),this._pendingPromises.add(s),this._set(\"updating\",!0);const i=()=>this.removeHandles(e);return s.then(i,i),s}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(s,e,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(s,d);const a=n(s,e,i);return this.addHandles(a,d),t((()=>this.removeHandles(d)))}_installSyncUpdatingWatch(s,e){const t=this._createSyncUpdatingCallback(),n=i(s,t,{sync:!0,equals:()=>!1});return this.addHandles(n,e),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const s=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r((()=>{s===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))})),c)}}};s([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=s([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n"],
  "mappings": "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",
  "names": ["e", "v", "s", "d", "a"]
}
