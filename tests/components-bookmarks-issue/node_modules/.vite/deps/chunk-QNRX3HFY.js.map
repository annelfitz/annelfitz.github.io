{
  "version": 3,
  "sources": ["../../@arcgis/core/widgets/support/AnalysisViewModel.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import{createTask as s}from\"../../core/asyncUtils.js\";import i from\"../../core/Logger.js\";import{abortMaybe as n,removeMaybe as r}from\"../../core/maybe.js\";import{throwIfAborted as a,isAbortError as o,isAborted as l}from\"../../core/promiseUtils.js\";import{watch as h,syncAndInitial as c,sync as w,whenOnce as y,when as p}from\"../../core/reactiveUtils.js\";import{property as u}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";var v;!function(e){e[e.PENDING=0]=\"PENDING\",e[e.WAIT_FOR_VIEW_READY=1]=\"WAIT_FOR_VIEW_READY\",e[e.RUNNING=2]=\"RUNNING\"}(v||(v={}));let _=class extends t{constructor(e={}){super(e),this.view=null,this.analysisView=null,this._reconnectViewTask=null,this._forceInteractiveHandle=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const t=e?.analysis;null!=t?this.analysis=t:(this._set(\"analysis\",this.constructAnalysis()),this._set(\"isAnalysisOwner\",!0)),null!=e?.visible&&(this.visible=e.visible)}normalizeCtorArgs(e){const{analysis:t,...s}=e;return s}initialize(){this.addHandles([h((()=>({readyAndNotSupported:null!=this.view&&this.view.ready&&!this.supported})),(({readyAndNotSupported:e})=>{e&&i.getLogger(this).errorOnce(this.unsupportedErrorMessage)}),c),h((()=>this.analysis?.parent),(e=>{this._parentChangeFromReconnect||e===this.view||this._set(\"isAnalysisOwner\",!1);const t=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,t&&this._scheduleViewReconnect()}),w),h((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),(({view:e},t)=>{const s=t?.view;e!==s&&(this._startUserOperation=n(this._startUserOperation),this._disconnectFromView(s)),this._scheduleViewReconnect()}),c)])}destroy(){this._reconnectViewTask=n(this._reconnectViewTask),this._startUserOperation=n(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),this._set(\"view\",null),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set(\"analysis\",null))}get supported(){return null==this.view||this.view.type===this.supportedViewType}set visible(e){this._set(\"visible\",e),null!=this.analysisView&&(this.analysisView.visible=e)}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}set analysis(e){e!==this._get(\"analysis\")&&(this._startUserOperation=n(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(e),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get(\"isAnalysisOwner\")}get tool(){return null!=this.analysisView?this.analysisView.tool:null}clear(){this._startUserOperation=n(this._startUserOperation),this._resetInteractiveCreationState(),null!=this.tool&&null!=this.view&&this.view.activeTool===this.tool&&(this.view.activeTool=null)}async start(){if(!this.visible)return void i.getLogger(this).warn(\"Cannot start analysis when not visible\");this.clear();const e={task:null,abort:null,state:v.PENDING},t=s((async t=>{if(e.state=v.WAIT_FOR_VIEW_READY,await y((()=>this.ready),t),e.state=v.RUNNING,null==this.analysisView||null==this.view)return;const s=this.analysisView.tool;null!=s&&(this.view.activeTool=s,p((()=>s.created),(()=>{s.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0}))}));return e.task=t,e.abort=()=>t.abort(),this._startUserOperation=e,t.promise}onConnectToAnalysisView(e){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=n(this._reconnectViewTask);const e=s((async t=>{try{await this._reconnectView(t)}catch(s){if(a(t),!o(s))return void i.getLogger(this).warn(\"Failed to use analysis in view model\",s);throw s}finally{e===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=e}async _reconnectView(e){const{view:t}=this,s=null!=t&&t.ready&&this.supported,n=this.analysis;if(this._startUserOperation=V(this._startUserOperation),this._disconnectFromView(t),s&&null!=t&&null!=n){if(this.isAnalysisOwner){if(null!=n.parent)return void i.getLogger(this).errorOnce(\"expected owned analysis to have null parent when connecting to view\");this._parentChangeFromReconnect=!0,t.analyses.add(n)}this.analysisView=await t.whenAnalysisView(n),l(e)?this._startUserOperation=V(this._startUserOperation):(this.analysisView.visible=this.visible,this._forceInteractiveHandle=this.analysisView.forceInteractiveForViewModel(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(this.analysisView))}}_disconnectFromView(e){null!=e&&this.isAnalysisOwner&&e.analyses.includes(this.analysis)&&(this._parentChangeFromReconnect=!0,this.analysis.clear(),e.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=r(this._forceInteractiveHandle),this.analysisView=null}_setExternalAnalysis(e){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=void 0,this._forceInteractiveHandle=r(this._forceInteractiveHandle)),this.analysisView=null,this._set(\"isAnalysisOwner\",!1),this._set(\"analysis\",e),this._parentChangeFromReconnect=!1}_resetInteractiveCreationState(){this.analysis.clear(),null!=this.tool&&this.tool.resetCreated()}get testInfo(){return{analysisView:this.analysisView}}};function V(e){return null!=e&&e.state>=v.RUNNING?(e.abort(),null):e}e([u()],_.prototype,\"supported\",null),e([u()],_.prototype,\"view\",void 0),e([u({type:Boolean,value:!0})],_.prototype,\"visible\",null),e([u()],_.prototype,\"active\",null),e([u()],_.prototype,\"disabled\",null),e([u({nonNullable:!0})],_.prototype,\"analysis\",null),e([u()],_.prototype,\"analysisView\",void 0),e([u()],_.prototype,\"ready\",null),e([u()],_.prototype,\"connectingToView\",null),e([u({readOnly:!0})],_.prototype,\"isAnalysisOwner\",null),e([u()],_.prototype,\"_reconnectViewTask\",void 0),e([u()],_.prototype,\"_forceInteractiveHandle\",void 0),e([u()],_.prototype,\"tool\",null),_=e([d(\"esri.widgets.support.AnalysisViewModel\")],_);export{_ as AnalysisViewModel};\n"],
  "mappings": "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",
  "names": ["e", "s", "d", "t", "n"]
}
