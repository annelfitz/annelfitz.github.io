import {
  e as e5,
  f2 as f3,
  l as l2,
  l2 as l3,
  n,
  n3 as n2,
  o as o2,
  o2 as o3,
  o3 as o4,
  o4 as o5,
  r as r4
} from "./chunk-VVAVEXL2.js";
import {
  e as e4,
  f as f2
} from "./chunk-BKBB7AOV.js";
import {
  e as e3
} from "./chunk-H7T5AB2S.js";
import {
  r as r5
} from "./chunk-HXYRQKMI.js";
import {
  D
} from "./chunk-WKVHVZW2.js";
import {
  h,
  l
} from "./chunk-3RIV3ECV.js";
import "./chunk-WEER6QME.js";
import {
  c,
  m,
  w
} from "./chunk-IYU3Q2BA.js";
import "./chunk-L52HB3KV.js";
import "./chunk-TXLJQAAN.js";
import {
  V
} from "./chunk-XJICXW6N.js";
import "./chunk-YF5E2R37.js";
import "./chunk-R4SGP2EA.js";
import {
  E,
  L,
  O,
  T,
  c as c2,
  i,
  u as u2,
  x
} from "./chunk-IRL6OOVK.js";
import "./chunk-3AIILHI5.js";
import "./chunk-QJRGTKPN.js";
import "./chunk-VIH3KDZO.js";
import {
  a,
  e2,
  f,
  o
} from "./chunk-LA365FE7.js";
import "./chunk-DVIGFJWY.js";
import "./chunk-WIVZ7SMV.js";
import "./chunk-O76UVYOO.js";
import "./chunk-QCMUK3QA.js";
import {
  j
} from "./chunk-HZSGATFT.js";
import "./chunk-KNMQQRV7.js";
import "./chunk-N5GQOIDP.js";
import {
  e
} from "./chunk-NFB6O77E.js";
import {
  r as r3
} from "./chunk-AKEHDP75.js";
import "./chunk-5MMGIT64.js";
import "./chunk-SCHTG6ZQ.js";
import "./chunk-HWHMO3CO.js";
import "./chunk-R4CJB3GP.js";
import {
  u
} from "./chunk-WDPG5BMO.js";
import "./chunk-TGXFDJCS.js";
import "./chunk-VBUVOOM6.js";
import "./chunk-CZSTCON2.js";
import "./chunk-2ICUS4HL.js";
import "./chunk-ZXJ6I4RF.js";
import "./chunk-GBF2OQAY.js";
import "./chunk-WNNYD62G.js";
import "./chunk-HV6S3GY2.js";
import "./chunk-IGR2BTWR.js";
import "./chunk-C7NPPGFR.js";
import "./chunk-ZPYA32PH.js";
import {
  M,
  _
} from "./chunk-OCF7OAES.js";
import "./chunk-JZBR4X6W.js";
import {
  r as r2
} from "./chunk-OIJCMME5.js";
import "./chunk-4KLYOMH2.js";
import "./chunk-IZKCZQUY.js";
import "./chunk-M5ZB5S5C.js";
import "./chunk-MBGZKT2Z.js";
import "./chunk-UWQ3OYA5.js";
import "./chunk-ORO4D3FB.js";
import "./chunk-YOPMY6TS.js";
import "./chunk-VIN55KNF.js";
import "./chunk-IOB3DJMR.js";
import "./chunk-BPRXWDBO.js";
import "./chunk-RUN6MNXL.js";
import {
  U
} from "./chunk-SAYWXQVM.js";
import "./chunk-SBL4URUW.js";
import "./chunk-BVQWKK2V.js";
import "./chunk-D25BO7X7.js";
import "./chunk-NDIXNREV.js";
import {
  r2 as r
} from "./chunk-I2RC5KWA.js";
import "./chunk-SSFWZSUM.js";
import "./chunk-2F6FFF5T.js";
import "./chunk-C26KUZ46.js";
import "./chunk-JGDJR5EV.js";
import "./chunk-QHK5ZYFW.js";
import "./chunk-L65HKN25.js";
import "./chunk-7RBRCL6S.js";
import "./chunk-J2EGIWT6.js";
import "./chunk-Z4ZPL3B3.js";

// node_modules/@arcgis/core/chunks/mat3.js
function e6(e8, t4, o8) {
  const r7 = e8.typedBuffer, f4 = e8.typedBufferStride, d = t4.typedBuffer, n3 = t4.typedBufferStride, c3 = o8 ? o8.count : t4.count;
  let u4 = ((o8 == null ? void 0 : o8.dstIndex) ?? 0) * f4, l4 = ((o8 == null ? void 0 : o8.srcIndex) ?? 0) * n3;
  for (let p = 0; p < c3; ++p) {
    for (let e9 = 0; e9 < 9; ++e9)
      r7[u4 + e9] = d[l4 + e9];
    u4 += f4, l4 += n3;
  }
}
var t = Object.freeze(Object.defineProperty({ __proto__: null, copy: e6 }, Symbol.toStringTag, { value: "Module" }));

// node_modules/@arcgis/core/chunks/mat4.js
function e7(e8, t4, o8) {
  const r7 = e8.typedBuffer, f4 = e8.typedBufferStride, d = t4.typedBuffer, n3 = t4.typedBufferStride, c3 = o8 ? o8.count : t4.count;
  let u4 = ((o8 == null ? void 0 : o8.dstIndex) ?? 0) * f4, l4 = ((o8 == null ? void 0 : o8.srcIndex) ?? 0) * n3;
  for (let p = 0; p < c3; ++p) {
    for (let e9 = 0; e9 < 16; ++e9)
      r7[u4 + e9] = d[l4 + e9];
    u4 += f4, l4 += n3;
  }
}
var t2 = Object.freeze(Object.defineProperty({ __proto__: null, copy: e7 }, Symbol.toStringTag, { value: "Module" }));

// node_modules/@arcgis/core/geometry/support/buffer/utils.js
function r6(s, r7) {
  return new s(new ArrayBuffer(r7 * s.ElementCount * e3(s.ElementType)));
}

// node_modules/@arcgis/core/geometry/support/meshUtils/loadGLTFMesh.js
async function N(e8, t4, r7) {
  const o8 = new n2(z(r7)), n3 = (await l3(o8, t4, r7, true)).model, s = n3.lods.shift(), a2 = /* @__PURE__ */ new Map(), i2 = /* @__PURE__ */ new Map();
  n3.textures.forEach((e9, t5) => a2.set(t5, H(e9))), n3.materials.forEach((e9, t5) => i2.set(t5, J(e9, a2)));
  const l4 = Q(s);
  for (const p of l4.parts)
    W(l4, p, i2);
  const { position: u4, normal: c3, tangent: f4, color: m2, texCoord0: g } = l4.vertexAttributes, x2 = { position: u4.typedBuffer, normal: null != c3 ? c3.typedBuffer : null, tangent: null != f4 ? f4.typedBuffer : null, uv: null != g ? g.typedBuffer : null, color: null != m2 ? m2.typedBuffer : null }, d = V(x2, e8, r7);
  return { transform: d.transform, vertexSpace: d.vertexSpace, components: l4.components, spatialReference: e8.spatialReference, vertexAttributes: new l({ position: d.vertexAttributes.position, normal: d.vertexAttributes.normal, tangent: d.vertexAttributes.tangent, color: x2.color, uv: x2.uv }) };
}
function z(e8) {
  const r7 = e8 == null ? void 0 : e8.resolveFile;
  return r7 ? { busy: false, request: async (e9, o8, n3) => {
    const s = (r7 == null ? void 0 : r7(e9)) ?? e9, a2 = "image" === o8 ? "image" : "binary" === o8 ? "array-buffer" : "json";
    return (await U(s, { responseType: a2, signal: n3 == null ? void 0 : n3.signal, timeout: 0 })).data;
  } } : null;
}
function G(e8, t4) {
  if (null == e8)
    return "-";
  const o8 = e8.typedBuffer;
  return `${r(t4, o8.buffer, () => t4.size)}/${o8.byteOffset}/${o8.byteLength}`;
}
function K(e8) {
  return null != e8 ? e8.toString() : "-";
}
function Q(e8) {
  let t4 = 0;
  const has = { color: false, tangent: false, normal: false, texCoord0: false }, o8 = /* @__PURE__ */ new Map(), n3 = /* @__PURE__ */ new Map(), s = [];
  for (const a2 of e8.parts) {
    const { attributes: { position: e9, normal: i2, color: l4, tangent: u4, texCoord0: c3 } } = a2, f4 = `
      ${G(e9, o8)}/
      ${G(i2, o8)}/
      ${G(l4, o8)}/
      ${G(u4, o8)}/
      ${G(c3, o8)}/
      ${K(a2.transform)}
    `;
    let m2 = false;
    const p = r(n3, f4, () => (m2 = true, { start: t4, length: e9.count }));
    m2 && (t4 += e9.count), i2 && (has.normal = true), l4 && (has.color = true), u4 && (has.tangent = true), c3 && (has.texCoord0 = true), s.push({ gltf: a2, writeVertices: m2, region: p });
  }
  return { vertexAttributes: { position: r6(T, t4), normal: has.normal ? r6(i, t4) : null, tangent: has.tangent ? r6(c2, t4) : null, color: has.color ? r6(x, t4) : null, texCoord0: has.texCoord0 ? r6(u2, t4) : null }, parts: s, components: [] };
}
function H(e8) {
  return new w({ data: (r5(e8.data), e8.data), wrap: Z(e8.parameters.wrap) });
}
function J(t4, r7) {
  const o8 = new u(re(t4.color, t4.opacity)), s = t4.emissiveFactor ? new u(oe(t4.emissiveFactor)) : null, a2 = (e8) => e8 ? new c({ scale: e8.scale ? [e8.scale[0], e8.scale[1]] : [1, 1], rotation: M(e8.rotation ?? 0), offset: e8.offset ? [e8.offset[0], e8.offset[1]] : [0, 0] }) : null;
  return new m({ color: o8, colorTexture: r7.get(t4.textureColor), normalTexture: r7.get(t4.textureNormal), emissiveColor: s, emissiveTexture: r7.get(t4.textureEmissive), occlusionTexture: r7.get(t4.textureOcclusion), alphaMode: Y(t4.alphaMode), alphaCutoff: t4.alphaCutoff, doubleSided: t4.doubleSided, metallic: t4.metallicFactor, roughness: t4.roughnessFactor, metallicRoughnessTexture: r7.get(t4.textureMetallicRoughness), colorTextureTransform: a2(t4.colorTextureTransform), normalTextureTransform: a2(t4.normalTextureTransform), occlusionTextureTransform: a2(t4.occlusionTextureTransform), emissiveTextureTransform: a2(t4.emissiveTextureTransform), metallicRoughnessTextureTransform: a2(t4.metallicRoughnessTextureTransform) });
}
function W(e8, t4, r7) {
  t4.writeVertices && X(e8, t4);
  const { indices: o8, attributes: n3, primitiveType: s, material: a2 } = t4.gltf;
  let i2 = o4(o8 || n3.position.count, s);
  const l4 = t4.region.start;
  if (l4) {
    const e9 = new Uint32Array(i2);
    for (let t5 = 0; t5 < i2.length; t5++)
      e9[t5] += l4;
    i2 = e9;
  }
  e8.components.push(new h({ name: t4.gltf.name, faces: i2, material: r7.get(a2), shading: n3.normal ? "source" : "flat", trustSourceNormals: true }));
}
function X(e8, t4) {
  const { position: r7, normal: n3, tangent: i2, color: l4, texCoord0: u4 } = e8.vertexAttributes, c3 = t4.region.start, { attributes: f4, transform: m2 } = t4.gltf, p = f4.position.count;
  if (e2(r7.slice(c3, p), f4.position, m2), null != f4.normal && null != n3) {
    const e9 = j(e(), m2), t5 = n3.slice(c3, p);
    f(t5, f4.normal, e9), _(e9) && a(t5, t5);
  } else
    null != n3 && f2(n3, 0, 0, 1, { dstIndex: c3, count: p });
  if (null != f4.tangent && null != i2) {
    const e9 = j(e(), m2), t5 = i2.slice(c3, p);
    r4(t5, f4.tangent, e9), _(e9) && n(t5, t5);
  } else
    null != i2 && f3(i2, 0, 0, 1, 1, { dstIndex: c3, count: p });
  if (null != f4.texCoord0 && null != u4 ? o3(u4.slice(c3, p), f4.texCoord0) : null != u4 && l2(u4, 0, 0, { dstIndex: c3, count: p }), null != f4.color && null != l4) {
    const e9 = f4.color, t5 = l4.slice(c3, p);
    if (4 === e9.elementCount)
      e9 instanceof c2 ? o2(t5, e9, 255) : e9 instanceof x ? e5(t5, e9) : e9 instanceof L && o2(t5, e9, 1 / 256);
    else {
      f3(t5, 255, 255, 255, 255);
      const r8 = O.fromTypedArray(t5.typedBuffer, t5.typedBufferStride);
      e9 instanceof i ? o(r8, e9, 255) : e9 instanceof O ? e4(r8, e9) : e9 instanceof E && o(r8, e9, 1 / 256);
    }
  } else
    null != l4 && f3(l4.slice(c3, p), 255, 255, 255, 255);
}
function Y(e8) {
  switch (e8) {
    case "OPAQUE":
      return "opaque";
    case "MASK":
      return "mask";
    case "BLEND":
      return "blend";
  }
}
function Z(e8) {
  return { horizontal: ee(e8.s), vertical: ee(e8.t) };
}
function ee(e8) {
  switch (e8) {
    case D.CLAMP_TO_EDGE:
      return "clamp";
    case D.MIRRORED_REPEAT:
      return "mirror";
    case D.REPEAT:
      return "repeat";
  }
}
function te(e8) {
  return e8 ** (1 / o5) * 255;
}
function re(e8, t4) {
  return r3(te(e8[0]), te(e8[1]), te(e8[2]), t4);
}
function oe(e8) {
  return r2(te(e8[0]), te(e8[1]), te(e8[2]));
}
export {
  N as loadGLTFMesh
};
//# sourceMappingURL=loadGLTFMesh-RURX4BWJ.js.map
