{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/data/StreamFeatureManager.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/CircularArray.js\";import{clamp as e}from\"../../../core/mathUtils.js\";const s=\"__esri_stream_id__\",i=\"__esri_timestamp__\",r=1e3;class o{constructor(t,e,i,r,o=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=r,this.store=t,this.objectIdField=e,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===s}removeById(t){this._removed.push(t)}removeByTrackId(t){const e=this._trackIdToObservations.get(t);if(e)for(const s of e.entries)this._removed.push(s)}add(s){if(this._useGeneratedIds){const t=this._nextId();s.attributes[this.objectIdField]=t,s.objectId=t}else s.objectId=s.attributes[this.objectIdField];const i=s.objectId;if(this._addOrUpdated.set(i,s),this._maxAge=Math.max(this._maxAge,s.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new t(1e5)),void this._trackIdLessObservations.enqueue(i);const o=s.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(o)){const s=null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:r,i=e(s,0,r);this._trackIdToObservations.set(o,new t(i))}const d=this._trackIdToObservations.get(o),a=d?.enqueue(i);null!=a&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}checkForUpdates(){const t=this._getToAdd(),e=this._getToRemove(),s=performance.now();s-this._lastPurge>=this.purgeInterval&&(this._purge(s),this._lastPurge=s);const r=[];if(null!=e)for(const i of e){const t=this.store.removeById(i);null!=t&&r.push(t)}const o=[];if(null!=t){const r=new Set(e??[]);for(const e of t)r.has(e.objectId)||(e.attributes[i]=s,this.store.add(e),o.push(e))}return!(!o.length&&!r?.length)&&(this.store.update(o,r),!0)}_getToAdd(){if(!this._addOrUpdated.size)return null;const t=new Array(this._addOrUpdated.size);let e=0;return this._addOrUpdated.forEach((s=>t[e++]=s)),this._addOrUpdated.clear(),t}_getToRemove(){const t=this._removed;return this._removed.length?(this._removed=[],t):null}_nextId(){const t=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,t}_purge(t){const e=this._purgeOptions;null!=e&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeByAgeReceived(t,e),this._purgeTracks())}_purgeSomeByDisplayCount(t){if(!t.displayCount)return;let e=this.store.size;if(e>t.displayCount){if(this._timeInfo.trackIdField)for(const s of this._trackIdToObservations.values())if(e>t.displayCount&&s.size){const t=s.dequeue();this._removed.push(t),e--}if(null!=this._trackIdLessObservations){let s=e-t.displayCount;for(;s-- >0;){const t=this._trackIdLessObservations.dequeue();null!=t&&this._removed.push(t)}}}}_purgeByAge(t){const e=this._timeInfo?.startTimeField;if(!t.age||!e)return;const s=60*t.age*1e3,i=this._maxAge-s;this.store.forEach((t=>{t.attributes[e]<i&&this._removed.push(t.objectId)}))}_purgeByAgeReceived(t,e){if(!e.ageReceived)return;const s=t-60*e.ageReceived*1e3;this.store.forEach((t=>{t.attributes[i]<s&&this._removed.push(t.objectId)}))}_purgeTracks(){this._trackIdToObservations.forEach(((t,e)=>{0===t.size&&this._trackIdToObservations.delete(e)}))}}export{o as StreamFeatureManager,s as defaultStreamIdField,i as esriTimestamp};\n"],
  "mappings": "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",
  "names": ["t", "e", "i", "r", "o", "s"]
}
