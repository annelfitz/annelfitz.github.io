{
  "version": 3,
  "sources": ["../../@arcgis/core/widgets/support/InteractiveAnalysisViewModel.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import{createTask as t}from\"../../core/asyncUtils.js\";import i from\"../../core/Logger.js\";import{abortMaybe as e}from\"../../core/maybe.js\";import{throwIfAborted as n,isAbortError as a,isAborted as r}from\"../../core/promiseUtils.js\";import{watch as o,sync as l,syncAndInitial as c,whenOnce as h}from\"../../core/reactiveUtils.js\";import{property as y}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{subclass as w}from\"../../core/accessorSupport/decorators/subclass.js\";import{InteractiveToolViewModel as p}from\"./InteractiveToolViewModel.js\";var u;!function(s){s[s.PENDING=0]=\"PENDING\",s[s.WAIT_FOR_VIEW_READY=1]=\"WAIT_FOR_VIEW_READY\",s[s.RUNNING=2]=\"RUNNING\"}(u||(u={}));let _=class extends p{constructor(s={}){super(s),this.analysisView=null,this._reconnectViewTask=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const t=s?.analysis;null!=t?this.analysis=t:(this._set(\"analysis\",this.constructAnalysis()),this._set(\"isAnalysisOwner\",!0))}normalizeCtorArgs(s){const{analysis:t,...i}=s;return i}initialize(){this.addHandles([o((()=>this.analysis?.parent),(s=>{this._parentChangeFromReconnect||s===this.view||this._set(\"isAnalysisOwner\",!1);const t=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,t&&this._scheduleViewReconnect()}),l),o((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),(({view:s},t)=>{const i=t?.view;s!==i&&(this._startUserOperation=e(this._startUserOperation),this._disconnectFromView(i)),this._scheduleViewReconnect()}),c),o((()=>this.analysis.isEditable),((s,t)=>{null!=this.analysisView&&(s&&!t&&null==this.tool?this.createTool():s||!t||null==this.tool||this.tool.active||this.removeTool())}))])}destroy(){this._reconnectViewTask=e(this._reconnectViewTask),this._startUserOperation=e(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set(\"analysis\",null))}set analysis(s){s!==this._get(\"analysis\")&&(this._startUserOperation=e(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(s),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get(\"isAnalysisOwner\")}set visible(s){this._set(\"visible\",s),null!=this.analysisView&&(this.analysisView.visible=s)}async start(){if(!this.visible)return void i.getLogger(this).warn(\"Cannot start analysis when not visible\");this.clear();const s={task:null,abort:null,state:u.PENDING},e=t((async t=>{s.state=u.WAIT_FOR_VIEW_READY,await h((()=>this.ready),t),s.state=u.RUNNING,this.createTool({interactive:!0})}));return s.task=e,s.abort=()=>e.abort(),this._startUserOperation=s,e.promise}clear(){this._startUserOperation=e(this._startUserOperation),this.removeTool(),this.analysis.clear()}onConnectToAnalysisView(s){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=e(this._reconnectViewTask);const s=t((async t=>{try{await this._reconnectView(t)}catch(e){if(n(t),!a(e))return void i.getLogger(this).warn(\"Failed to use analysis in view model\",e);throw e}finally{s===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=s}async _reconnectView(s){const{view:t}=this,i=null!=t&&t.ready&&this.supported,e=this.analysis;if(this._startUserOperation=V(this._startUserOperation),this._disconnectFromView(t),i&&null!=t&&null!=e){if(this.isAnalysisOwner){if(null!=e.parent)return void this.logError(\"expected owned analysis to have null parent when connecting to view\");this._parentChangeFromReconnect=!0,t.analyses.add(e)}this.analysisView=await t.whenAnalysisView(e),r(s)?this._startUserOperation=V(this._startUserOperation):(this.analysisView.visible=this.visible,this.onConnectToAnalysisView(this.analysisView),this.createTool())}}_disconnectFromView(s){this.removeTool(),null!=s&&this.isAnalysisOwner&&(this._parentChangeFromReconnect=!0,s.analyses.remove(this.analysis),this.analysis.clear()),this.analysisView=null,this.onDisconnectFromAnalysisView()}_setExternalAnalysis(s){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=!0),this.analysisView=null,this._set(\"isAnalysisOwner\",!1),this._set(\"analysis\",s),this._parentChangeFromReconnect=!1}get testInfo(){return{analysisView:this.analysisView}}};function V(s){return null!=s&&s.state>=u.RUNNING?(s.abort(),null):s}s([y({nonNullable:!0})],_.prototype,\"analysis\",null),s([y()],_.prototype,\"analysisView\",void 0),s([y()],_.prototype,\"ready\",null),s([y()],_.prototype,\"connectingToView\",null),s([y({readOnly:!0})],_.prototype,\"isAnalysisOwner\",null),s([y({type:Boolean,value:!0})],_.prototype,\"visible\",null),s([y()],_.prototype,\"_reconnectViewTask\",void 0),_=s([w(\"esri.widgets.support.InteractiveAnalysisViewModel\")],_);export{_ as InteractiveAnalysisViewModel};\n"],
  "mappings": "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",
  "names": ["s", "d", "e"]
}
