import {
  n as n2,
  p as p2
} from "./chunk-5T2QNVDA.js";
import {
  l
} from "./chunk-OPQLV3CH.js";
import {
  t
} from "./chunk-6P4ZZRYH.js";
import {
  N
} from "./chunk-PMK5VFGV.js";
import {
  $,
  E2 as E,
  G2 as G,
  He,
  K,
  U,
  X,
  Y,
  a,
  ae,
  ee,
  me,
  q,
  r as r2,
  re,
  te
} from "./chunk-YGY4RCQM.js";
import "./chunk-GEMKWQ3Q.js";
import {
  a as a2
} from "./chunk-BFREIQNB.js";
import {
  c,
  m,
  p,
  t as t2
} from "./chunk-YCSHXPL7.js";
import "./chunk-QD3CP3I4.js";
import "./chunk-Z3NX5DTX.js";
import "./chunk-J4RP32NG.js";
import "./chunk-6NLHKXEW.js";
import "./chunk-PCKG3UTS.js";
import "./chunk-I2X6UR6L.js";
import "./chunk-B647DRFJ.js";
import "./chunk-PJNK3TLV.js";
import "./chunk-J7AMTUNG.js";
import "./chunk-TGXFDJCS.js";
import {
  S
} from "./chunk-SLQA5YBV.js";
import {
  Q
} from "./chunk-UMXV3EBO.js";
import "./chunk-ONK5AE7R.js";
import "./chunk-CZSTCON2.js";
import {
  B,
  b,
  k
} from "./chunk-2ICUS4HL.js";
import "./chunk-ZXJ6I4RF.js";
import "./chunk-GBF2OQAY.js";
import "./chunk-WNNYD62G.js";
import "./chunk-HV6S3GY2.js";
import "./chunk-IGR2BTWR.js";
import "./chunk-C7NPPGFR.js";
import "./chunk-ZPYA32PH.js";
import "./chunk-OCF7OAES.js";
import "./chunk-JZBR4X6W.js";
import "./chunk-OIJCMME5.js";
import "./chunk-4KLYOMH2.js";
import "./chunk-Z2PDA67N.js";
import "./chunk-545NO6M2.js";
import "./chunk-5LSHHVQ5.js";
import "./chunk-IZKCZQUY.js";
import {
  R,
  d,
  n
} from "./chunk-M5ZB5S5C.js";
import {
  f
} from "./chunk-MBGZKT2Z.js";
import "./chunk-UWQ3OYA5.js";
import "./chunk-ORO4D3FB.js";
import "./chunk-YOPMY6TS.js";
import "./chunk-VIN55KNF.js";
import "./chunk-NIDZ6R4E.js";
import "./chunk-IOB3DJMR.js";
import "./chunk-BPRXWDBO.js";
import "./chunk-7MT4ACA4.js";
import "./chunk-RUN6MNXL.js";
import "./chunk-SAYWXQVM.js";
import "./chunk-SBL4URUW.js";
import "./chunk-D25BO7X7.js";
import "./chunk-NDIXNREV.js";
import "./chunk-I2RC5KWA.js";
import "./chunk-SSFWZSUM.js";
import "./chunk-2F6FFF5T.js";
import "./chunk-C26KUZ46.js";
import "./chunk-JGDJR5EV.js";
import "./chunk-QHK5ZYFW.js";
import "./chunk-L65HKN25.js";
import {
  r
} from "./chunk-7RBRCL6S.js";
import "./chunk-J2EGIWT6.js";
import "./chunk-Z4ZPL3B3.js";

// node_modules/@arcgis/core/arcade/functions/knowledgegraph.js
var F = null;
async function J(r3) {
  const t3 = r.geometryServiceUrl ?? "";
  if (!t3) {
    b() || await k();
    for (const e of r3)
      e.container[e.indexer] = B(e.container[e.indexer], f.WGS84);
    return;
  }
  const n3 = r3.map((e) => e.container[e.indexer]), o = new p2({ geometries: n3, outSpatialReference: f.WGS84 }), a3 = await n2(t3, o);
  for (let e = 0; e < a3.length; e++) {
    const t4 = r3[e];
    t4.container[t4.indexer] = a3[e];
  }
}
async function M(e, r3) {
  const t3 = new S({ portal: e, id: r3 });
  return await t3.load(), null === F && (F = await import("./knowledgeGraphService-537ZSY6R.js")), await F.fetchKnowledgeGraph(t3.url);
}
function Q2(e, r3, t3, a3, i) {
  if (null === e)
    return null;
  if (G(e) || E(e))
    return e;
  if (X(e))
    return e.toJSDate();
  if (X(e))
    return e.toJSDate();
  if (ee(e))
    return e.toStorageFormat();
  if (te(e))
    return e.toStorageString();
  if (K(e)) {
    const n3 = {};
    for (const o of e.keys())
      n3[o] = Q2(e.field(o), r3, t3, a3, i), n3[o] instanceof n && i.push({ container: n3, indexer: o });
    return n3;
  }
  if (U(e)) {
    const n3 = e.map((e2) => Q2(e2, r3, t3, a3, i));
    for (let e2 = 0; e2 < n3.length; e2++)
      n3[e2] instanceof n && i.push({ container: n3, indexer: e2 });
    return n3;
  }
  if (q(e)) {
    if (e.spatialReference.isWGS84)
      return e;
    if (e.spatialReference.isWebMercator && r3)
      return R(e);
    if (!r3 || !t3)
      return e;
    throw new a(a3, r2.WrongSpatialReference, null);
  }
}
function E2(e, r3) {
  if (!e)
    return e;
  if (e.spatialReference.isWGS84 && r3.spatialReference.isWebMercator)
    return d(e);
  if (e.spatialReference.equals(r3.spatialReference))
    return e;
  throw new a(r3, r2.WrongSpatialReference, null);
}
function K2(e, r3) {
  if (!e)
    return null;
  const t3 = {};
  for (const n3 in e)
    t3[n3] = V(e[n3], r3);
  return t3;
}
function V(e, r3) {
  return null === e ? null : U(e) ? e.map((e2) => V(e2, r3)) : e instanceof m ? { graphTypeName: e.typeName, id: e.id, graphType: "entity", properties: K2(e.properties, r3) } : e instanceof t2 ? { graphType: "object", properties: K2(e.properties, r3) } : e instanceof p ? { graphTypeName: e.typeName, id: e.id, graphType: "relationship", originId: e.originId ?? null, destinationId: e.destinationId ?? null, properties: K2(e.properties, r3) } : e instanceof c ? { graphType: "path", path: e.path ? e.path.map((e2) => V(e2, r3)) : null } : q(e) ? E2(e, r3) : G(e) || E(e) || re(e) ? e : null;
}
function C(e) {
  "async" === e.mode && (e.functions.knowledgegraphbyportalitem = function(t3, p3) {
    return e.standardFunctionAsync(t3, p3, (e2, l2, c2) => {
      var _a, _b;
      if (ae(c2, 2, 2, t3, p3), null === c2[0])
        throw new a(t3, r2.PortalRequired, p3);
      if (c2[0] instanceof t) {
        const e3 = me(c2[1]);
        let r3;
        r3 = ((_a = t3.services) == null ? void 0 : _a.portal) ? t3.services.portal : Q.getDefault();
        return M(l(c2[0], r3), e3);
      }
      if (false === G(c2[0]))
        throw new a(t3, r2.InvalidParameter, p3);
      const f2 = me(c2[0]);
      return M(((_b = t3.services) == null ? void 0 : _b.portal) ?? Q.getDefault(), f2);
    });
  }, e.signatures.push({ name: "knowledgegraphbyportalitem", min: 2, max: 2 }), e.functions.querygraph = function(r3, i) {
    return e.standardFunctionAsync(r3, i, async (e2, u, m2) => {
      var _a;
      ae(m2, 2, 4, r3, i);
      const g = m2[0];
      if (!$(g))
        throw new a(r3, r2.InvalidParameter, i);
      const h = m2[1];
      if (!G(h))
        throw new a(r3, r2.InvalidParameter, i);
      null === F && (F = await import("./knowledgeGraphService-537ZSY6R.js"));
      let d2 = null;
      const w = Y(m2[2], null);
      if (!(w instanceof N || null === w))
        throw new a(r3, r2.InvalidParameter, i);
      if (w) {
        let e3 = [];
        d2 = Q2(w, true, false, r3, e3), e3 = e3.filter((e4) => !e4.container[e4.indexer].spatialReference.isWGS84), e3.length > 0 && await J(e3);
      }
      const y = new a2({ openCypherQuery: h, bindParameters: d2 });
      (((_a = g == null ? void 0 : g.serviceDefinition) == null ? void 0 : _a.currentVersion) ?? 11.3) > 11.2 && (y.outputSpatialReference = r3.spatialReference);
      const j = (await F.executeQueryStreaming(g, y)).resultRowsStream.getReader(), S2 = [];
      try {
        for (; ; ) {
          const { done: e3, value: t3 } = await j.read();
          if (e3)
            break;
          if (U(t3))
            for (const n3 of t3)
              S2.push(V(n3, r3));
          else {
            const e4 = [];
            for (const n3 of t3)
              e4.push(V(t3[n3], r3));
            S2.push(e4);
          }
        }
      } catch (R2) {
        throw R2;
      }
      return N.convertJsonToArcade(S2, He(r3), false, true);
    });
  }, e.signatures.push({ name: "querygraph", min: 2, max: 4 }));
}
export {
  C as registerFunctions
};
//# sourceMappingURL=knowledgegraph-26WWAUE6.js.map
