{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/mixins/refresh.js", "../../@arcgis/core/layers/mixins/RefreshableLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Collection.js\";import\"../../core/asyncUtils.js\";import\"../../core/Error.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/watch.js\";import{autorun as r}from\"../../core/accessorSupport/trackingUtils.js\";const t=new e,o=new WeakMap;function n(e){f(e)&&t.push(new WeakRef(e))}function s(e){const r=t.find((r=>r.deref()===e));r&&t.remove(r)}function f(e){return null!=e&&\"object\"==typeof e&&\"refreshInterval\"in e&&\"refresh\"in e}function c(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:c(r,e%r):0}let i=0,l=0;function a(){const e=Date.now();let r=!1;for(const n of t){const t=n.deref();if(t){if(t.refreshInterval){e-(o.get(t)??0)+5>=6e4*t.refreshInterval&&(o.set(t,e),t.refresh(e))}}else r=!0}if(r)for(let o=t.length-1;o>=0;o--){t.at(o).deref()||t.removeAt(o)}}r((()=>{const e=Date.now();let r=0;for(const n of t){const t=n.deref();t&&(r=c(Math.round(6e4*t.refreshInterval),r),t.refreshInterval?o.get(t)||o.set(t,e):o.delete(t))}if(r!==l){if(l=r,clearInterval(i),0===l)return void(i=0);i=setInterval(a,l)}}));const u={get hasRefreshTimer(){return i>0},get tickInterval(){return l},forceRefresh(){a()},hasLayer:e=>f(e)&&t.some((r=>r.deref()===e)),clear(){for(const e of t){const r=e.deref();r&&o.delete(r)}t.removeAll()}};export{n as registerLayer,u as test,s as unregisterLayer};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Logger.js\";import{debounce as t,ignoreAbortErrors as s}from\"../../core/promiseUtils.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{cast as a}from\"../../core/accessorSupport/decorators/cast.js\";import\"../../core/RandomLCG.js\";import\"../../core/has.js\";import{subclass as n}from\"../../core/accessorSupport/decorators/subclass.js\";import{excludeTables as i}from\"../../core/accessorSupport/layerContainerType.js\";import{registerLayer as h,unregisterLayer as p}from\"./refresh.js\";function m(e){return null!=e&&\"object\"==typeof e&&\"refreshTimestamp\"in e&&\"refresh\"in e}const c=.1,f=m=>{let f=class extends m{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=t((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||h(this)}),(()=>{}))}destroy(){p(this)}castRefreshInterval(e){return e>=c?e:e<=0?0:c}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){s(this._debounceHasDataChanged()).then((r=>{r&&this._set(\"refreshTimestamp\",e),this.emit(\"refresh\",{dataChanged:r})}),(e=>{r.getLogger(this).error(e),this.emit(\"refresh\",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){const e=this;return{set refreshInterval(r){e._set(\"refreshInterval\",r)}}}};return e([o({type:Number,json:{write:!0,origins:{\"web-scene\":{write:{enabled:!0,layerContainerTypes:i}}}}})],f.prototype,\"refreshInterval\",void 0),e([a(\"refreshInterval\")],f.prototype,\"castRefreshInterval\",null),e([o({readOnly:!0})],f.prototype,\"refreshTimestamp\",void 0),e([o({readOnly:!0})],f.prototype,\"refreshParameters\",null),f=e([n(\"esri.layers.mixins.RefreshableLayer\")],f),f};export{f as RefreshableLayer,m as isRefreshableLayer};\n"],
  "mappings": "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",
  "names": ["n", "e", "s", "r", "i", "a", "t", "o", "e", "c", "f", "m", "n", "s", "a"]
}
