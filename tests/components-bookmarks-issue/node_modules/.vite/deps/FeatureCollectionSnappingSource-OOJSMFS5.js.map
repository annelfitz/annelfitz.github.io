{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{memoize as i}from\"../../../../core/memoize.js\";import{throwIfAborted as o,whenOrAbort as n}from\"../../../../core/promiseUtils.js\";import{watch as r,initial as a,on as s}from\"../../../../core/reactiveUtils.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as y}from\"../../../../support/elevationInfoUtils.js\";import{makeFilter as c,makeSnappingQuery as g}from\"../snappingUtils.js\";import{convertSnappingCandidate as u,makeGetGroundElevation as h}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as m}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as d}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as v}from\"./symbologySnappingCandidates.js\";let S=class extends t{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&\"3d\"===e.type;if(!i||\"subtype-group\"===t.type)return m();const o=async(i,o)=>(await n(e.whenLayerView(t),o)).elevationAlignPointsInFeatures(i,o);return m(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:o})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return d(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type?v(this._symbologySnappingSupported,(async(i,n)=>{const r=await e.whenLayerView(t);return o(n),r.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},n)})):v()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on(\"elevation-change\",(({context:e})=>{const{elevationInfo:i}=t;y(e,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),r((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),a),r((()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),a),s((()=>this._layerView3D?.layer),[\"edits\",\"apply-edits\",\"graphic-update\"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(e){super(e),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=i(h)}refresh(){}async fetchCandidates(e,t){const{layer:i}=this.layerSource,n=i.source;if(!n?.querySnapping)return[];const r=c(i),a=g(e,this.view?.type??\"2d\",r),s=await n.querySnapping(a,{signal:t});o(t);const p=e.coordinateHelper.spatialReference,l=await this._snappingElevationAligner.alignCandidates(s.candidates,p,t);o(t);const y=await this._symbologySnappingFetcher.fetch(l,t);o(t);const h=0===y.length?l:[...l,...y],m=this._snappingElevationFilter.filter(a,h),d=this._memoizedMakeGetGroundElevation(this.view,p);return m.map((e=>u(e,d)))}};e([p({constructOnly:!0})],S.prototype,\"layerSource\",void 0),e([p({constructOnly:!0})],S.prototype,\"view\",void 0),e([p()],S.prototype,\"_snappingElevationAligner\",null),e([p()],S.prototype,\"_snappingElevationFilter\",null),e([p()],S.prototype,\"_symbologySnappingFetcher\",null),e([p()],S.prototype,\"_layerView3D\",void 0),e([p()],S.prototype,\"_symbologySnappingSupported\",null),S=e([l(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],S);export{S as FeatureCollectionSnappingSource};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI8lC,IAAIA,KAAE,cAAc,EAAC;AAAA,EAAC,IAAI,eAAc;AAAC,WAAO;AAAA,EAAC;AAAA,EAAC,IAAI,WAAU;AAAC,WAAO,KAAK,YAAY;AAAA,EAAQ;AAAA,EAAC,IAAI,4BAA2B;AAAC,UAAK,EAAC,MAAKC,GAAC,IAAE,MAAK,EAAC,OAAMC,GAAC,IAAE,KAAK,aAAYC,KAAE,QAAMF,MAAG,SAAOA,GAAE;AAAK,QAAG,CAACE,MAAG,oBAAkBD,GAAE;AAAK,aAAO,EAAE;AAAE,UAAME,KAAE,OAAMD,IAAEC,QAAK,MAAM,EAAEH,GAAE,cAAcC,EAAC,GAAEE,EAAC,GAAG,+BAA+BD,IAAEC,EAAC;AAAE,WAAO,EAAED,IAAE,EAAC,eAAcD,GAAE,eAAc,uBAAsBE,GAAC,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,2BAA0B;AAAC,UAAK,EAAC,MAAKH,GAAC,IAAE,MAAKC,KAAE,QAAMD,MAAG,SAAOA,GAAE,QAAM,oBAAkB,KAAK,YAAY,MAAM;AAAK,WAAO,EAAEC,EAAC;AAAA,EAAC;AAAA,EAAC,IAAI,4BAA2B;AAAC,UAAK,EAAC,MAAKD,GAAC,IAAE,MAAK,EAAC,OAAMC,GAAC,IAAE,KAAK;AAAY,WAAO,QAAMD,MAAG,SAAOA,GAAE,QAAM,oBAAkBC,GAAE,OAAK,EAAE,KAAK,6BAA6B,OAAMC,IAAEE,OAAI;AAAC,YAAMC,KAAE,MAAML,GAAE,cAAcC,EAAC;AAAE,aAAO,EAAEG,EAAC,GAAEC,GAAE,0BAA0B,EAAC,YAAWH,IAAE,kBAAiBF,GAAE,iBAAgB,GAAEI,EAAC;AAAA,IAAC,CAAE,IAAE,EAAE;AAAA,EAAC;AAAA,EAAC,IAAI,8BAA6B;AAAC,WAAO,QAAM,KAAK,gBAAc,KAAK,aAAa;AAAA,EAA0B;AAAA,EAAC,aAAY;AAAC,UAAK,EAAC,MAAKJ,GAAC,IAAE,MAAK,EAAC,OAAMC,GAAC,IAAE,KAAK;AAAY,YAAMD,MAAG,SAAOA,GAAE,QAAM,oBAAkBC,GAAE,SAAOD,GAAE,cAAcC,EAAC,EAAE,KAAM,CAAAD,OAAG,KAAK,eAAaA,EAAE,GAAE,KAAK,WAAW,CAACA,GAAE,kBAAkB,GAAG,oBAAoB,CAAC,EAAC,SAAQA,GAAC,MAAI;AAAC,YAAK,EAAC,eAAcE,GAAC,IAAED;AAAE,QAAED,IAAEE,EAAC,KAAG,KAAK,0BAA0B,4BAA4B;AAAA,IAAC,CAAE,GAAE,EAAG,MAAID,GAAE,eAAgB,MAAI,KAAK,0BAA0B,4BAA4B,GAAG,CAAC,GAAE,EAAG,MAAE;AAJh9E;AAIk9E,qBAAM,KAAK,gBAAa,UAAK,aAAa,cAAlB,mBAA6B,WAAS;AAAA,OAAO,MAAI,KAAK,0BAA0B,sBAAsB,GAAG,CAAC,GAAE,EAAG,MAAE;AAJ3lF;AAI6lF,wBAAK,iBAAL,mBAAmB;AAAA,OAAO,CAAC,SAAQ,eAAc,gBAAgB,GAAG,MAAI,KAAK,0BAA0B,sBAAsB,CAAE,CAAC,CAAC;AAAA,EAAE;AAAA,EAAC,YAAYD,IAAE;AAAC,UAAMA,EAAC,GAAE,KAAK,OAAK,MAAK,KAAK,eAAa,MAAK,KAAK,kCAAgC,EAAE,CAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAA,EAAC;AAAA,EAAC,MAAM,gBAAgBA,IAAEC,IAAE;AAJ92F;AAI+2F,UAAK,EAAC,OAAMC,GAAC,IAAE,KAAK,aAAYE,KAAEF,GAAE;AAAO,QAAG,EAACE,MAAA,gBAAAA,GAAG;AAAc,aAAM,CAAC;AAAE,UAAMC,KAAE,EAAEH,EAAC,GAAEI,KAAEC,GAAEP,MAAE,UAAK,SAAL,mBAAW,SAAM,MAAKK,EAAC,GAAEG,KAAE,MAAMJ,GAAE,cAAcE,IAAE,EAAC,QAAOL,GAAC,CAAC;AAAE,MAAEA,EAAC;AAAE,UAAM,IAAED,GAAE,iBAAiB,kBAAiB,IAAE,MAAM,KAAK,0BAA0B,gBAAgBQ,GAAE,YAAW,GAAEP,EAAC;AAAE,MAAEA,EAAC;AAAE,UAAMM,KAAE,MAAM,KAAK,0BAA0B,MAAM,GAAEN,EAAC;AAAE,MAAEA,EAAC;AAAE,UAAMQ,KAAE,MAAIF,GAAE,SAAO,IAAE,CAAC,GAAG,GAAE,GAAGA,EAAC,GAAE,IAAE,KAAK,yBAAyB,OAAOD,IAAEG,EAAC,GAAEC,KAAE,KAAK,gCAAgC,KAAK,MAAK,CAAC;AAAE,WAAO,EAAE,IAAK,CAAAV,OAAGM,GAAEN,IAAEU,EAAC,CAAE;AAAA,EAAC;AAAC;AAAE,EAAE,CAAC,EAAE,EAAC,eAAc,KAAE,CAAC,CAAC,GAAEX,GAAE,WAAU,eAAc,MAAM,GAAE,EAAE,CAAC,EAAE,EAAC,eAAc,KAAE,CAAC,CAAC,GAAEA,GAAE,WAAU,QAAO,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,6BAA4B,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,4BAA2B,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,6BAA4B,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,gBAAe,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,+BAA8B,IAAI,GAAEA,KAAE,EAAE,CAAC,EAAE,gFAAgF,CAAC,GAAEA,EAAC;",
  "names": ["S", "e", "t", "i", "o", "n", "r", "a", "y", "s", "h", "d"]
}
