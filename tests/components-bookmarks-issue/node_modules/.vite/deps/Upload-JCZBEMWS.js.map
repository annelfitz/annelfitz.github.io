{
  "version": 3,
  "sources": ["../../@arcgis/core/widgets/Editor/Upload.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{createTask as o}from\"../../core/asyncUtils.js\";import s from\"../../core/Error.js\";import{on as t}from\"../../core/events.js\";import{throwIfAborted as i,createResolver as l}from\"../../core/promiseUtils.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as n}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{uploadProgressWeights as c}from\"../../layers/graphics/sources/support/uploadProgressWeights.js\";import{getSupportedExtensions as u}from\"../../layers/support/infoFor3D.js\";import{makeProgressManager as d,estimatedTransferTime as m}from\"../../support/progressUtils.js\";let h=class extends r{constructor(){super({}),this.files=[],this.progress=0,this._uploadTask=null,this._layer=null}destroy(){this.cancel(),this.files=[],this._layer=null,this._uploadTask=null}get state(){const e=this._uploadTask;return e&&0!==this.files.length?e.finished?e.error?\"error\":\"success\":\"pending\":\"default\"}get result(){return this._uploadTask?.value??null}get error(){return this._uploadTask?.error??null}uploadTo(e){this.cancel(),this.files=[],this._layer=e,this._uploadTask=o((async r=>{const o=await y(e);i(r),this.progress=0,this.files=o;const t=d(c.upload,(e=>{this.progress=e}),\"Upload.uploadTo\");if(0===o.length)return null;i(r);const l=await e.extractAndFilterFiles(o);i(r),l.length>0&&(this.files=l);const a=new p({x:0,y:0,z:0,spatialReference:e.spatialReference}),n=await e.convertMesh(l,{location:a,signal:r,onProgress:t.makeOnProgress(\"createFromFiles\")});if(i(r),!n)throw new s(\"editor:upload\",\"could not upload or convert model\");const u=l.reduce(((e,r)=>e+r.size),0),h=t.simulate(\"loadMesh\",m(u));try{await n.load()}finally{h.remove()}return n}))}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){this._uploadTask?.abort()}};e([a()],h.prototype,\"files\",void 0),e([a()],h.prototype,\"progress\",void 0),e([a()],h.prototype,\"state\",null),e([a()],h.prototype,\"result\",null),e([a()],h.prototype,\"error\",null),e([a()],h.prototype,\"_uploadTask\",void 0),e([a()],h.prototype,\"_layer\",void 0),h=e([n(\"esri.widgets.Editor.Upload\")],h);let f=null;async function y(e){const{resolve:r,promise:o}=l(),s=document.createElement(\"input\");s.type=\"file\",s.multiple=!1,s.accept=[...u(e.infoFor3D),\".zip\"].join(\",\"),s.style.display=\"none\",document.body.appendChild(s);const i=t(s,\"change\",(()=>r(s.files?Array.from(s.files):[])));return f?f(s):s.click(),o.finally((()=>{i.remove(),s.remove()}))}function g(e){f=r=>{Promise.resolve().then((()=>e)).then((e=>{if(!f)return;const o=new DataTransfer;e.forEach((e=>o.items.add(e))),r.files=o.files,r.dispatchEvent(new Event(\"change\"))}))}}function j(){f=null}export{h as Upload,j as clearPromptForFilesStub,g as stubFilePickerToSelect};\n"],
  "mappings": "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",
  "names": ["h", "e", "o", "y", "s", "a", "r", "i"]
}
