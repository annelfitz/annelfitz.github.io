import {
  importCoreReactiveUtils,
  newViewsSceneView,
  newWebScene
} from "./chunk-YXW2SI4L.js";
import {
  addHandles,
  isNotSameCamera,
  isNotSameEnvironment,
  isNotSameViewpoint,
  isNullOrEmptyString,
  isValidInteger
} from "./chunk-UXZQL3ZN.js";
import {
  createEvent,
  getElement,
  h,
  registerInstance
} from "./chunk-KMIMZXFW.js";
import "./chunk-Z4ZPL3B3.js";

// node_modules/@arcgis/map-components/dist/esm/arcgis-scene.entry.js
var sceneCss = ".arcgis-scene{padding:0;margin:0;height:100%;width:100%}";
var ArcgisScene = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
    this.arcgisViewReadyChange = createEvent(this, "arcgisViewReadyChange", 7);
    this.arcgisViewChange = createEvent(this, "arcgisViewChange", 7);
    this.arcgisViewClick = createEvent(this, "arcgisViewClick", 7);
    this.arcgisViewDoubleClick = createEvent(this, "arcgisViewDoubleClick", 7);
    this.arcgisViewDrag = createEvent(this, "arcgisViewDrag", 7);
    this.arcgisViewHold = createEvent(this, "arcgisViewHold", 7);
    this.arcgisViewImmediateClick = createEvent(this, "arcgisViewImmediateClick", 7);
    this.arcgisViewImmediateDoubleClick = createEvent(this, "arcgisViewImmediateDoubleClick", 7);
    this.arcgisViewKeyDown = createEvent(this, "arcgisViewKeyDown", 7);
    this.arcgisViewKeyUp = createEvent(this, "arcgisViewKeyUp", 7);
    this.arcgisViewLayerviewCreate = createEvent(this, "arcgisViewLayerviewCreate", 7);
    this.arcgisViewLayerviewCreateError = createEvent(this, "arcgisViewLayerviewCreateError", 7);
    this.arcgisViewLayerviewDestroy = createEvent(this, "arcgisViewLayerviewDestroy", 7);
    this.arcgisViewMouseWheel = createEvent(this, "arcgisViewMouseWheel", 7);
    this.arcgisViewPointerDown = createEvent(this, "arcgisViewPointerDown", 7);
    this.arcgisViewPointerEnter = createEvent(this, "arcgisViewPointerEnter", 7);
    this.arcgisViewPointerLeave = createEvent(this, "arcgisViewPointerLeave", 7);
    this.arcgisViewPointerMove = createEvent(this, "arcgisViewPointerMove", 7);
    this.arcgisViewPointerUp = createEvent(this, "arcgisViewPointerUp", 7);
    this._watchHandles = [];
    this.allLayerViews = void 0;
    this.alphaCompositingEnabled = false;
    this.analyses = void 0;
    this.basemapView = void 0;
    this.basemap = void 0;
    this.camera = void 0;
    this.center = void 0;
    this.clippingArea = void 0;
    this.constraints = void 0;
    this.destroyDisabled = false;
    this.environment = void 0;
    this.extent = void 0;
    this.fatalError = void 0;
    this.floors = void 0;
    this.gamepad = void 0;
    this.graphics = void 0;
    this.ground = void 0;
    this.groundView = void 0;
    this.highlightOptions = void 0;
    this.interacting = false;
    this.itemId = void 0;
    this.layerViews = void 0;
    this.magnifier = void 0;
    this.map = void 0;
    this.navigating = false;
    this.navigation = void 0;
    this.padding = void 0;
    this.performanceInfo = void 0;
    this.popup = void 0;
    this.popupEnabled = true;
    this.qualityProfile = void 0;
    this.ready = false;
    this.resolution = void 0;
    this.scale = void 0;
    this.spatialReference = void 0;
    this.stationary = void 0;
    this.suspended = false;
    this.theme = void 0;
    this.timeExtent = void 0;
    this.toMap = void 0;
    this.toScreen = void 0;
    this.updating = false;
    this.viewingMode = "global";
    this.viewpoint = void 0;
    this.zoom = void 0;
    this.view = void 0;
  }
  alphaCompositingEnabledWatcher(value) {
    if (value !== void 0 && this.view) {
      this.view.alphaCompositingEnabled = value;
    }
  }
  basemapWatcher(value) {
    var _a, _b;
    if (typeof value === "string" && ((_a = this.view) == null ? void 0 : _a.map) && !isNullOrEmptyString(value)) {
      this.view.map.basemap = value;
    } else if ((_b = this.view) == null ? void 0 : _b.map) {
      this.view.map.basemap = value;
    }
  }
  cameraWatcher(value) {
    if (this.view && value && isNotSameCamera(this.view.camera, value)) {
      this.view.camera = value;
    }
  }
  centerWatcher(value, old) {
    if (value !== old && this.view) {
      if (typeof value === "string") {
        const center = value.split(",").map((x) => Number(x));
        if (center[0] !== this.view.center.longitude && center[1] !== this.view.center.latitude) {
          this.view.center = center;
        }
      } else if (Array.isArray(value)) {
        if (value[0] !== this.view.center.longitude && value[1] !== this.view.center.latitude) {
          this.view.center = value;
        }
      } else if (!this.view.center.equals(value)) {
        this.view.center = value;
      }
    }
  }
  clippingAreaWatcher(value) {
    var _a;
    if (this.view && value && !((_a = this.view.clippingArea) == null ? void 0 : _a.equals(value))) {
      this.view.clippingArea = value;
    }
  }
  constraintsWatcher(value) {
    if (this.view) {
      this.view.constraints = value;
    }
  }
  environmentWatcher(value) {
    if (this.view && value && isNotSameEnvironment(this.view.environment, value)) {
      this.view.environment = value;
    }
  }
  extentWatcher(value) {
    if (this.view && value && !this.view.extent.equals(value)) {
      this.view.extent = value;
    }
  }
  floorsWatcher(value) {
    if (this.view) {
      this.view.floors = value;
    }
  }
  graphicsWatcher(value) {
    if (this.view) {
      this.view.graphics = value;
    }
  }
  groundWatcher(value) {
    var _a;
    if (((_a = this.view) == null ? void 0 : _a.map) && !isNullOrEmptyString(value)) {
      this.view.map.ground = value;
    }
  }
  highlightOptionsWatcher(value) {
    if (this.view) {
      this.view.highlightOptions = value;
    }
  }
  itemIdWatcher(value, old) {
    var _a;
    if (value !== old) {
      if ((_a = this.view) == null ? void 0 : _a.map) {
        void this._updateMap();
      } else {
        void this._loadMap();
      }
    }
  }
  mapWatcher(value) {
    if (this.view) {
      this.view.map = value;
    }
  }
  navigationWatcher(value) {
    if (this.view) {
      this.view.navigation = value;
    }
  }
  paddingWatcher(value) {
    if (this.view) {
      this.view.padding = value;
    }
  }
  popupWatcher(value) {
    if (this.view) {
      this.view.popup = value;
    }
  }
  popupEnabledWatcher(value, old) {
    if (value !== old && this.view) {
      this.view.popupEnabled = value;
    }
  }
  qualityProfileWatcher(value) {
    if (this.view && this.view.qualityProfile !== value) {
      this.view.qualityProfile = value;
    }
  }
  scaleWatcher(value, old) {
    if (this.view && this.view.stationary && !this.view.interacting && value != null && value !== old) {
      this.view.scale = value;
    }
  }
  spatialReferenceWatcher(value) {
    if (this.view && value && !this.view.spatialReference.equals(value)) {
      this.view.spatialReference = value;
    }
  }
  themeWatcher(value) {
    if (this.view) {
      this.view.theme = value;
    }
  }
  timeExtentWatcher(value) {
    if (this.view) {
      this.view.timeExtent = value;
    }
  }
  viewingModeWatcher(value) {
    if (this.view) {
      this.view.viewingMode = value;
    }
  }
  viewpointWatcher(value) {
    if (this.view && isNotSameViewpoint(this.view.viewpoint, value)) {
      this.view.viewpoint = value;
    }
  }
  zoomWatcher(value, old) {
    if (this.view && this.view.stationary && !this.view.interacting && value !== old && isValidInteger(value)) {
      this.view.zoom = value;
    }
  }
  //--------------------------------------------------------------------------
  //
  //  Methods
  //
  //--------------------------------------------------------------------------
  async closePopup() {
    var _a;
    (_a = this.view) == null ? void 0 : _a.closePopup();
  }
  async destroy() {
    if (this.destroyDisabled) {
      this._clearWatchHandles();
      this.view.destroy();
    }
  }
  async goTo(target, options) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.goTo(target, options));
  }
  async hitTest(screenPoint, options) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.hitTest(screenPoint, options));
  }
  async openPopup(options) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.openPopup(options));
  }
  async takeScreenshot(options) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.takeScreenshot(options));
  }
  async tryFatalErrorRecovery() {
    var _a;
    (_a = this.view) == null ? void 0 : _a.tryFatalErrorRecovery();
  }
  async whenAnalysisView(analysis) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.whenAnalysisView(analysis));
  }
  async whenLayerView(layer) {
    var _a;
    return await ((_a = this.view) == null ? void 0 : _a.whenLayerView(layer));
  }
  //--------------------------------------------------------------------------
  //
  //  Lifecycle
  //
  //--------------------------------------------------------------------------
  async componentWillLoad() {
    if (!this.view) {
      await this._loadMap();
    }
  }
  componentDidRender() {
    if (this.view && !this.view.container) {
      this.view.container = this.el;
    }
  }
  componentDidLoad() {
    this._proxyEvents();
  }
  disconnectedCallback() {
    void this.destroy();
  }
  render() {
    return h("div", { class: "arcgis-scene", ref: (el) => this.el = el });
  }
  //--------------------------------------------------------------------------
  //
  //  Private Methods
  //
  //--------------------------------------------------------------------------
  _clearWatchHandles() {
    this._watchHandles.forEach((handle) => handle.remove());
    this._watchHandles = [];
  }
  async _addWatchers() {
    const { watch, when } = await importCoreReactiveUtils();
    addHandles(this, [
      // watch for stationary and emit arcgisViewChange event
      watch(() => this.view.stationary, () => {
        this.stationary = this.view.stationary;
        this.interacting = this.view.interacting;
        this.navigating = this.view.navigating;
        this.arcgisViewChange.emit();
      }, {
        initial: true
      }),
      // when view stationary is true, update these props:
      // zoom, scale, center, rotation, extent, camera, viewpoint
      when(() => this.view.stationary, () => {
        this.camera = this.view.camera;
        this.center = this.view.center;
        this.extent = this.view.extent;
        this.scale = this.view.scale;
        this.viewpoint = this.view.viewpoint;
        this.zoom = this.view.zoom;
        this.spatialReference = this.view.spatialReference;
      }),
      // watchers for other props to update component
      watch(() => this.view.allLayerViews, () => {
        this.allLayerViews = this.view.allLayerViews;
      }, {
        initial: true
      }),
      watch(() => this.view.analyses, () => {
        this.analyses = this.view.analyses;
      }, {
        initial: true
      }),
      watch(() => {
        var _a;
        return (_a = this.view.map) == null ? void 0 : _a.basemap;
      }, () => {
        var _a;
        this.basemap = (_a = this.view.map) == null ? void 0 : _a.basemap;
      }, {
        initial: true
      }),
      watch(() => this.view.basemapView, () => {
        this.basemapView = this.view.basemapView;
      }, {
        initial: true
      }),
      watch(() => this.view.environment, () => {
        this.environment = this.view.environment;
      }, {
        initial: true
      }),
      watch(() => this.view.fatalError, () => {
        this.fatalError = this.view.fatalError;
      }, {
        initial: true
      }),
      watch(() => this.view.input.gamepad, () => {
        this.gamepad = this.view.input.gamepad;
      }, {
        initial: true
      }),
      watch(() => this.view.graphics, () => {
        this.graphics = this.view.graphics;
      }, {
        initial: true
      }),
      watch(() => {
        var _a;
        return (_a = this.view.map) == null ? void 0 : _a.ground;
      }, () => {
        var _a;
        this.ground = (_a = this.view.map) == null ? void 0 : _a.ground;
      }, {
        initial: true
      }),
      watch(() => this.view.groundView, () => {
        this.groundView = this.view.groundView;
      }, {
        initial: true
      }),
      // Start: arcgisStationaryChange events
      watch(() => this.view.interacting, () => {
        this.interacting = this.view.interacting;
      }),
      watch(() => this.view.navigating, () => {
        this.navigating = this.view.navigating;
      }),
      watch(() => this.view.stationary, () => {
        this.stationary = this.view.stationary;
      }),
      watch(() => this.view.layerViews, () => {
        this.layerViews = this.view.layerViews;
      }, {
        initial: true
      }),
      watch(() => this.view.navigation, () => {
        this.navigation = this.view.navigation;
      }, {
        initial: true
      }),
      watch(() => this.view.map, () => {
        this.map = this.view.map;
      }, {
        initial: true
      }),
      watch(() => this.view.performanceInfo, () => {
        this.performanceInfo = this.view.performanceInfo;
      }),
      watch(() => this.view.popup, () => {
        this.popup = this.view.popup;
      }, {
        initial: true
      }),
      watch(() => this.view.qualityProfile, () => {
        this.qualityProfile = this.view.qualityProfile;
      }, {
        initial: true
      }),
      watch(() => this.view.resolution, () => {
        this.resolution = this.view.resolution;
      }, {
        initial: true
      }),
      watch(() => this.view.suspended, () => {
        this.suspended = this.view.suspended;
      }, {
        initial: true
      }),
      watch(() => this.view.updating, () => {
        this.updating = this.view.updating;
      }, {
        initial: true
      }),
      // watch for ready and emit arcgisViewReadyChange event
      watch(() => this.view.ready, () => {
        this.ready = this.view.ready;
        this.arcgisViewReadyChange.emit();
      }, {
        initial: true
      })
    ]);
  }
  async _createMap() {
    const mapParams = {};
    if (this.itemId) {
      mapParams.portalItem = await this._createPortalItem();
    }
    if (this.basemap) {
      mapParams.basemap = this.basemap;
    } else if (isNullOrEmptyString(this.itemId)) {
      mapParams.basemap = "topo-vector";
    }
    if (this.ground) {
      mapParams.ground = this.ground;
    } else if (isNullOrEmptyString(this.itemId)) {
      mapParams.ground = "world-elevation";
    }
    const map = await newWebScene(mapParams);
    return map;
  }
  async _createPortalItem() {
    const itemProps = {};
    if (this.itemId) {
      itemProps.id = this.itemId;
    }
    return itemProps;
  }
  _createViewParams() {
    const params = {};
    if (this.center) {
      if (typeof this.center === "string") {
        params.center = this.center.split(",").map((x) => Number(x));
      } else {
        params.center = this.center;
      }
    }
    if (this.constraints) {
      params.constraints = this.constraints;
    }
    if (this.extent) {
      params.extent = this.extent;
    }
    if (this.floors) {
      params.floors = this.floors;
    }
    if (this.graphics) {
      params.graphics = this.graphics;
    }
    if (this.highlightOptions) {
      params.highlightOptions = this.highlightOptions;
    }
    if (this.map) {
      params.map = this.map;
    }
    if (this.navigation) {
      params.navigation = this.navigation;
    }
    if (this.padding) {
      params.padding = this.padding;
    }
    if (this.popup) {
      params.popup = this.popup;
    }
    if (this.popupEnabled !== void 0) {
      params.popupEnabled = this.popupEnabled;
    }
    if (this.scale !== void 0) {
      params.scale = this.scale;
    }
    if (this.spatialReference) {
      params.spatialReference = this.spatialReference;
    }
    if (this.theme) {
      params.theme = this.theme;
    }
    if (this.timeExtent) {
      params.timeExtent = this.timeExtent;
    }
    if (this.viewpoint) {
      params.viewpoint = this.viewpoint;
    }
    if (this.zoom !== void 0) {
      params.zoom = this.zoom;
    }
    return params;
  }
  async _loadMap() {
    const map = await this._createMap();
    const params = this._createViewParams();
    const view = await newViewsSceneView({
      map,
      ...params
    });
    this.view = view;
    return void view.when(async () => {
      this.toMap = view.toMap.bind(view);
      this.toScreen = view.toScreen.bind(view);
      await this._addWatchers();
    });
  }
  _proxyEvents() {
    addHandles(this, [
      this.view.on("click", (event) => {
        this.arcgisViewClick.emit(event);
      }),
      this.view.on("double-click", (event) => {
        this.arcgisViewDoubleClick.emit(event);
      }),
      this.view.on("drag", (event) => {
        this.arcgisViewDrag.emit(event);
      }),
      this.view.on("hold", (event) => {
        this.arcgisViewHold.emit(event);
      }),
      this.view.on("immediate-click", (event) => {
        this.arcgisViewImmediateClick.emit(event);
      }),
      this.view.on("immediate-double-click", (event) => {
        this.arcgisViewImmediateDoubleClick.emit(event);
      }),
      this.view.on("key-down", (event) => {
        this.arcgisViewKeyDown.emit(event);
      }),
      this.view.on("key-up", (event) => {
        this.arcgisViewKeyUp.emit(event);
      }),
      this.view.on("layerview-create", (event) => {
        this.arcgisViewLayerviewCreate.emit(event);
      }),
      this.view.on("layerview-create-error", (event) => {
        this.arcgisViewLayerviewCreateError.emit(event);
      }),
      this.view.on("layerview-destroy", (event) => {
        this.arcgisViewLayerviewDestroy.emit(event);
      }),
      this.view.on("mouse-wheel", (event) => {
        this.arcgisViewMouseWheel.emit(event);
      }),
      this.view.on("pointer-down", (event) => {
        this.arcgisViewPointerDown.emit(event);
      }),
      this.view.on("pointer-enter", (event) => {
        this.arcgisViewPointerEnter.emit(event);
      }),
      this.view.on("pointer-leave", (event) => {
        this.arcgisViewPointerLeave.emit(event);
      }),
      this.view.on("pointer-move", (event) => {
        this.arcgisViewPointerMove.emit(event);
      }),
      this.view.on("pointer-up", (event) => {
        this.arcgisViewPointerUp.emit(event);
      })
    ]);
  }
  async _updateMap() {
    var _a;
    if ((_a = this.view) == null ? void 0 : _a.map) {
      this.view.map.destroy();
      const map = await this._createMap();
      this.view.map = map;
    }
  }
  get _hostElement() {
    return getElement(this);
  }
  static get watchers() {
    return {
      "alphaCompositingEnabled": ["alphaCompositingEnabledWatcher"],
      "basemap": ["basemapWatcher"],
      "camera": ["cameraWatcher"],
      "center": ["centerWatcher"],
      "clippingArea": ["clippingAreaWatcher"],
      "constraints": ["constraintsWatcher"],
      "environment": ["environmentWatcher"],
      "extent": ["extentWatcher"],
      "floors": ["floorsWatcher"],
      "graphics": ["graphicsWatcher"],
      "ground": ["groundWatcher"],
      "highlightOptions": ["highlightOptionsWatcher"],
      "itemId": ["itemIdWatcher"],
      "map": ["mapWatcher"],
      "navigation": ["navigationWatcher"],
      "padding": ["paddingWatcher"],
      "popup": ["popupWatcher"],
      "popupEnabled": ["popupEnabledWatcher"],
      "qualityProfile": ["qualityProfileWatcher"],
      "scale": ["scaleWatcher"],
      "spatialReference": ["spatialReferenceWatcher"],
      "theme": ["themeWatcher"],
      "timeExtent": ["timeExtentWatcher"],
      "viewingMode": ["viewingModeWatcher"],
      "viewpoint": ["viewpointWatcher"],
      "zoom": ["zoomWatcher"]
    };
  }
};
ArcgisScene.style = sceneCss;
export {
  ArcgisScene as arcgis_scene
};
/*! Bundled license information:

@arcgis/map-components/dist/esm/arcgis-scene.entry.js:
  (*!
   * All material copyright Esri, All Rights Reserved, unless otherwise specified.
   * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
   * v4.30.0-next.13
   *)
*/
//# sourceMappingURL=arcgis-scene.entry-PX42CJPQ.js.map
