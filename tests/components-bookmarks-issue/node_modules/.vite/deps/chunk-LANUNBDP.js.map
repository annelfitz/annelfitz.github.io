{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../../chunks/tslib.es6.js\";import{normalFromMat4 as r}from\"../../../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as o}from\"../../../../../../core/libs/gl-matrix-2/factories/mat3f64.js\";import{IDENTITY as a}from\"../../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{s as n}from\"../../../../../../chunks/vec32.js\";import{create as i}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{ShaderOutput as t}from\"../ShaderOutput.js\";import{DoublePrecision as s}from\"../util/DoublePrecision.glsl.js\";import{addViewNormal as l}from\"../util/View.glsl.js\";import{Float3DrawUniform as m}from\"../../shaderModules/Float3DrawUniform.js\";import{NoParameters as c,glsl as d}from\"../../shaderModules/interfaces.js\";import{Matrix3PassUniform as u}from\"../../shaderModules/Matrix3PassUniform.js\";import{Matrix4PassUniform as p}from\"../../shaderModules/Matrix4PassUniform.js\";import{ShaderTechniqueConfiguration as v,parameter as f}from\"../../shaderTechnique/ShaderTechniqueConfiguration.js\";import{VertexAttribute as g}from\"../../../lib/VertexAttribute.js\";import{encodeDoubleHi as x,encodeDoubleLo as M}from\"../../../../../webgl/doublePrecisionUtils.js\";class O extends v{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}e([f()],O.prototype,\"instancedDoublePrecision\",void 0),e([f()],O.prototype,\"hasModelTransformation\",void 0);class w extends c{constructor(){super(...arguments),this.modelTransformation=null}}const h=o();function N(e,o){const i=o.hasModelTransformation,c=o.instancedDoublePrecision;i&&(e.vertex.uniforms.add(new p(\"model\",(e=>e.modelTransformation??a))),e.vertex.uniforms.add(new u(\"normalLocalOriginFromModel\",(e=>(r(h,e.modelTransformation??a),h))))),o.instanced&&c&&(e.attributes.add(g.INSTANCEMODELORIGINHI,\"vec3\"),e.attributes.add(g.INSTANCEMODELORIGINLO,\"vec3\"),e.attributes.add(g.INSTANCEMODEL,\"mat3\"),e.attributes.add(g.INSTANCEMODELNORMAL,\"mat3\"));const v=e.vertex;c&&(v.include(s,o),v.uniforms.add(new m(\"viewOriginHi\",((e,r)=>x(n(T,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]),T))),new m(\"viewOriginLo\",((e,r)=>M(n(T,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]),T))))),v.code.add(d`\n    vec3 getVertexInLocalOriginSpace() {\n      return ${i?c?\"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz\":\"(model * localPosition()).xyz\":c?\"instanceModel * localPosition().xyz\":\"localPosition().xyz\"};\n    }\n\n    vec3 subtractOrigin(vec3 _pos) {\n      ${c?d`\n          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped\n          // working for macOS 14+ and iOS 17+.\n          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280\n          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);\n          return _pos - originDelta;`:\"return vpos;\"}\n    }\n    `),v.code.add(d`\n    vec3 dpNormal(vec4 _normal) {\n      return normalize(${i?c?\"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)\":\"normalLocalOriginFromModel * _normal.xyz\":c?\"instanceModelNormal * _normal.xyz\":\"_normal.xyz\"});\n    }\n    `),o.output===t.Normal&&(l(v),v.code.add(d`\n    vec3 dpNormalView(vec4 _normal) {\n      return normalize((viewNormal * ${i?c?\"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)\":\"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)\":c?\"vec4(instanceModelNormal * _normal.xyz, 1.0)\":\"_normal\"}).xyz);\n    }\n    `)),o.hasVertexTangents&&v.code.add(d`\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ${i?c?\"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);\":\"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);\":c?\"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);\":\"return _tangent;\"}\n    }`)}const T=i();export{O as InstancedDoubleConfiguration,w as InstancedDoublePassParameters,N as InstancedDoublePrecision};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIisC,IAAM,IAAN,cAAgB,EAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,2BAAyB,OAAG,KAAK,yBAAuB;AAAA,EAAE;AAAC;AAAC,EAAE,CAACA,GAAE,CAAC,GAAE,EAAE,WAAU,4BAA2B,MAAM,GAAE,EAAE,CAACA,GAAE,CAAC,GAAE,EAAE,WAAU,0BAAyB,MAAM;AAAqF,IAAM,IAAEC,GAAE;AAAE,SAAS,EAAEA,IAAEC,IAAE;AAAC,QAAM,IAAEA,GAAE,wBAAuBC,KAAED,GAAE;AAAyB,QAAID,GAAE,OAAO,SAAS,IAAI,IAAIA,GAAE,SAAS,CAAAA,OAAGA,GAAE,uBAAqBC,EAAE,CAAC,GAAED,GAAE,OAAO,SAAS,IAAI,IAAIA,GAAE,8BAA8B,CAAAA,QAAI,EAAE,GAAEA,GAAE,uBAAqBC,EAAC,GAAE,EAAG,CAAC,IAAGA,GAAE,aAAWC,OAAIF,GAAE,WAAW,IAAIA,GAAE,uBAAsB,MAAM,GAAEA,GAAE,WAAW,IAAIA,GAAE,uBAAsB,MAAM,GAAEA,GAAE,WAAW,IAAIA,GAAE,eAAc,MAAM,GAAEA,GAAE,WAAW,IAAIA,GAAE,qBAAoB,MAAM;AAAG,QAAM,IAAEA,GAAE;AAAO,EAAAE,OAAI,EAAE,QAAQ,GAAED,EAAC,GAAE,EAAE,SAAS,IAAI,IAAIA,GAAE,gBAAgB,CAACD,IAAEG,OAAIF,GAAE,EAAE,GAAEE,GAAE,OAAO,2BAA2B,CAAC,GAAEA,GAAE,OAAO,2BAA2B,CAAC,GAAEA,GAAE,OAAO,2BAA2B,EAAE,CAAC,GAAE,CAAC,CAAE,GAAE,IAAIF,GAAE,gBAAgB,CAACD,IAAEG,OAAI,EAAE,EAAE,GAAEA,GAAE,OAAO,2BAA2B,CAAC,GAAEA,GAAE,OAAO,2BAA2B,CAAC,GAAEA,GAAE,OAAO,2BAA2B,EAAE,CAAC,GAAE,CAAC,CAAE,CAAC,IAAG,EAAE,KAAK,IAAIF;AAAA;AAAA,eAErzE,IAAEC,KAAE,iEAA+D,kCAAgCA,KAAE,wCAAsC,qBAAqB;AAAA;AAAA;AAAA;AAAA,QAIvKA,KAAED;AAAA;AAAA;AAAA;AAAA;AAAA,wCAK4B,cAAc;AAAA;AAAA,KAE/C,GAAE,EAAE,KAAK,IAAIA;AAAA;AAAA,yBAEO,IAAEC,KAAE,qEAAmE,6CAA2CA,KAAE,sCAAoC,aAAa;AAAA;AAAA,KAEzL,GAAED,GAAE,WAASA,GAAE,WAAS,EAAE,CAAC,GAAE,EAAE,KAAK,IAAIA;AAAA;AAAA,uCAEN,IAAEC,KAAE,gFAA8E,wDAAsDA,KAAE,iDAA+C,SAAS;AAAA;AAAA,KAEpO,IAAGD,GAAE,qBAAmB,EAAE,KAAK,IAAIA;AAAA;AAAA,QAEhC,IAAEC,KAAE,gGAA8F,wEAAsEA,KAAE,iEAA+D,kBAAkB;AAAA,MAC7P;AAAC;AAAC,IAAM,IAAE,EAAE;",
  "names": ["r", "e", "o", "c", "r"]
}
