{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/interactive/visualElements/RightAngleQuadVisualElement.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{watch as e}from\"../../../../core/reactiveUtils.js\";import{fromTranslation as t,scale as r}from\"../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as i}from\"../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{q as s,n as o,f as a,c as n,j as c,g as l}from\"../../../../chunks/vec32.js\";import{create as u,ZEROS as h}from\"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{c as d}from\"../../../../chunks/vec42.js\";import{fromValues as m}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{sv3d as _}from\"../../../../geometry/support/vectorStacks.js\";import{makeDehydratedPoint as p}from\"../../../../layers/graphics/dehydratedPoint.js\";import{EngineVisualElement as f}from\"./EngineVisualElement.js\";import{drapedZ as g}from\"../../terrain/OverlayRenderer.js\";import{Attribute as b}from\"../../webgl-engine/lib/Attribute.js\";import{Geometry as M}from\"../../webgl-engine/lib/Geometry.js\";import{createPolylineGeometry as O}from\"../../webgl-engine/lib/GeometryUtil.js\";import{RenderOccludedFlag as j}from\"../../webgl-engine/lib/Material.js\";import{RenderGeometry as R}from\"../../webgl-engine/lib/RenderGeometry.js\";import{VertexAttribute as w}from\"../../webgl-engine/lib/VertexAttribute.js\";import{ColorMaterial as z}from\"../../webgl-engine/materials/ColorMaterial.js\";import{RibbonLineMaterial as y}from\"../../webgl-engine/materials/RibbonLineMaterial.js\";class D extends f{constructor(e){super(e),this._maxSize=0,this._position=u(),this._up=u(),this._right=u(),this._renderOccluded=j.OccludeAndTransparent,this._color=m(1,0,0,1),this._outlineColor=m(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=j.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:P}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){d(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){d(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:r}){this._maxSize=Math.min(s(t,e),s(t,r))/3,o(this._up,a(this._up,e,t)),o(this._right,a(this._right,r,t)),n(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new z(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new y(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r,forEach:e=>{e(t),r&&e(r)}}}_createObject3DGeometries(e,t,r){if(c(this._up,h)&&c(this._right,h))return;const i=this._createGeometries(t,r);for(const s of i)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const t=new z(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new y(this._outlineMaterialParameters),i=this._createGeometries(t,r).map((e=>new R(e)));this._setTransformDraped(i);return{quadMaterial:t,outlineMaterial:r,geometries:i,pixelRatioHandle:e((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:r,right:i,corner:s}=this._getVertices(),o=v(r,i,s,e);if(!t)return[o];return[o,O(t,[r,s,i])]}_getVertices(){let e=this._up,t=this._right;const r=l(_.get(),e,t);return this.isDraped&&(e=n(_.get(),e),t=n(_.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const i=this.view.state.camera,s=this._size*i.computeScreenPixelSizeAt(this._position),o=Math.min(this._maxSize,s);t(x,this._position),r(x,x,[o,o,o]),e.transformation=x}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:i},state:{contentPixelRatio:s}}}=this,{_position:o,_size:a}=this,c=n(_.get(),o);c[2]=g;const l=S;l.spatialReference=i.renderer.spatialReference,l.x=c[0],l.y=c[1];const u=a*(this.view.overlayPixelSizeInMapUnits(l)*s),h=Math.min(this._maxSize,u);t(x,c),r(x,x,[h,h,1]);for(const t of e)t.transformation=x}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function P(e){e.pixelRatioHandle.remove(),e.geometries=[]}function v(e,t,r,i){return new M(i,[[w.POSITION,new b([0,0,0,...t,...e,...r],[0,1,2,1,2,3],3,!0)]])}const x=i(),S=p(0,0,void 0,null);export{D as RightAngleQuadVisualElement};\n"],
  "mappings": "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",
  "names": ["t", "e", "r", "x", "a", "c", "l", "u", "h"]
}
