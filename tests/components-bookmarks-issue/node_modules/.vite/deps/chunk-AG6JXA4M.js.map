{
  "version": 3,
  "sources": ["../../@arcgis/core/support/arcadeOnDemand.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport\"../geometry.js\";import e from\"../core/Error.js\";import r from\"../core/Logger.js\";import t from\"../geometry/SpatialReference.js\";const a=()=>r.getLogger(\"esri.support.arcadeOnDemand\");let s;function i(){return s||(s=(async()=>{const e=await import(\"./arcadeUtils.js\");return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),s}const c=(e,r,t)=>p.create(e,r,t,null,[\"$feature\",\"$view\"],[]),n=(e,r)=>p.create(e,r.spatialReference,r.fields,null,[\"$feature\",\"$view\"],[]),o=(e,r,t)=>p.create(e,r,t,null,[\"$feature\",\"$view\"],[]),l=o,u=(e,r,t,a)=>p.create(e,r,t,a,[\"$feature\",\"$view\"],[]);class p{constructor(e,r,t,a,s,i,c){this.services=null,this.script=e,this.evaluate=a;const n=Array.isArray(i)?i:i?.fields;this.fields=n??[],this._syntaxTree=t,this._arcade=r,this._arcadeFeature=s,this._spatialReference=c,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,\"scale\")}static async create(r,s,c,n,o,l){const{arcade:u,Feature:f,Dictionary:m}=await i(),d=t.fromJSON(s);let y;try{y=u.parseScript(r,l)}catch(x){return a().error(new e(\"arcade-bad-expression\",\"Failed to parse arcade script\",{script:r,error:x})),null}const h=o.reduce(((e,r)=>({...e,[r]:null})),{});let w=null;null!=n&&(w=new m(n),w.immutable=!0,h.$config=null);const v=u.scriptUsesGeometryEngine(y),$=v&&u.enableGeometrySupport(),g=u.scriptUsesFeatureSet(y)&&u.enableFeatureSetSupport(),_=u.scriptIsAsync(y),F=_&&u.enableAsyncSupport(),S={vars:h,spatialReference:d,useAsync:!!F};await Promise.all([$,g,F]);const b=new Set;await u.loadDependentModules(b,y,null,_,v);const R=new m;R.immutable=!1,R.setField(\"scale\",0);const j=u.compileScript(y,S),G=(e,r)=>{const t=e.$view?.timeZone;return\"$view\"in e&&e.$view&&(R.setField(\"scale\",\"object\"==typeof e.$view&&\"scale\"in e.$view?e.$view.scale:void 0),e.$view=R),w&&(e.$config=w),j({vars:e,spatialReference:d,services:r,timeZone:t})};return new p(r,u,y,G,new f,c,d)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}export{p as ArcadeExpression,u as createDictionaryExpression,c as createLabelExpression,o as createRendererExpression,n as createRendererExpressionWithOptions,l as createVVExpression,i as loadArcade};\n"],
  "mappings": "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",
  "names": ["s", "a", "s", "i", "c", "n", "o", "u", "f", "r"]
}
