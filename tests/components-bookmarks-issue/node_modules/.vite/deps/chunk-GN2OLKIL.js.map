{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/terrain/OverlayContent.js", "../../@arcgis/core/views/3d/webgl-engine/core/renderPasses/AllRenderPasses.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nvar o;!function(o){o[o.Color=0]=\"Color\",o[o.ColorNoRasterImage=1]=\"ColorNoRasterImage\",o[o.Highlight=2]=\"Highlight\",o[o.WaterNormal=3]=\"WaterNormal\",o[o.Occluded=4]=\"Occluded\",o[o.ObjectAndLayerIdColor=5]=\"ObjectAndLayerIdColor\"}(o||(o={}));export{o as OverlayContent};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{create as t}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{ShaderOutput as r}from\"../shaderLibrary/ShaderOutput.js\";import{VertexNormalPassParameters as i,VertexNormalDrawParameters as s}from\"../shaderLibrary/attributes/VertexNormal.glsl.js\";class e extends i{constructor(){super(...arguments),this.slicePlaneLocalOrigin=t(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}class a extends s{}var o;!function(t){t[t.Material=0]=\"Material\",t[t.ShadowMap=1]=\"ShadowMap\",t[t.Highlight=2]=\"Highlight\"}(o||(o={}));class l extends e{constructor(){super(...arguments),this.identifier=o.Material,this.output=r.Color,this.transparent=!1}}class n extends e{constructor(){super(...arguments),this.identifier=o.ShadowMap}}class c extends e{constructor(){super(...arguments),this.identifier=o.Highlight}}export{a as DrawParameters,c as HighlightPassParameters,l as MaterialPassParameters,e as PassParameters,o as RenderPassIdentifier,n as ShadowMapPassParameters};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{hasArea as o,width as r,height as t}from\"../../../../../../geometry/support/aaBoundingRect.js\";import{OverlayIndex as a}from\"../../../../terrain/interfaces.js\";import{OverlayContent as i}from\"../../../../terrain/OverlayContent.js\";import{RenderPassIdentifier as l}from\"../../renderPasses/AllRenderPasses.js\";import{ShaderOutput as s}from\"../ShaderOutput.js\";import{addMainLightDirection as n,addMainLightIntensity as d}from\"../shading/MainLighting.glsl.js\";import{PBRMode as c}from\"../shading/PhysicallyBasedRenderingParameters.glsl.js\";import{Water as v}from\"../shading/Water.glsl.js\";import{Float4DrawUniform as x}from\"../../shaderModules/Float4DrawUniform.js\";import{FloatPassUniform as p}from\"../../shaderModules/FloatPassUniform.js\";import{glsl as y}from\"../../shaderModules/interfaces.js\";import{Texture2DPassUniform as u}from\"../../shaderModules/Texture2DPassUniform.js\";import{Uniform as m}from\"../../shaderModules/Uniform.js\";var f;function C(e,o){const{vertex:r,fragment:t}=e;r.uniforms.add(new x(\"overlayTexOffset\",((e,o)=>b(e,o))),new x(\"overlayTexScale\",((e,o)=>M(e,o)))),t.constants.add(\"overlayOpacity\",\"float\",1),t.uniforms.add(new u(\"ovColorTex\",((e,o)=>O(e,o)))),T(e,o)}function g(e,o){const{vertex:r,fragment:t}=e;r.uniforms.add(new h(\"overlayTexOffset\"),new h(\"overlayTexScale\")),t.uniforms.add(new p(\"overlayOpacity\",(e=>e.overlayOpacity)),new u(\"ovColorTex\",((e,o)=>o.overlay?.getTexture(e.overlayContent)))),T(e,o)}!function(e){e[e.Disabled=0]=\"Disabled\",e[e.Enabled=1]=\"Enabled\",e[e.EnabledWithWater=2]=\"EnabledWithWater\",e[e.COUNT=3]=\"COUNT\"}(f||(f={}));class h extends m{constructor(e){super(e,\"vec4\")}}function T(e,o){o.pbrMode!==c.Water&&o.pbrMode!==c.WaterOnIntegratedMesh&&o.pbrMode!==c.TerrainWithWater||e.include(v,o);const{vertex:r,fragment:t}=e;e.varyings.add(\"vtcOverlay\",\"vec4\"),r.code.add(y`void setOverlayVTC(in vec2 uv) {\nvtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n}`),t.code.add(y`bool isValid(vec2 uv, vec2 dxdy) {\nreturn (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);\n}\nvec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {\nvec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));\nvec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}`),t.code.add(y`vec4 getCombinedOverlayColor() {\nreturn overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);\n}`),t.code.add(y`vec4 getOverlayColorTexel(vec4 texCoords) {\nvec2 texDim =  vec2(textureSize(ovColorTex, 0));\nvec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);\nvec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}`),o.pbrMode!==c.Water&&o.pbrMode!==c.WaterOnIntegratedMesh&&o.pbrMode!==c.TerrainWithWater||(n(t),d(t),t.code.add(y`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\nfloat shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {\nvec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\nvec3 v = vposEyeDir;\nvec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);\nreturn vec4(final, colorInput.w);\n}`))}function O(e,o){return e.identifier===l.Material&&e.output===s.Color?o.overlay?.getTexture(i.ColorNoRasterImage):e.identifier===l.Material&&e.output===s.ObjectAndLayerIdColor?o.overlay?.getTexture(i.ObjectAndLayerIdColor):e.identifier===l.Highlight?o.overlay?.getTexture(i.Highlight):null}function b(e,i){const l=i.overlay?.overlays[a.INNER]?.extent;o(l)&&(w[0]=e.toMapSpace[0]/r(l)-l[0]/r(l),w[1]=e.toMapSpace[1]/t(l)-l[1]/t(l));const s=i.overlay?.overlays[a.OUTER]?.extent;return o(s)&&(w[2]=e.toMapSpace[0]/r(s)-s[0]/r(s),w[3]=e.toMapSpace[1]/t(s)-s[1]/t(s)),w}function M(e,i){const l=i.overlay?.overlays[a.INNER]?.extent;o(l)&&(w[0]=e.toMapSpace[2]/r(l),w[1]=e.toMapSpace[3]/t(l));const s=i.overlay?.overlays[a.OUTER]?.extent;return o(s)&&(w[2]=e.toMapSpace[2]/r(s),w[3]=e.toMapSpace[3]/t(s)),w}const w=e();export{C as OverlayIM,f as OverlayMode,g as OverlayTerrain,O as getIMColorTexture};\n"],
  "mappings": "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",
  "names": ["o", "o", "t", "n", "c", "f", "e", "o", "t", "M", "s", "a", "l", "n"]
}
