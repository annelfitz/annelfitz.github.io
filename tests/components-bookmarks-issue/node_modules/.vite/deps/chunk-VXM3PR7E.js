import {
  p as p2
} from "./chunk-VE57JPH4.js";
import {
  x
} from "./chunk-FLBJ53KN.js";
import {
  i
} from "./chunk-CQFVWMFK.js";
import {
  R,
  g,
  m,
  p,
  v,
  w
} from "./chunk-CZSTCON2.js";
import {
  n as n2
} from "./chunk-TPLOIZC7.js";
import {
  Ht,
  V,
  Y,
  Z,
  it
} from "./chunk-SAYWXQVM.js";
import {
  d,
  n2 as n
} from "./chunk-NDIXNREV.js";
import {
  o2 as o
} from "./chunk-I2RC5KWA.js";
import {
  s
} from "./chunk-7RBRCL6S.js";

// node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js
function j(t) {
  const r = (t == null ? void 0 : t.origins) ?? [void 0];
  return (e, o2) => {
    const s2 = U(t, e, o2);
    for (const t2 of r) {
      const r2 = d(e, t2, o2);
      for (const t3 in s2)
        r2[t3] = s2[t3];
    }
  };
}
function U(t, r, e) {
  if ("resource" === (t == null ? void 0 : t.type))
    return w2(t, r, e);
  switch ((t == null ? void 0 : t.type) ?? "other") {
    case "other":
      return { read: true, write: true };
    case "url": {
      const { read: t2, write: r2 } = w;
      return { read: t2, write: r2 };
    }
  }
}
function w2(t, r, n3) {
  const i2 = o(r, n3);
  return { type: String, read: (t2, r2, e) => {
    const o2 = p(t2, r2, e);
    return i2.type === String ? o2 : "function" == typeof i2.type ? new i2.type({ url: o2 }) : void 0;
  }, write: { writer(r2, p3, c, u) {
    if (!(u == null ? void 0 : u.resources))
      return "string" == typeof r2 ? void (p3[c] = m(r2, u)) : void (p3[c] = r2.write({}, u));
    const l = x2(r2), m2 = m(l, { ...u, verifyItemRelativeUrls: (u == null ? void 0 : u.verifyItemRelativeUrls) ? { writtenUrls: u.verifyItemRelativeUrls.writtenUrls, rootPath: void 0 } : void 0 }, R.NO), d2 = i2.type !== String && (!i(this) || (u == null ? void 0 : u.origin) && this.originIdOf(n3) > n(u.origin)), h = { object: this, propertyName: n3, value: r2, targetUrl: m2, dest: p3, targetPropertyName: c, context: u, params: t };
    (u == null ? void 0 : u.portalItem) && m2 && !Y(m2) ? d2 && (t == null ? void 0 : t.contentAddressed) ? I(h) : d2 ? N(h) : P(h) : (u == null ? void 0 : u.portalItem) && (null == m2 || null != g(m2) || Z(m2) || d2) ? I(h) : p3[c] = m2;
  } } };
}
function I(e) {
  var _a;
  const { targetUrl: o2, params: p3, value: u, context: a, dest: l, targetPropertyName: d2 } = e;
  if (!a.portalItem)
    return;
  const f = v(o2), y = S(u, o2, a);
  if ((p3 == null ? void 0 : p3.contentAddressed) && "json" !== y.type)
    return void ((_a = a.messages) == null ? void 0 : _a.push(new s("persistable:contentAddressingUnsupported", `Property "${d2}" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`, { content: y })));
  const g2 = (p3 == null ? void 0 : p3.contentAddressed) && "json" === y.type ? x(y.jsonString) : (f == null ? void 0 : f.filename) ?? n2(), v2 = V((p3 == null ? void 0 : p3.prefix) ?? (f == null ? void 0 : f.prefix), g2), j2 = `${v2}.${p2(y)}`;
  if ((p3 == null ? void 0 : p3.contentAddressed) && a.resources && "json" === y.type) {
    const t = a.resources.toKeep.find(({ resource: t2 }) => t2.path === j2) ?? a.resources.toAdd.find(({ resource: t2 }) => t2.path === j2);
    if (t)
      return void (l[d2] = t.resource.itemRelativeUrl);
  }
  const U2 = a.portalItem.resourceFromPath(j2);
  Z(o2) && a.resources && a.resources.pendingOperations.push(it(o2).then((t) => {
    U2.path = `${v2}.${p2({ type: "blob", blob: t })}`, l[d2] = U2.itemRelativeUrl;
  }).catch(() => {
  }));
  const w3 = (p3 == null ? void 0 : p3.compress) ?? false;
  a.resources && b({ ...e, resource: U2, content: y, compress: w3, updates: a.resources.toAdd }), l[d2] = U2.itemRelativeUrl;
}
function N(t) {
  const { context: r, targetUrl: e, params: o2, value: s2, dest: n3, targetPropertyName: i2 } = t;
  if (!r.portalItem)
    return;
  const c = r.portalItem.resourceFromPath(e), u = S(s2, e, r), a = p2(u), l = Ht(c.path), d2 = (o2 == null ? void 0 : o2.compress) ?? false;
  a === l ? (r.resources && b({ ...t, resource: c, content: u, compress: d2, updates: r.resources.toUpdate }), n3[i2] = e) : I(t);
}
function P({ context: t, targetUrl: r, dest: e, targetPropertyName: o2 }) {
  t.portalItem && t.resources && (t.resources.toKeep.push({ resource: t.portalItem.resourceFromPath(r), compress: false }), e[o2] = r);
}
function b({ object: t, propertyName: r, updates: e, resource: o2, content: s2, compress: n3 }) {
  const i2 = (e2) => {
    O(t, r, e2);
  };
  e.push({ resource: o2, content: s2, compress: n3, finish: i2 });
}
function S(t, r, e) {
  return "string" == typeof t ? { type: "url", url: r } : { type: "json", jsonString: JSON.stringify(t.toJSON(e)) };
}
function x2(t) {
  return null == t ? null : "string" == typeof t ? t : t.url;
}
function O(t, r, e) {
  "string" == typeof t[r] ? t[r] = e.url : t[r].url = e.url;
}

export {
  j
};
//# sourceMappingURL=chunk-VXM3PR7E.js.map
