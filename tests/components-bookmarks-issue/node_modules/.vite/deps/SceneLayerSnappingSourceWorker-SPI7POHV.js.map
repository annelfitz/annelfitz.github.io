{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js", "../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{r as s,q as r,g as o}from\"../../../../../chunks/vec32.js\";import{c,g as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function e(t,e,a){const m=c(),p=n(m);return s(p,p,t,.5),s(p,p,e,.5),m[3]=r(p,t),o(p,p,a),m}export{e as boundsFromEdge,t as maxCandidateCount};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{g as s,q as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{g as p,n as m}from\"../../../../../chunks/sphere.js\";import u from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as h}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as g,boundsFromEdge as l}from\"./sceneLayerSnappingUtils.js\";let f=class{constructor(){this._idToComponent=new Map,this._components=new u((e=>e.bounds)),this._edges=new u((e=>e.bounds)),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,s),s.length<g)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0}),e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new j(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((o=>(o.component===t&&e.push(o),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=h.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=l(n,r,e.origin),d=new w(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),b(e,p,d,o),b(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};f=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],f);const _=f;function b(e,t,o,s){if(!e.returnVertex||!m(e.bounds,o))return;const i=p(e.bounds);s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(i,o)})}class j{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++j.uid}}j.uid=0;class w{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}export{_ as default};\n"],
  "mappings": "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",
  "names": ["t", "e", "a", "m", "e", "s", "t", "n", "j", "c", "d", "w", "a", "b", "u"]
}
