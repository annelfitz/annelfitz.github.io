{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/save/utils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import o from\"../../portal/PortalItem.js\";import{createForItemWrite as a}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{validateSaveAPIKey as s}from\"../../webdoc/support/saveAPIKeyUtils.js\";import{evaluateWriteErrors as p}from\"../../webdoc/support/saveUtils.js\";function l(t,r,o){const a=o(t);if(!a.isValid)throw new e(`${r}:invalid-parameters`,a.errorMessage,{layer:t})}async function m(e){const{layer:t,errorNamePrefix:r,validateLayer:o}=e;await t.load(),l(t,r,o)}function c(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function u(t){const{item:r,errorNamePrefix:o,layer:a,validateItem:i}=t;if(s(r),f(t),i){const t=i(r);if(!t.isValid)throw new e(`${o}:invalid-parameters`,t.errorMessage,{layer:a})}}function f(t){const{item:r,itemType:o,additionalItemType:a,errorNamePrefix:i,layer:n}=t,s=[o];if(a&&s.push(a),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function d(t){const{layer:r,errorNamePrefix:o}=t,{portalItem:a}=r;if(!a)throw new e(`${o}:portal-item-not-set`,c(r,\"requires the portalItem property to be set\"));if(!a.loaded)throw new e(`${o}:portal-item-not-loaded`,c(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));u({...t,item:a})}function y(e){const{newItem:t,itemType:a}=e;let i=o.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=a,i.portal??=r.getDefault(),u({...e,item:i}),i}function w(e){return a(e,\"portal-item\")}async function I(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const o=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),p(t,{errorName:\"layer-write:unsupported\"},r),o}function v(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function P(e,t,r){const o=e.portal;await o.signIn(),await(o.user?.addItem({item:e,data:t,folder:r?.folder}))}async function $(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e),d(e);const l=o.portalItem,c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await(n?.(o,l)),v(l),await l.update({data:f}),t(c),await(s?.(l,c)),l}async function j(e,r){const{layer:o,createItemData:a,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await m(e);const l=y(e),c=i?i(l):w(l),u=await I(o,c,{...r,supplementalUnsupportedErrors:p}),f=await a({layer:o,layerJSON:u},l);return await n(o,l),v(l),await P(l,f,r),o.portalItem=l,t(c),await(s?.(l,c)),l}export{P as addItem,c as createErrorMessage,w as createJSONContextForWrite,d as ensureItemConfig,l as ensureLayerConfig,I as getLayerJSON,y as getPortalItem,$ as save,j as saveAs,v as setCommonItemProperties};\n"],
  "mappings": "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",
  "names": ["t", "o", "i", "f", "s", "e", "l", "c", "u"]
}
