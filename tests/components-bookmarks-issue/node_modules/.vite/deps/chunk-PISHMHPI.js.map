{
  "version": 3,
  "sources": ["../../@arcgis/core/chunks/PointRenderer.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{numberMaxFloat32 as e}from\"../core/mathUtils.js\";import{multiply as i,fromTranslation as o}from\"../core/libs/gl-matrix-2/math/mat4.js\";import{create as r}from\"../core/libs/gl-matrix-2/factories/mat4f64.js\";import{set as t}from\"../core/libs/gl-matrix-2/math/vec2.js\";import{create as a}from\"../core/libs/gl-matrix-2/factories/vec2f64.js\";import{s}from\"./vec32.js\";import{create as n}from\"../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,positiveInfinity as l}from\"../geometry/support/aaBoundingBox.js\";import{addNearFar as p,addCalculateLinearDepth as d}from\"../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl.js\";import{ShaderOutput as m}from\"../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput.js\";import{SlicePlaneParameters as g,SliceDraw as f}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{OutputHighlight as u}from\"../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{RgbaFloatEncoding as h}from\"../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl.js\";import{Float2DrawUniform as S}from\"../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform.js\";import{Float2PassUniform as x}from\"../views/3d/webgl-engine/core/shaderModules/Float2PassUniform.js\";import{Float3DrawUniform as v}from\"../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform.js\";import{NoParameters as w,glsl as z}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{Matrix4DrawUniform as b}from\"../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform.js\";import{Matrix4PassUniform as M}from\"../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform.js\";import{ShaderBuilder as j}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";import{VertexAttribute as P}from\"../views/3d/webgl-engine/lib/VertexAttribute.js\";class y extends w{constructor(){super(...arguments),this.clipBox=c(l),this.useFixedSizes=!1,this.useRealWorldSymbolSizes=!1,this.scaleFactor=1,this.minSizePx=0,this.size=0,this.sizePx=0}get fixedSize(){return this.drawScreenSpace?this.sizePx:this.size}get screenMinSize(){return this.useFixedSizes?0:this.minSizePx}get drawScreenSpace(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}class O extends g{constructor(e,i,o){super(e),this.origin=e,this.isLeaf=i,this.splatSize=o}}function R(r){const a=new j,n=r.output===m.Color,c=r.output===m.LinearDepth,l=r.output===m.Highlight,{vertex:g,fragment:w}=a;return a.include(f,r),a.attributes.add(P.POSITION,\"vec3\"),a.attributes.add(P.COLOR,\"vec3\"),g.uniforms.add(new b(\"modelView\",((e,r)=>i(B,r.camera.viewMatrix,o(B,e.origin)))),new M(\"proj\",((e,i)=>i.camera.projectionMatrix)),new S(\"screenMinMaxSize\",((e,i,o)=>t(_,o.useFixedSizes?0:o.minSizePx*i.camera.pixelRatio,F(e.isLeaf)*i.camera.pixelRatio))),r.useFixedSizes?new x(\"pointScale\",((e,i)=>t(_,e.fixedSize*i.camera.pixelRatio,i.camera.fullHeight))):new S(\"pointScale\",((e,i,o)=>t(_,e.splatSize*o.scaleFactor*i.camera.pixelRatio,i.camera.fullHeight/i.camera.pixelRatio)))),r.clippingEnabled?g.uniforms.add(new v(\"clipMin\",((e,i,o)=>s(L,o.clipBox[0]-e.origin[0],o.clipBox[1]-e.origin[1],o.clipBox[2]-e.origin[2]))),new v(\"clipMax\",((e,i,o)=>s(L,o.clipBox[3]-e.origin[0],o.clipBox[4]-e.origin[1],o.clipBox[5]-e.origin[2])))):(g.constants.add(\"clipMin\",\"vec3\",[-e,-e,-e]),g.constants.add(\"clipMax\",\"vec3\",[e,e,e])),c?(p(a),d(a),a.varyings.add(\"depth\",\"float\")):r.output!==m.Highlight&&a.varyings.add(\"vColor\",\"vec3\"),g.code.add(z`\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||\n        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera = modelView * vec4(position, 1.0);\n\n      float pointSize = pointScale.x;\n      vec4 position = proj * camera;\n     ${r.drawScreenSize?z`\n      float clampedScreenSize = pointSize;`:z`\n      float pointRadius = 0.5 * pointSize;\n      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset = proj * cameraOffset;\n      float radius = abs(positionOffset.y - position.y);\n      float viewHeight = pointScale.y;\n      // screen diameter = (2 * r / w) * (h / 2)\n      float screenPointSize = (radius / position.w) * viewHeight;\n      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position = proj * camera;`}\n\n     gl_PointSize = clampedScreenSize;\n     gl_Position = position;\n\n     ${c?z`depth = calculateLinearDepth(nearFar, camera.z);`:\"\"}\n     ${n?z`vColor = color;`:\"\"}\n    }\n  `),w.include(h,r),l&&a.include(u,r),w.code.add(z`\n    void main(void) {\n      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n      float r2 = dot(vOffset, vOffset);\n\n      if (r2 > 0.25) {\n        discard;\n      }\n      ${c?z`fragColor = float2rgba(depth);`:\"\"}\n      ${l?z`outputHighlight();`:\"\"}\n      ${n?z`fragColor = vec4(vColor, 1.0);`:\"\"}\n    }\n  `),a}function F(e){return e?256:64}const B=r(),L=n(),_=a(),C=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:O,PointRendererPassParameters:y,build:R,getMaxPointSizeScreenspace:F},Symbol.toStringTag,{value:\"Module\"}));export{y as P,O as a,C as b,R as c,F as g};\n"],
  "mappings": "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",
  "names": ["n", "e", "i", "o", "a", "c", "r"]
}
