import {
  v
} from "./chunk-N5A4ZMGV.js";
import {
  A,
  _,
  c,
  f,
  l,
  m,
  p
} from "./chunk-HB6ZUQQ2.js";
import {
  L
} from "./chunk-WKVHVZW2.js";
import {
  r
} from "./chunk-QHK5ZYFW.js";

// node_modules/@arcgis/core/views/3d/terrain/RasterTile.js
var u = { bandCount: 3, outMin: 0, outMax: 1, minCutOff: [0, 0, 0], maxCutOff: [255, 255, 255], factor: [1 / 255, 1 / 255, 1 / 255], useGamma: false, gamma: [1, 1, 1], gammaCorrection: [1, 1, 1], colormap: null, colormapOffset: null, stretchType: "none", type: "stretch" };
var m2 = class {
  constructor(t, e, r2 = null, s = null) {
    this.lij = t, this.type = "raster-tile", this._memoryUsed = null, this._source = null, this._symbolizerParameters = null, this._bandIds = null, this._interpolation = null, this._dirty = false, this._transformGrid = null, this.isRendereredSource = false, this.symbolizerRenderer = null, this.rawPixelData = null, this.opacity = 1, this.source = e, this.width = r2 || e.width, this.height = s || e.height;
  }
  get source() {
    return this._source;
  }
  set source(e) {
    this._source = e, this._rasterTexture = r(this._rasterTexture), this._memoryUsed = null;
  }
  get symbolizerParameters() {
    return this.isRendereredSource ? { ...u, maxCutOff: [1, 1, 1], factor: [1, 1, 1] } : this._symbolizerParameters || u;
  }
  set symbolizerParameters(t) {
    this._symbolizerParameters = t;
  }
  get bandIds() {
    return this._bandIds;
  }
  set bandIds(t) {
    if (null != t && t.length > 0) {
      this._bandIds && t.every((t2, e) => {
        var _a;
        return !!((_a = this._bandIds) == null ? void 0 : _a[e]) && t2 === this._bandIds[e];
      }) || (this._bandIds = t, this._dirty = true);
    } else
      this._bandIds = null;
  }
  get interpolation() {
    return this._interpolation || "nearest";
  }
  set interpolation(t) {
    if (this._interpolation = t, null != this._rasterTexture) {
      const e = this._getRasterTextureInterpolation(t);
      this._rasterTexture.setSamplingMode("bilinear" === e ? L.LINEAR : L.NEAREST);
    }
  }
  get transformGrid() {
    return this._transformGrid;
  }
  set transformGrid(e) {
    this._transformGrid = e, this._transformGridTexture = r(this._transformGridTexture), this._memoryUsed = null;
  }
  bind(t) {
    return !!(this.source && this.source.pixels && this.source.pixels.length > 0) && ((null == this._rasterTexture || this._dirty) && this._updateRasterTexture(t, this.bandIds), null != this._rasterTexture && (this._updateColormapTexture(t), this.transformGrid && null == this._transformGridTexture && (this._transformGridTexture = c(t, this.transformGrid))), true);
  }
  getUniforms() {
    const { symbolizerParameters: t, transformGrid: r2, width: s, height: h, opacity: n } = this, u2 = l(r2, [s, h], [this.source.width, this.source.height], n), m3 = _(t.colormap, t.colormapOffset), d = "stretch" === this.symbolizerParameters.type ? p(this.symbolizerParameters) : null, _2 = "hillshade" === this.symbolizerParameters.type ? A(this.symbolizerParameters) : null;
    return new v(u2, m3, d || _2, this._rasterTexture, this._transformGridTexture, this._colormapTexture);
  }
  get isBilinearWithStretchColorRamp() {
    const { symbolizerParameters: t } = this;
    return "bilinear" === this.interpolation && null != t.colormap && "stretch" === t.type;
  }
  get memoryUsage() {
    if (null == this._memoryUsed) {
      const t = [this._rasterTexture, this._transformGridTexture, this._colormapTexture];
      this._memoryUsed = t.map((t2) => null != t2 ? t2.descriptor.width * t2.descriptor.height * 4 : 0).reduce((t2, e) => t2 + e, 0);
    }
    return this._memoryUsed;
  }
  release() {
    return this._rasterTexture = r(this._rasterTexture), this._transformGridTexture = r(this._transformGridTexture), this._colormapTexture = r(this._colormapTexture), this.source = null, this.transformGrid = null, this.rawPixelData = null, true;
  }
  _updateRasterTexture(e, r2) {
    const s = this.source ? this.source.extractBands(r2) : null;
    if (!(s && s.pixels && s.pixels.length > 0))
      return void (this._rasterTexture = r(this._rasterTexture));
    const i = null == r2 && null == this.bandIds || null != r2 && null != this.bandIds && r2.join("") === this.bandIds.join("");
    if (null != this._rasterTexture && i)
      return;
    this._rasterTexture = r(this._rasterTexture);
    const o = this._getRasterTextureInterpolation(this.interpolation);
    this._rasterTexture = f(e, s, o, this.isRendereredSource || this.hasStretchTypeNone());
  }
  hasStretchTypeNone() {
    return "stretchType" in this.symbolizerParameters && "none" === this.symbolizerParameters.stretchType && !this.symbolizerParameters.useGamma && "u8" === this.source.pixelType;
  }
  _getRasterTextureInterpolation(t) {
    return "lut" === this.symbolizerParameters.type || "nearest" === t || "majority" === t || this.isBilinearWithStretchColorRamp ? "nearest" : "bilinear";
  }
  _updateColormapTexture(e) {
    const r2 = this._colormap, s = this.symbolizerParameters.colormap;
    return s ? r2 ? s.length !== r2.length || s.some((t, e2) => t !== r2[e2]) ? (this._colormapTexture = r(this._colormapTexture), this._colormapTexture = m(e, s), void (this._colormap = s)) : void 0 : (this._colormapTexture = m(e, s), void (this._colormap = s)) : (this._colormapTexture = r(this._colormapTexture), void (this._colormap = null));
  }
};

export {
  m2 as m
};
//# sourceMappingURL=chunk-YWTRNCRU.js.map
