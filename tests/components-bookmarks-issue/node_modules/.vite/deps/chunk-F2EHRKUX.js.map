{
  "version": 3,
  "sources": ["../../@arcgis/core/rest/query/operations/query.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as o}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as u}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as l}from\"./queryZScale.js\";const s=\"Layer does not support extent calculation.\";function m(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const o=i;let u,l,s;if(null!=n&&(l=n.spatialReference,s=a(l),o.geometryType=r(n),o.geometry=m(n,t.compactGeometryEnabled),o.inSR=s),i.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(o.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(o.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete o.outFields:i.outFields.includes(\"*\")?o.outFields=\"*\":o.outFields=i.outFields.join(\",\"),i.outSR?(o.outSR=a(i.outSR),u=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(o.outSR=o.inSR,u=l),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(o.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(o.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(o.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=l&&null!=t.quantizationParameters?.extent&&l.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(o.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(o.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(o.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(o.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function c(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await E(t,e,\"json\",r);return l(e,n,i.data),i}async function f(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await d(t,e,r),a=i;return a.data=u(i.data,n),a}function d(t,e,n){return E(t,e,\"pbf\",n)}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(t,e,\"json\",n,{returnIdsOnly:!0})}function S(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await E(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(s);if(i.hasOwnProperty(\"count\"))throw new Error(s);return r}async function E(r,a,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=a.geometry?[a.geometry]:[],f=await i(c,null,{signal:l.signal}),d=f?.[0];null!=d&&((a=a.clone()).geometry=d);const p=o({...m.query,f:u,...s,...y(a,s)});return t(n(m.path,g(a,s)?\"query3d\":\"query\"),{...l,responseType:\"pbf\"===u?\"array-buffer\":\"json\",query:{...p,...l.query}})}function g(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{m as encodeGeometry,c as executeQuery,S as executeQueryForCount,x as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,d as executeQueryPBFBuffer,y as queryToQueryStringParameters,E as runQuery};\n"],
  "mappings": "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",
  "names": ["t", "s", "e", "n", "d", "p", "m", "c", "f"]
}
