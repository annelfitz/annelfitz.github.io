{
  "version": 3,
  "sources": ["../../@esri/calcite-components/dist/esm/src/utils/label.ts"],
  "sourcesContent": ["import { closestElementCrossShadowBoundary, isBefore, queryElementRoots } from \"./dom\";\nimport { componentOnReady } from \"./component\";\n\nexport interface LabelableComponent {\n  /**\n   * When true, disabled prevents interaction.\n   */\n  disabled: boolean;\n\n  /**\n   * The host element.\n   */\n  readonly el: HTMLElement;\n\n  /**\n   * Text label.\n   */\n  label?: string;\n\n  /**\n   * The label this component is associated with.\n   */\n  labelEl: HTMLCalciteLabelElement;\n\n  /**\n   * Hook for components to provide custom label click behavior.\n   */\n  onLabelClick: (event: CustomEvent<any>) => void;\n}\n\n/**\n * Exported for testing purposes only\n *\n * @internal\n */\nexport const labelClickEvent = \"calciteInternalLabelClick\";\nexport const labelConnectedEvent = \"calciteInternalLabelConnected\";\nexport const labelDisconnectedEvent = \"calciteInternalLabelDisconnected\";\n\nconst labelTagName = \"calcite-label\";\nconst labelToLabelables = new WeakMap<HTMLCalciteLabelElement, LabelableComponent[]>();\nconst onLabelClickMap = new WeakMap<HTMLCalciteLabelElement, typeof onLabelClick>();\nconst onLabelConnectedMap = new WeakMap<LabelableComponent, typeof onLabelConnected>();\nconst onLabelDisconnectedMap = new WeakMap<LabelableComponent, typeof onLabelDisconnected>();\nconst unlabeledComponents = new Set<LabelableComponent>();\n\nconst findLabelForComponent = (componentEl: HTMLElement): HTMLCalciteLabelElement | null => {\n  const { id } = componentEl;\n\n  const forLabel =\n    id && (queryElementRoots(componentEl, { selector: `${labelTagName}[for=\"${id}\"]` }) as HTMLCalciteLabelElement);\n\n  if (forLabel) {\n    return forLabel;\n  }\n\n  const parentLabel = closestElementCrossShadowBoundary<HTMLCalciteLabelElement>(componentEl, labelTagName);\n\n  if (\n    !parentLabel ||\n    // labelable components within other custom elements are not considered labelable\n    hasAncestorCustomElements(parentLabel, componentEl)\n  ) {\n    return null;\n  }\n\n  return parentLabel;\n};\n\nfunction hasAncestorCustomElements(label: HTMLCalciteLabelElement, componentEl: HTMLElement): boolean {\n  let traversedElements: HTMLElement[];\n  const customElementAncestorCheckEventType = \"custom-element-ancestor-check\";\n\n  const listener = (event: CustomEvent) => {\n    event.stopImmediatePropagation();\n    const composedPath = event.composedPath() as HTMLElement[];\n    traversedElements = composedPath.slice(composedPath.indexOf(componentEl), composedPath.indexOf(label));\n  };\n\n  label.addEventListener(customElementAncestorCheckEventType, listener, { once: true });\n\n  componentEl.dispatchEvent(new CustomEvent(customElementAncestorCheckEventType, { composed: true, bubbles: true }));\n  label.removeEventListener(customElementAncestorCheckEventType, listener);\n\n  const ancestorCustomElements = traversedElements\n    .filter((el) => el !== componentEl && el !== label)\n    .filter((el) => el.tagName?.includes(\"-\"));\n\n  return ancestorCustomElements.length > 0;\n}\n\n/**\n * Helper to set up label interactions on connectedCallback.\n *\n * @param component\n */\nexport function connectLabel(component: LabelableComponent): void {\n  if (!component) {\n    return;\n  }\n\n  const labelEl = findLabelForComponent(component.el);\n\n  if (\n    (onLabelClickMap.has(labelEl) && labelEl === component.labelEl) ||\n    (!labelEl && unlabeledComponents.has(component))\n  ) {\n    return;\n  }\n\n  const boundOnLabelDisconnected = onLabelDisconnected.bind(component);\n\n  if (labelEl) {\n    component.labelEl = labelEl;\n\n    const labelables = labelToLabelables.get(labelEl) || [];\n    labelables.push(component);\n    labelToLabelables.set(labelEl, labelables.sort(sortByDOMOrder));\n\n    if (!onLabelClickMap.has(component.labelEl)) {\n      onLabelClickMap.set(component.labelEl, onLabelClick);\n      component.labelEl.addEventListener(labelClickEvent, onLabelClick);\n    }\n\n    unlabeledComponents.delete(component);\n    document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n    onLabelDisconnectedMap.set(component, boundOnLabelDisconnected);\n    document.addEventListener(labelDisconnectedEvent, boundOnLabelDisconnected);\n  } else if (!unlabeledComponents.has(component)) {\n    boundOnLabelDisconnected();\n    document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  }\n}\n/**\n * Helper to tear down label interactions on disconnectedCallback on labelable components.\n *\n * @param component\n */\nexport function disconnectLabel(component: LabelableComponent): void {\n  if (!component) {\n    return;\n  }\n\n  unlabeledComponents.delete(component);\n  document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n  document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  onLabelConnectedMap.delete(component);\n  onLabelDisconnectedMap.delete(component);\n\n  if (!component.labelEl) {\n    return;\n  }\n\n  const labelables = labelToLabelables.get(component.labelEl);\n\n  if (labelables.length === 1) {\n    component.labelEl.removeEventListener(labelClickEvent, onLabelClickMap.get(component.labelEl));\n    onLabelClickMap.delete(component.labelEl);\n  }\n\n  labelToLabelables.set(\n    component.labelEl,\n    labelables.filter((labelable) => labelable !== component).sort(sortByDOMOrder),\n  );\n\n  component.labelEl = null;\n}\n\nfunction sortByDOMOrder(a: LabelableComponent, b: LabelableComponent): number {\n  return isBefore(a.el, b.el) ? -1 : 1;\n}\n\n/**\n * Helper to get the label text from a component.\n *\n * @param component\n */\nexport function getLabelText(component: LabelableComponent): string {\n  return component.label || component.labelEl?.textContent?.trim() || \"\";\n}\n\nfunction onLabelClick(this: HTMLCalciteLabelElement, event: CustomEvent<{ sourceEvent: MouseEvent }>): void {\n  const labelClickTarget = event.detail.sourceEvent.target as HTMLElement;\n  const labelables = labelToLabelables.get(this);\n  const clickedLabelable = labelables.find((labelable) => labelable.el === labelClickTarget);\n  const labelableChildClicked = labelables.includes(clickedLabelable);\n\n  if (labelableChildClicked) {\n    // no need to forward click as labelable will receive focus\n    return;\n  }\n\n  const firstLabelable = labelables[0];\n\n  if (firstLabelable.disabled) {\n    return;\n  }\n\n  firstLabelable.onLabelClick(event);\n}\n\nfunction onLabelConnected(this: LabelableComponent): void {\n  if (unlabeledComponents.has(this)) {\n    connectLabel(this);\n  }\n}\n\nfunction onLabelDisconnected(this: LabelableComponent): void {\n  unlabeledComponents.add(this);\n  const boundOnLabelConnected = onLabelConnectedMap.get(this) || onLabelConnected.bind(this);\n  onLabelConnectedMap.set(this, boundOnLabelConnected);\n  document.addEventListener(labelConnectedEvent, boundOnLabelConnected);\n}\n\n/**\n * Helper to associate an explicit label (i.e., using `for`) with a labelable component that does not have an associated label.\n *\n * @param label - the label element\n */\nexport async function associateExplicitLabelToUnlabeledComponent(label: HTMLCalciteLabelElement): Promise<void> {\n  await componentOnReady(label);\n\n  const alreadyLabeled = labelToLabelables.has(label);\n\n  if (alreadyLabeled) {\n    return;\n  }\n\n  const forComponentEl = label.ownerDocument?.getElementById(label.for);\n\n  if (!forComponentEl) {\n    return;\n  }\n\n  requestAnimationFrame(() => {\n    for (const labelable of unlabeledComponents) {\n      if (labelable.el === forComponentEl) {\n        connectLabel(labelable);\n        break;\n      }\n    }\n  });\n}\n"],
  "mappings": "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",
  "names": []
}
