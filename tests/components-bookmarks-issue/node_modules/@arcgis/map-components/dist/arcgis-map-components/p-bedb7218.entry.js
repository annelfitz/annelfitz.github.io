/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.13
 */
import{r as i,c as t,h as e,H as s,g as n}from"./p-7d3260b2.js";import{i as c}from"./p-af31b1ec.js";const o=class{constructor(e){i(this,e),this.versionItemActionClickedEventWithServiceUrl=t(this,"versionItemActionClickedEventWithServiceUrl",7),this.versionListActionClickedEvent=t(this,"versionListActionClickedEvent",7),this._versionListEventListeners=new Map,this._watchHandles=[],this._versionItemActionClickedEventWithServiceUrl=i=>{this.versionItemActionClickedEventWithServiceUrl.emit(i.detail)},this._versionListActionClickedEvent=i=>{this.versionListActionClickedEvent.emit(i.detail)},this.flowElement=void 0,this.heading=void 0,this.serviceUrl=void 0,this.strings=void 0,this.viewModel=void 0,this.state=void 0}async componentDidLoad(){const{watch:i}=await c();this._watchHandles.push(i((()=>this.viewModel.state),(i=>{this.state=i})))}async componentWillLoad(){this.state=this.viewModel.state}disconnectedCallback(){this._watchHandles.forEach((i=>{i.remove()})),this._watchHandles=[],this._removeVersionListEventListeners(this._versionList)}render(){const{flowElement:i,heading:t,serviceUrl:n,strings:c,viewModel:o}=this;let{_versionList:a}=this;const r=o.serviceNameLookup.get(n);return e(s,null,e("calcite-panel",{heading:r},e("calcite-action",{id:`actionManageVersions_${r}`,icon:"list",scale:"s",slot:"header-actions-end",text:"",onClick:async()=>{await o.getVersionInfos(n,!1),a=document.createElement("arcgis-version-management-version-list"),a.addEventListener("calciteFlowItemBack",(async()=>{a.remove()})),a.heading=t,a.serviceUrl=n,a.serviceName=r,a.strings=c,a.userHasAdvancedEditingUserTypeExtension=o.advancedEditingUserTypeExtensionLookup.get(n),a.versionInfos=o.versionInfoLookup.get(n),a.viewModel=o,this._addVersionListEventListeners(a),i.append(a)}}),e("calcite-tooltip",{"overlay-positioning":"fixed",referenceElement:`actionManageVersions_${r}`},e("span",null,c.headers.manageVersions))))}_addVersionListEventListeners(i){i.addEventListener("versionItemActionClickedEventWithServiceUrl",this._versionItemActionClickedEventWithServiceUrl),this._versionListEventListeners.set("versionItemActionClickedEventWithServiceUrl",this._versionItemActionClickedEventWithServiceUrl),i.addEventListener("versionListActionClickedEvent",this._versionListActionClickedEvent),this._versionListEventListeners.set("versionListActionClickedEvent",this._versionListActionClickedEvent)}_removeVersionListEventListeners(i){for(const[t,e]of this._versionListEventListeners)i.removeEventListener(t,e)}get _hostElement(){return n(this)}},a=class{constructor(e){i(this,e),this.versionPropertiesSaveClickedEvent=t(this,"versionPropertiesSaveClickedEvent",7),this._watchHandles=[],this.flowElement=void 0,this.serviceUrl=void 0,this.strings=void 0,this.versionInfo=void 0,this.viewModel=void 0,this.executionError=void 0,this.state=void 0}async componentDidLoad(){await this.viewModel.getVersionInfos(this.serviceUrl,!1)}async componentWillLoad(){const{watch:i}=await c();this._watchHandles.push(i((()=>this.viewModel.state),(i=>{this.state=i})))}disconnectedCallback(){this._watchHandles.forEach((i=>{i.remove()})),this._watchHandles=[]}render(){const{serviceUrl:i,strings:t,versionInfo:n}=this,{viewModel:{executionError:c}}=this;return e(s,null,e("calcite-flow-item",{description:n?n.versionIdentifier.name:"",heading:n?t.actions.editVersion:t.actions.newVersion},e("calcite-panel",{loading:"executing"===this.state},e("div",{class:"div-content"},e("calcite-label",null,t.input.versionName,e("calcite-input-text",{id:"inputName",maxLength:62,value:n?n.versionIdentifier.name.split(".")[1]:""})),e("calcite-label",null,t.input.versionDescription,e("calcite-text-area",{id:"inputDescription",resize:"vertical",value:n?n.description:""})),e("calcite-label",null,t.input.versionAccess,e("calcite-chip-group",{id:"chipGroupAccessLevel",selectionMode:"single",label:""},e("calcite-chip",{selected:"public"===n?.access||!n,value:"public"},t.accessLevels.public),e("calcite-chip",{selected:"protected"===n?.access,value:"protected"},t.accessLevels.protected),e("calcite-chip",{selected:"private"===n?.access,value:"private"},t.accessLevels.private))),e("calcite-label",null,t.input.versionOwner,e("calcite-input-text",{id:"inputOwner",disabled:!this.viewModel.advancedEditingUserTypeExtensionLookup.get(i),value:n?n.versionIdentifier.name.split(".")[0]:this.viewModel.userLookup.get(i)?.toUpperCase()})),e("calcite-button",{appearance:"outline",slot:"footer",width:"half",onClick:()=>{this.flowElement.back()}},t.actions.cancelSave),e("calcite-button",{slot:"footer",width:"half",onClick:async()=>{const t=Array.from(this._hostElement.getElementsByTagName("calcite-input-text")),e=this._hostElement.getElementsByTagName("calcite-text-area")[0],s=t.find((i=>"inputName"===i.id)),c=t.find((i=>"inputOwner"===i.id)),o=Array.from(this._hostElement.getElementsByTagName("calcite-chip-group"))[0];this.versionPropertiesSaveClickedEvent.emit({serviceUrl:i,versionInfo:{access:o.selectedItems[0].value,description:e.value,versionIdentifier:{name:""!==c.value?`${c.value}.${s.value}`:s.value,guid:n?n.versionIdentifier.guid:""}}})}},t.actions.saveVersion)),"failed"===this.state?e("calcite-notice",{class:"notice",closable:!0,kind:"warning",open:!0,scale:"s",slot:"footer"},e("div",{slot:"message"},this._getExecutionError(c))):void 0)))}_getExecutionError(i){const{strings:{executionErrors:t}}=this;switch(i){case"no-advanced-editing-user-type-extension":return t.noAdvancedEditingUserTypeExtension;case"no-feature-service-found":return t.noFeatureServiceFound;case"no-valid-enterprise-version":return t.notValidEnterpriseVersion;case"no-valid-version-name":return t.invalidVersionName;default:return i}}get _hostElement(){return n(this)}};export{o as arcgis_version_management_service_item,a as arcgis_version_management_version_properties}