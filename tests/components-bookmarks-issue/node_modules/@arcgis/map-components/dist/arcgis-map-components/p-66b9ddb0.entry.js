/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.13
 */
import{r as t,a as e,h as i,H as s,g as n}from"./p-7d3260b2.js";import{i as r,a3 as a}from"./p-af31b1ec.js";function o(t,e){let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1}var c=new Set(["ar","bg","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),l=new Map;async function h(t,e,i=""){let s=`${e}/${i}${t}.json`;if(l.has(s))return l.get(s);try{let n=await fetch(s);if(n.ok){let t=await n.json();return l.set(s,t),t}if("en"===t)return void l.set(s,void 0);let r=await h("en",e,i);return l.set(s,r),r}catch{return void l.set(s,void 0)}}var d=new WeakMap,u=new WeakMap,v=new WeakMap;async function f(t,e){let{lang:i,t9nLocale:s}=function(t){let e=function(t,e,i){return function(t,e){let i=t;for(;i;){let t=i.closest(e);if(t)return t;let s=i.getRootNode();if(s===document)return null;i=s.host}return null}(t,`[${e}]`)?.getAttribute(e)??i}(t,"lang",navigator.language||"en");if(c.has(e))return{lang:e,t9nLocale:e};let i=e.slice(0,2);return{lang:e,t9nLocale:c.has(i)?i:"en"}}(t._hostElement);if(i===t._lang&&s===t._t9nLocale||(i!==t._lang&&(t._lang=i),s===t._t9nLocale))return;let n=v.get(t);if(!n){let e=u.get(t)??"",i=t._hostElement.tagName.toLowerCase().replace("arcgis-",""),r=`${e}/${i}/t9n`,a=`${i}.t9n.`;n=await h(s,r,a)}s!==t._t9nLocale&&(t._t9nLocale=s,t._t9nStrings=n,await(e?.call(t)))}const w=class{constructor(e){t(this,e),this._watchHandles=[],this.label=void 0,this.position="top-right",this.view=void 0,this._lang="",this._t9nLocale="",this._t9nStrings=void 0,this.state=void 0}positionWatcher(t){void 0!==t&&this.viewModel&&this.view.ui.move(this._hostElement,t)}async componentDidLoad(){const{watch:t}=await r();this._watchHandles.push(t((()=>this.viewModel.state),(t=>{this.state=t})))}async componentWillLoad(){await async function(t,e,i){u.set(t,e),d.set(t,function(t,e,i=(()=>{})){if(!e||e.length<=0)return;let s=new MutationObserver((e=>{for(let s of e)o(t,s.target)&&i()}));return s.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0}),s}(t._hostElement,["lang"],(()=>{f(t,i).catch(console.error)}))),await f(t,i)}(this,e("./assets")),await this._checkForView(),this.viewModel=await a({view:this.view}),this.label=this.label?this.label:this._t9nStrings.label}disconnectedCallback(){var t;t=this,d.get(t)?.disconnect(),d.delete(t),u.delete(t),this._watchHandles.forEach((t=>{t.remove()})),this._watchHandles=[]}render(){const{_t9nStrings:t,label:e,viewModel:n,viewModel:{state:r,loadError:a}}=this,o=Array.from(this.viewModel.serviceNameLookup,(([t,e])=>({url:t,name:e})));return i(s,null,i("calcite-flow",{ref:t=>{this.flowElement=t},class:"flow-main"},i("calcite-flow-item",{heading:e},i("calcite-panel",{class:"panel-services",loading:"loading"===r},o.map((s=>i("arcgis-version-management-service-item",{flowElement:this.flowElement,heading:e,serviceUrl:s.url,strings:t,viewModel:n,onVersionItemActionClickedEventWithServiceUrl:t=>{this.flowElement&&this._handleVersionItemActionClick(t,this.flowElement)},onVersionListActionClickedEvent:t=>{this.flowElement&&this._handleVersionListActionClick(t,this.flowElement)}}))),"disabled"===r?i("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer"},i("div",{slot:"message"},this._getLoadError(a))):void 0))))}async _checkForView(){const t=this._hostElement.closest("arcgis-map");t?.view&&(await t.view.map.load(),this.view=t.view,this.view.ui.add(this._hostElement,this.position))}_createVersionPropertiesFlow(t,e){const{flowElement:i,viewModel:s}=this;if(!i)return null;const n=document.createElement("arcgis-version-management-version-properties");return n.flowElement=i,n.serviceUrl=t,n.strings=this._t9nStrings,n.versionInfo=e,n.viewModel=s,n.addEventListener("versionPropertiesSaveClickedEvent",(async t=>{const{serviceUrl:e,versionInfo:n}=t.detail,r=n.versionIdentifier.name,a=r.split(".").length>1?r.split(".")[1]:r,o=r.split(".").length>1?r.split(".")[0]:s.userLookup.get(e);if(""===n.versionIdentifier.guid?await s.createVersion({access:n.access,description:n.description,featureServerUrl:e,ownerName:o,versionName:a}):await s.alterVersion({access:n.access,description:n.description,featureServerUrl:e,ownerName:o,versionIdentifier:{name:"",guid:n.versionIdentifier.guid},versionName:a}),"ready"===s.state){const t=i.getElementsByTagName("arcgis-version-management-version-list")[0];t.versionInfos=[];const n=await s.getVersionInfos(e,!0);t.versionInfos=n,await i.back()}})),n}_getLoadError(t){const{_t9nStrings:e}=this;switch(t){case"no-feature-services":return e.loadErrors.noFeatureServices;case"no-layers-property":return e.loadErrors.noLayersProperty;default:return t}}async _handleVersionItemActionClick(t,e){const{actionType:i,serviceUrl:s,versionInfo:n}=t.detail;switch(i){case"changeVersion":await this._switchToVersion(s,n.versionIdentifier.name,n.versionIdentifier.guid);break;case"editVersion":{const t=this._createVersionPropertiesFlow(s,n);t&&e.append(t);break}}}async _handleVersionListActionClick(t,e){const{actionType:i,serviceUrl:s}=t.detail;switch(i){case"newVersion":{const t=this._createVersionPropertiesFlow(s,void 0);t&&e.append(t);break}case"refreshVersions":if(this.flowElement){const t=this.flowElement.getElementsByTagName("arcgis-version-management-version-list")[0];t.versionInfos=[];const e=await this.viewModel.getVersionInfos(s,!0);t.versionInfos=e}}}async _switchToVersion(t,e,i){await this.viewModel.changeVersion(t,e,i)}static get assetsDirs(){return["assets"]}get _hostElement(){return n(this)}static get watchers(){return{position:["positionWatcher"]}}};w.style=".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}";export{w as arcgis_version_management}