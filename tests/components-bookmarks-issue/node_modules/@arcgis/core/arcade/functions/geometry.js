/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../Dictionary.js";import{ArcadeExecutionError as t,ExecutionErrorCodes as n}from"../executionError.js";import r from"../Feature.js";import a from"../ImmutablePathArray.js";import i from"../ImmutablePointArray.js";import{H as s,o as l,q as o,x as f,S as c,I as u,r as m,B as p,c as h,j as w,k as d,b as y,n as R,m as g,a as I,i as v,f as P,N as b,F,L as x}from"../../chunks/languageUtils.js";import{angle2D as O,angleBetween2D as S,bearing2D as j,bearingBetween2D as N,pathsSelfIntersecting as k}from"./centroid.js";import J from"../../geometry/Extent.js";import z from"../../geometry/Geometry.js";import D from"../../geometry/Multipoint.js";import G from"../../geometry/Point.js";import Z from"../../geometry/Polygon.js";import _ from"../../geometry/Polyline.js";import{isClockwise as C}from"../../geometry/support/coordsUtils.js";import{fromJSON as M}from"../../geometry/support/jsonUtils.js";function A(a,A){a.ringisclockwise=function(e,r){return A(e,r,((a,f,c)=>{s(c,1,1,e,r);let u=[];if(null===c[0])return!1;if(l(c[0]))for(const i of c[0]){if(!(i instanceof G))throw new t(e,n.InvalidParameter,r);u.push(i.hasZ?i.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y])}else if(c[0]instanceof i)u=c[0]._elements;else{if(!o(c[0]))throw new t(e,n.InvalidParameter,r);for(const a of c[0].toArray()){if(!(a instanceof G))throw new t(e,n.InvalidParameter,r);u.push(a.hasZ?a.hasM?[a.x,a.y,a.z,a.m]:[a.x,a.y,a.z]:[a.x,a.y])}}return!(u.length<3)&&C(u)}))},a.polygon=function(a,i){return A(a,i,((l,o,u)=>{let m;if(s(u,1,1,a,i),u[0]instanceof e){const e=f(r.parseGeometryFromDictionary(u[0],a.spatialReference),a.spatialReference);if(e instanceof Z==!1)throw new t(a,n.InvalidParameter,i);m=e}else if(u[0]instanceof Z)m=M(u[0].toJSON());else{const e=JSON.parse(u[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),m=f(new Z(e),a.spatialReference)}if(null!==m&&!1===m.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(m)}))},a.polyline=function(a,i){return A(a,i,((l,o,u)=>{let m;if(s(u,1,1,a,i),u[0]instanceof e){const e=f(r.parseGeometryFromDictionary(u[0],a.spatialReference),a.spatialReference);if(e instanceof _==!1)throw new t(a,n.InvalidParameter,i);m=e}else if(u[0]instanceof _)m=M(u[0].toJSON());else{const e=JSON.parse(u[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),m=f(new _(e),a.spatialReference)}if(null!==m&&!1===m.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(m)}))},a.point=function(a,i){return A(a,i,((l,o,u)=>{let m;if(s(u,1,1,a,i),u[0]instanceof e){const e=f(r.parseGeometryFromDictionary(u[0],a.spatialReference),a.spatialReference);if(e instanceof G==!1)throw new t(a,n.InvalidParameter,i);m=e}else if(u[0]instanceof G)m=M(u[0].toJSON());else{const e=JSON.parse(u[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),m=f(new G(e),a.spatialReference)}if(null!==m&&!1===m.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(m)}))},a.multipoint=function(a,i){return A(a,i,((l,o,u)=>{let m;if(s(u,1,1,a,i),u[0]instanceof e){const e=f(r.parseGeometryFromDictionary(u[0],a.spatialReference),a.spatialReference);if(e instanceof D==!1)throw new t(a,n.InvalidParameter,i);m=e}else if(u[0]instanceof D)m=M(u[0].toJSON());else{const e=JSON.parse(u[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),m=f(new D(e),a.spatialReference)}if(null!==m&&!1===m.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(m)}))},a.extent=function(a,i){return A(a,i,((l,o,m)=>{m=u(m),s(m,1,1,a,i);let p=null;if(m[0]instanceof e)p=f(r.parseGeometryFromDictionary(m[0],a.spatialReference),a.spatialReference);else if(m[0]instanceof G){const e={xmin:m[0].x,ymin:m[0].y,xmax:m[0].x,ymax:m[0].y,spatialReference:m[0].spatialReference.toJSON()},t=m[0];t.hasZ?(e.zmin=t.z,e.zmax=t.z):t.hasM&&(e.mmin=t.m,e.mmax=t.m),p=M(e)}else if(m[0]instanceof Z)p=M(m[0].extent?.toJSON());else if(m[0]instanceof _)p=M(m[0].extent?.toJSON());else if(m[0]instanceof D)p=M(m[0].extent?.toJSON());else if(m[0]instanceof J)p=M(m[0].toJSON());else{const e=JSON.parse(m[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),p=f(new J(e),a.spatialReference)}if(null!==p&&!1===p.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(p)}))},a.geometry=function(a,i){return A(a,i,((l,o,u)=>{s(u,1,1,a,i);let p=null;if(null===u[0])return null;if(m(u[0]))p=f(u[0].geometry(),a.spatialReference);else if(u[0]instanceof e)p=f(r.parseGeometryFromDictionary(u[0],a.spatialReference),a.spatialReference);else{const e=JSON.parse(u[0]);e&&!e.spatialReference&&(e.spatialReference=a.spatialReference),p=f(M(e),a.spatialReference)}if(null!==p&&!1===p.spatialReference.equals(a.spatialReference))throw new t(a,n.WrongSpatialReference,i);return c(p)}))},a.setgeometry=function(e,r){return A(e,r,((a,i,l)=>{if(s(l,2,2,e,r),!m(l[0]))throw new t(e,n.InvalidParameter,r);if(!0===l[0].immutable)throw new t(e,n.Immutable,r);if(!(l[1]instanceof z||null===l[1]))throw new t(e,n.InvalidParameter,r);return l[0]._geometry=l[1],p}))},a.feature=function(a,i){return A(a,i,((s,l,o)=>{if(0===o.length)throw new t(a,n.WrongNumberOfParameters,i);let c;if(1===o.length)if(h(o[0]))c=r.fromJson(JSON.parse(o[0]),a.timeZone);else if(m(o[0]))c=r.createFromArcadeFeature(o[0]);else if(o[0]instanceof z)c=r.createFromGraphicLikeObject(o[0],null,null,a.timeZone);else{if(!(o[0]instanceof e))throw new t(a,n.InvalidParameter,i);{let t=o[0].hasField("geometry")?o[0].field("geometry"):null,n=o[0].hasField("attributes")?o[0].field("attributes"):null;null!==t&&t instanceof e&&(t=r.parseGeometryFromDictionary(t,a.spatialReference)),null!==n&&(n=r.parseAttributesFromDictionary(n)),c=r.createFromGraphicLikeObject(t,n,null,a.timeZone)}}else if(2===o.length){let s=null,l=null;if(null!==o[0])if(o[0]instanceof z)s=o[0];else{if(!(s instanceof e))throw new t(a,n.InvalidParameter,i);s=r.parseGeometryFromDictionary(o[0],a.spatialReference)}if(null!==o[1]){if(!(o[1]instanceof e))throw new t(a,n.InvalidParameter,i);l=r.parseAttributesFromDictionary(o[1])}c=r.createFromGraphicLikeObject(s,l,null,a.timeZone)}else{let s=null;const l={};if(null!==o[0])if(o[0]instanceof z)s=o[0];else{if(!(s instanceof e))throw new t(a,n.InvalidParameter,i);s=r.parseGeometryFromDictionary(o[0],a.spatialReference)}for(let e=1;e<o.length;e+=2){const r=w(o[e]),s=o[e+1];if(!(null==s||h(s)||isNaN(s)||d(s)||y(s)||R(s)||g(s)||I(s)))throw new t(a,n.InvalidParameter,i);if(v(s)||!1===P(s))throw new t(a,n.InvalidParameter,i);l[r]=s===p?null:s}c=r.createFromGraphicLikeObject(s,l,null,a.timeZone)}return c._geometry=f(c.geometry(),a.spatialReference),c.immutable=!1,c}))},a.dictionary=function(r,a){return A(r,a,((i,s,f)=>{if(0===f.length||1===f.length&&null===f[0]){const t=new e;return t.immutable=!1,t}if(1===f.length&&h(f[0]))try{const t=JSON.parse(f[0]),n=e.convertObjectToArcadeDictionary(t,b(r),!1);return n.immutable=!1,n}catch(P){throw new t(r,n.InvalidParameter,a)}if(1===f.length&&f[0]instanceof z)try{const t=f[0].toJSON();t.hasZ=!0===f[0].hasZ,t.hasM=!0===f[0].hasM;const n=e.convertObjectToArcadeDictionary(t,b(r),!1);return n.immutable=!1,n}catch(P){throw new t(r,n.InvalidParameter,a)}if(1===f.length&&m(f[0]))try{const t=new e;t.immutable=!1,t.setField("geometry",f[0].geometry());const n=new e;n.immutable=!1,t.setField("attributes",n);for(const e of f[0].keys())n.setField(e,f[0].field(e));return t}catch(P){throw new t(r,n.InvalidParameter,a)}if(1===f.length&&f[0]instanceof e)try{const t=new e;t.immutable=!1;for(const e of f[0].keys())t.setField(e,f[0].field(e));return t}catch(P){throw new t(r,n.InvalidParameter,a)}if(2===f.length&&f[0]instanceof e&&I(f[1]))try{if(!(!0===f[1])){const t=new e;t.immutable=!1;for(const e of f[0].keys())t.setField(e,f[0].field(e));return t}return f[0].deepClone()}catch(P){throw new t(r,n.InvalidParameter,a)}if(f.length%2!=0)throw new t(r,n.WrongNumberOfParameters,a);const c={};for(let e=0;e<f.length;e+=2){const i=w(f[e]),s=f[e+1];if(!(null==s||h(s)||isNaN(s)||d(s)||y(s)||I(s)||g(s)||R(s)||l(s)||o(s)))throw new t(r,n.InvalidParameter,a);if(v(s))throw new t(r,n.InvalidParameter,a);c[i]=s===p?null:s}const u=new e(c);return u.immutable=!1,u}))},a.haskey=function(r,a){return A(r,a,((i,l,o)=>{s(o,2,2,r,a);const f=w(o[1]);if(m(o[0]))return o[0].hasField(f);if(o[0]instanceof e)return o[0].hasField(f);if(o[0]instanceof z){const e=q(o[0],f,null,null,2);return!e||"notfound"!==e.keystate}throw new t(r,n.InvalidParameter,a)}))},a.hasvalue=function(r,a){return A(r,a,((i,f,c)=>{if(s(c,2,2,r,a),l(c[1])||o(c[1])){const i=c[1];let s=[];if(o(i))s=i.toArray();else{if(!l(i))throw new t(r,n.InvalidParameter,a);s=i}let f=c[0];if(null===f)return!1;for(const t of s)if(m(f)){if(!1===h(t))return!1;if(!f.hasField(t))return!1;if(f=f.field(t),null===f)return!1}else if(f instanceof e){if(!1===h(t))return!1;if(!f.hasField(t))return!1;if(f=f.field(t),null===f)return!1}else if(f instanceof z){if(!1===h(t))return!1;if(f=q(f,t,null,null,0),null===f)return!1}else if(l(f)){if(!1===y(t))return!1;if(f=f[t],null==f)return!1}else{if(!o(f))return!1;if(!1===y(t))return!1;if(f=f.get(t),null==f)return!1}return!0}if(null===c[0]||null===c[1])return!1;const u=w(c[1]);if(m(c[0]))return!!c[0].hasField(u)&&null!==c[0].field(u);if(c[0]instanceof e)return!!c[0].hasField(u)&&null!==c[0].field(u);if(c[0]instanceof z){return null!==q(c[0],u,null,null,0)}return!1}))},a.indexof=function(e,r){return A(e,r,((a,i,f)=>{s(f,2,2,e,r);const c=f[1];if(l(f[0])){for(let e=0;e<f[0].length;e++)if(F(c,f[0][e]))return e;return-1}if(o(f[0])){const e=f[0].length();for(let t=0;t<e;t++)if(F(c,f[0].get(t)))return t;return-1}throw new t(e,n.InvalidParameter,r)}))},a.angle=function(e,r){return A(e,r,((a,i,l)=>{if(l=u(l),s(l,2,3,e,r),!(l[0]instanceof G))throw new t(e,n.InvalidParameter,r);if(!(l[1]instanceof G))throw new t(e,n.InvalidParameter,r);if(l.length>2&&!(l[2]instanceof G))throw new t(e,n.InvalidParameter,r);return 2===l.length?O(l[0],l[1]):S(l[0],l[1],l[2])}))},a.bearing=function(e,r){return A(e,r,((a,i,l)=>{if(l=u(l),s(l,2,3,e,r),!(l[0]instanceof G))throw new t(e,n.InvalidParameter,r);if(!(l[1]instanceof G))throw new t(e,n.InvalidParameter,r);if(l.length>2&&!(l[2]instanceof G))throw new t(e,n.InvalidParameter,r);return 2===l.length?j(l[0],l[1]):N(l[0],l[1],l[2])}))},a.isselfintersecting=function(e,t){return A(e,t,((n,r,a)=>{a=u(a),s(a,1,1,e,t);let i=a[0];if(i instanceof Z)return i.isSelfIntersecting;if(i instanceof _)return k(i.paths);if(i instanceof D){const e=i.points;for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++)if(n!==t){let r=!0;for(let a=0;a<e[t].length;a++)if(e[t][a]!==e[n][a]){r=!1;break}if(!0===r)return!0}}if(l(i)||o(i)){const t=x(i,e.spatialReference);return null!==t&&(i=t.paths),k(i)}return!1}))}}let W=0;function q(r,s,l,o,f=1){let c;switch(s=s.toLowerCase()){case"hasz":{const e=r.hasZ;return void 0!==e&&e}case"hasm":{const e=r.hasM;return void 0!==e&&e}case"spatialreference":{let t=r.spatialReference._arcadeCacheId;if(void 0===t){let e=!0;Object.freeze&&Object.isFrozen(r.spatialReference)&&(e=!1),e&&(W++,r.spatialReference._arcadeCacheId=W,t=W)}const n=new e({wkt:r.spatialReference.wkt,wkid:r.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(r.type){case"extent":switch(s){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const e=r[s];return void 0!==e?e:null}case"type":return"Extent"}break;case"polygon":switch(s){case"rings":c=r.cache._arcadeCacheId,void 0===c&&(W++,c=W,r.cache._arcadeCacheId=c);return new a(r.rings,r.spatialReference,!0===r.hasZ,!0===r.hasM,c);case"type":return"Polygon"}break;case"point":switch(s){case"x":case"y":case"z":case"m":return r[s]??null;case"type":return"Point"}break;case"polyline":switch(s){case"paths":c=r.cache._arcadeCacheId,void 0===c&&(W++,c=W,r.cache._arcadeCacheId=c);return new a(r.paths,r.spatialReference,!0===r.hasZ,!0===r.hasM,c);case"type":return"Polyline"}break;case"multipoint":switch(s){case"points":c=r.cache._arcadeCacheId,void 0===c&&(W++,c=W,r.cache._arcadeCacheId=c);return new i(r.points,r.spatialReference,!0===r.hasZ,!0===r.hasM,c,1);case"type":return"Multipoint"}}if(1===f)throw new t(l,n.InvalidIdentifier,o);return 2===f?{keystate:"notfound"}:null}export{q as geometryMember,A as registerFunctions};
