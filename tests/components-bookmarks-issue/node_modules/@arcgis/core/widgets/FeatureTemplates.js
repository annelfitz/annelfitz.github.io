/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{watch as t,initial as o}from"../core/reactiveUtils.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/Logger.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{isTable as s}from"../layers/support/layerUtils.js";import n from"./Widget.js";import{isTemplateItemGroup as l}from"./FeatureForm/featureFormUtils.js";import a from"./FeatureTemplates/FeatureTemplatesViewModel.js";import{ItemList as d}from"./FeatureTemplates/ItemList.js";import c from"./FeatureTemplates/TemplateItem.js";import m from"./FeatureTemplates/VisibleElements.js";import{loadCalciteComponents as p}from"./support/componentsUtils.js";import{globalCss as u}from"./support/globalCss.js";import"./support/widgetUtils.js";import{messageBundle as h}from"./support/decorators/messageBundle.js";import{vmEvent as f}from"./support/decorators/vmEvent.js";import{tsx as v}from"./support/jsxFactory.js";const b={base:"esri-feature-templates"};function I(e){return e.length>0&&l(e[0])}function y(e){return e.id}let g=class extends n{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new a,this.visibleElements=new m,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const o=e.target;if(w(o))return void t.unobserve(o);const r=C(o),{layer:i,template:s}=r;j(o,!0);const n=await c.fetchThumbnail(i,s).catch((()=>(j(o,!1),null)));if(null==n)return;o.appendChild(n)}}))})),this._renderItemIcon=e=>s(e.layer)?v("span",{"data-has-icon":!0,"data-item":e,key:"icon"},v("calcite-icon",{icon:"table"})):v("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(t((()=>this.viewModel),((t,o)=>{t&&!t.filterFunction&&(this.filterFunction=e),o&&o!==t&&o.filterFunction===e&&(o.filterFunction=null)}),o))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return p({icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),loader:()=>import("@esri/calcite-components/dist/components/calcite-loader.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js")})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:o,headingLevel:r,messages:i,viewModel:{items:s,numberOfFeatureTemplates:n,selectedItem:c,state:m}}=this,p=this.visibleElements.filter&&n>1;if(I(s)){const e=s.find((e=>e.label===a.nullGroupBy.label));e&&(e.label=i.other)}return v("div",{"aria-label":i.widgetLabel,class:this.classes(b.base,u.widget)},"loading"===m?v("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):"ready"===m?v(d,{disabled:e,enableListScroll:t,filterEnabled:p,filterText:o,headingLevel:r,id:this.id,identify:y,items:s,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:c??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},onItemSelect:e=>!l(e)&&this.viewModel.select(e)}):null)}};function C(e){return e?.["data-item"]}function w(e){return!!e?.["data-has-icon"]}function j(e,t){e&&(e["data-has-icon"]=t)}e([r()],g.prototype,"disabled",null),e([r()],g.prototype,"enableListScroll",void 0),e([r()],g.prototype,"filterFunction",null),e([r()],g.prototype,"filterText",void 0),e([r()],g.prototype,"groupBy",null),e([r()],g.prototype,"headingLevel",void 0),e([r()],g.prototype,"icon",null),e([r()],g.prototype,"label",null),e([r()],g.prototype,"layers",null),e([r(),h("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],g.prototype,"messages",void 0),e([r(),h("esri/t9n/common")],g.prototype,"messagesCommon",void 0),e([r({readOnly:!0})],g.prototype,"selectedItem",null),e([r()],g.prototype,"selectionMode",void 0),e([r(),f("select")],g.prototype,"viewModel",void 0),e([r({type:m,nonNullable:!0})],g.prototype,"visibleElements",void 0),e([r()],g.prototype,"renderCustomItem",void 0),e([r()],g.prototype,"renderCustomGroupContent",void 0),e([r()],g.prototype,"renderItemLabel",void 0),e([r()],g.prototype,"renderItemDescription",void 0),e([r()],g.prototype,"renderItemContent",void 0),e([r()],g.prototype,"renderItemContentEnd",void 0),g=e([i("esri.widgets.FeatureTemplates")],g);const F=g;export{F as default};
