/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{watch as s}from"../core/reactiveUtils.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/Logger.js";import"../core/RandomLCG.js";import{subclass as e}from"../core/accessorSupport/decorators/subclass.js";import o from"./Widget.js";import{loadCalciteComponents as n}from"./support/componentsUtils.js";import"./support/widgetUtils.js";import{messageBundle as a}from"./support/decorators/messageBundle.js";import{tsx as c}from"./support/jsxFactory.js";import l from"./UtilityNetworkAssociations/UtilityNetworkAssociationsLineSymbolPicker.js";import r from"./UtilityNetworkAssociations/UtilityNetworkAssociationsViewModel.js";import d from"./UtilityNetworkAssociations/VisibleElements.js";const h="esri-un-associations",A={action:`${h}__action`,actionRefresh:`${h}__action-refresh`,blockContent:`${h}__block-content`,blockSectionSettings:`${h}__block-section-settings`,divControlsMain:`${h}__div-controls-main`,label:`${h}__label`,labelAndSlider:`${h}__label-and-slider`,labelAndToggle:`${h}__label-and-toggle`,slider:`${h}__slider`,statusIconContainer:`${h}__status-icon-container`,statusIconWarning:`${h}__status-icon-warning`,switch:`${h}__switch`,switchContainer:`${h}__switch-container`,widgetContainer:`${h}__widget-container`};let m=class extends o{constructor(t,s){super(t,s),this._autoRefreshAssociations=!0,this._associationsOptionsEnabled=!1,this._maxAllowableAssociationsSliderMax=1e3,this._maxAllowableAssociationsSliderMin=250,this._maxAllowableAssociationsSliderStep=250,this.messages=null,this.messagesCommon=null,this.viewModel=new r,this.visibleElements=new d}initialize(){this.addHandles([s((()=>[this.view?.stationary,this.showAssociationsEnabled,this.includeConnectivityAssociations,this.includeStructuralAttachmentAssociations,this.maxAllowableAssociations]),(()=>{!0===this.autoRefreshAssociations&&(!0===this.showAssociationsEnabled?this.viewModel.showAssociations():this.viewModel.removeAssociations())}))])}get autoRefreshAssociations(){return this._autoRefreshAssociations}set autoRefreshAssociations(t){this._autoRefreshAssociations=t}get connectivityAssociationsLineSymbol(){return this.viewModel.connectivityAssociationsLineSymbol}set connectivityAssociationsLineSymbol(t){this.viewModel.connectivityAssociationsLineSymbol=t}get icon(){return"view-associations"}set icon(t){this._overrideIfSome("icon",t)}get includeConnectivityAssociations(){return this.viewModel.includeConnectivityAssociations}set includeConnectivityAssociations(t){this.viewModel.includeConnectivityAssociations=t}get includeStructuralAttachmentAssociations(){return this.viewModel.includeStructuralAttachmentAssociations}set includeStructuralAttachmentAssociations(t){this.viewModel.includeStructuralAttachmentAssociations=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get maxAllowableAssociations(){return this.viewModel.maxAllowableAssociations}set maxAllowableAssociations(t){this.viewModel.maxAllowableAssociations=t}get maxAllowableAssociationsSliderMax(){return this._maxAllowableAssociationsSliderMax}set maxAllowableAssociationsSliderMax(t){t<=this.maxAllowableAssociationsSliderMin||(this._maxAllowableAssociationsSliderMax=t)}get maxAllowableAssociationsSliderMin(){return this._maxAllowableAssociationsSliderMin}set maxAllowableAssociationsSliderMin(t){t<0||t>=this.maxAllowableAssociationsSliderMax||(this._maxAllowableAssociationsSliderMin=t)}get maxAllowableAssociationsSliderStep(){return this._maxAllowableAssociationsSliderStep}set maxAllowableAssociationsSliderStep(t){this._maxAllowableAssociationsSliderStep=t}get showArrowsConnectivity(){return this.viewModel.showArrowsConnectivity}set showArrowsConnectivity(t){this.viewModel.showArrowsConnectivity=t}get showArrowsStructuralAttachment(){return this.viewModel.showArrowsStructuralAttachment}set showArrowsStructuralAttachment(t){this.viewModel.showArrowsStructuralAttachment=t}get showAssociationsEnabled(){return this.viewModel.showAssociationsEnabled}set showAssociationsEnabled(t){this.viewModel.showAssociationsEnabled=t}get structuralAttachmentAssociationsLineSymbol(){return this.viewModel.structuralAttachmentAssociationsLineSymbol}set structuralAttachmentAssociationsLineSymbol(t){this.viewModel.structuralAttachmentAssociationsLineSymbol=t}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{label:t}=this;return c("div",{class:A.widgetContainer},c("calcite-block",{class:A.blockContent,collapsible:!0,heading:t},this._renderStatusIcon(),this.autoRefreshAssociations?this._renderShowAssociationsSwitch():this._renderRefreshAssociationsAction(),this._renderContent()))}loadDependencies(){return n({action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),block:()=>import("@esri/calcite-components/dist/components/calcite-block.js"),"block-section":()=>import("@esri/calcite-components/dist/components/calcite-block-section.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),label:()=>import("@esri/calcite-components/dist/components/calcite-label.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js"),panel:()=>import("@esri/calcite-components/dist/components/calcite-panel.js"),slider:()=>import("@esri/calcite-components/dist/components/calcite-slider.js"),switch:()=>import("@esri/calcite-components/dist/components/calcite-switch.js"),tooltip:()=>import("@esri/calcite-components/dist/components/calcite-tooltip.js")})}_connectivityAssociationsSwitchChange(t){this.includeConnectivityAssociations=t.target.checked}_getLoadErrorMessagesAsNotices(t,s){return c("calcite-notice",{closable:!1,key:`error-notice-${s}`,kind:"warning",open:!0,scale:"s"},c("div",{slot:"message"},t))}_maxAllowableAssociationsSliderChange(t){this.maxAllowableAssociations=Number(t.target.value)}_refreshAssociations(){const{viewModel:t,viewModel:{state:s}}=this;"ready"!==s&&"warning"!==s||t.showAssociations()}_renderConnectivityAssociationsSettings(){const{messages:{input:{enableConnectivity:t}},visibleElements:{connectivityAssociationsSettings:s}}=this;if(s)return c("calcite-block-section",{class:A.blockSectionSettings,text:t},c(l,{id:`${this.id}-symbol-picker-connectivity`,lineSymbol:this.connectivityAssociationsLineSymbol,showArrows:this.showArrowsConnectivity,visibleElements:s}))}_renderConnectivityAssociationsToggle(){const{messages:{input:{enableConnectivity:t}}}=this;return c("div",{class:A.labelAndToggle,key:"connectivityAssociationsToggleDiv"},c("calcite-label",{class:A.label},t),c("calcite-switch",{bind:this,checked:this.includeConnectivityAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._connectivityAssociationsSwitchChange}))}_renderContent(){const{viewModel:{loadErrors:t,state:s}}=this;return"disabled"===s?c("div",{class:A.divControlsMain,key:"loadErrorsDiv"},t.items.map(this._getLoadErrorMessagesAsNotices)):c("calcite-panel",{disabled:"loading"===s},c("div",{class:A.divControlsMain},this._renderConnectivityAssociationsToggle(),this._renderStructuralAttachmentAssociationsToggle(),this._renderSettingsPane()))}_renderLoadingAction(t,s,i){return c("div",{key:t,slot:"control"},c("calcite-action",{id:s,loading:!0,text:i}),c("calcite-tooltip",{referenceElement:s},c("span",null,i)))}_renderMaxAllowableAssociationsSlider(){const{messages:{input:{maxAllowableAssociations:t}},visibleElements:{maxAllowableAssociationsSlider:s}}=this;if(s)return c("div",{class:A.labelAndSlider},c("calcite-label",{class:A.label},t),c("calcite-slider",{bind:this,class:A.slider,labelTicks:!0,max:this.maxAllowableAssociationsSliderMax,min:this.maxAllowableAssociationsSliderMin,scale:"s",snap:!0,step:this.maxAllowableAssociationsSliderStep,ticks:this.maxAllowableAssociationsSliderStep,value:this.maxAllowableAssociations,onCalciteSliderChange:this._maxAllowableAssociationsSliderChange}))}_renderRefreshAssociationsAction(){const{messages:{input:{refreshAssociations:t}},messagesCommon:{loading:s},viewModel:{state:i}}=this,e=`${this.id}-refresh-action`;if("disabled"!==i)return c("div",{class:A.actionRefresh,slot:"control"},c("calcite-action",{bind:this,class:A.action,icon:"refresh-f",id:e,loading:"loading"===i,onclick:this._refreshAssociations,text:t}),c("calcite-tooltip",{referenceElement:e},c("span",null,"loading"===i?s:t)))}_renderSettingsPane(){const{messagesCommon:{settings:t},visibleElements:{maxAllowableAssociationsSlider:s,connectivityAssociationsSettings:i,structuralAttachmentAssociationsSettings:e}}=this;if(s||i||e)return c("calcite-block",{class:A.blockContent,collapsible:!0,heading:t},this._renderMaxAllowableAssociationsSlider(),this._renderConnectivityAssociationsSettings(),this._renderStructuralAttachmentAssociationsSettings())}_renderShowAssociationsSwitch(){const{messages:{input:{enableAssociations:t}},messagesCommon:{loading:s},viewModel:{state:i}}=this,e=`${this.id}-show-associations-switch`;if("disabled"!==i)return"loading"===i?this._renderLoadingAction("loadingActionDiv",`${this.id}-loading-action`,s):c("div",{class:A.switchContainer,key:"switchDiv",slot:"control"},c("calcite-switch",{bind:this,checked:this.showAssociationsEnabled,class:A.switch,id:e,onCalciteSwitchChange:this._showAssociationsSwitchChange}),c("calcite-tooltip",{referenceElement:e},c("span",null,t)))}_renderStatusIcon(){const{messagesCommon:{executing:t},viewModel:{executionError:s,state:i}}=this;switch(i){case"disabled":return this._renderWarningIcon("statusDiv",`${this.id}-disabled-icon`,null);case"warning":return this._renderWarningIcon("statusDiv",`${this.id}-warning-icon`,s);case"executing":return this._renderLoadingAction("executingActionDiv",`${this.id}-executing-action`,t);default:return}}_renderStructuralAttachmentAssociationsSettings(){const{messages:{input:{enableStructuralAttachment:t}},visibleElements:{structuralAttachmentAssociationsSettings:s}}=this;if(s)return c("calcite-block-section",{class:A.blockSectionSettings,text:t},c(l,{id:`${this.id}-symbol-picker-structural-attachment`,lineSymbol:this.structuralAttachmentAssociationsLineSymbol,showArrows:this.showArrowsStructuralAttachment,visibleElements:s}))}_renderStructuralAttachmentAssociationsToggle(){const{messages:{input:{enableStructuralAttachment:t}}}=this;return c("div",{class:A.labelAndToggle,key:"structuralAttachmentAssociationsToggleDiv"},c("calcite-label",{class:A.label},t),c("calcite-switch",{bind:this,checked:this.includeStructuralAttachmentAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._structuralAttAssociationsSwitchChange}))}_showAssociationsSwitchChange(t){const{viewModel:s}=this;this.showAssociationsEnabled=t.target.checked,this._associationsOptionsEnabled=t.target.checked,this.showAssociationsEnabled||s.removeAssociations()}_structuralAttAssociationsSwitchChange(t){this.includeStructuralAttachmentAssociations=t.target.checked}_renderWarningIcon(t,s,i){return i?c("div",{class:A.statusIconContainer,key:t,slot:"control"},c("calcite-icon",{class:A.statusIconWarning,icon:"exclamation-mark-triangle",id:s,scale:"s"}),c("calcite-tooltip",{referenceElement:s},c("span",null,i))):c("div",{class:A.statusIconContainer,key:t,slot:"control"},c("calcite-icon",{class:A.statusIconWarning,icon:"exclamation-mark-triangle",id:s,scale:"s"}))}};t([i()],m.prototype,"autoRefreshAssociations",null),t([i()],m.prototype,"connectivityAssociationsLineSymbol",null),t([i()],m.prototype,"icon",null),t([i()],m.prototype,"includeConnectivityAssociations",null),t([i()],m.prototype,"includeStructuralAttachmentAssociations",null),t([i()],m.prototype,"label",null),t([i()],m.prototype,"maxAllowableAssociations",null),t([i()],m.prototype,"maxAllowableAssociationsSliderMax",null),t([i()],m.prototype,"maxAllowableAssociationsSliderMin",null),t([i()],m.prototype,"maxAllowableAssociationsSliderStep",null),t([i(),a("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations")],m.prototype,"messages",void 0),t([i(),a("esri/t9n/common")],m.prototype,"messagesCommon",void 0),t([i()],m.prototype,"showArrowsConnectivity",null),t([i()],m.prototype,"showArrowsStructuralAttachment",null),t([i()],m.prototype,"showAssociationsEnabled",null),t([i()],m.prototype,"structuralAttachmentAssociationsLineSymbol",null),t([i()],m.prototype,"utilityNetwork",null),t([i()],m.prototype,"view",null),t([i({type:r})],m.prototype,"viewModel",void 0),t([i({type:d,nonNullable:!0})],m.prototype,"visibleElements",void 0),m=t([e("esri.widgets.UtilityNetworkAssociations")],m);const u=m;export{u as default};
