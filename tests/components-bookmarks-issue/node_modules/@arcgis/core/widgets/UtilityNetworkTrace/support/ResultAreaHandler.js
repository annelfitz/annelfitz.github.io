/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../Graphic.js";import r from"../../../layers/GraphicsLayer.js";import t from"../../../popup/FieldInfo.js";import o from"../../../symbols/SimpleFillSymbol.js";import{GeometryHandler as a}from"./GeometryHandler.js";const i=`utility-network-trace-result-area-${Date.now()}`;function n(e){return"graphics"===e.type}class l{constructor(){this.traceInformation={},this._geometryHandler=new a}addResultAreaToMap(e,r){const t=this.createGraphicLayer(r);t&&n(t)&&t.add(e)}changeResultAreaColor(e,r,t){const a=new o({color:r.color,style:"solid",outline:{color:r.color,width:1}}),i=this._findGraphicsByTraceId(e,t);return i&&i.forEach((e=>{e.symbol=a})),a}createBuffer(e,r,t,o){return this._geometryHandler.createBuffer(e,r,t,o)}createConvexHull(e,r,t){const o=this._geometryHandler.createConvexHull(e);return r>0&&o?this.createBuffer(o,[r],t,!1):o}createResultAreaGraphic(r,a,i,n,l,s){const c=new o({color:s.color,style:"solid",outline:{color:s.color,width:1}}),u=[];for(const e in a)u.push(new t({fieldName:e,label:"areaStatistic"===e?n.attributeStrings[e]+" ("+l.units[i]?.abbr+")":n.attributeStrings[e]}));return new e({geometry:r,symbol:c,attributes:a,popupTemplate:{title:a.traceName,content:[{type:"fields",fieldInfos:u}]}})}removeResultArea(e,r){const t=r.findLayerById(i);if(t&&n(t)){const o=this._findGraphicsByTraceId(e,r);return o&&t.removeMany(o),o}return null}removeAllResultAreaGraphics(e){if(e){const r=e.findLayerById(i);r&&n(r)&&r.removeAll()}}createGraphicLayer(e,t){const o=e.findLayerById(i);if(o&&n(o))return o;const a=new r({title:t??i,listMode:"hide",id:i});return e.add(a),a}_findGraphicsByTraceId(e,r){const t=r.findLayerById(i);if(t&&n(t)){const r=t.graphics.filter((r=>r.attributes.traceId===e));return r.length>0?r.toArray():null}return null}}export{l as ResultAreaHandler,i as resultAreaGraphicLayer};
