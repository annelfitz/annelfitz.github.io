/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import e from"../../../core/Evented.js";import{watch as o}from"../../../core/reactiveUtils.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as n}from"../../../core/accessorSupport/decorators/subclass.js";import r from"./support/ButtonMenu.js";import{legacyIcon as s}from"../../support/legacyIcon.js";import{renderingSanitizer as l}from"../../support/widgetUtils.js";const a="esri-column",d={menuContainer:`${a}__menu-container`,sorter:`${a}__sorter`,headerContent:`${a}__header-content`,headerLabel:`${a}__header-label`},c={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let h=class extends e.EventedAccessor{constructor(t){super(t),this._menuContainer=document.createElement("div"),this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:t})=>l.sanitize(t),this.direction=null,this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.frozenToEnd=!1,this.grid=null,this.header=null,this.headerRenderFunction=t=>{const{root:e}=t;if(this.removeCellContent(e),e.classList.add(d.headerContent),this.sortable)this.headerSorterRenderFunction(t);else{const t=document.createElement("div");t.classList.add(d.headerLabel);const o=document.createElement("span");o.textContent=this.label,o.setAttribute("title",this.label),t.appendChild(o),e.appendChild(t)}this.headerMenuEnabled&&this.headerMenuRenderFunction(t)},this.headerMenuRenderFunction=({root:t})=>{this.menu?.items?.length&&t.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:t})=>{const{label:e,sortElement:o}=this;if(!o)return void(t.textContent=e);o.textContent!==e&&o.setAttribute("textContent",e),t.appendChild(o);const i=this.grid?.getSlotElementByName(t.slot),n=i?.parentElement;n&&!n.onkeydown&&(n.onkeydown=({key:t})=>{t!==c.keyboardSort1&&t!==c.keyboardSort2||o.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.initialSortPriority=null,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.path=null,this.renderFunction=({root:t,column:e,rowData:o})=>{const i=this.getCellValue(e,o),n=this.cellValueFormatFunction({column:e,rowData:o,value:i});t.innerHTML!==n&&(t.innerHTML=n)},this.resizable=!0,this.sortable=!1,this.textAlign="start",this.timeZone=null,this.timeZoneName=null,this.width=200}initialize(){const{messages:t,path:e}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",e??""),this._menuContainer.classList.add(d.menuContainer),this.menu=new r({container:this._menuContainer,label:t?.options,...this.menuConfig}),this.menu.set("items",this.getMenuItems()),this.addHandles([o((()=>this.direction),(t=>{const{sortElement:e}=this;this.sortable&&e&&(t?this.sortElement.direction!==t&&e.setAttribute("direction",t):e.removeAttribute("direction"))})),o((()=>this.hidden),(()=>this.menu?.set("open",!1))),o((()=>this.path),(t=>{const{sortElement:e}=this,o=t??"";e&&e.path!==o&&e.setAttribute("path",o)}))])}destroy(){this.menu?.destroy()}set invalid(t){this._set("invalid",t),this.grid?.generateCellPartNames()}get label(){return l.sanitize(this.header??this.path??"")}getMenuItems(){const{menuConfig:t,sortable:e}=this,o=t?.items,i=this.getSortMenuItems(),n=[];return e&&n.push(...i),o?.length&&n.push(...o),n.length?n:null}getSortMenuItems(){const{messages:t}=this;return[{selected:"asc"===this.direction,iconClass:s.arrowUp,label:t?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:s.arrowDown,label:t?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(t,e){return t.path&&e?.item?e.item[t.path]:""}createSortElement(){const{direction:t,label:e,path:o,initialSortPriority:i}=this,n=document.createElement("vaadin-grid-sorter");return n.classList.add(d.sorter),n.setAttribute("path",o??""),n.setAttribute("title",e),n.textContent=e,t&&n.setAttribute("direction",t),null!=i&&(n._initialOrder=i),n.addEventListener("direction-changed",(()=>{this.direction!==n.direction&&this._set("direction",n.direction)})),n}createCalciteAction(t){const e=document.createElement("calcite-action"),{click:o,icon:i,text:n}=t;return e.scale="s",e.text=n,e.title=n,e.icon=i,e.onclick=o,e}removeCellContent(t){if(t&&t.firstChild)try{for(;t?.firstChild;)t?.removeChild(t.firstChild)}catch(e){}}};t([i()],h.prototype,"activeRowIndex",void 0),t([i()],h.prototype,"autoWidth",void 0),t([i()],h.prototype,"cellValueFormatFunction",void 0),t([i()],h.prototype,"direction",void 0),t([i()],h.prototype,"flexGrow",void 0),t([i()],h.prototype,"footerRenderFunction",void 0),t([i()],h.prototype,"frozen",void 0),t([i()],h.prototype,"frozenToEnd",void 0),t([i()],h.prototype,"grid",void 0),t([i()],h.prototype,"header",void 0),t([i()],h.prototype,"invalid",null),t([i()],h.prototype,"headerRenderFunction",void 0),t([i()],h.prototype,"headerMenuRenderFunction",void 0),t([i()],h.prototype,"headerSorterRenderFunction",void 0),t([i()],h.prototype,"hidden",void 0),t([i()],h.prototype,"headerMenuEnabled",void 0),t([i({constructOnly:!0})],h.prototype,"initialSortPriority",void 0),t([i({readOnly:!0})],h.prototype,"label",null),t([i()],h.prototype,"menu",void 0),t([i()],h.prototype,"menuConfig",void 0),t([i()],h.prototype,"messages",void 0),t([i()],h.prototype,"messagesCommon",void 0),t([i()],h.prototype,"messagesURIUtils",void 0),t([i()],h.prototype,"path",void 0),t([i()],h.prototype,"renderFunction",void 0),t([i()],h.prototype,"resizable",void 0),t([i()],h.prototype,"sortable",void 0),t([i({readOnly:!0})],h.prototype,"sortElement",void 0),t([i()],h.prototype,"textAlign",void 0),t([i()],h.prototype,"timeZone",void 0),t([i()],h.prototype,"timeZoneName",void 0),t([i()],h.prototype,"width",void 0),h=t([n("esri.widgets.FeatureTable.Grid.Column")],h);const u=h;export{u as default};
