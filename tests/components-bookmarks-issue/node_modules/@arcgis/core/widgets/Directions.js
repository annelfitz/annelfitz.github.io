/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{on as t,pausable as s}from"../core/events.js";import{makeHandle as o}from"../core/handleUtils.js";import{assertIsSome as i}from"../core/maybe.js";import{watch as r,initial as n,when as a,on as l}from"../core/reactiveUtils.js";import{escapeRegExpString as c}from"../core/string.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import{cast as u}from"../core/accessorSupport/decorators/cast.js";import"../core/RandomLCG.js";import"../core/has.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import{defaultUnitPropertyMetadata as p}from"../properties/defaultUnit.js";import v from"../rest/support/Stop.js";import m from"../symbols/SimpleMarkerSymbol.js";import _ from"./Search.js";import g from"./Widget.js";import{css as S}from"./Directions/css.js";import y from"./Directions/DirectionsViewModel.js";import{SaveLayer as w}from"./Directions/components/SaveLayer.js";import{DepartureTimeOption as f,formatDistance as M,formatDuration as b,getIconName as C}from"./Directions/support/directionsUtils.js";import{isArcGISWorldGeocoder as T,meteredArcGISLocatorUrl as k}from"./Search/support/locatorUtils.js";import{loadCalciteComponents as I}from"./support/componentsUtils.js";import{globalCss as D}from"./support/globalCss.js";import{Heading as R,incrementHeadingLevel as P}from"./support/Heading.js";import{legacyIcon as B}from"./support/legacyIcon.js";import{accessibleHandler as L}from"./support/decorators/accessibleHandler.js";import{messageBundle as j}from"./support/decorators/messageBundle.js";import{tsx as A}from"./support/jsxFactory.js";import"./support/widgetUtils.js";import E from"sortablejs";import{formatNumber as H}from"../intl/number.js";const x={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function U(e){const{branchName:t,displayText:s,exitName:o,intersectingName:i,name:r,objectId:n,towardName:a}=e;if(null==s)return null;const l=[t,o,i,r,a].filter(Boolean).sort(((e,t)=>t.length-e.length)).map((e=>c(e)));if(!l.length)return s;const d=new RegExp(l.join("|"),"g"),u=s.matchAll(d);let h=0;const p=[];for(const{0:c,index:v}of u)p.push(s.slice(h,v),A("span",{class:S.maneuverPlaceName},c)),h=v+c.length;return p.push(s.slice(h)),A("span",{id:`${S.maneuver}-${n}`},p)}function z(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}function $(e){const t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())}const O="search-term",F=100,N=500;let V=class extends g{constructor(e,t){super(e,t),this._activeStop=null,this._activeManeuver=null,this._autoStopRemovalDelay=F,this._autoStopRemovalTimeoutId=void 0,this._focusedManeuver=null,this._newPlaceholderStop=null,this._pointerDownUpHandle=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new w,this._sections=null,this._sortable=null,this._stopsToSearches=new Map,this._viewClickHandle=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new y,this.visibleElements={...x},this._setUpDragAndDropStops=e=>{this._sortable=E.create(e,{draggable:`.${S.validStopRow}`,ghostClass:S.stopRowGhost,handle:`.${S.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this.viewModel.layer?.stops.forEach((e=>this.acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t||null==t||null==e)return;const{children:o}=s,i=o[t],r=o[e],n=t-e<0;s.insertBefore(i,n?r.nextElementSibling:r);const{stops:a}=this.viewModel.layer;a.reorder(a.at(e),t);for(const l of a)l.sequence=null;this._solveRoute()}}initialize(){this.addHandles([r((()=>this.viewModel.layer?.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),n),a((()=>this.view),((e,s)=>{if(s&&(this._viewClickHandle=null,null!=s&&this.removeHandles(s)),e){const s=this._prepPointerDownUpClick(),o=this._prepViewClick();s.pause(),o.pause();const i=e.surface;this.addHandles([t(i,"mousedown",(()=>this._autoStopRemovalDelay=N)),t(i,"mouseup",(()=>this._autoStopRemovalDelay=F)),s,o],e),this._pointerDownUpHandle=s,this._viewClickHandle=o}}),n),a((()=>null==this.viewModel.serviceDescription),(()=>{try{this.viewModel.load()}catch{}}),n),r((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))}loadDependencies(){return I({button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),"input-date-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-date-picker.js"),"input-time-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-time-picker.js"),link:()=>import("@esri/calcite-components/dist/components/calcite-link.js"),popover:()=>import("@esri/calcite-components/dist/components/calcite-popover.js")})}destroy(){for(const e of this._stopsToSearches.values())e.destroy();this._sortable?.destroy(),null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"right"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...x,...e}}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new _({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([l((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.geometry=s.selectedResult?.feature.geometry,e.name=s.selectedResult?.name,this._solveRoute()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e))),s.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer?.removeResult()})),r((()=>s.searchTerm),(t=>{e.name=t}))],s),this._stopsToSearches.set(e,s),s}getDirections(){return this.viewModel.getDirections()}render(){return A("div",{class:this.classes(S.base,D.widget,D.panel,S.scroller)},this._renderPanelContent())}save(){return this.viewModel.save()}saveAs(e,t={}){return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{layer:e,serviceDescription:t,state:s}=this.viewModel,o="initializing"===s,i="error"===s&&!t,r="unauthenticated"===s,n={[S.panelContentLoading]:o,[S.panelContentError]:i||!e,[S.panelContentSignIn]:r},a=o?"presentation":"group",l=e?r?this._renderSignIn():i?this._renderMessage(this._getErrorMessage()):o?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return A("div",{class:this.classes(S.panelContent,n),role:a},l)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return A("div",{class:S.signInContent,key:"sign-in"},A(R,{class:S.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),A(R,{level:P(this.headingLevel)},this.messages.signInRequired),A("button",{bind:this,class:this.classes(D.button,D.buttonSecondary,S.signInButton),onclick:this._handleSignInClick,tabIndex:0,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}))}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=null!=e?e.name:this.messages.travelMode;return A("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(S.travelMode,this._saveLayer.opened&&D.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},A("select",{"aria-label":s,bind:this,class:this.classes(S.travelModeSelect,D.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map(((t,s)=>A("option",{"data-mode":t,key:`esri-directions__travel-mode-${s}`,selected:e===t,value:`${s}`},t.name)))))}_handleTravelModeChange(e){const t=e.currentTarget;this.viewModel.selectedTravelMode=q(t.item(t.selectedIndex)),this._solveRoute()}_renderStopsContainer(){return this.visibleElements.stops?A("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(S.section,this._saveLayer.opened&&D.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const{messages:{departAt:e,departureTime:t,leaveNow:s,timeUnspecified:o},viewModel:{departureOption:i}}=this;return A("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(S.departureTime,this._saveLayer.opened&&D.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},A("select",{"aria-label":t,bind:this,class:this.classes(S.departureTimeSelect,D.select),onchange:this._handleDepartureOptionChange,title:t},A("option",{selected:i===f.NOW,value:f.NOW},s),A("option",{selected:i===f.DEPART_AT,value:f.DEPART_AT},e),A("option",{selected:i===f.UNSPECIFIED,value:f.UNSPECIFIED},o)),i===f.DEPART_AT?this._renderTimeControls():null)}_renderStops(){const{stops:e}=this.viewModel.layer;let t=0;for(const i of this._stopsToSearches.keys())e.includes(i)||this._disposeSearch(i);for(const i of e){const e=this.acquireSearch(i);"none"!==e.activeMenu&&(t+=1),null!=i.name&&(e.searchTerm=i.name)}const s=e.toArray().map(((s,o)=>{const i=e.length,r=o>1&&null==s.geometry,n={[B.radioUnchecked]:o>=0&&o<i-1,[B.radioChecked]:o===i-1},a={[S.lastStopIconContainer]:o===i-1},l={[S.validStopRow]:!r},c=e.at(o+1),d=o===i-1,u=o===i-2,h=2===i&&0===o||i>2&&!d&&!u||i>2&&u&&null!=c?.geometry||i>2&&d&&null==s.geometry,p=i<3,v=this.acquireSearch(s),{messages:m}=this,{removeStop:_,reverseStops:g,unlocated:y}=m,w=null!=s.geometry&&null!=s.name?s.name:y,f=H(o+1),M=`${m.stopLabel} ${f} (${w})`,b=`${this.id}__stop--${o}`,C=!!v.searchTerm&&!!v.selectedResult&&null!=s.geometry&&v.selectedResult.name===s.name,T={zIndex:"none"!==v.activeMenu?""+t--:""};return A("li",{afterCreate:this._handleStopFieldCreation,"aria-label":M,bind:this,class:this.classes(S.stopRow,l),"data-stop-index":o,id:b,key:o,styles:T},A("div",{class:S.stopHandle},A("span",{"aria-hidden":"true",class:this.classes(S.stopIcon,B.handleVertical,S.stopHandleIcon,S.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),A("div",{"aria-labelledby":b,bind:this,class:this.classes(S.stopIconContainer,a),"data-stop-index":o,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},A("span",{class:this.classes(S.stopIcon,n),tabIndex:C?0:void 0}))),A("div",{class:S.stopInput},v.render()),A("div",{class:S.stopOptions,role:"group"},A("div",{"aria-label":_,bind:this,class:S.removeStopButton,"data-stop-index":o,hidden:p,onclick:this._handleRemoveStop,onkeydown:this._handleRemoveStop,role:"button",tabIndex:0,title:_},A("span",{"aria-hidden":"true",class:this.classes(S.stopIcon,S.removeStop,B.trash,S.interactiveStopIcon)}),A("span",{class:B.fontFallbackText},"removeStopTitle")),A("div",{"aria-label":g,bind:this,class:S.reverseStops,hidden:h,onclick:this._handleReverseStops,onkeydown:this._handleReverseStops,role:"button",tabIndex:0,title:g},A("span",{"aria-hidden":"true",class:this.classes(S.stopIcon,B.upDownArrows,S.interactiveStopIcon)}),A("span",{class:B.fontFallbackText},"removeStopTitle"))))})),o=this._renderAddStop();return A("div",null,A("ol",{afterCreate:this._setUpDragAndDropStops,class:S.stops,role:"group"},s),o)}_renderAddStop(){const e=this.viewModel.layer?.stops;if(!e)return null;const t=e.filter((({geometry:e})=>null!=e)),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&null!=s?.geometry?A("div",{class:S.toolbarSection},A("div",{class:S.toolbarButtons},A("calcite-button",{appearance:"outline",class:S.addStopButton,iconStart:"plus",key:S.addStopButton,kind:"neutral",label:this.messages.addStop,onclick:()=>{this._addNewPlaceholder()},round:!0,scale:"s",width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){const t=W(e.currentTarget),s=null!=t?this.viewModel.layer?.stops.at(t):void 0;s?.geometry&&this._centerAtStop(s)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const s=W(e),o=null!=s?this.viewModel.layer?.stops.at(s):void 0;if(t===o){const e=this.acquireSearch(o);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){if(this._saveLayer.opened)return;this.removeHandles(O);if(!!e.selectedResult&&null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle?.pause();const s=null==t.geometry&&null==e.selectedResult?.feature.geometry,o=null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry!==e.selectedResult?.feature.geometry;if((s||o)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle?.pause();e.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(null!=t.geometry&&(t.geometry=null,this._solveRoute()),this.scheduleRender()):this._pointerDownUpHandle?.pause())}),this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){this._pointerDownUpHandle?.resume();const{view:s}=this;if(this.hasHandles(O)||!s)return;const i=s.cursor;this.addHandles([o((()=>{s.cursor=i})),r((()=>e.searchTerm),(t=>{e.destroyed||(s.cursor=t.length?i:"copy")}),n)],O),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel;i(e),i(e.surface);const t=s(e,"click",this._handleViewClick.bind(this)),o=s(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),o.pause()}));return{remove(){o.remove(),t.remove()},pause(){o.pause(),t.pause()},resume(){o.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=s(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=z(e)?this._activeStop:null})),t=s(document,"pointerup",(e=>{this._pointerDownUpHandle?.pause();const t=z(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?s:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){e.stopPropagation();const t=this._activeStop,s=t?this._stopsToSearches.get(t):null;t&&s&&!s.searchTerm&&(s.search(e.mapPoint).then((e=>{const o=e?.results[0].results;if(!o)return;const{feature:i,name:r}=o[0];t.geometry=i.geometry,t.name=r,s.searchTerm=r})),this.scheduleRender()),this._viewClickHandle?.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){if(this._pointerDownUpHandle?.pause(),this._newPlaceholderStop)return;const e=new v({symbol:new m});this.viewModel.layer?.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){const e=this.viewModel.layer?.stops??[];e.reverse();for(const t of e)t.sequence=null;this._solveRoute()}_handleRemoveStop(e){const{layer:t}=this.viewModel;if(!t)return;const s=W(e.currentTarget);if(null==s)return;const{stops:o,routeInfo:i}=t,r=o.at(s);this._removeStop(r),null==r.geometry&&null!=i||this._solveRoute()}_removeStop(e){const{stops:t}=this.viewModel.layer;!e||t.length<=2||(this._disposeSearch(e),t.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.departureOption=s.value,this._solveRoute()}_renderTimeControls(){return this.viewModel.departureIsoDate&&this.viewModel.departureIsoTime?A("div",{class:S.departureTimeControls,key:S.departureTimeControls,role:"group"},A("div",{class:S.departureDateTimePickers},A("calcite-input-date-picker",{valueAsDate:$(this.viewModel.departureIsoDate),onCalciteInputDatePickerChange:({target:e})=>{this.viewModel.departureIsoDate=e.value,this._solveRoute()}}),A("calcite-input-time-picker",{value:this.viewModel.departureIsoTime,onCalciteInputTimePickerChange:({target:e})=>{this.viewModel.departureIsoTime=e.value,this._solveRoute()}}))):null}_renderSectionSplitter(){return A("div",{class:S.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:o}=this.visibleElements;return e||t||s||o?A("div",{class:S.saveSection,key:S.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?A("div",{class:S.saveButtons,key:S.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const{portalItem:e,routeInfo:t}=this.viewModel.layer,s=e?.itemControl,o=null!=t&&("admin"===s||"update"===s);return A("calcite-button",{appearance:"outline",class:S.saveButton,disabled:!o,iconStart:"save",key:S.saveButton,label:this.messagesCommon.save,onclick:()=>{this._handleSaveButtonClick()},width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=null==this.viewModel.layer.routeInfo;return A("div",{class:S.saveAsButtonPopover,key:S.saveAsButtonPopover},A("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:S.saveAsButton,disabled:e,iconStart:"duplicate",key:S.saveAsButton,label:this.messagesCommon.saveAs,onclick:()=>this._handleSaveAsButtonClick(),width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return A("calcite-popover",{class:S.savePopover,label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode,triggerDisabled:!0},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?A("calcite-button",{appearance:"outline",class:S.printButton,iconStart:"print",key:S.printButton,label:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e,o=`${s}/home/item.html?id=${t}`;return A("calcite-link",{class:S.layerDetailsLink,href:o,key:S.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return A("div",{class:this.classes(S.directionsSection,S.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return A("div",{class:S.loader,key:"loader"})}_renderWarningCard(){return A("div",{class:S.warningCard,role:"alert"},A("div",{class:S.warningHeader},A("span",{"aria-hidden":"true",class:B.noticeTriangle}),A(R,{class:S.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),A("div",{class:S.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{layer:e,state:t}=this.viewModel,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():null!=e.directionLines?A("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(S.summary,this._saveLayer.opened&&D.buttonDisabled),key:S.summary,role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):A("div",{class:D.empty,key:"esri-directions__placeholder"},this._renderPlaceholder(),A(R,{class:S.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return A("svg",{class:D.emptyIllustration,viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},A("path",{d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z",fill:"currentcolor"}))}_renderMessage(e){return A(R,{class:S.messageHeading,level:this.headingLevel},e)}_renderRouteActions(){return A("div",{class:S.routeActions},A("button",{"aria-label":this.messages.clearRoute,bind:this,class:this.classes(S.clearRouteButton,D.button,D.buttonTertiary),onclick:this._handleClearRouteClick,tabIndex:0,type:"button"},this.messages.clearRoute))}_getSections(){const{layer:e}=this.viewModel;if(!e)return null;const{directionPoints:t,directionLines:s,stops:o}=e;if(null==t||null==s)return null;const i=[];let r=null;for(const n of t){const{objectId:e,stopId:t}=n;if(null!=t){const e=o.find((({objectId:e})=>e===t)),s=0===i.length;null!=r&&r.stop===e||(r={stop:e,directions:[],open:s},i.push(r));continue}if(null==r)continue;const a=s.find((({directionPointId:t})=>t===e));null!=a&&r.directions.push({directionPoint:n,directionLine:a})}return i}_renderManeuverSections(){return null==this._sections?null:A("div",{class:S.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let o;e.directions.length>0&&s&&(o=A("ol",{class:S.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const i=this._sections.length>2,r=t===this._sections.length-1,n={[S.collapsibleSection]:i},a={[B.down]:!s,[B.up]:s};let l;if(i&&!r){const t=s?this.messagesCommon.close:this.messagesCommon.open;l=A("header",{class:this.classes(S.maneuverSectionHeader,S.maneuverSectionToggle),key:S.maneuverSectionHeader},A("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:S.maneuverSectionHeaderButton,"data-maneuver-section":e,onclick:this._handleSectionToggle,onkeydown:this._handleSectionToggle,role:"button",tabIndex:0,title:t},A(R,{class:S.maneuverSectionTitle,level:this.headingLevel},e.stop.name),A("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=A("header",{class:S.maneuverSectionHeader,key:S.maneuverSectionHeader},A(R,{class:S.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return A("section",{class:this.classes(S.maneuverSection,n),key:t},l,o)})))}_handleSectionToggle(e){const t=G(e.currentTarget);t&&(t.open=!t.open)}_renderCosts(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(null==t||null==e)return null;const{distance:s,duration:o}=e,{primaryCosts:i,secondaryCosts:r,zoomToRoute:n}=this.messages,a=this._renderEta();return A("div",{"aria-label":n,bind:this,class:S.directionCosts,onclick:this._handleSummaryInteraction,onkeydown:this._handleSummaryInteraction,role:"button",tabIndex:0,title:n},A("div",{class:S.costsDetails,role:"group"},A("div",{class:S.primaryCosts,title:i},o),A("div",{class:S.verticalSplitter}),A("div",{class:S.secondaryCosts,title:r},s)),a)}_renderEta(){return this.viewModel.departureOption===f.UNSPECIFIED?null:A("div",{class:S.arrivalTimeContainer,title:this.messages.eta},A("span",{class:S.arrivalTime},this.viewModel.formattedEta))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??="street",T(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=k))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_renderManeuver(e){const{directionPoint:t,directionLine:s}=e,{distance:o,duration:i}=s,{messages:r,messagesUnits:n,unit:a}=this,l=M(n,o??0,a),c=b(i??0),d=l&&c?`${l}&nbsp;&middot;&nbsp;${c}`:`${l}${c}`,u=U(t),{objectId:h,directionPointType:p}=t,v=C(p),m=`${S.maneuver}-${h}`,_=`${S.intermediateCost}-${h}`,g={[S.maneuverActive]:this._activeManeuver===s};return A("li",{"aria-labelledby":`${m} ${_}`,bind:this,class:this.classes(S.maneuver,g),"data-maneuver":s,key:s,onblur:this._handleManeuverBlur,onclick:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onkeydown:this._handleManeuverClick,onmouseout:this._handleManeuverMouseOut,onmouseover:this._handleManeuverMouseOver,tabIndex:0},A("calcite-icon",{alt:"",class:S.maneuverIcon,icon:v}),A("div",{class:S.maneuverCostsContainer},u,A("div",{class:S.maneuverCosts},A("div",{class:S.horizontalSplitter}),A("div",{"aria-hidden":"true",class:S.intermediateCost,id:_,innerHTML:d,title:r.intermediateCosts}))))}_handleManeuverClick(e){const t=Y(e.currentTarget);if(!t)return;if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=Y(e.currentTarget);t&&this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=Y(e.currentTarget);t&&(this._focusedManeuver=t,this.viewModel.highlight(t))}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:o}=s.layer;if(null==o)return null;const i=o.totalDistance??0,r=o.totalDuration??0;return{distance:M(e,i,t),duration:b(r)}}async _solveRoute(){this.viewModel.updateDepartureTime();const e=this.viewModel.layer?.stops.filter((({geometry:e})=>null!=e));if(e&&!(e.length<2))try{await this.viewModel.getDirections()}catch{}}};e([d()],V.prototype,"apiKey",null),e([d(p)],V.prototype,"defaultUnit",void 0),e([d()],V.prototype,"goToOverride",null),e([d()],V.prototype,"headingLevel",void 0),e([d()],V.prototype,"icon",null),e([d()],V.prototype,"label",null),e([d({readOnly:!0})],V.prototype,"lastRoute",null),e([d()],V.prototype,"layer",null),e([d()],V.prototype,"maxStops",null),e([d(),j("esri/widgets/Directions/t9n/Directions")],V.prototype,"messages",void 0),e([d(),j("esri/t9n/common")],V.prototype,"messagesCommon",void 0),e([d(),j("esri/core/t9n/Units")],V.prototype,"messagesUnits",void 0),e([d()],V.prototype,"searchProperties",void 0),e([d()],V.prototype,"unit",null),e([d()],V.prototype,"view",null),e([d({type:y})],V.prototype,"viewModel",void 0),e([d()],V.prototype,"visibleElements",void 0),e([u("visibleElements")],V.prototype,"castVisibleElements",null),e([L()],V.prototype,"_handleStopIconClick",null),e([L()],V.prototype,"_handleClearRouteClick",null),e([L()],V.prototype,"_handleReverseStops",null),e([L()],V.prototype,"_handleRemoveStop",null),e([L()],V.prototype,"_handleSectionToggle",null),e([L()],V.prototype,"_handleSummaryInteraction",null),e([L()],V.prototype,"_handleManeuverClick",null),V=e([h("esri.widgets.Directions")],V);const K=V;function q(e){return e?.["data-mode"]}function W(e){return e?.["data-stop-index"]}function G(e){return e?.["data-maneuver-section"]}function Y(e){return e?.["data-maneuver"]}export{K as default};
