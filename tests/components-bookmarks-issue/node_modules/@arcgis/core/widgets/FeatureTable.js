/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{on as t,watch as i}from"../core/reactiveUtils.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import{cast as o}from"../core/accessorSupport/decorators/cast.js";import"../core/RandomLCG.js";import"../core/has.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import n from"./Widget.js";import r from"./FeatureTable/FeatureTableViewModel.js";import d from"./FeatureTable/Grid/support/ButtonMenu.js";import a from"./FeatureTable/Grid/support/ButtonMenuItem.js";import{loadCalciteComponents as c}from"./support/componentsUtils.js";import{globalCss as h}from"./support/globalCss.js";import{Heading as m}from"./support/Heading.js";import{legacyIcon as u}from"./support/legacyIcon.js";import"./support/widgetUtils.js";import{messageBundle as p}from"./support/decorators/messageBundle.js";import{tsx as g}from"./support/jsxFactory.js";import{substitute as b}from"../intl/substitute.js";const v={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0,deleteSelection:!0},selectionColumn:!0,columnMenus:!0},w="esri-feature-table",M=`${w}__prompt`,y={base:w,header:`${w}__header`,title:`${w}__title`,content:`${w}__content`,loader:`${w}__loader`,loaderContainer:`${w}__loader-container`,menuContainer:`${w}__menu`,promptContainer:M,promptHeader:`${M}__header`,promptHeading:`${M}__header__heading`,promptMessage:`${M}__message`,promptDivider:`${M}__divider`,promptActions:`${M}__actions`};let _=class extends n{constructor(e,t){super(e,t),this._prompt=null,this.menu=null,this.menuConfig=null,this.viewModel=new r,this.visibleElements={...v},this._showDeletePrompt=this._showDeletePrompt.bind(this),this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.addHandles([t((()=>this.viewModel.columns),"change",(()=>this._syncMenuConfig())),t((()=>this.viewModel.activeFilters),"change",(()=>this._syncMenuConfig())),t((()=>this.viewModel),"selection-change",(()=>this._syncMenuConfig())),i((()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled]),(()=>this.scheduleRender())),i((()=>[this.menuConfig,this.editingEnabled]),(()=>this._syncMenuConfig())),i((()=>this.messages),(()=>{this.menu&&(this.menu.label=this.messages?.options),this._syncMenuConfig()}))]),this._set("menu",new d({label:this.messages?.options,iconClass:u.handleHorizontal,...this.menuConfig}));const{attachmentsEnabled:e,relatedRecordsEnabled:l}=this;this.viewModel?.store?.set({attachmentsEnabled:e,relatedRecordsEnabled:l})}loadDependencies(){return c({button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),scrim:()=>import("@esri/calcite-components/dist/components/calcite-scrim.js"),action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),"action-bar":()=>import("@esri/calcite-components/dist/components/calcite-action-bar.js"),"input-date-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-date-picker.js"),"input-time-picker":()=>import("@esri/calcite-components/dist/components/calcite-input-time-picker.js"),"input-time-zone":()=>import("@esri/calcite-components/dist/components/calcite-input-time-zone.js")})}destroy(){this._prompt=null,this.menu?.destroy()}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(e){this.viewModel.attachmentsEnabled=e}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(e){this.viewModel.autoRefreshEnabled=e}get columnPerformanceModeEnabled(){return this.viewModel.columnPerformanceModeEnabled}set columnPerformanceModeEnabled(e){this.viewModel.columnPerformanceModeEnabled=e}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(e){this.viewModel.columnReorderingEnabled=e}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(e){this.viewModel.editingEnabled=e}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(e){this.viewModel.filterGeometry=e}get grid(){return this.viewModel.grid}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(e){this.viewModel.hiddenFields=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(e){this.viewModel.highlightIds=e}get icon(){return"table"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get layerView(){return this.viewModel.layerView}get messages(){return this.viewModel.messages}set messages(e){this.viewModel.messages=e}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(e){this.viewModel.messagesCommon=e}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(e){this.viewModel.messagesURIUtils=e}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(e){this.viewModel.multiSortEnabled=e}get pageSize(){return this.viewModel.pageSize}set pageSize(e){this.viewModel.pageSize=e}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(e){this.viewModel.relatedRecordsEnabled=e}get returnGeometryEnabled(){return this.viewModel.returnGeometryEnabled}set returnGeometryEnabled(e){this.viewModel.returnGeometryEnabled=e}get state(){return this.viewModel.state}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(e){this.viewModel.tableTemplate=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){const t={...v,...e};return this.grid?.set("visibleElements",{...this.grid.visibleElements,selectionColumn:t.selectionColumn,columnMenus:t.columnMenus}),t}clearSelectionFilter(){this.viewModel.clearSelectionFilter()}deleteSelection(e){return this.highlightIds.length?e?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}filterBySelection(){this.viewModel.filterBySelection()}findColumn(e){return this.viewModel.findColumn(e)}hideColumn(e){this.grid?.hideColumn(e),this._syncMenuConfig()}refresh(){return this.viewModel.refresh()}showAllColumns(){this.viewModel.showAllColumns()}showColumn(e){this.grid?.showColumn(e),this._syncMenuConfig()}sortColumn(e,t){this.viewModel.sortColumn(e,t)}scrollToIndex(e){this.viewModel.scrollToIndex(e)}zoomToSelection(){this.viewModel.zoomToSelection()}render(){const{_prompt:e}=this,t=null!=e?g("calcite-scrim",null,this._renderPrompt(e)):null;return g("div",{bind:this,class:this.classes(y.base,h.widget)},this.visibleElements.header?this._renderHeader():null,g("div",{class:y.content},"disabled"!==this.state&&this.grid?.render()),t)}_renderPrompt({title:e,message:t,context:i,actions:l}){const o=g("calcite-button",{appearance:"solid",key:"prompt-primary-button",kind:"danger"===i?"danger":"brand",onclick:l.primary.action,width:l.secondary?"half":"full"},l.primary.label),s=l.secondary?g("calcite-button",{appearance:"outline",key:"prompt-secondary-button",kind:"danger"===i?"danger":"brand",onclick:l.secondary.action,width:"half"},l.secondary.label):null;return g("div",{class:`${y.promptContainer}--${i}`},g("div",{class:y.promptHeader},g("calcite-icon",{icon:"exclamation-mark-triangle"}),g(m,{class:y.promptHeading,level:2},e)),g("div",{class:y.promptMessage},t),g("div",{class:y.promptDivider}),g("div",{class:y.promptActions},s,o))}_renderHeader(){return g("div",{class:y.header,key:"header"},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)}_renderTitle(){return g("div",{class:y.title,key:"title"},this._getTitle())}_getTitle(){const{grid:e,highlightIds:t,layer:i,messages:l,viewModel:{size:o}}=this;return e&&i?b(l.header,{title:i.title,count:o,selected:t.length||0}):""}_renderLoader(){const{state:e,store:t}=this.viewModel,i="loading"===e||t.syncing||t.querying;return g("div",{class:y.loaderContainer},i?g("div",{class:y.loader,key:"loader"}):null)}_renderMenu(){return g("div",{class:y.menuContainer},this.menu?.render())}_syncMenuConfig(){this.menu?.set({...this.menuConfig,items:this._getMenuItems()})}_getMenuItems(){const e=this.menuConfig?.items,t=this._getDefaultMenuItems(),i=[];return t?.length&&i.push(...t),e?.length&&i.push(...e),i}_getDefaultMenuItems(){const{highlightIds:e,messages:t,viewModel:i,visibleElements:l}=this,{menuItems:o}=l,s=[];if(o?.refreshData&&s.push(new a({selectionEnabled:!1,label:t?.refreshData,clickFunction:()=>this.refresh()})),e.length){const i=this._getSelectionFilter();if(o?.clearSelection&&s.push(new a({selectionEnabled:!1,label:t?.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()})),o?.zoomToSelection&&this.view&&s.push(new a({selectionEnabled:!1,label:t?.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()})),o?.selectedRecordsShowSelectedToggle&&(!i||e.length!==i.objectIds.length)){const e=t?.showSelected,i=new a({selectionEnabled:!1,label:e,clickFunction:()=>{this.filterBySelection(),i.set("label",e)}});s.push(i)}o?.deleteSelection&&this.editingEnabled&&this.layer?.capabilities?.operations?.supportsDelete&&s.push(new a({selectionEnabled:!1,label:t.deleteSelection,clickFunction:this._showDeletePrompt}))}if(o?.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const e=t.showAllRecords,i=new a({selectionEnabled:!1,label:e,clickFunction:()=>{this.clearSelectionFilter(),i.set("label",e)}});s.push(i)}return o?.toggleColumns&&s.push(new a({iconClass:u.right,label:t?.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:i?.columns?.items.map((({header:e,hidden:t,path:i})=>new a({label:e||i,selected:!t,selectionEnabled:!0,iconClass:u.checkMark,clickFunction:()=>this._toggleColumnFromMenuItem(i)})))})),s.length?s:null}_toggleMenuItemSelectedIcon({item:e}){e?.set("iconClass",e?.selected?u.down:u.right)}_toggleColumnFromMenuItem(e){const{grid:t,viewModel:i}=this,l=i.findColumn(e);l?.hidden?t?.showColumn(e):t?.hideColumn(e)}_showDeletePrompt(){const{messages:e,messagesCommon:t}=this,i=this.highlightIds.length||0,l=b(e.deleteSelectionCount,{count:i});this.menu&&(this.menu.open=!1),this._prompt={title:l,message:e.deleteRecordsRemoved,context:"danger",actions:{primary:{label:t.delete,action:this._onDeleteSelectionClick},secondary:{label:e.keepRecords,action:()=>this._prompt=null}}}}async _onDeleteSelectionClick(){await this.viewModel.deleteSelection(),this._prompt=null}_getSelectionFilter(){return this.viewModel.activeFilters?.find((e=>"selection"===e.type))}_hasSelectionFilter(){return!!this._getSelectionFilter()}};e([l({readOnly:!0})],_.prototype,"activeFilters",null),e([l({readOnly:!0})],_.prototype,"activeSortOrders",null),e([l()],_.prototype,"attachmentsEnabled",null),e([l()],_.prototype,"autoRefreshEnabled",null),e([l()],_.prototype,"columnPerformanceModeEnabled",null),e([l()],_.prototype,"columnReorderingEnabled",null),e([l({readOnly:!0})],_.prototype,"columns",null),e([l()],_.prototype,"editingEnabled",null),e([l()],_.prototype,"filterGeometry",null),e([l({readOnly:!0})],_.prototype,"grid",null),e([l()],_.prototype,"hiddenFields",null),e([l()],_.prototype,"highlightEnabled",null),e([l()],_.prototype,"highlightIds",null),e([l()],_.prototype,"icon",null),e([l()],_.prototype,"label",null),e([l()],_.prototype,"layer",null),e([l()],_.prototype,"layerView",null),e([l(),p("esri/widgets/FeatureTable/t9n/FeatureTable")],_.prototype,"messages",null),e([l(),p("esri/t9n/common")],_.prototype,"messagesCommon",null),e([l(),p("esri/widgets/support/t9n/uriUtils")],_.prototype,"messagesURIUtils",null),e([l({readOnly:!0})],_.prototype,"menu",void 0),e([l()],_.prototype,"menuConfig",void 0),e([l()],_.prototype,"multiSortEnabled",null),e([l()],_.prototype,"pageSize",null),e([l()],_.prototype,"relatedRecordsEnabled",null),e([l()],_.prototype,"returnGeometryEnabled",null),e([l({readOnly:!0})],_.prototype,"state",null),e([l()],_.prototype,"tableTemplate",null),e([l()],_.prototype,"timeExtent",null),e([l()],_.prototype,"timeZone",null),e([l()],_.prototype,"view",null),e([l()],_.prototype,"viewModel",void 0),e([l()],_.prototype,"visibleElements",void 0),e([o("visibleElements")],_.prototype,"castVisibleElements",null),_=e([s("esri.widgets.FeatureTable")],_);const E=_;export{E as default};
