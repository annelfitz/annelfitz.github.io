/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import t from"../../Color.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{cast as a}from"../../core/accessorSupport/decorators/cast.js";import"../../core/RandomLCG.js";import"../../core/has.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import i from"../../renderers/visualVariables/SizeVariable.js";import o from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as l}from"./SmartMappingSliderBase.js";import n from"./SizeSlider/SizeSliderViewModel.js";import{getSizesFromVariable as p,getFillFromColor as d,getDynamicPathForSizeStops as m,getPathForSizeStops as u}from"./support/utils.js";import{globalCss as c}from"../support/globalCss.js";import{storeNode as h}from"../support/widgetUtils.js";import{messageBundle as g}from"../support/decorators/messageBundle.js";import{tsx as v}from"../support/jsxFactory.js";var b;const z="esri-size-slider",y={base:z,rampElement:`${z}__ramp`,sliderContainer:`${z}__slider-container`,histogramContainer:`${z}__histogram-container`,zoomCapTop:`${z}__zoom-cap-top`,zoomCapBottom:`${z}__zoom-cap-bottom`,zoomCapLine:`${z}__zoom-cap-line`,zoomCapMask:`${z}__zoom-cap-mask`,zoomCapUnderline:`${z}__zoom-cap-underline`,primaryHandle:`${z}--primary-handle`,track:`${z}--interactive-track`},f={trackFillColor:new t([149,149,149]),trackBackgroundColor:new t([224,224,224])};let S=b=class extends l{constructor(e,t){super(e,t),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...f},this.viewModel=new n}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...f,...e}}static fromRendererResult(e,t){const{visualVariables:s,statistics:a}=e,{avg:r,stddev:i}=a,o=s[0],[l,n]=p(o),d=e.renderer.authoringInfo.visualVariables[0],m=d.minSliderValue,u=d.maxSliderValue;return new b({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:i,bins:t?t.bins:[]}})}updateFromRendererResult(e,t){const{visualVariables:s,statistics:a}=e,{avg:r,stddev:i}=a,o=s[0],[l,n]=p(o),d=e.renderer.authoringInfo.visualVariables[0],m=d.minSliderValue,u=d.maxSliderValue;this.set({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:r,standardDeviation:i,bins:t?t.bins:[]}})}updateVisualVariable(e){const t=e.clone(),{stops:s}=this;if(!e||!s)return null;if(t.stops)return t.stops=s,t;const a=s[0],r=s[s.length-1];let o=t.maxSize,l=t.minSize;if(o instanceof i){const e=o.stops,t=r.size/e[0].size,s=e.map((e=>(e.size*=t,e)));o.stops=s}else o=r.size;if(l instanceof i){const e=l.stops,t=a.size/e[0].size,s=e.map((e=>(e.size*=t,e)));l.stops=s}else l=a.size;return t.set({maxDataValue:r.value,minDataValue:a.value,maxSize:o,minSize:l}),t}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:t,minDataValue:s,stops:a}=e;if(a)this.stops=a;else{const[a,r]=p(e);this.stops=[new o({value:s,size:r}),new o({value:t,size:a})]}}render(){const{label:e,primaryHandleEnabled:t,state:s,visibleElements:a}=this,r="disabled"===s,i=this.classes(y.base,c.widget,c.panel,{[c.disabled]:r,[y.primaryHandle]:t,[y.track]:!!a.interactiveTrack});return v("div",{"aria-label":e,class:i},r?null:this.renderContent(this._renderRamp(),y.sliderContainer,y.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return v("div",{afterCreate:h,bind:this,class:y.rampElement,"data-node-ref":"_rampNode"},v("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},v("rect",{fill:d(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPath()),t?this.renderZoomCaps():null)}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(null==e||null==t)return;const{primaryHandleEnabled:s,stops:a,style:{trackFillColor:r},values:i,viewModel:{max:o,min:l},_maxRampFillWidth:n,_minRampFillWidth:p}=this,c=[n,p];a[0].size<a[a.length-1].size&&c.reverse();const h=i.slice().sort(((e,t)=>e>t?1:-1)),[g,b]=c,[z,y]=h,f=s?m({max:o,min:l,pathHeight:e,pathWidth:t,stops:a,padding:b}):u({bottomValue:z,bottomWidth:g,max:o,min:l,pathHeight:e,pathWidth:t,topValue:y,topWidth:b});return v("path",{d:f,fill:d(r)})}};e([s()],S.prototype,"handlesSyncedToPrimary",null),e([s()],S.prototype,"label",null),e([s(),g("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),e([s()],S.prototype,"persistSizeRangeEnabled",null),e([s()],S.prototype,"primaryHandleEnabled",null),e([s()],S.prototype,"stops",null),e([s()],S.prototype,"style",void 0),e([a("style")],S.prototype,"castStyle",null),e([s()],S.prototype,"viewModel",void 0),S=b=e([r("esri.widgets.smartMapping.SizeSlider")],S);const _=S;export{_ as default};
