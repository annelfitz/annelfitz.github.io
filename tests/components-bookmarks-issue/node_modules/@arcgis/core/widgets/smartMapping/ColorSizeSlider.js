/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../core/Error.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/RandomLCG.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import t from"../../renderers/visualVariables/support/ColorSizeStop.js";import l from"../../renderers/visualVariables/support/ColorStop.js";import a from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as o}from"./SmartMappingSliderBase.js";import n from"./ColorSizeSlider/ColorSizeSliderViewModel.js";import{getDynamicPathForSizeStops as d,getPathForSizeStops as p}from"./support/utils.js";import{globalCss as m}from"../support/globalCss.js";import{storeNode as u}from"../support/widgetUtils.js";import{messageBundle as h}from"../support/decorators/messageBundle.js";import{tsx as c}from"../support/jsxFactory.js";var b;const v="esri-color-size-slider",g={base:v,rampElement:`${v}__ramp`,sliderContainer:`${v}__slider-container`,histogramContainer:`${v}__histogram-container`,primaryHandle:`${v}--primary-handle`,track:`${v}--interactive-track`};let f=b=class extends o{constructor(e,r){super(e,r),this._backgroundFillColor="#e0e0e0",this._minRampFillWidth=.2,this._rampNode=null,this._maxRampFillWidth=1,this.messages=null,this.viewModel=new n,this._bgFillId=`${this.id}-bg-fill`,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}static fromRendererResult(e,i){const s=e.size.visualVariables,l=e.renderer.authoringInfo.univariateTheme,a=e.color?.visualVariable.stops,{statistics:o}=e,{avg:n,stddev:d}=o;if(!a)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===l,m=e.renderer.authoringInfo.visualVariables[0],u=m.minSliderValue,h=m.maxSliderValue,c=s.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),v=c.stops,g=a.map(((e,r)=>{const{color:i,label:s,value:l}=e;let o;return o=v&&v.length>0?v[r].size:0===r?c.minSize:r===a.length-1?c.maxSize:null,new t({color:i,label:s,value:l,size:o})}));return new b({max:h,min:u,stops:g,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:i?i.bins:[]}})}updateFromRendererResult(e,i){const s=e.size.visualVariables,l=e.renderer.authoringInfo.univariateTheme,a=e.color?.visualVariable.stops,{statistics:o}=e,{avg:n,stddev:d}=o;if(!a)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===l,m=e.renderer.authoringInfo.visualVariables[0],u=m.minSliderValue,h=m.maxSliderValue,c=s.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),b=c.stops,v=a.map(((e,r)=>{const{color:i,label:s,value:l}=e;let o;return o=b&&b.length>0?b[r].size:0===r?c.minSize:r===a.length-1?c.maxSize:null,new t({color:i,label:s,value:l,size:o})}));this.set({max:h,min:u,stops:v,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:i?i.bins:[]}})}updateRenderer(e){const{stops:r}=this,i=r[0],s=r[r.length-1],t=r[Math.floor(r.length/2)],o=e.clone(),n=o.visualVariables.map((e=>{if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return e;null!=e.minSize&&null!=e.maxSize?e.set({maxDataValue:s.value,minDataValue:i.value,maxSize:s.size,minSize:i.size}):e.stops&&e.set({stops:r.map((e=>{const{label:r,size:i,value:s}=e;return new a({label:r,size:i,value:s})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:r,label:i,value:s}=e;return new l({color:r,label:i,value:s})}))});return e}));if(o.visualVariables=n,o.classBreakInfos.length>1){const e=t.value;o.classBreakInfos[0].maxValue=e,o.classBreakInfos[1].minValue=e}return o}updateVisualVariables(e){return e.map((e=>{const r=e.clone();if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return r;if(null!=e.minSize&&null!=e.maxSize){const{stops:e}=this,i=e[0],s=e[e.length-1];r.set({maxDataValue:s.value,minDataValue:i.value,maxSize:s.size,minSize:i.size})}else e.stops&&r.set({stops:this.stops.map((e=>{const{label:r,size:i,value:s}=e;return new a({label:r,size:i,value:s})}))})}else"color"===e.type&&r.set({stops:this.stops.map((e=>{const{color:r,label:i,value:s}=e;return new l({color:r,label:i,value:s})}))});return r}))}render(){const{label:e,primaryHandleEnabled:r,state:i,visibleElements:s}=this,t="disabled"===i,l=this.classes(g.base,m.widget,m.panel,{[m.disabled]:t,[g.primaryHandle]:r,[g.track]:!!s.interactiveTrack});return c("div",{"aria-label":e,class:l},t?null:this.renderContent(this._renderRamp(),g.sliderContainer,g.histogramContainer))}_renderRamp(){const{_bgFillId:e,_rampFillId:r,viewModel:i,zoomOptions:s}=this,t=i.getStopInfo();return c("div",{afterCreate:u,bind:this,class:g.rampElement,"data-node-ref":"_rampNode"},c("svg",{xmlns:"http://www.w3.org/2000/svg"},c("defs",null,this.renderRampFillDefinition(r,t),this.renderBackgroundFillDefinition(e)),c("rect",{fill:this._backgroundFillColor,height:"100%",width:"100%",x:"0",y:"0"}),this._renderPaths()),s?this.renderZoomCaps():null)}_renderPaths(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(null==e||null==r)return;const{primaryHandleEnabled:i,stops:s,values:t,viewModel:{max:l,min:a},_bgFillId:o,_maxRampFillWidth:n,_minRampFillWidth:m,_rampFillId:u}=this,h=[n,m];s[0].size<s[s.length-1].size&&h.reverse();const b=t.slice().sort(((e,r)=>e>r?1:-1)),[v,g]=h,[f,S]=b,z=i?d({max:l,min:a,pathHeight:e,pathWidth:r,stops:s,padding:m}):p({bottomValue:f,bottomWidth:v,max:l,min:a,pathHeight:e,pathWidth:r,topValue:S,topWidth:g});return[c("path",{d:z,fill:`url(#${o})`,key:"background"}),c("path",{d:z,fill:`url(#${u})`,key:"fill"})]}};e([i()],f.prototype,"label",null),e([i(),h("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],f.prototype,"messages",void 0),e([i()],f.prototype,"persistSizeRangeEnabled",null),e([i()],f.prototype,"primaryHandleEnabled",null),e([i()],f.prototype,"stops",null),e([i()],f.prototype,"viewModel",void 0),f=b=e([s("esri.widgets.smartMapping.ColorSizeSlider")],f);const S=f;export{S as default};
