/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{getScaleForResolution as i}from"../../geometry/support/scaleUtils.js";import t from"../../renderers/visualVariables/SizeVariable.js";import a from"../statistics/spatialStatistics.js";import{verifyBinningParams as r}from"../support/binningUtils.js";import{binningCapableLayerTypes as o,featureCapableLayerTypes as s,createLayerAdapter as n,getLayerTypeLabels as l}from"../support/adapters/support/layerUtils.js";const p=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];async function u(i){const{view:t}=i;if(!(i&&t&&i.layer))throw new e("outline:missing-parameters","'view' and 'layer' parameters are required");i.forBinning&&r(i,"outline");const{layer:a,...p}=i,u=i.forBinning?o:s,f=n(a,u,i.forBinning);if(!f)throw new e("outline:invalid-parameters","'layer' must be one of these types: "+l(u).join(", "));const m={layerAdapter:f,...p,view:t};await t.when();const w=null!=m.signal?{signal:m.signal}:null;if(await f.load(w),"polygon"!==f.geometryType)throw new e("outline:not-supported",`outline is not supported for geometryType: ${f.geometryType}`);return m}function f(e,a){const r=e.avgSize,o=i(1,a.spatialReference),s=p.map((e=>({size:e.width,value:Math.round(r/e.size*o)})));s.sort(((e,i)=>e.value-i.value));return{visualVariables:[new t({target:"outline",valueExpression:"$view.scale",stops:s})],opacity:.25}}async function m(i){const{layerAdapter:t,...r}=await u(i),o=-1,s=await t.getSampleFeatures({sampleSize:o,returnGeometry:!0,...r},"json");if(!s?.length)throw new e("outline:insufficient-info","No features are available to calculate statistics");const n=await a({features:s,geometryType:t.geometryType});if(!(n&&"avgSize"in n&&n.avgSize))throw new e("outline:insufficient-info","average polygon size is invalid");return f({...n,avgSize:n.avgSize},r.view)}export{m as default};
