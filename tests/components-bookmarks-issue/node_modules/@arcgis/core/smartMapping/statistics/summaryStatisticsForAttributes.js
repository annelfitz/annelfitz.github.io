/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{getSumOfAttributesExpr as s,verifyBasicFieldValidity as t}from"./support/utils.js";import{verifyBinningParams as r}from"../support/binningUtils.js";import{getFieldsList as i}from"../support/utils.js";import{LayerType as a,binningCapableLayerTypes as n,createLayerAdapter as o,getLayerTypeLabels as u}from"../support/adapters/support/layerUtils.js";async function l(s){if(!(s&&s.layer&&s.attributes))throw new e("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(s.attributes.some((e=>!!e.valueExpression))&&!s.view)throw new e("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");s.forBinning&&r(s,"summary-statistics-for-attributes");const{layer:l,...p}=s,m=[a.CSVLayer,a.FeatureLayer,a.OGCFeatureLayer,a.GeoJSONLayer,a.WFSLayer],c=s.forBinning?n:m,f=o(l,c,s.forBinning);if(!f)throw new e("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+u(c).join(", "));const y={layerAdapter:f,...p};y.includeZeros=null==y.includeZeros||y.includeZeros,y.includeNegatives=null==y.includeNegatives||y.includeNegatives;const d=y.view,w=null!=y.signal?{signal:y.signal}:null;await Promise.all([d?.when(),f.load(w)]);const v=[];for(const e of y.attributes){const s=await i({field:e.field,valueExpression:e.valueExpression});Array.prototype.push.apply(v,s)}const g=t(f,v,"summary-statistics-for-attributes:invalid-parameters");if(g)throw g;return y}async function p(e){const{layerAdapter:t,...r}=await l(e),i=s(r.attributes,r.includeZeros,r.includeNegatives);return t.summaryStatistics({valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,view:r.view,signal:r.signal})}export{p as default};
