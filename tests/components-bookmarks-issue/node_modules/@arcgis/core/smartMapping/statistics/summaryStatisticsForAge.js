/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import a from"./summaryStatistics.js";import{getAgeExpressions as t,verifyDates as r,supportedAgeUnits as i}from"./support/ageUtils.js";import{createLayerAdapter as s,featureCapableLayerTypes as n,getLayerTypeLabels as m}from"../support/adapters/support/layerUtils.js";async function o(a){if(!(a&&a.layer&&a.startTime&&a.endTime&&a.unit))throw new e("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const{layer:t,...o}=a,l=s(t,n);if(!l)throw new e("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+m(n).join(", "));const u={layerAdapter:l,...o},p=u.view,y=null!=u.signal?{signal:u.signal}:null;await Promise.all([p?.when(),l.load(y)]);const d=r(l,u.startTime,u.endTime,"summary-statistics-for-age:invalid-parameters");if(d)throw d;if(!u.unit||!i.includes(u.unit))throw new e("summary-statistics-for-age:invalid-parameters",`Supported units are: ${i.join(", ")}`);return u}async function l(e){const{layerAdapter:r,...i}=await o(e),{view:s,startTime:n,endTime:m,unit:l,minValue:u,maxValue:p,signal:y}=i,{valueExpression:d,statisticsQuery:c}=t({layer:r,startTime:n,endTime:m,unit:l}),f={layer:r,valueExpression:d,...c,minValue:u,maxValue:p,view:s,signal:y};return a(f)}export{l as default};
