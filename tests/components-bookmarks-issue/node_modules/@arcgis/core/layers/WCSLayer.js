/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Error.js";import{MultiOriginJSONMixin as r}from"../core/MultiOriginJSONSupport.js";import{watch as s}from"../core/reactiveUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/Logger.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import a from"./Layer.js";import{BlendLayer as n}from"./mixins/BlendLayer.js";import{CustomParametersMixin as l}from"./mixins/CustomParametersMixin.js";import{ImageryTileMixin as p}from"./mixins/ImageryTileMixin.js";import{OperationalLayer as m}from"./mixins/OperationalLayer.js";import{PortalLayer as u}from"./mixins/PortalLayer.js";import{RefreshableLayer as c}from"./mixins/RefreshableLayer.js";import{ScaleRangeLayer as d}from"./mixins/ScaleRangeLayer.js";import{TemporalLayer as f}from"./mixins/TemporalLayer.js";import{popupEnabled as h}from"./support/commonProperties.js";import y from"./support/Field.js";import v from"./support/rasterDatasets/WCSRaster.js";import{createPopupTemplate as g}from"../support/popupUtils.js";const j=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let I=class extends(n(d(m(u(l(p(f(c(r(a)))))))))){constructor(...e){super(...e),this.coverageId=null,this.version=null,this.isReference=null,this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._openRaster(t)),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[new y({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}createPopupTemplate(e){return g({fields:this.rasterFields,title:this.title},e)}async _openRaster(e){const r=new v({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await r.open({signal:e}),!r.rasterInfo)throw r.destroy(),new t("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:o}=r;this._set("serviceRasterInfo",o),this._set("spatialReference",o.spatialReference),null==this.title&&this.setAtOrigin("title",r.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",r.coverageInfo.id,"service"),this.setAtOrigin("tileInfo",r.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:i}=o;if(null!=i){const e=i.variables[0].dimensions.find((({name:e})=>"StdTime"===e));if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let r=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(r)&&(r=r[1]);const s=j.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:r},timeZone:null,interval:s?{value:e.interval,unit:s}:null})}}this.raster=r,this._configDefaultSettings(),this.addHandles(s((()=>this.customParameters),(e=>this.raster.ioConfig.customFetchParameters=e)))}};e([o({type:String,nonNullable:!0,json:{write:!0}})],I.prototype,"coverageId",void 0),e([o()],I.prototype,"coverageInfo",null),e([o()],I.prototype,"version",void 0),e([o()],I.prototype,"isReference",void 0),e([o()],I.prototype,"raster",void 0),e([o({readOnly:!0})],I.prototype,"type",void 0),e([o(h)],I.prototype,"popupEnabled",void 0),e([o()],I.prototype,"popupTemplate",void 0),e([o({readOnly:!0})],I.prototype,"defaultPopupTemplate",null),e([o({readOnly:!0,type:[y]})],I.prototype,"fields",void 0),e([o({readOnly:!0,type:[y]})],I.prototype,"rasterFields",null),I=e([i("esri.layers.WCSLayer")],I);const x=I;export{x as default};
