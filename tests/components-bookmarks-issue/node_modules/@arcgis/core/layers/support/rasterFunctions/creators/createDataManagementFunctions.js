/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{getNamedColor as t,hex2rgba as n}from"../../../../colorUtils.js";import{colormapName as a}from"../../rasterFunctionConstants.js";import{createRasterFunction as o}from"./utils.js";import{colorRampDict as e}from"../../../../renderers/support/colorRampUtils.js";function r(t){return"colormap"in t?s(t):"colorRamp"in t?i(t):u(t)}function s(a){const e=a.colormap.map((a=>{if("value"in a){const o="string"==typeof a.color?t(a.color)??n(a.color):a.color;(a=[a.value,...o])[4]&&a[4]<=1&&(a[4]=Math.round(255*a[4]))}return a})),{raster:r,outputPixelType:s}=a;return o("Colormap",{colormap:e,raster:r},s)}function i(t){const{raster:n,colorRamp:a,outputPixelType:e}=t,r={colorRamp:"toJSON"in a?a.toJSON():a,raster:n};return o("Colormap",r,e)}function u(t){const{colorRampName:n}=t,r=Object.values(a).find((t=>t.toLowerCase()===n?.toLowerCase())),s=e.toJSON(n),{raster:i,outputPixelType:u="unknown"}=t;return o("Colormap",r?{colormapName:r,raster:i}:{colorRampName:s,raster:i},u)}function l(t){const{raster:n,histograms:a,outputPixelType:e}=t,r=t.statistics?.map((t=>({min:t.min,max:t.max,mean:t.avg,standardDeviation:t.stddev})));return o("StatisticsHistograms",{raster:n,statistics:r,histograms:a},e)}function p(t){const{raster:n,attributeTable:a,outputPixelType:e="unknown"}=t,r="toJSON"in a?a.toJSON():a;return o("Table",{raster:n,attributeTableAsRecordSet:r},e)}function c(t){const{raster:n,outputPixelType:a="unknown"}=t,e={raster:n,missingBandAction:"fail"===t.missingBandAction?1:0};return"bandIds"in t?e.bandIds=t.bandIds:"bandNames"in t?e.bandNames=t.bandNames:"bandWavelengths"in t&&(e.bandWavelengths=t.bandWavelengths),o("ExtractBand",e,a)}function m(t){const{rasters:n,outputPixelType:a}=t;return o("CompositeBand",{rasters:n},a)}function d(t){const{allowUnmatched:n,raster:a,rangeMaps:e,outputPixelType:r}=t,s=e?.filter((({output:t})=>null!=t)),i=s?.flatMap((({range:t})=>t)),u=s?.map((({output:t})=>t)),l=e?.filter((t=>null==t.output))?.flatMap((({range:t})=>t));return o("Remap",{allowUnmatched:n,raster:a,inputRanges:i,outputValues:u,noDataRanges:l},r)}function f(t){const{raster:n,outputPixelType:a="unknown"}=t,e=t.includedRanges?.flatMap((t=>t)),r=t.noDataValues?.map((t=>t.join(" "))),s="match-all"===t.noDataInterpretation?1:0;return o("Mask",{raster:n,includedRanges:e,noDataInterpretation:s,noDataValues:r},a)}function g(t){const{geometry:n,keepOutside:a,outputPixelType:e="unknown"}=t,r="declaredClass"in n?n.toJSON():n;return o("Clip",{clippingGeometry:r,clippingType:a?2:1},e)}function y(t){const{weights:n,outputPixelType:a="unknown"}=t;return o("Grayscale",{conversionParameters:n},a)}export{g as clip,r as colormap,m as compositeBands,c as extractBand,y as grayscale,f as mask,d as remap,l as statisticsHistogram,p as table};
