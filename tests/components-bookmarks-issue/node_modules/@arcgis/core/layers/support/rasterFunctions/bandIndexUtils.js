/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{JSONMap as n}from"../../../core/jsonMap.js";import t from"../PixelBlock.js";import{calculateCustomBandIndex as e}from"./customBandIndexUtils.js";import{isValidPixelBlock as r}from"./pixelUtils.js";const o=new n({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function a(n,o){if(!r(n))return n;const{equation:a,method:s}=o,i=o.bandIndexes.map((n=>n-1)),{pixels:x,mask:j}=n;let q;switch(s){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":q=l(j,x[i[0]],x[i[1]]);break;case"ndwi":q=l(j,x[i[1]],x[i[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":q=c(j,x[i[0]],x[i[1]]);break;case"ci-g":case"ci-re":q=u(j,x[i[0]],x[i[1]]);break;case"savi":q=f(j,x[i[0]],x[i[1]],i[2]+1);break;case"tsavi":q=w(j,x[i[0]],x[i[1]],i[2]+1,i[3]+1,i[4]+1);break;case"msavi":q=h(j,x[i[0]],x[i[1]]);break;case"gemi":q=m(j,x[i[0]],x[i[1]]);break;case"pvi":q=d(j,x[i[0]],x[i[1]],i[2]+1,i[3]+1);break;case"gvitm":q=g(j,[x[i[0]],x[i[1]],x[i[2]],x[i[3]],x[i[4]],x[i[5]]]);break;case"sultan":q=y(j,[x[i[0]],x[i[1]],x[i[2]],x[i[3]],x[i[4]]]);break;case"vari":q=b(j,[x[i[0]],x[i[1]],x[i[2]]]);break;case"mtvi2":q=v(j,[x[i[0]],x[i[1]],x[i[2]]]);break;case"rtvi-core":q=k(j,[x[i[0]],x[i[1]],x[i[2]]]);break;case"evi":q=A(j,[x[i[0]],x[i[1]],x[i[2]]]);break;case"wndwi":q=p(j,[x[i[0]],x[i[1]],x[i[2]]],i[3]?i[3]+1:.5);break;case"bai":q=F(j,x[i[0]],x[i[1]]);break;case"custom":q=e(j,x,a);break;default:return n}const M=null!=j?new Uint8Array(j.length):null;null!=j&&null!=M&&M.set(j);const U=new t({width:n.width,height:n.height,pixelType:"f32",pixels:q,mask:M});return U.updateStatistics(),U}function s(n,e,r,o){const{mask:a,pixels:s,width:i,height:l}=n,c=s[r],u=s[e],f=u.length,w=o?new Uint8Array(f):new Float32Array(f),h=o?100:1,m=o?100.5:0;for(let t=0;t<f;t++)if(null==a||a[t]){const n=c[t],e=u[t],r=n+e;r&&(w[t]=(n-e)/r*h+m)}const d=new t({width:i,height:l,mask:a,pixelType:o?"u8":"f32",pixels:[w]});return d.updateStatistics(),d}function i(n){const t=new Float32Array(9);return t[3*n[0]]=1,t[3*n[1]+1]=1,t[3*n[2]+2]=1,t}function l(n,t,e){const r=e.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a]){const n=t[a],r=e[a],s=n+r;s&&(o[a]=(n-r)/s)}return[o]}function c(n,t,e){const r=e.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a]){const n=t[a],r=e[a];r&&(o[a]=n/r)}return[o]}function u(n,t,e){const r=t.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a]){const n=t[a],r=e[a];r&&(o[a]=n/r-1)}return[o]}function f(n,t,e,r){const o=e.length,a=new Float32Array(o);for(let s=0;s<o;s++)if(null==n||n[s]){const n=e[s],o=t[s],i=o+n+r;i&&(a[s]=(o-n)/i*(1+r))}return[a]}function w(n,t,e,r,o,a){const s=e.length,i=new Float32Array(s),l=-o*r+a*(1+r*r);for(let c=0;c<s;c++)if(null==n||n[c]){const n=e[c],a=t[c],s=o*a+n+l;s&&(i[c]=r*(a-r*n-o)/s)}return[i]}function h(n,t,e){const r=e.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a]){const n=e[a],r=t[a],s=2*r+1;o[a]=.5*(s-Math.sqrt(s*s-8*(r-n)))}return[o]}function m(n,t,e){const r=e.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a]){const n=e[a],r=t[a];if(1!==n&&r+n+.5!==0){const t=(2*(r*r-n*n)+1.5*r+.5*n)/(r+n+.5);o[a]=t*(1-.25*t)-(n-.125)/(1-n)}}return[o]}function d(n,t,e,r,o){const a=e.length,s=new Float32Array(a),i=1/Math.sqrt(1+r*r);for(let l=0;l<a;l++)if(null==n||n[l]){const n=e[l],a=t[l];s[l]=(a-r*n-o)*i}return[s]}function g(n,t){const[e,r,o,a,s,i]=t,l=e.length,c=new Float32Array(l);for(let u=0;u<l;u++)(null==n||n[u])&&(c[u]=-.2848*e[u]-.2435*r[u]-.5436*o[u]+.7243*a[u]+.084*s[u]-.18*i[u]);return[c]}function y(n,t){const[e,r,o,a,s]=t,i=e.length,l=new Float32Array(i),c=new Float32Array(i),u=new Float32Array(i);for(let f=0;f<i;f++)(null==n||n[f])&&(l[f]=s[f]?a[f]/s[f]*100:0,c[f]=e[f]?a[f]/e[f]*100:0,u[f]=o[f]?r[f]/o[f]*(a[f]/o[f])*100:0);return[l,c,u]}function b(n,t){const[e,r,o]=t,a=e.length,s=new Float32Array(a);for(let i=0;i<a;i++)if(null==n||n[i])for(i=0;i<a;i++){const n=e[i],t=r[i],a=t+n-o[i];a&&(s[i]=(t-n)/a)}return[s]}function v(n,t){const[e,r,o]=t,a=e.length,s=new Float32Array(a);for(let i=0;i<a;i++)if(null==n||n[i])for(i=0;i<a;i++){const n=e[i],t=r[i],a=o[i],l=Math.sqrt((2*n+1)**2-(6*n-5*Math.sqrt(t))-.5);if(l){const e=1.5*(1.2*(n-a)-2.5*(t-a));s[i]=e/l}}return[s]}function k(n,t){const[e,r,o]=t,a=e.length,s=new Float32Array(a);for(let i=0;i<a;i++)if(null==n||n[i])for(i=0;i<a;i++){const n=e[i],t=r[i],a=o[i];s[i]=100*(n-t)-10*(n-a)}return[s]}function A(n,t){const[e,r,o]=t,a=e.length,s=new Float32Array(a);for(let i=0;i<a;i++)if(null==n||n[i])for(i=0;i<a;i++){const n=e[i],t=r[i],a=n+6*t-7.5*o[i]+1;a&&(s[i]=2.5*(n-t)/a)}return[s]}function p(n,t,e=.5){const[r,o,a]=t,s=o.length,i=new Float32Array(s);for(let l=0;l<s;l++)if(null==n||n[l])for(l=0;l<s;l++){const n=r[l],t=o[l],s=a[l],c=n+e*t+(1-e)*s;c&&(i[l]=(n-e*t-(1-e)*s)/c)}return[i]}function F(n,t,e){const r=e.length,o=new Float32Array(r);for(let a=0;a<r;a++)if(null==n||n[a])for(a=0;a<r;a++){const n=(.1-t[a])**2+(.06-e[a])**2;n&&(o[a]=1/n)}return[o]}export{o as bandIndexMethodMap,a as calculateBandIndex,s as calculateNDVI,i as getBandMatrix3};
