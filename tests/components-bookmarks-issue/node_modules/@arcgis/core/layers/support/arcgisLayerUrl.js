/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{urlToObject as e,removeTrailingSlash as r,removeQueryParameters as t,join as s,Url as n,makeAbsolute as l}from"../../core/urlUtils.js";import{w as u}from"../../chunks/persistableUrlUtils.js";const i={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},o=Object.values(i),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),f=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function v(e){return!!c.test(e)}function p(r){if(null==r)return null;const t=e(r),s=t?.path.match(c)||t?.path.match(a);if(!s)return null;const[,n,l,u,o]=s,f=l.indexOf("/");return{title:m(-1!==f?l.slice(f+1):l),serverType:i[u.toLowerCase()],sublayer:null!=o&&""!==o?parseInt(o,10):null,url:{path:n}}}function d(r){const t=e(r).path.match(f);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function m(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function h(e,r){const t=[];if(e){const r=p(e);null!=r&&r.title&&t.push(r.title)}if(r){const e=m(r);t.push(e)}if(2===t.length){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")}function w(e){if(!e)return!1;const r=".arcgis.com/",t="//services",s="//tiles",n="//features",l=(e=e.toLowerCase()).includes(r),u=e.includes(t)||e.includes(s)||e.includes(n);return l&&u}function y(e,s){return e?r(t(e,s)):e}function g(s){let{url:n}=s;if(!n)return{url:n};n=t(n,s.logger);const l=e(n),u=p(l.path);let i;if(null!=u)null!=u.sublayer&&null==s.layer.layerId&&(i=u.sublayer),n=u.url.path;else if(s.nonStandardUrlAllowed){const e=d(l.path);null!=e&&(n=e.serviceUrl,i=e.sublayerId)}return{url:r(n),layerId:i}}function S(e,r,t,n,l){u(r,n,"url",l),n.url&&null!=e.layerId&&(n.url=s(n.url,t,e.layerId.toString()))}function C(e){if(!e)return!1;const r=e.toLowerCase(),t=r.includes("/services/"),s=r.includes("/mapserver/wmsserver"),n=r.includes("/imageserver/wmsserver"),l=r.includes("/wmsserver");return t&&(s||n||l)}function b(e){if(!e)return!1;const r=new n(l(e)),t=r.authority?.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}export{m as cleanTitle,v as isArcGISUrl,w as isHostedAgolService,b as isServerOrServicesAGOLUrl,C as isWmsServer,p as parse,d as parseNonStandardSublayerUrl,y as sanitizeUrl,g as sanitizeUrlWithLayerId,o as serverTypes,h as titleFromUrlAndName,S as writeUrlWithLayerId};
