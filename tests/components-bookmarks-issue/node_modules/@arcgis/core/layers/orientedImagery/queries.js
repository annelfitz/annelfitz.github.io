/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import"../../geometry.js";import{geographicToWebMercator as e}from"../../geometry/support/webMercatorUtils.js";import r from"../OrientedImageryLayer.js";import t from"./core/ExposurePoint.js";import a from"../../rest/support/Query.js";import o from"../../geometry/Extent.js";const n={},s=1e3;async function i(t,o){const{point:i,queryParams:l,queryFeatures:m}=t;if(null==i)return null;const y={};let f=t.layerInstanceOrURL;const p=i.spatialReference.isGeographic?e(i.clone()):i.clone();if(y.outSpatialReference=p.spatialReference,l&&(y.maxRecordCountFactor=l.maxRecordCountFactor??5,y.outFields=l.outFields??["*"],y.where=l.where??"1=1",y.returnGeometry=l.returnGeometry??!0,y.outSpatialReference=l.outSpatialReference),"string"==typeof f&&(n.layer&&n.layer.url===f?f=n.layer:(n.layer?.destroy(),f=n.layer=new r({url:f}),await f.load())),f){if(m&&"esri.layers.OrientedImageryLayer"===f?.declaredClass)return u(f)(m);const e=f,r=c(p,l?.maximumDistance??e.maximumDistance??s),t=new a({geometry:r,...y});return e.queryFeatures(t,o).then(u(e))}return null}function u(e){return r=>{const{features:a,spatialReference:o}=r;return a.forEach((r=>{r.geometry&&(r.geometry.spatialReference=o);const a=t.fromJSON({...r.toJSON(),layer:e});a&&(r.attributes=a),r.layer=e,r.spatialReference=o})),r}}function c(e,r){const t=e.x-r,a=e.x+r,n=e.y-r,s=e.y+r;return new o({xmin:t,xmax:a,ymin:n,ymax:s,spatialReference:e.spatialReference})}export{c as createExtentFromPointAtDistance,i as searchImages};
