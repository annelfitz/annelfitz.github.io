/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{deprecatedFunction as r}from"./deprecate.js";import t from"./Handles.js";import e from"./Logger.js";import{destroyMaybe as s}from"./maybe.js";import{beforeDestroySymbol as o}from"./accessorSupport/beforeDestroy.js";import{get as i}from"./accessorSupport/get.js";import{Lifecycle as c}from"./accessorSupport/interfaces.js";import{getPropertiesMetadata as n}from"./accessorSupport/metadata.js";import a from"./accessorSupport/Properties.js";import{set as l}from"./accessorSupport/set.js";import{getAccessorInterceptor as p}from"./accessorSupport/testSupport.js";import{removeTarget as _,watch as h}from"./accessorSupport/watch.js";import{property as u}from"./accessorSupport/decorators/property.js";import{subclass as d}from"./accessorSupport/decorators/subclass.js";var y,m;function f(r){if(null==r)return{value:r};if(Array.isArray(r))return{type:[r[0]],value:null};switch(typeof r){case"object":return r.constructor?.__accessorMetadata__||r instanceof Date?{type:r.constructor,value:r}:r;case"boolean":return{type:Boolean,value:r};case"string":return{type:String,value:r};case"number":return{type:Number,value:r};case"function":return{type:r,value:null};default:return}}const v=Symbol("Accessor-Handles"),g=Symbol("Accessor-Initialized");class S{static createSubclass(r={}){if(Array.isArray(r))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:e,constructor:s}=r;delete r.declaredClass,delete r.properties,delete r.constructor;const o=this;class i extends o{constructor(...r){super(...r),this.inherited=null,s&&s.apply(this,r)}}n(i.prototype);for(const c in r){const t=r[c];i.prototype[c]="function"==typeof t?function(...r){const e=this.inherited;let s;this.inherited=function(...r){if(o.prototype[c])return o.prototype[c].apply(this,r)};try{s=t.apply(this,r)}catch(i){throw this.inherited=e,i}return this.inherited=e,s}:r[c]}for(const c in t){const r=f(t[c]);u(r)(i.prototype,c)}return d(e)(i)}constructor(...r){if(this[y]=null,this[m]=!1,this.constructor===S)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const t=new a(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:t}),r.length>0&&this.normalizeCtorArgs&&(t.ctorArgs=this.normalizeCtorArgs.apply(this,r)),p()?.onInstanceConstruct(this)}postscript(r){const t=this.__accessor__,e=t.ctorArgs||r;t.initialize(),e&&(this.set(e),t.ctorArgs=null),t.constructed(),this.initialize(),this[g]=!0}initialize(){}[o](){this[v]=s(this[v])}destroy(){this.destroyed||(_(this),this.__accessor__.destroy(),p()?.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[g]}get destroyed(){return this.__accessor__?.lifecycle===c.DESTROYED||!1}commitProperty(r){i(this,r)}get(t){return r(e.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),i(this,t)}hasOwnProperty(r){return this.__accessor__?this.__accessor__.has(r):Object.prototype.hasOwnProperty.call(this,r)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(r,t){return l(this,r,t),this}watch(r,t,e){return h(this,r,t,e)}addHandles(r,e){if(this.destroyed){const t=Array.isArray(r)?r:[r];for(const r of t)r.remove();return}let s=this[v];null==s&&(s=this[v]=new t),s.add(r,e)}removeHandles(r){const t=this[v];null!=t&&t.remove(r)}removeAllHandles(){const r=this[v];null!=r&&r.removeAll()}hasHandles(r){const t=this[v];return null!=t&&t.has(r)}_override(r,t){void 0===t?this.__accessor__.clearOverride(r):this.__accessor__.override(r,t)}_clearOverride(r){return this.__accessor__.clearOverride(r)}_overrideIfSome(r,t){null==t?this.__accessor__.clearOverride(r):this.__accessor__.override(r,t)}_isOverridden(r){return this.__accessor__.isOverridden(r)}notifyChange(r){this.__accessor__.notifyChange(r)}_get(r){return this.__accessor__.internalGet(r)}_set(r,t){return this.__accessor__.internalSet(r,t),this}}y=v,m=g;export{S as default};
