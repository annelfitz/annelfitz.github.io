/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import t from"../../Color.js";import{getVisualVariableValues as e}from"../visualVariables/support/visualVariableUtils.js";function o(t,e){if(!t||t.symbol)return null;const o=e?.renderer;return t&&null!=o&&o.getObservationRenderer?o.getObservationRenderer(t):o}function r(t,e){if(null!=t.symbol)return t.symbol;const r=o(t,e);return null!=r&&"dot-density"!==r.type?r.getSymbol(t,e):null}function i(t,i){const n=o(t,i),l=r(t,i);if(null==l)return null;const a={renderer:n,symbol:l};if(null==n||!("visualVariables"in n)||!n.visualVariables)return a;const s=e(n,t,i)??[],u=["proportional","proportional","proportional"];for(const{variable:e,value:o}of s)switch(e.type){case"color":a.color=o.toRgba();break;case"size":if("outline"===e.target)a.outlineSize=o;else{const t=e.axis,r=e.useSymbolValue?"symbol-value":o;switch(t){case"width":u[0]=r;break;case"depth":u[1]=r;break;case"height":u[2]=r;break;case"width-and-depth":u[0]=u[1]=r;break;default:u[0]=u[1]=u[2]=r}}break;case"opacity":a.opacity=o;break;case"rotation":switch(e.axis){case"tilt":a.tilt=o;break;case"roll":a.roll=o;break;default:a.heading=o}}return"proportional"===u[0]&&"proportional"===u[1]&&"proportional"===u[2]||(a.size=u),a}async function n(t,e){if(null!=t.symbol)return t.symbol;const r=o(t,e);return null!=r?r.getSymbolAsync(t,e):null}async function l(r,i){const l=o(r,i),a=await n(r,i);if(!a)return null;const s={renderer:l,symbol:a};if(!l||!("visualVariables"in l)||!l.visualVariables)return s;const u=e(l,r,i)??[],c=["proportional","proportional","proportional"];for(const{variable:e,value:o}of u)if("color"===e.type)s.color=t.toUnitRGBA(o);else if("size"===e.type)if("outline"===e.target)s.outlineSize=o;else{const t=e.axis,r=e.useSymbolValue?"symbol-value":o;"width"===t?c[0]=r:"depth"===t?c[1]=r:"height"===t?c[2]=r:c[0]=c[1]="width-and-depth"===t?r:c[2]=r}else"opacity"===e.type?s.opacity=o:"rotation"===e.type&&"tilt"===e.axis?s.tilt=o:"rotation"===e.type&&"roll"===e.axis?s.roll=o:"rotation"===e.type&&(s.heading=o);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function a(t,e=0){const o=t[e];return"number"==typeof o&&isFinite(o)?o:null}function s(t){for(let e=0;e<3;e++){const o=t[e];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{a as getDriverAxisSizeValue,s as getDriverAxisSizeValueAny,o as getRenderer,i as getRenderingInfo,l as getRenderingInfoAsync,n as getSymbolAsync};
