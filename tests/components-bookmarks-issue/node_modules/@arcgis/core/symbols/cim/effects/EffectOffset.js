/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import"../../../geometry.js";import{GeometryCursor as t}from"../../../geometry/GeometryCursor.js";import{collectPath as e}from"../../../geometry/geometryCursorCollectUtils.js";import{isExtent as s}from"../../../geometry/support/jsonUtils.js";import{clipCursorToTileExtent as o}from"../CIMEffects.js";import{CurveHelper as r,pixelTolerance as i}from"../CurveHelper.js";import{GeometricEffectOffsetMethod as n}from"../enums.js";import m from"../../../geometry/SpatialReference.js";const f=10;class h{static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,s,o,r,i){return new l(t,e,s,o,r,i)}}h.instance=null;class l{constructor(t,e,s,o,n,m){this._inputGeometries=t,this._tileKey=o,this._geometryEngine=n,this._curveHelper=new r,this._offset=(e.offset??1)*s,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(m*s),f),this._option=e.option,this._offsetFlattenError=i*s}next(){let r;for(;r=this._inputGeometries.next();){if(0===this._offset)return r.clone();if("esriGeometryEnvelope"===r.geometryType){if(this._method===n.Rounded&&this._offset>0){const s=e(r),o=this._curveHelper.offset(s,-this._offset,this._method,4,this._offsetFlattenError);if(o){const e=t.createEmptyOptimizedCIM(r.geometryType);return e.pushPath(o),e}return null}const o=r.asJSON();if(s(o)&&Math.min(o.xmax-o.xmin,o.ymax-o.ymin)+2*this._offset>0)return t.fromJSONCIM({xmin:o.xmin-this._offset,xmax:o.xmax+this._offset,ymin:o.ymin-this._offset,ymax:o.ymax+this._offset})}const i=this._geometryEngine;if(null==i)continue;const f=this._tileKey?o(r,this._maxInflateSize):r.clone();if(!f)continue;const h=i.offset(m.WebMercator,f.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return h?t.fromJSONCIM(h):null}return null}}export{h as EffectOffset};
