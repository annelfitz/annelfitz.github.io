/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import"../../../geometry.js";import{GeometryCursor as e}from"../../../geometry/GeometryCursor.js";import{collectMultipath as t}from"../../../geometry/geometryCursorCollectUtils.js";import{clipCursorToTileExtent as i}from"../CIMEffects.js";import{CurveHelper as s,pixelTolerance as r}from"../CurveHelper.js";import{GeometricEffectOffsetMethod as n}from"../enums.js";import o from"../../../geometry/SpatialReference.js";class m{static local(){return null===m.instance&&(m.instance=new m),m.instance}execute(e,t,i,s,r,n){return new l(e,t,i,s,r,n)}}m.instance=null;class l{constructor(e,t,i,n,o,m){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=o,this._curveHelper=new s,this._size=(void 0!==t.size?t.size:1)*i,this._maxInflateSize=m*i,this._offsetFlattenError=r*i}next(){let s;for(;s=this._inputGeometries.next();){if(0===this._size)return s;if("esriGeometryEnvelope"===s.geometryType)if(this._size>0){const i=e.createEmptyOptimizedCIM(s.geometryType),r=t(s)[0],o=this._curveHelper.offset(r,this._size,n.Rounded,4,this._offsetFlattenError);if(o)return i.pushPath(o),i}else if(this._size<0){const t=s.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return e.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}const r=this._geometryEngine;if(null==r)return null;const m=this._tileKey?i(s,this._maxInflateSize):s;if(!m)continue;const l=r.buffer(o.WebMercator,m.asJSON(),this._size,1);return l?e.fromJSONCIM(l):null}return null}}export{m as EffectBuffer};
