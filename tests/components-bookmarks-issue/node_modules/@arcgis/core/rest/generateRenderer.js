/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import t from"../request.js";import{fromJSON as e}from"../renderers/support/jsonUtils.js";import{executeQuery as o}from"./query/executeQuery.js";import{parseUrl as r}from"./utils.js";import"../kernel.js";import"../core/urlUtils.js";import"./query/support/AttachmentInfo.js";import"./support/AttachmentQuery.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/Multipoint.js";import"../geometry/Point.js";import"../geometry/Polygon.js";import"../geometry/Polyline.js";import"../config.js";import"../core/Error.js";import"../core/Logger.js";import"../geometry/support/normalizeUtilsCommon.js";import"../geometry/support/spatialReferenceUtils.js";import"../core/RandomLCG.js";import"../core/has.js";import"../geometry/SpatialReference.js";import"../geometry/support/Ellipsoid.js";import"../geometry.js";import"../core/pbf.js";import"../core/unitUtils.js";import"../geometry/ellipsoidUtils.js";import i from"./support/Query.js";import"./support/FeatureSet.js";import"../geometry/support/aaBoundingBox.js";import"../core/mathUtils.js";import"./support/RelationshipQuery.js";import"./support/TopFeaturesQuery.js";import s from"./support/StatisticDefinition.js";async function n(e,o,i,s){const n=r(e),{source:a,checkValueRange:m}=o,{classificationDefinition:p}=i,u={...i.toJSON(),f:"json"};let c=null;if(c="class-breaks-definition"===p?.type?p.classificationField:p?.attributeField,a){const t={source:a?.toJSON()};u.layer=JSON.stringify(t)}u.classificationDef&&(u.classificationDef=JSON.stringify(u.classificationDef));let f={query:u};s&&(f={...s,...f});const j={url:n.path,field:c,checkValueRange:m},y=n.path+"/generateRenderer";return t(y,f).then((t=>l(j,t)))}function l(t,e){const{field:r,checkValueRange:n,url:l}=t,m=e?.data;if(!m)return;if(!n){const t=a(m);return Promise.resolve(t)}const p=new s({statisticType:"min",onStatisticField:r}),u=new s({statisticType:"max",onStatisticField:r}),c=new i({outStatistics:[p,u]});return o(l,c).then((t=>{const e=t.features[0].attributes;let o=null,r=null;for(const i in e)0===i.toLowerCase().indexOf("min")?o=e[i]:r=e[i];return a(m,o,r)}))}function a(t,o,r){if("classBreaks"===t.type){const i=e(t);return{classBreaks:i.classBreakInfos.map(((t,e)=>(0===e&&null!=o&&(t.minValue=o),e===i.classBreakInfos.length-1&&null!=r&&(t.maxValue=r),{minValue:t.minValue,maxValue:t.maxValue,label:t.label}))),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=t;return{uniqueValues:i?.map(((t,e)=>(0===e&&null!=o&&(t.value=o),e===i.length-1&&null!=r&&(t.value=r),{count:t.count,value:t.value,label:t.label})))??[]}}export{n as generateRenderer};
