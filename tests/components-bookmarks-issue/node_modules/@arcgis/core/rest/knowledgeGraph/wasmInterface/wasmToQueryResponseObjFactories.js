/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import t from"../Entity.js";import n from"../GraphObject.js";import r from"../ObjectValue.js";import o from"../Path.js";import s from"../Relationship.js";import{WasmGeometryTypeCodes as u}from"./KnowledgeWasmInterface.js";import{WasmGraphQueryResponseTypeCodes as a}from"./WasmQueryWrapperInterfaces.js";import{wasmToPolygonGeometry as i,wasmToPolylineGeometry as c,wasmToMultipointGeometry as l,wasmToPointGeometry as p}from"./wasmToGeometryFactories.js";const _=()=>e.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),d={decodedWasmObjToQueryResponseObj:(e,t,n)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case u.ESRI_GEOMETRY_POINT:return p(e,n);case u.ESRI_GEOMETRY_MULTIPOINT:return l(e,n);case u.ESRI_GEOMETRY_POLYLINE:return c(e,n);case u.ESRI_GEOMETRY_POLYGON:return i(e,n);case u.ESRI_GEOMETRY_ENVELOPE:case u.ESRI_GEOMETRY_MULTI_PATCH:return _().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case u.ESRI_GEOMETRY_NULL:case u.ESRI_GEOMETRY_ANY:default:return _().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return _().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case a.OBJECT:return g(e,t,n);case a.ENTITY:return f(e,t,n);case a.RELATIONSHIP:return j(e,t,n);case a.PATH:return R(e,t,n);case a.ARRAY:return m(e,t,n);default:return _().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function m(e,t,n){const r=[],o=e.count();for(let s=0;s<o;s++){const o=e.get_value_at(s);r.push(E(o,t,n))}return r}function E(e,t,n){return d.decodedWasmObjToQueryResponseObj(e,t,n)}function f(e,n,r){const o=e.type_name,s=O(e,n,r),u=e.get_id();return new t(Object.assign({typeName:o,id:u},s))}function y(e,t,r){return new n(O(e,t,r))}function O(e,t,n){const r={},o=e.key_count();for(let s=0;s<o;s++)r[e.get_key_at(s)]=E(e.get_value_at(s),t,n);return{properties:r}}function g(e,t,n){return new r(O(e,t,n))}function R(e,t,n){const r=e.entity_count(),s=e.relationship_count(),u=[];for(let o=0;o<r;o++)u.push(f(e.get_entity_at(o),t,n)),o<s&&u.push(j(e.get_relationship_at(o),t,n));return new o({path:u})}function j(e,t,n){const r=e.type_name,o=O(e,t,n);return new s(Object.assign({typeName:r,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},o))}export{d as decodeWasmObjectTest,E as decodedWasmObjToQueryResponseObj,m as wasmArrayToArray,f as wasmToEntity,y as wasmToGraphObject,g as wasmToObjectValue,R as wasmToPath,j as wasmToRelationship};
