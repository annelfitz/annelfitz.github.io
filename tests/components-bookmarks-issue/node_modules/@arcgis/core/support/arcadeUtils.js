/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import"../geometry.js";import{p as e,c as n,e as r,a as t,r as o,l as i,b as s,d as a,f as u,s as l,g as c}from"../chunks/arcade.js";export{h as arcade}from"../chunks/arcade.js";import f from"../arcade/Dictionary.js";import p from"../arcade/Feature.js";import{o as m,q as y,k as d,c as v,a as g,b as x,r as j,u as w,s as b}from"../chunks/languageUtils.js";import{clone as E}from"../core/lang.js";import{DateOnly as S}from"../core/sql/DateOnly.js";import{TimeOnly as F}from"../core/sql/TimeOnly.js";import $ from"../geometry/Point.js";import R from"../geometry/Polygon.js";import C from"../geometry/Polyline.js";import k from"../geometry/Multipoint.js";import z from"../geometry/Extent.js";const M=/^\$(feature|aggregatedFeatures)\./i,P={vars:{$feature:"any",$view:"any"},spatialReference:null};function A(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function q(e){return null==e?null:m(e)||y(e)?"array":d(e)?"date":v(e)?"text":g(e)?"boolean":x(e)?"number":e instanceof f?"dictionary":j(e)?"feature":e instanceof $?"point":e instanceof R?"polygon":e instanceof C?"polyline":e instanceof k?"multipoint":e instanceof z?"extent":e instanceof S?"dateOnly":e instanceof F?"time":w(e)?"featureSet":b(e)?"featureSetCollection":null}function I(n){if(!n)return null;try{return e(n)}catch(r){}return null}function O(e,r){const t="string"==typeof e?I(e):e;if(!t)return null;try{return r=r||E(P),n(t,r)}catch(o){}return null}function G(e,n,r){return{vars:{$feature:null==e?new p:p.createFromGraphic(e,r),$view:n?.view},spatialReference:n?.sr,timeZone:r??null}}function T(e,n,r){return p.createFromGraphicLikeObject(n,e,r,null)}function V(e,n){null!=e.vars&&(e.vars.$feature=n)}function D(e,n){let t;try{t=r(e,n)}catch(o){t=null}return t}function L(e,n){let r;try{r=e?e(n):null}catch(t){r=null}return r}function J(e,n){try{return e?e(n):Promise.resolve(null)}catch(r){return Promise.resolve(null)}}function U(e,n){if(!e)return[];const r="string"==typeof e?I(e):e;if(!r)return[];const o=t(r);let i=new Array;o.forEach((e=>{M.test(e)&&(e=e.replace(M,""),i.push(e))}));const s=i.filter((e=>e.includes("*")));return i=i.filter((e=>!s.includes(e))),n&&s.forEach((e=>{const r=new RegExp(`^${e.split(/\*+/).map(A).join(".*")}$`,"i");n.forEach((e=>r.test(e)?i.push(e):null))})),[...new Set(i.sort())]}function Z(e){return o(e,"$view")}function B(e,n){return!!e&&o(e,n)}function H(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new f({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}}function K({url:e,spatialReference:n,lrucache:r,interceptor:t}){const o=u();return o?o.createFeatureSetCollectionFromService(e,n,r,t):null}function N({layer:e,spatialReference:n,outFields:r,returnGeometry:t,lrucache:o,interceptor:i}){if(null===e)return null;const s=u();return s?s.constructFeatureSet(e,n,r,t??!0,o,i):null}function Q(e){if(null===e?.map)return null;const n=u();return n?n.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function W(e,n){return f.convertJsonToArcade(e,n)}function X(e,n,r=[]){return i(e,n,r)}function Y(){return s()}function _(){return a()}function ee(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type||"dot-density"===e.type||"dictionary"===e.type||"pie-chart"===e.type}function ne(e){return"esri.layers.support.LabelClass"===e.declaredClass}function re(e){return"esri.PopupTemplate"===e.declaredClass}function te(e,n){if(!e)return!1;if("string"==typeof e)return n(e);const r=e;if(ee(r)){if("dot-density"===r.type){const e=r.attributes?.some((e=>n(e.valueExpression)));if(e)return e}const e=r.visualVariables,t=!!e&&e.some((e=>{let r=n(e.valueExpression);return"size"===e.type&&(ue(e.minSize)&&(r=r||n(e.minSize.valueExpression)),ue(e.maxSize)&&(r=r||n(e.maxSize.valueExpression))),r}));return!(!("valueExpression"in r)||!n(r.valueExpression))||t}if(ne(r)){const e=r.labelExpressionInfo?.expression;return!(!e||!n(e))||!1}return!!re(r)&&(!!r.expressionInfos&&r.expressionInfos.some((e=>n(e.expression)))||Array.isArray(r.content)&&r.content.some((e=>"expression"===e.type&&n(e.expressionInfo?.expression))))}function oe(e){const n=I(e);return!!n&&l(n)}function ie(e){return te(e,oe)}function se(e){const n=I(e);return!!n&&c(n)}function ae(e){return te(e,se)}function ue(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}export{f as Dictionary,p as arcadeFeature,N as convertFeatureLayerToFeatureSet,W as convertJsonToArcade,Q as convertMapToFeatureSetCollection,K as convertServiceUrlToWorkspace,G as createExecContext,T as createFeature,O as createFunction,I as createSyntaxTree,Z as dependsOnView,_ as enableFeatureSetOperations,Y as enableGeometryOperations,D as evalSyntaxTree,J as executeAsyncFunction,L as executeFunction,U as extractFieldNames,q as getArcadeType,H as getViewInfo,ie as hasGeometryFunctions,ae as hasGeometryOperations,B as hasVariable,X as loadScriptDependencies,V as updateExecContext};
