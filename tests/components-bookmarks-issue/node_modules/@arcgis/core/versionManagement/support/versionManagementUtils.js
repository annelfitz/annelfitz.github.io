/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../request.js";import{generateLowercaseBracedUUID as r}from"../../core/uuid.js";const t=r(),n=new Map,o=new Map,s=new Map;async function a(r,t,o){if(!r||!o)return!1;if(!t)return!0;const s=new URL(r).host;let a=n.get(s);if(!a){const t=r.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");a=(await e(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return a===t}async function i(e,r,n=!1){if(!e||!r)return!0;const s=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),a=o.get(s)?.entries();if(a)for(const[o,i]of a)if(i.name===r){const e=!i.stack?.hasForwardEdits();if(!e&&n){const[{deleteForwardEdits:e},{default:r}]=await Promise.all([import("../../rest/versionManagement/gdbVersion/deleteForwardEdits.js"),import("../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js")]);return e(s,o,new r({sessionId:t,moment:i.moment}))}return e}return!0}function c(e,r){if(!e)return!1;const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=o.get(t)?.entries();if(n)for(const[o,s]of n)if(s.name===r){return"edit"===s.lockType}return!1}export{t as currentSessionId,n as defaultVersionNameLookup,a as isHistoricVersion,i as isSafeToEditVersion,c as isVersionInEditSession,o as versionCollection,s as versionCollectionCount};
