/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{deg2rad as e}from"../../core/mathUtils.js";import{create as r}from"../../core/libs/gl-matrix-2/factories/vec3f64.js";import{createEmptyProjectorCache as t,populateProjectorCache as o,copy3 as n,ProjectionID as s,projectionTable as i,wgs84ToWebMercator as c}from"./projectors.js";import{earth as l}from"../support/Ellipsoid.js";function a(e,r,t,a){if(null==r||null==a)return!1;const E=o(r,a,p);if(E.projector===n)return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],!0;if(null==E.projector)return!1;const{source:m,dest:R}=E;if(R.spatialReferenceId===s.WEB_MERCATOR){const r=i[m.spatialReferenceId][s.WGS84];return null!=r&&(r(e,0,f,0),c(f,0,t,0),t[3]=u(f[1],e[2],e[3],l.radius),!0)}if(m.spatialReferenceId!==s.WGS84&&m.spatialReferenceId!==s.CGCS2000||R.spatialReferenceId!==s.PLATE_CARREE){E.projector(e,0,t,0);const r=m.metersPerUnit??1,o=R.metersPerUnit??1;t[3]=e[3]*r/o}else{const r=i[m.spatialReferenceId][s.SPHERICAL_ECEF],o=i[s.SPHERICAL_ECEF][s.PLATE_CARREE];let n=e[3];null!=r&&null!=o&&(n=u(e[1],e[2],e[3],l.radius)),E.projector(e,0,t,0),t[3]=n}return!0}function u(e,r,t,o){const n=o+r;if(n<o/2||t>n)return Number.MAX_VALUE;const s=Math.abs(E*e)+Math.asin(t/n);return s>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(s)}const f=r(),p=t(),E=e(1);export{a as projectBoundingSphere};
