/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{rad2deg as n,clamp as l,deg2rad as C,asinClamped as e}from"../../core/mathUtils.js";import{getMetersPerUnitForSR as E}from"../../core/unitUtils.js";import{isSphericalECEF as t,WGS84ECEFSpatialReferenceLike as S,SphericalPCPFMarsLike as u,SphericalPCPFMoonLike as r}from"../ellipsoidUtils.js";import{moon as R,mars as a,earth as A}from"../support/Ellipsoid.js";import{earthEllipsoidConstants as P}from"../support/geodesicConstants.js";import{isWGS84 as _,isWebMercator as c,isPlateCarree as s,isMars as o,isMoon as M,equals as i}from"../support/spatialReferenceUtils.js";import{SupportedGCSWkids as O}from"../support/SupportedGCSWkids.js";var N;!function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",n[n.WGS84=2]="WGS84",n[n.WEB_MERCATOR=3]="WEB_MERCATOR",n[n.WGS84_ECEF=4]="WGS84_ECEF",n[n.CGCS2000=5]="CGCS2000",n[n.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",n[n.GCSMARS2000=7]="GCSMARS2000",n[n.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",n[n.GCSMOON2000=9]="GCSMOON2000",n[n.LON_LAT=10]="LON_LAT",n[n.PLATE_CARREE=11]="PLATE_CARREE"}(N||(N={}));const L={[N.WGS84]:{[N.CGCS2000]:null,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:f,[N.SPHERICAL_ECEF]:x,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:h,[N.PLATE_CARREE]:d,[N.WGS84]:f,[N.WGS84_ECEF]:X},[N.CGCS2000]:{[N.CGCS2000]:f,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:f,[N.SPHERICAL_ECEF]:x,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:d,[N.WGS84]:f,[N.WGS84_ECEF]:X},[N.GCSMARS2000]:{[N.CGCS2000]:null,[N.GCSMARS2000]:f,[N.GCSMOON2000]:null,[N.LON_LAT]:f,[N.SPHERICAL_ECEF]:null,[N.SPHERICAL_MARS_PCPF]:k,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:null,[N.WGS84]:null,[N.WGS84_ECEF]:null},[N.GCSMOON2000]:{[N.CGCS2000]:null,[N.GCSMARS2000]:null,[N.GCSMOON2000]:f,[N.LON_LAT]:f,[N.SPHERICAL_ECEF]:null,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:b,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:null,[N.WGS84]:null,[N.WGS84_ECEF]:null},[N.WEB_MERCATOR]:{[N.CGCS2000]:null,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:I,[N.SPHERICAL_ECEF]:T,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:f,[N.PLATE_CARREE]:K,[N.WGS84]:I,[N.WGS84_ECEF]:p},[N.WGS84_ECEF]:{[N.CGCS2000]:Y,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:Y,[N.SPHERICAL_ECEF]:Z,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:$,[N.PLATE_CARREE]:m,[N.WGS84]:Y,[N.WGS84_ECEF]:f},[N.SPHERICAL_ECEF]:{[N.CGCS2000]:D,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:D,[N.SPHERICAL_ECEF]:f,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:J,[N.PLATE_CARREE]:w,[N.WGS84]:D,[N.WGS84_ECEF]:Q},[N.SPHERICAL_MARS_PCPF]:{[N.CGCS2000]:null,[N.GCSMARS2000]:z,[N.GCSMOON2000]:null,[N.LON_LAT]:z,[N.SPHERICAL_ECEF]:null,[N.SPHERICAL_MARS_PCPF]:f,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:null,[N.WGS84]:null,[N.WGS84_ECEF]:null},[N.SPHERICAL_MOON_PCPF]:{[N.CGCS2000]:null,[N.GCSMARS2000]:null,[N.GCSMOON2000]:v,[N.LON_LAT]:v,[N.SPHERICAL_ECEF]:null,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:f,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:null,[N.WGS84]:null,[N.WGS84_ECEF]:null},[N.UNKNOWN]:{[N.CGCS2000]:null,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:null,[N.SPHERICAL_ECEF]:null,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:f,[N.WEB_MERCATOR]:null,[N.PLATE_CARREE]:null,[N.WGS84]:null,[N.WGS84_ECEF]:null},[N.LON_LAT]:{[N.CGCS2000]:f,[N.GCSMARS2000]:f,[N.GCSMOON2000]:f,[N.LON_LAT]:f,[N.SPHERICAL_ECEF]:x,[N.SPHERICAL_MARS_PCPF]:k,[N.SPHERICAL_MOON_PCPF]:b,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:h,[N.PLATE_CARREE]:d,[N.WGS84]:f,[N.WGS84_ECEF]:X},[N.PLATE_CARREE]:{[N.CGCS2000]:U,[N.GCSMARS2000]:null,[N.GCSMOON2000]:null,[N.LON_LAT]:U,[N.SPHERICAL_ECEF]:B,[N.SPHERICAL_MARS_PCPF]:null,[N.SPHERICAL_MOON_PCPF]:null,[N.UNKNOWN]:null,[N.WEB_MERCATOR]:j,[N.PLATE_CARREE]:f,[N.WGS84]:U,[N.WGS84_ECEF]:q}};function G(n,l,C=ln()){return null==n||null==l?null:nn(n,l,C).projector}function W(n,l){switch(G(n,l,En)){case f:return"copy3";case x:return"wgs84ToSphericalECEF";case h:return"wgs84ToWebMercator";case d:return"wgs84ToPlateCarree";case X:return"wgs84ToWGS84ECEF";case I:return"webMercatorToWGS84";case T:return"webMercatorToSphericalECEF";case p:return"webMercatorToWGS84ECEF";case K:return"webMercatorToPlateCarree";case Y:return"wgs84ECEFToWGS84";case Z:return"wgs84ECEFToSphericalECEF";case $:return"wgs84ECEFToWebMercator";case D:return"sphericalECEFToWGS84";case J:return"sphericalECEFToWebMercator";case z:return"sphericalMarsPCPFToMars2000";case v:return"sphericalMoonPCPFToMoon2000";case Q:return"sphericalECEFToWGS84ECEF";case k:return"mars2000ToSphericalPCPF";case b:return"moon2000ToSphericalPCPF";default:return null}}function F(n,l){return n?l.spatialReference===n?l.spatialReferenceId:(l.spatialReference=n,"metersPerUnit"in l&&(l.metersPerUnit=E(n,1)),t(n)?l.spatialReferenceId=N.SPHERICAL_ECEF:_(n)?l.spatialReferenceId=N.WGS84:c(n)?l.spatialReferenceId=N.WEB_MERCATOR:s(n)?l.spatialReferenceId=N.PLATE_CARREE:n.wkt===S.wkt?l.spatialReferenceId=N.WGS84_ECEF:n.wkid===O.CGCS2000?l.spatialReferenceId=N.CGCS2000:n.wkt===u.wkt?l.spatialReferenceId=N.SPHERICAL_MARS_PCPF:n.wkt===r.wkt?l.spatialReferenceId=N.SPHERICAL_MOON_PCPF:o(n)?l.spatialReferenceId=N.GCSMARS2000:M(n)?l.spatialReferenceId=N.GCSMOON2000:l.spatialReferenceId=N.UNKNOWN):N.UNKNOWN}function f(n,l,C,e){n!==C&&(C[e++]=n[l++],C[e++]=n[l++],C[e]=n[l])}function I(n,l,C,e){C[e]=Sn*(n[l]/Rn),C[e+1]=Sn*(rn-2*Math.atan(Math.exp(-n[l+1]/Rn))),C[e+2]=n[l+2]}function T(n,l,C,e){const E=n[l]/Rn,t=rn-2*Math.atan(Math.exp(-n[l+1]/Rn)),S=Rn+n[l+2],u=Math.cos(t)*S;C[e]=Math.cos(E)*u,C[e+1]=Math.sin(E)*u,C[e+2]=Math.sin(t)*S}function p(n,l,C,e){I(n,l,C,e),X(C,e,C,e)}function H(n,C,e,E,t){const S=.4999999*un,u=l(tn*n[C+1],-S,S),r=Math.sin(u);e[E++]=tn*n[C]*t.radius,e[E++]=t.halfSemiMajorAxis*Math.log((1+r)/(1-r)),e[E]=n[C+2]}function h(n,l,C,e){H(n,l,C,e,A)}function d(n,l,C,e){C[e]=n[l]*an,C[e+1]=n[l+1]*an,C[e+2]=n[l+2]}function U(n,l,C,e){C[e]=n[l]*An,C[e+1]=n[l+1]*An,C[e+2]=n[l+2]}function K(n,l,C,e){I(n,l,C,e),d(C,e,C,e)}function m(n,l,C,e){Y(n,l,C,e),d(C,e,C,e)}function w(n,l,C,e){D(n,l,C,e),d(C,e,C,e)}function B(n,l,C,e){U(n,l,C,e),x(C,e,C,e)}function j(n,l,C,e){U(n,l,C,e),h(C,e,C,e)}function q(n,l,C,e){U(n,l,C,e),X(C,e,C,e)}function g(n,l,C,e,E){const t=E+n[l+2],S=tn*n[l+1],u=tn*n[l],r=Math.cos(S)*t;C[e]=Math.cos(u)*r,C[e+1]=Math.sin(u)*r,C[e+2]=Math.sin(S)*t}function b(n,l,C,e){g(n,l,C,e,R.radius)}function k(n,l,C,e){g(n,l,C,e,a.radius)}function x(n,l,C,e){g(n,l,C,e,A.radius)}function y(n,l,C,E,t){const S=n[l],u=n[l+1],r=n[l+2],R=Math.sqrt(S*S+u*u+r*r),a=e(r/(0===R?1:R)),A=Math.atan2(u,S);C[E++]=Sn*A,C[E++]=Sn*a,C[E]=R-t}function v(n,l,C,e){y(n,l,C,e,R.radius)}function z(n,l,C,e){y(n,l,C,e,a.radius)}function D(n,l,C,e){y(n,l,C,e,A.radius)}function J(n,l,C,e){D(n,l,C,e),h(C,e,C,e)}function Q(n,l,C,e){D(n,l,C,e),X(C,e,C,e)}function V(n,l,C,e,E){const t=tn*n[l],S=tn*n[l+1],u=n[l+2],r=Math.sin(S),R=Math.cos(S),a=E.radius/Math.sqrt(1-E.eccentricitySquared*r*r);C[e++]=(a+u)*R*Math.cos(t),C[e++]=(a+u)*R*Math.sin(t),C[e++]=(a*(1-E.eccentricitySquared)+u)*r}function X(n,l,C,e){V(n,l,C,e,A)}function Y(n,l,C,e){const E=P,t=n[l],S=n[l+1],u=n[l+2];let r,R,a,_,c,s,o,M,i,O,N,L,G,W,F,f,I,T,p,H,h;r=Math.abs(u),R=t*t+S*S,a=Math.sqrt(R),_=R+u*u,c=Math.sqrt(_),H=Math.atan2(S,t),s=u*u/_,o=R/_,W=E.a2/c,F=E.a3-E.a4/c,o>.3?(M=r/c*(1+o*(E.a1+W+s*F)/c),p=Math.asin(M),O=M*M,i=Math.sqrt(1-O)):(i=a/c*(1-s*(E.a5-W-o*F)/c),p=Math.acos(i),O=1-i*i,M=Math.sqrt(O)),N=1-A.eccentricitySquared*O,L=A.radius/Math.sqrt(N),G=E.a6*L,W=a-L*i,F=r-G*M,I=i*W+M*F,f=i*F-M*W,T=f/(G/N+I),p+=T,h=I+f*T/2,u<0&&(p=-p),C[e++]=Sn*H,C[e++]=Sn*p,C[e]=h}function Z(n,l,C,e){Y(n,l,C,e),x(C,e,C,e)}function $(n,l,C,e){Y(n,l,C,e),h(C,e,C,e)}function nn(n,l,C){if(null==n||null==l||C.source.spatialReference===n&&C.dest.spatialReference===l)return C;const e=F(n,C.source),E=F(l,C.dest);return e===N.UNKNOWN&&E===N.UNKNOWN?i(n,l)?C.projector=f:C.projector=null:C.projector=L[e][E],C}function ln(){return{source:{spatialReference:null,spatialReferenceId:N.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:N.UNKNOWN,metersPerUnit:1},projector:f}}const Cn={spatialReference:null,spatialReferenceId:N.UNKNOWN},en={spatialReference:null,spatialReferenceId:N.UNKNOWN},En=ln(),tn=C(1),Sn=n(1),un=Math.PI,rn=.5*un,Rn=A.radius,an=Rn*un/180,An=180/(Rn*un);export{N as ProjectionID,F as classifySpatialReference,f as copy3,ln as createEmptyProjectorCache,en as destClassificationCache,G as getProjector,W as getProjectorName,An as invPlateCarreeScale,H as lonLatToWebMercatorComparable,nn as populateProjectorCache,L as projectionTable,En as projectorCache,Cn as sourceClassificationCache,y as sphericalPCPFtoLonLatElevation,h as wgs84ToWebMercator};
