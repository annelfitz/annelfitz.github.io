/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import r from"../../../core/Logger.js";import{normalFromMat4 as e,isOrthoNormal as t,fromMat4 as o,transpose as n}from"../../../core/libs/gl-matrix-2/math/mat3.js";import{create as f}from"../../../core/libs/gl-matrix-2/factories/mat3f64.js";import{create as i}from"../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{t as a,n as c}from"../../../chunks/vec32.js";import{create as m}from"../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{getSphericalPCPF as s}from"../../spatialReferenceEllipsoidUtils.js";import{computeTranslationToOriginAndRotation as p}from"../../projection/computeTranslationToOriginAndRotation.js";import{projectBuffer as l}from"../../projection/projectBuffer.js";import{isCGCS2000 as u,isMars as y,isMoon as P}from"../spatialReferenceUtils.js";import{y2lat as T}from"../webMercatorUtils.js";import{BufferViewVec3f as F,BufferViewVec3f64 as g}from"../buffer/BufferView.js";import{b as A,n as C}from"../../../chunks/vec3.js";const d=()=>r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,t,o,n){return V(o)?(v(L.TO_PCPF,F.fromTypedArray(r),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n)),n):(d().error("Cannot convert spatial reference to PCPF"),n)}function _(r,e,t,o,n){return V(o)?(v(L.FROM_PCPF,F.fromTypedArray(r),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n)),n):(d().error("Cannot convert to spatial reference from PCPF"),n)}function O(r,e,t){return l(r,e,0,t,s(e),0,r.length/3),t}function E(r,e,t){return l(r,s(t),0,e,t,0,r.length/3),e}function M(r,o,n){return e(w,n),A(o,r,w),t(w)||C(o,o),o}function R(r,o,n){if(e(w,n),A(o,r,w,4),t(w)||C(o,o,4),r!==o)for(let e=3;e<r.length;e+=4)o[e]=r[e];return o}function h(r,e,t,o,n){if(!V(o))return d().error("Cannot convert spatial reference to PCPF"),n;v(L.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function b(r,e,t,o,n){if(!V(o))return d().error("Cannot convert to spatial reference from PCPF"),n;v(L.FROM_PCPF,F.fromTypedArray(r,16),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n,16));for(let f=3;f<r.length;f+=4)n[f]=r[f];return n}function v(r,e,t,f,i,m){if(!e)return;const l=t.count,u=s(i);if(x(i))for(let c=0;c<l;c++)f.getVec(c,U),e.getVec(c,S),p(u,U,k,u),o(w,k),r===L.FROM_PCPF&&n(w,w),a(S,S,w),m.setVec(c,S);else for(let s=0;s<l;s++){f.getVec(s,U),e.getVec(s,S),p(u,U,k,u),o(w,k);const i=T(t.get(s,1));let l=Math.cos(i);r===L.TO_PCPF&&(l=1/l),w[0]*=l,w[1]*=l,w[2]*=l,w[3]*=l,w[4]*=l,w[5]*=l,r===L.FROM_PCPF&&n(w,w),a(S,S,w),c(S,S),m.setVec(s,S)}return m}function V(r){return x(r)||B(r)}function x(r){return r.isWGS84||u(r)||y(r)||P(r)}function B(r){return r.isWebMercator}var L;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(L||(L={}));const U=m(),S=m(),k=i(),w=f();export{E as projectFromPCPF,_ as projectNormalFromPCPF,j as projectNormalToPCPF,b as projectTangentFromPCPF,h as projectTangentToPCPF,O as projectToPCPF,M as transformNormal,R as transformTangent};
