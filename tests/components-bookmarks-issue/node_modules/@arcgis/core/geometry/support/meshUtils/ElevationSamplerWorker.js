/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import has from"../../../core/has.js";import{PooledRBush as t}from"../../../core/libs/rbush/PooledRBush.js";import{isRelativeVertexSpace as e}from"../meshVertexSpaceUtils.js";import{georeferenceApplyTransform as n}from"./georeference.js";class r{async createIndex(e,n){const r=new Array;if(!e.vertexAttributes?.position)return new t;const o=i(e),s=null!=n?await n.invoke("createIndexThread",o,{transferList:r}):this.createIndexThread(o).result;return a().fromJSON(s)}createIndexThread(t){const e=new Float64Array(t.position),n=a();return t.components?s(n,e,t.components.map((t=>new Uint32Array(t)))):o(n,e)}}function o(t,e){const n=new Array(e.length/9);let r=0;for(let o=0;o<e.length;o+=9)n[r++]=c(e,o,o+3,o+6);return t.load(n),{result:t.toJSON()}}function s(t,e,n){let r=0;for(const i of n)r+=i.length/3;const o=new Array(r);let s=0;for(const i of n)for(let t=0;t<i.length;t+=3)o[s++]=c(e,3*i[t],3*i[t+1],3*i[t+2]);return t.load(o),{result:t.toJSON()}}function i(t){const r=(e(t.vertexSpace)?n({position:t.vertexAttributes.position,normal:null,tangent:null},t.vertexSpace,t.transform,t.spatialReference).position:t.vertexAttributes.position).buffer;return!t.components||t.components.some((t=>!t.faces))?{position:r}:{position:r,components:t.components.map((t=>t.faces))}}function a(){return new t(9,has("esri-csp-restrictions")?t=>t:[".minX",".minY",".maxX",".maxY"])}function c(t,e,n,r){return{minX:Math.min(t[e],t[n],t[r]),maxX:Math.max(t[e],t[n],t[r]),minY:Math.min(t[e+1],t[n+1],t[r+1]),maxY:Math.max(t[e+1],t[n+1],t[r+1]),p0:[t[e],t[e+1],t[e+2]],p1:[t[n],t[n+1],t[n+2]],p2:[t[r],t[r+1],t[r+2]]}}export{r as default};
