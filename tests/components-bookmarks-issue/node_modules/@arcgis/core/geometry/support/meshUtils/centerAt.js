/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{f as t,g as r}from"../../../chunks/vec32.js";import{create as i}from"../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{projectPointToVector as o}from"../../projection/projectPointToVector.js";import{isRelativeVertexSpace as n}from"../meshVertexSpaceUtils.js";import{usesLocalTangentPlaneOnECEFForOperations as s}from"./geographicUtils.js";import{ungeoreferenceGlobal as a,georeferenceGlobal as c}from"./georeference.js";const p="esri.geometry.support.meshUtils.centerAt";function l(e,t,r){if(!e.vertexAttributes?.position)return;const{vertexSpace:i}=e,o=r?.origin??e.anchor,a=r?.geographic,c=s(p,i,o.spatialReference,a);n(i)?f(e,t,o):c?g(e,t,o):d(e,t,o)}function f(s,a,c){const{vertexSpace:l}=s;if(!n(l))return;const f=u,g=j;if(!o(a,g,s.spatialReference))return void e.getLogger(p).error(`Failed to project centerAt location (wkid:${a.spatialReference.wkid}) to mesh spatial reference (wkid:${s.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!o(c,f,s.spatialReference)){const t=s.origin;f[0]=t.x,f[1]=t.y,f[2]=t.z,e.getLogger(p).error(`Failed to project specified origin (wkid:${c.spatialReference.wkid}) to mesh spatial reference (wkid:${s.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const d=t(b,g,f);l.origin=r(i(),l.origin,d)}function g(e,t,r){const i=a(e.vertexAttributes,r),{position:o,normal:n,tangent:s}=c(i,t,!1);e.vertexAttributes.position=o,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=s,e.vertexAttributesChanged()}function d(t,r,i){const n=u,s=j;if(o(r,s,t.spatialReference)){if(!o(i,n,t.spatialReference)){const r=t.origin;n[0]=r.x,n[1]=r.y,n[2]=r.z,e.getLogger(p).error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}m(t.vertexAttributes.position,s,n),t.vertexAttributesChanged()}else e.getLogger(p).error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function m(e,t,r){if(e)for(let i=0;i<e.length;i+=3)for(let o=0;o<3;o++)e[i+o]+=t[o]-r[o]}const j=i(),u=i(),b=i();export{l as centerAt};
