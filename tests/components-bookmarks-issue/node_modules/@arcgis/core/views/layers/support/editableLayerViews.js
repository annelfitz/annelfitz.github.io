/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{equals as t,isGeographic as r,isWebMercator as i,isWGS84 as o}from"../../../geometry/support/spatialReferenceUtils.js";import{getMimeTypeFormatId as s,getFilenameFormatId as n}from"../../../layers/support/infoFor3D.js";import{ViewingMode as a}from"../../ViewingMode.js";const d="esri.views.layers.support.editableLayerViews";function c(c,l){const{associatedLayer:g}=c,p=g?.infoFor3D;if(!!!p)return!1;const{supportedFormats:u,queryFormats:f}=p,w=s("model/gltf-binary",u)??n("glb",u);if(!(null!=w&&f.includes(w)))return e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits because it does not support GLB queries.`),!1;const y=c.spatialReference,m=g.spatialReference;if(!t(y,m))return e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits because its spatial reference (wkid:${y.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${m.wkid}).`),!1;const $=g.sourceJSON.sourceSpatialReference;if(!(null==$||t($,m)))return e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${m.wkid}) is different from its source spatial reference (wkid:${$.wkid}).`),!1;const{view:L}=l;if(l.destroyed||null==L)return!1;const k=L.spatialReference,{viewingMode:b}=L.state,v=r(y),h=b===a.Global;if(v&&!h)return e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${y.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1;if(!v&&h)return e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${y.wkid}) is projected. Please consider changing the viewing mode to local.`),!1;return!!(t(y,k)||h&&i(k)&&o(y))||(e.getLogger(d).warnOnce(`SceneLayer (${c.title??"Untitled layer"}, ${c.id}) does not support geometry edits because its spatial reference (wkid:${y.wkid}) does not match the view spatial reference (wkid:${k.wkid}).`),!1)}export{c as isGeometryEditableSceneLayer};
