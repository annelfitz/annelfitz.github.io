/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{lerp as e,distance as t}from"../../../core/libs/gl-matrix-2/math/vec2.js";import{create as i}from"../../../core/libs/gl-matrix-2/factories/vec2f64.js";import{absoluteHeightElevationInfo as r}from"../../../support/elevationInfoUtils.js";import{fromAnyMapPoint as o,asVec2 as s,fromValues as n}from"../sketch/normalizedPoint.js";import{SnappingAlgorithm as p}from"./SnappingAlgorithm.js";import{squaredScreenDistance as a}from"./snappingUtils.js";import{RightAngleTriangleSnappingCandidate as d}from"./candidates/RightAngleTriangleSnappingCandidate.js";import{vectorToScreenPoint as l}from"../support/viewUtils.js";import{projectPointToCircle as m}from"../../support/geometry2dUtils.js";class c extends p{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],s=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return r;const{view:n}=this,p=i.vertices[0],a=i.vertices[s-1],d=o(p.pos,n,t),l=o(a.pos,n,t);return this._processCandidateProposal(d,l,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===r.index||r.index===s.vertices.length-1))return i;const{view:n}=this,p=o(r.leftEdge.leftVertex.pos,n,t),a=o(r.rightEdge.rightVertex.pos,n,t);return this._processCandidateProposal(p,a,e,t,i),i}_processCandidateProposal(i,o,p,c,f){if(!this.exceedsShortLineThreshold(i,o,c))return;const g=e(h,s(i),s(o),.5),v=.5*t(s(i),s(o)),x=m(h,s(p),g,v),u=n(x[0],x[1],p[2]),{spatialReference:j,pointer:y}=c,w=l(p,j,r,this.view);if(a(w,l(u,j,r,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(i,u,c)||this.isVertical(u,o,c))return;f.push(new d({targetPoint:u,point1:i,point2:o,isDraped:"on-the-ground"===c.elevationInfo?.mode}))}}}const h=i();export{c as RightAngleTriangleSnapper};
