/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{lerp as t}from"../../../../core/mathUtils.js";import{transpose as i}from"../../../../core/libs/gl-matrix-2/math/mat3.js";import{create as e}from"../../../../core/libs/gl-matrix-2/factories/mat3f64.js";import{l as s,q as o,m as a,c as h,f as n,t as c,h as r,b as m,k as p,g as l,n as d}from"../../../../chunks/vec32.js";import{create as M,clone as y,UNIT_Z as g,UNIT_Y as w,UNIT_X as u}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{ViewingMode as f}from"../../../ViewingMode.js";import{angle as P,slerp as A}from"../../support/mathUtils.js";class _{constructor(t){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.direction=y(F),this.fov=55,this.size=1}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===f.Global){const e=(s(this.center)+s(t.center))/2;i.pan=P(this.center,t.center)*e}else i.pan=o(this.center,t.center);let e=Math.abs(t.yaw-this.yaw);e>=Math.PI&&(e=2*Math.PI-e);const a=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(e,a),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(i,e,s){this.viewingMode===f.Global?A(i.center,e.center,s.pan,this.center):a(this.center,i.center,e.center,s.pan),this.distance=isFinite(e.distance)?t(i.distance,e.distance,s.zoom):i.distance,this.pitch=t(i.pitch,e.pitch,s.rotate);let o=i.yaw;const h=e.yaw;Math.abs(h-o)>=Math.PI&&(o+=2*(o<h?1:-1)*Math.PI),this.yaw=t(o,h,s.rotate)}copyFrom(t){h(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,h(this.direction,t.direction),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,Z);h(this.center,t.center),n(j,t.center,t.eye),c(j,j,i),c(k,t.up,i),this.distance=s(j),0!==this.distance&&(j[0]/=this.distance,j[1]/=this.distance,j[2]/=this.distance),this.pitch=this._eyeUpToPitch(j),this.yaw=x(j,k),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,Z);i(e,e),this._axisAngleVec3(V,this.pitch-Math.PI/2,F,j),this._axisAngleVec3(T,this.yaw,j,j),this._axisAngleVec3(V,this.pitch-Math.PI/2,T,k),this._axisAngleVec3(T,this.yaw,k,k),r(j,j,this.distance),c(j,j,e),c(k,k,e),t.center=this.center,t.eye=n(j,this.center,j),t.up=k}_axisAngleVec3(t,i,e,s){const o=Math.cos(i),a=Math.sin(i);return r(v,e,o),m(z,t,e),r(z,z,a),r(b,t,(1-o)*p(t,e)),l(s,l(s,v,z),b)}_lookAtOrientation(t,i=e()){return this._upAtLookAt(t,b),m(v,this.direction,b),d(v,v),0===v[0]&&0===v[1]&&0===v[2]&&h(v,V),m(z,b,v),d(z,z),i[0]=v[0],i[1]=z[0],i[2]=b[0],i[3]=v[1],i[4]=z[1],i[5]=b[1],i[6]=v[2],i[7]=z[2],i[8]=b[2],i}_upAtLookAt(t,i){return this.viewingMode===f.Local?h(i,T):d(i,t)}_eyeUpToPitch(t){return Math.PI-P(T,t)}}function x(t,i){const e=I;return Math.abs(i[2])<.5?(h(e,i),t[2]>0&&r(e,e,-1)):h(e,t),m(z,e,T),d(z,z),P(V,z,T)}const v=M(),z=M(),b=M(),j=M(),k=M(),I=M(),T=g,F=w,V=u,Z=e();export{_ as Camera};
