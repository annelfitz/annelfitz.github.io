/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{create as t}from"../../../../core/libs/gl-matrix-2/factories/vec2f64.js";import{f as n,b as e,n as o,h as s,g as r,k as l,s as h,c as u,e as c}from"../../../../chunks/vec32.js";import{fromValues as a,create as f,clone as p}from"../../../../core/libs/gl-matrix-2/factories/vec3f32.js";import{clone as i,create as g,fromValues as w}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{newDoubleArray as m}from"../../../../geometry/support/DoubleArray.js";import{newFloatArray as O,floatArrayFrom as M}from"../../../../geometry/support/FloatArray.js";import{getZeroIndexArray as A,getContinuousIndexArray as I}from"../../../../geometry/support/Indices.js";import{create as y,fromPositionAndNormal as N,intersectRay as P}from"../../../../geometry/support/plane.js";import{wrap as T}from"../../../../geometry/support/ray.js";import{Attribute as S}from"./Attribute.js";import{Vec3Compact as b}from"./BufferVectorMath.js";import{ContentObjectType as R}from"./ContentObjectType.js";import{Geometry as L}from"./Geometry.js";import{assert as j}from"./Util.js";import{VertexAttribute as d}from"./VertexAttribute.js";const E=b,x=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],U=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],V=[0,0,1,0,1,1,0,1],v=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],F=new Array(36);for(let Nt=0;Nt<6;Nt++)for(let t=0;t<6;t++)F[6*Nt+t]=Nt;const C=new Array(36);for(let Nt=0;Nt<6;Nt++)C[6*Nt]=0,C[6*Nt+1]=1,C[6*Nt+2]=2,C[6*Nt+3]=2,C[6*Nt+4]=3,C[6*Nt+5]=0;function G(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(24);for(let o=0;o<8;o++)e[3*o]=x[o][0]*n[0],e[3*o+1]=x[o][1]*n[1],e[3*o+2]=x[o][2]*n[2];return new L(t,[[d.POSITION,new S(e,v,3,!0)],[d.NORMAL,new S(U,F,3)],[d.UV0,new S(V,C,2)]])}const D=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],k=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],q=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],B=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function z(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(18);for(let o=0;o<6;o++)e[3*o]=D[o][0]*n[0],e[3*o+1]=D[o][1]*n[1],e[3*o+2]=D[o][2]*n[2];return new L(t,[[d.POSITION,new S(e,q,3,!0)],[d.NORMAL,new S(k,B,3)]])}const Z=a(-.5,0,-.5),H=a(.5,0,-.5),J=a(0,0,.5),K=a(0,.5,0),Q=f(),W=f(),X=f(),Y=f(),$=f();n(Q,Z,K),n(W,Z,H),e(X,Q,W),o(X,X),n(Q,H,K),n(W,H,J),e(Y,Q,W),o(Y,Y),n(Q,J,K),n(W,J,Z),e($,Q,W),o($,$);const _=[Z,H,J,K],tt=[0,-1,0,X[0],X[1],X[2],Y[0],Y[1],Y[2],$[0],$[1],$[2]],nt=[0,1,2,3,1,0,3,2,1,3,0,2],et=[0,0,0,1,1,1,2,2,2,3,3,3];function ot(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(12);for(let o=0;o<4;o++)e[3*o]=_[o][0]*n[0],e[3*o+1]=_[o][1]*n[1],e[3*o+2]=_[o][2]*n[2];return new L(t,[[d.POSITION,new S(e,nt,3,!0)],[d.NORMAL,new S(tt,et,3)]])}function st(t,n,e,o,s={uv:!0}){const r=-Math.PI,l=2*Math.PI,h=-Math.PI/2,u=Math.PI,c=Math.max(3,Math.floor(e)),a=Math.max(2,Math.floor(o)),f=(c+1)*(a+1),p=O(3*f),i=O(3*f),g=O(2*f),w=[];let m=0;for(let O=0;O<=a;O++){const t=[],e=O/a,o=h+e*u,s=Math.cos(o);for(let h=0;h<=c;h++){const u=h/c,a=r+u*l,f=Math.cos(a)*s,w=Math.sin(o),O=-Math.sin(a)*s;p[3*m]=f*n,p[3*m+1]=w*n,p[3*m+2]=O*n,i[3*m]=f,i[3*m+1]=w,i[3*m+2]=O,g[2*m]=u,g[2*m+1]=e,t.push(m),++m}w.push(t)}const M=new Array;for(let O=0;O<a;O++)for(let t=0;t<c;t++){const n=w[O][t],e=w[O][t+1],o=w[O+1][t+1],s=w[O+1][t];0===O?(M.push(n),M.push(o),M.push(s)):O===a-1?(M.push(n),M.push(e),M.push(o)):(M.push(n),M.push(e),M.push(o),M.push(o),M.push(s),M.push(n))}const I=[[d.POSITION,new S(p,M,3,!0)],[d.NORMAL,new S(i,M,3,!0)]];return s.uv&&I.push([d.UV0,new S(g,M,2,!0)]),s.offset&&(I[0][0]=d.OFFSET,I.push([d.POSITION,new S(Float64Array.from(s.offset),A(M.length),3,!0)])),new L(t,I)}function rt(t,n,e,o){const s=lt(n,e,o);return new L(t,s)}function lt(t,n,e){const o=t;let s,r;if(e)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const t=o*(1+Math.sqrt(5))/2;s=[-o,t,0,o,t,0,-o,-t,0,o,-t,0,0,-o,t,0,o,t,0,-o,-t,0,o,-t,t,0,-o,t,0,o,-t,0,-o,-t,0,o],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)E.scale(s,c,t/E.length(s,c));let l={};function h(n,e){n>e&&([n,e]=[e,n]);const o=n.toString()+"."+e.toString();if(l[o])return l[o];let r=s.length;return s.length+=3,E.add(s,3*n,s,3*e,s,r),E.scale(s,r,t/E.length(s,r)),r/=3,l[o]=r,r}for(let c=0;c<n;c++){const t=r.length,n=new Array(4*t);for(let e=0;e<t;e+=3){const t=r[e],o=r[e+1],s=r[e+2],l=h(t,o),u=h(o,s),c=h(s,t),a=4*e;n[a]=t,n[a+1]=l,n[a+2]=c,n[a+3]=o,n[a+4]=u,n[a+5]=l,n[a+6]=s,n[a+7]=c,n[a+8]=u,n[a+9]=l,n[a+10]=u,n[a+11]=c}r=n,l={}}const u=M(s);for(let c=0;c<u.length;c+=3)E.normalize(u,c);return[[d.POSITION,new S(M(s),r,3,!0)],[d.NORMAL,new S(u,r,3,!0)]]}function ht(n,e,o,s,r,l,h,u,c=null){const a=o?i(o):g(),f=e?i(e):w(0,0,1);h??=t();const p=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],m=null!=r&&2===r.length?r:[1,1],O=A(1),M=[[d.POSITION,new S(a,O,3,!0)],[d.NORMAL,new S(f,O,3,!0)],[d.UV0,new S(h,O,h.length)],[d.COLOR,new S(p,O,4,!0)],[d.SIZE,new S(m,O,2)]];if(null!=l&&(l=[l[0],l[1],l[2],l[3]],M.push([d.CENTEROFFSETANDDISTANCE,new S(l,O,4)])),u){const t=[u[0],u[1],u[2],u[3]];M.push([d.FEATUREATTRIBUTE,new S(t,O,4)])}return new L(n,M,null,R.Point,c)}const ut=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function ct(t,n=ut){const e=new Array(12);for(let c=0;c<4;c++)for(let t=0;t<3;t++)e[3*c+t]=n[c][t];const o=[0,1,2,2,3,0],s=[0,0,1],r=[0,0,0,0,0,0],l=[0,0,1,0,1,1,0,1],h=[255,255,255,255],u=[[d.POSITION,new S(e,o,3,!0)],[d.NORMAL,new S(s,r,3,!0)],[d.UV0,new S(l,o,2,!0)],[d.COLOR,new S(h,r,4,!0)]];return new L(t,u)}function at(t,n,e,o,s,r=!0,l=!0){let h=0;const u=e,c=n;let f=a(0,h,0),p=a(0,h+c,0),i=a(0,-1,0),g=a(0,1,0);s&&(h=c,p=a(0,0,0),f=a(0,h,0),i=a(0,1,0),g=a(0,-1,0));const w=[p,f],m=[i,g],M=o+2,A=Math.sqrt(c*c+u*u);if(s)for(let O=o-1;O>=0;O--){const t=O*(2*Math.PI/o),n=a(Math.cos(t)*u,h,Math.sin(t)*u);w.push(n);const e=a(c*Math.cos(t)/A,-u/A,c*Math.sin(t)/A);m.push(e)}else for(let O=0;O<o;O++){const t=O*(2*Math.PI/o),n=a(Math.cos(t)*u,h,Math.sin(t)*u);w.push(n);const e=a(c*Math.cos(t)/A,u/A,c*Math.sin(t)/A);m.push(e)}const I=new Array,y=new Array;if(r){for(let t=3;t<w.length;t++)I.push(1),I.push(t-1),I.push(t),y.push(0),y.push(0),y.push(0);I.push(w.length-1),I.push(2),I.push(1),y.push(0),y.push(0),y.push(0)}if(l){for(let t=3;t<w.length;t++)I.push(t),I.push(t-1),I.push(0),y.push(t),y.push(t-1),y.push(1);I.push(0),I.push(2),I.push(w.length-1),y.push(1),y.push(2),y.push(m.length-1)}const N=O(3*M);for(let a=0;a<M;a++)N[3*a]=w[a][0],N[3*a+1]=w[a][1],N[3*a+2]=w[a][2];const P=O(3*M);for(let a=0;a<M;a++)P[3*a]=m[a][0],P[3*a+1]=m[a][1],P[3*a+2]=m[a][2];const T=[[d.POSITION,new S(N,I,3,!0)],[d.NORMAL,new S(P,y,3,!0)]];return new L(t,T)}function ft(t,n,u,c,i,g,w){const m=i?p(i):a(1,0,0),M=g?p(g):a(0,0,0);w??=!0;const A=f();o(A,m);const I=f();s(I,A,Math.abs(n));const y=f();s(y,I,-.5),r(y,y,M);const N=a(0,1,0);Math.abs(1-l(A,N))<.2&&h(N,0,0,1);const P=f();e(P,A,N),o(P,P),e(N,P,A);const T=2*c+(w?2:0),b=c+(w?2:0),R=O(3*T),j=O(3*b),E=O(2*T),x=new Array(3*c*(w?4:2)),U=new Array(3*c*(w?4:2));w&&(R[3*(T-2)]=y[0],R[3*(T-2)+1]=y[1],R[3*(T-2)+2]=y[2],E[2*(T-2)]=0,E[2*(T-2)+1]=0,R[3*(T-1)]=R[3*(T-2)]+I[0],R[3*(T-1)+1]=R[3*(T-2)+1]+I[1],R[3*(T-1)+2]=R[3*(T-2)+2]+I[2],E[2*(T-1)]=1,E[2*(T-1)+1]=1,j[3*(b-2)]=-A[0],j[3*(b-2)+1]=-A[1],j[3*(b-2)+2]=-A[2],j[3*(b-1)]=A[0],j[3*(b-1)+1]=A[1],j[3*(b-1)+2]=A[2]);const V=(t,n,e)=>{x[t]=n,U[t]=e};let v=0;const F=f(),C=f();for(let e=0;e<c;e++){const t=e*(2*Math.PI/c);s(F,N,Math.sin(t)),s(C,P,Math.cos(t)),r(F,F,C),j[3*e]=F[0],j[3*e+1]=F[1],j[3*e+2]=F[2],s(F,F,u),r(F,F,y),R[3*e]=F[0],R[3*e+1]=F[1],R[3*e+2]=F[2],E[2*e]=e/c,E[2*e+1]=0,R[3*(e+c)]=R[3*e]+I[0],R[3*(e+c)+1]=R[3*e+1]+I[1],R[3*(e+c)+2]=R[3*e+2]+I[2],E[2*(e+c)]=e/c,E[2*e+1]=1;const n=(e+1)%c;V(v++,e,e),V(v++,e+c,e),V(v++,n,n),V(v++,n,n),V(v++,e+c,e),V(v++,n+c,n)}if(w){for(let t=0;t<c;t++){const n=(t+1)%c;V(v++,T-2,b-2),V(v++,t,b-2),V(v++,n,b-2)}for(let t=0;t<c;t++){const n=(t+1)%c;V(v++,t+c,b-1),V(v++,T-1,b-1),V(v++,n+c,b-1)}}const G=[[d.POSITION,new S(R,x,3,!0)],[d.NORMAL,new S(j,U,3,!0)],[d.UV0,new S(E,x,2,!0)]];return new L(t,G)}function pt(t,n,e,o,s,r){o=o||10,s=null==s||s,j(n.length>1);const l=[[0,0,0]],h=[],u=[];for(let c=0;c<o;c++){h.push([0,-c-1,-(c+1)%o-1]);const t=c/o*2*Math.PI;u.push([Math.cos(t)*e,Math.sin(t)*e])}return it(t,u,n,l,h,s,r)}function it(t,l,c,f,p,i,w=a(0,0,0)){const m=l.length,M=O(c.length*m*3+(6*f.length||0)),A=O(c.length*m*3+(f?6:0)),I=new Array,b=new Array;let R=0,j=0;const E=g(),x=g(),U=g(),V=g(),v=g(),F=g(),C=g(),G=g(),D=g(),k=g(),q=g(),B=g(),z=g(),Z=y();h(D,0,1,0),n(x,c[1],c[0]),o(x,x),i?(r(G,c[0],w),o(U,G)):h(U,0,0,1),At(x,U,D,D,v,U,It),u(V,U),u(B,v);for(let n=0;n<f.length;n++)s(F,v,f[n][0]),s(G,U,f[n][2]),r(F,F,G),r(F,F,c[0]),M[R++]=F[0],M[R++]=F[1],M[R++]=F[2];A[j++]=-x[0],A[j++]=-x[1],A[j++]=-x[2];for(let n=0;n<p.length;n++)I.push(p[n][0]>0?p[n][0]:-p[n][0]-1+f.length),I.push(p[n][1]>0?p[n][1]:-p[n][1]-1+f.length),I.push(p[n][2]>0?p[n][2]:-p[n][2]-1+f.length),b.push(0),b.push(0),b.push(0);let H=f.length;const J=f.length-1;for(let h=0;h<c.length;h++){let t=!1;if(h>0){u(E,x),h<c.length-1?(n(x,c[h+1],c[h]),o(x,x)):t=!0,r(k,E,x),o(k,k),r(q,c[h-1],V),N(c[h],k,Z);P(Z,T(q,E),G)?(n(G,G,c[h]),o(U,G),e(v,k,U),o(v,v)):At(k,V,B,D,v,U,It),u(V,U),u(B,v)}i&&(r(G,c[h],w),o(z,G));for(let n=0;n<m;n++)if(s(F,v,l[n][0]),s(G,U,l[n][1]),r(F,F,G),o(C,F),A[j++]=C[0],A[j++]=C[1],A[j++]=C[2],r(F,F,c[h]),M[R++]=F[0],M[R++]=F[1],M[R++]=F[2],!t){const t=(n+1)%m;I.push(H+n),I.push(H+m+n),I.push(H+t),I.push(H+t),I.push(H+m+n),I.push(H+m+t);for(let n=0;n<6;n++){const t=I.length-6;b.push(I[t+n]-J)}}H+=m}const K=c[c.length-1];for(let n=0;n<f.length;n++)s(F,v,f[n][0]),s(G,U,f[n][1]),r(F,F,G),r(F,F,K),M[R++]=F[0],M[R++]=F[1],M[R++]=F[2];const Q=j/3;A[j++]=x[0],A[j++]=x[1],A[j++]=x[2];const W=H-m;for(let n=0;n<p.length;n++)I.push(p[n][0]>=0?H+p[n][0]:-p[n][0]-1+W),I.push(p[n][2]>=0?H+p[n][2]:-p[n][2]-1+W),I.push(p[n][1]>=0?H+p[n][1]:-p[n][1]-1+W),b.push(Q),b.push(Q),b.push(Q);const X=[[d.POSITION,new S(M,I,3,!0)],[d.NORMAL,new S(A,b,3,!0)]];return new L(t,X)}function gt(t,n,e,o){j(n.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),j(3===n[0].length,"createPolylineGeometry(): malformed vertex"),j(null==e||e.length===n.length,"createPolylineGeometry: need same number of points and normals"),j(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const s=m(3*n.length),r=new Array(2*(n.length-1));let l=0,h=0;for(let c=0;c<n.length;c++){for(let t=0;t<3;t++)s[l++]=n[c][t];c>0&&(r[h++]=c-1,r[h++]=c)}const u=[[d.POSITION,new S(s,r,3,!0)]];if(e){const t=O(3*e.length);let o=0;for(let s=0;s<n.length;s++)for(let n=0;n<3;n++)t[o++]=e[s][n];u.push([d.NORMAL,new S(t,r,3,!0)])}return o&&u.push([d.COLOR,new S(o,I(o.length/4),4)]),new L(t,u,null,R.Line)}function wt(t,n,e,o,s,r=0){const l=new Array(18),h=[[-e,r,s/2],[o,r,s/2],[0,n+r,s/2],[-e,r,-s/2],[o,r,-s/2],[0,n+r,-s/2]],u=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)l[3*c]=h[c][0],l[3*c+1]=h[c][1],l[3*c+2]=h[c][2];return new L(t,[[d.POSITION,new S(l,u,3,!0)]])}function mt(t,n){const e=t.getMutableAttribute(d.POSITION).data;for(let o=0;o<e.length;o+=3){const t=e[o],s=e[o+1],r=e[o+2];h(yt,t,s,r),c(yt,yt,n),e[o]=yt[0],e[o+1]=yt[1],e[o+2]=yt[2]}}function Ot(t,n=t){const e=t.attributes,o=e.get(d.POSITION).data,s=e.get(d.NORMAL).data;if(s){const t=n.getMutableAttribute(d.NORMAL).data;for(let n=0;n<s.length;n+=3){const e=s[n+1];t[n+1]=-s[n+2],t[n+2]=e}}if(o){const t=n.getMutableAttribute(d.POSITION).data;for(let n=0;n<o.length;n+=3){const e=o[n+1];t[n+1]=-o[n+2],t[n+2]=e}}}function Mt(t,n,s,r,h){return!(Math.abs(l(n,t))>h)&&(e(s,t,n),o(s,s),e(r,s,t),o(r,r),!0)}function At(t,n,e,o,s,r,l){return Mt(t,n,s,r,l)||Mt(t,e,s,r,l)||Mt(t,o,s,r,l)}const It=.99619469809,yt=g();export{Ot as cgToGIS,G as createBoxGeometry,at as createConeGeometry,ft as createCylinderGeometry,z as createDiamondGeometry,wt as createExtrudedTriangle,it as createPathExtrusionGeometry,ht as createPointGeometry,lt as createPolySphereData,rt as createPolySphereGeometry,gt as createPolylineGeometry,st as createSphereGeometry,ct as createSquareGeometry,ot as createTetrahedronGeometry,pt as createTubeGeometry,At as makeOrthoBasisDirUpFallback,mt as transformInPlace};
