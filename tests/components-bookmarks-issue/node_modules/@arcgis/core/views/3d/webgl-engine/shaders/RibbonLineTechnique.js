/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{isDepthLikeOutput as e,ShaderOutput as t}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as r}from"../core/shaderTechnique/ShaderTechnique.js";import{blendingDefault as n,oitBlending as l,oitDepthTest as s,oitDepthWrite as o,OITPolygonOffset as c}from"../lib/OrderIndependentTransparency.js";import{Program as a}from"../lib/Program.js";import{stencilWriteMaskOn as p,stencilToolMaskBaseParams as u,stencilBaseAllZerosParams as h,depthCompareAlways as d,stencilToolTransparentOccluderParams as T,stencilWriteMaskOff as f,stencilToolMaskOccluderParams as m,depthCompareLess as O}from"../lib/StencilUtils.js";import{TransparencyPassType as g}from"../lib/TransparencyPassType.js";import{VertexAttribute as P}from"../lib/VertexAttribute.js";import{R as I}from"../../../../chunks/RibbonLine.glsl.js";import{PrimitiveType as b}from"../../../webgl/enums.js";import{makePipelineState as S,defaultDepthWriteParams as E,defaultColorWriteParams as R}from"../../../webgl/renderState.js";const y=new Map([[P.POSITION,0],[P.PREVPOSITION,1],[P.NEXTPOSITION,2],[P.SUBDIVISIONFACTOR,3],[P.UV0,4],[P.COLOR,5],[P.COLORFEATUREATTRIBUTE,5],[P.SIZE,6],[P.SIZEFEATUREATTRIBUTE,6],[P.OPACITYFEATUREATTRIBUTE,7],[P.OBJECTANDLAYERIDCOLOR,8]]);class W extends r{initializeProgram(e){return new a(e.rctx,W.shader.get().build(this.configuration),y)}_makePipelineState(i,r){const a=this.configuration,d=i===g.NONE,T=i===g.FrontFace,f=e(a.output);return S({blending:a.output===t.Color||a.output===t.Alpha?d?n:l(i):null,depthTest:{func:s(i)},depthWrite:d?a.writeDepth||f?E:null:o(i),colorWrite:R,stencilWrite:a.hasOccludees?p:null,stencilTest:a.hasOccludees?r?u:h:null,polygonOffset:d||T?a.hasPolygonOffset?A:null:c})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?A:null;this._occluderPipelineTransparent=S({blending:n,polygonOffset:t,depthTest:d,depthWrite:null,colorWrite:R,stencilWrite:null,stencilTest:T}),this._occluderPipelineOpaque=S({blending:n,polygonOffset:t,depthTest:d,depthWrite:null,colorWrite:R,stencilWrite:f,stencilTest:m}),this._occluderPipelineMaskWrite=S({blending:null,polygonOffset:t,depthTest:O,depthWrite:null,colorWrite:null,stencilWrite:p,stencilTest:u})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?b.LINES:b.TRIANGLE_STRIP}getPipeline(e,t,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}W.shader=new i(I,(()=>import("./RibbonLine.glsl.js")));const A={factor:0,units:-4};export{W as RibbonLineTechnique,y as vertexAttributeLocations};
