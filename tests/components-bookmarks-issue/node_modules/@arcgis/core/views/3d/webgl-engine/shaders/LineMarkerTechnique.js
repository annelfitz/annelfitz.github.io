/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{ShaderOutput as e}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as t}from"../core/shaderTechnique/ShaderTechnique.js";import{blendingDefault as r,oitBlending as n,oitDepthTest as l,oitDepthWrite as s}from"../lib/OrderIndependentTransparency.js";import{Program as o}from"../lib/Program.js";import{stencilWriteMaskOn as a,stencilToolMaskBaseParams as c,stencilBaseAllZerosParams as p,depthCompareAlways as u,stencilToolTransparentOccluderParams as d,stencilWriteMaskOff as h,stencilToolMaskOccluderParams as T,depthCompareLess as m}from"../lib/StencilUtils.js";import{TransparencyPassType as P}from"../lib/TransparencyPassType.js";import{VertexAttribute as f}from"../lib/VertexAttribute.js";import{L as g}from"../../../../chunks/LineMarker.glsl.js";import{LineMarkerSpace as O}from"./LineMarkerTechniqueConfiguration.js";import{makePipelineState as b,defaultDepthWriteParams as S,defaultColorWriteParams as W}from"../../../webgl/renderState.js";const E=new Map([[f.POSITION,0],[f.PREVPOSITION,1],[f.UV0,2],[f.NORMAL,3],[f.COLOR,4],[f.COLORFEATUREATTRIBUTE,4],[f.SIZE,5],[f.SIZEFEATUREATTRIBUTE,5],[f.OPACITYFEATUREATTRIBUTE,6]]);class j extends t{initializeProgram(e){return new o(e.rctx,j.shader.get().build(this.configuration),E)}_makePipelineState(i,t){const o=this.configuration,u=i===P.NONE;return b({blending:o.output===e.Color||o.output===e.Alpha?u?r:n(i):null,depthTest:o.space===O.Draped?null:{func:l(i)},depthWrite:o.space===O.Draped?null:u?o.writeDepth?S:null:s(i),colorWrite:W,stencilWrite:o.hasOccludees?a:null,stencilTest:o.hasOccludees?t?c:p:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=b({blending:r,depthTest:u,depthWrite:null,colorWrite:W,stencilWrite:null,stencilTest:d}),this._occluderPipelineOpaque=b({blending:r,depthTest:u,depthWrite:null,colorWrite:W,stencilWrite:h,stencilTest:T}),this._occluderPipelineMaskWrite=b({blending:null,depthTest:m,depthWrite:null,colorWrite:null,stencilWrite:a,stencilTest:c})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,t){return e?this._occludeePipelineState:this.configuration.occluder?t?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}j.shader=new i(g,(()=>import("./LineMarker.glsl.js")));export{j as LineMarkerTechnique,E as vertexAttributeLocations};
