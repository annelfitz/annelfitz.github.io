/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../../Graphic.js";import{Tiles3DTarget as i}from"../i3s/Intersector.js";import{newIntersectorResult as t}from"../../webgl-engine/lib/Intersector.js";import{IntersectorType as r,StoreResults as s}from"../../webgl-engine/lib/IntersectorInterfaces.js";import{MeshIntersectionOptions as n}from"../../webgl-engine/lib/RayIntersections.js";class l{constructor(e){this.layerUid=[],this.type=r.TILES3D,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=e,this.layerUid.push(e.layer.uid)}intersect(e,r,l,o){const a=e.results,c=e.options.store===s.ALL;if(e.options.filteredLayerUids.includes(this.layerView.layer.uid))return;const u=this.layerView.view._stage.renderView.componentObjectCollection,d=new n(!1,e.options.normalRequired);this.layerView.objects.forEach((s=>{s.visible&&s.intersectionGeometry&&u.intersect(s,l,o,e.tolerance,null,d,((s,n,u,d)=>{if(n>=0){if(null!=r&&!r(l,o,n))return;const s=e=>{const t=new i(this.layerView.layer.uid,(()=>this._createTiles3DGraphic(this.layerView.layer,{})));e.set(this.type,t,n,u)};if(this.isGround&&(null==a.ground.dist||n<a.ground.dist)&&s(a.ground),e.options.isFiltered)return;if((null==a.min.dist||n<a.min.dist)&&s(a.min),(null==a.max.dist||n>a.max.dist)&&s(a.max),c){const i=t(e.ray);s(i),e.results.all.push(i)}}}))}))}_createTiles3DGraphic(i,t){return new e({layer:i,sourceLayer:i,attributes:t})}}export{l as Tiles3DIntersectionHandler};
