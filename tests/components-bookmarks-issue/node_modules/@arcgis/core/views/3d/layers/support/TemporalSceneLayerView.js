/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../chunks/tslib.es6.js";import{property as e}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as r}from"../../../../core/accessorSupport/decorators/subclass.js";import{getTimeOperator as s}from"../../../../layers/graphics/data/timeSupport.js";import{combinedViewLayerTimeExtentProperty as i}from"../../../../layers/support/commonProperties.js";import o from"../../../../layers/support/FeatureFilter.js";import{filterInPlace as n,getCachedAttributeValue as l}from"../i3s/I3SUtil.js";const u=s=>{let n=class extends s{constructor(){super(...arguments),this.timeExtent=null}get mergedFilter(){const{filter:t,timeExtent:e}=this;if(null==e)return t;const r=t?.clone()??new o;return null!=e&&(r.timeExtent=r.timeExtent?.intersection(e)??e),r}getTimeFilterDependencies(){const{timeInfo:t}=this.i3slayer;if(null==t)return[];const{startField:e,endField:r}=t;return[e,r]}addTimeFilter(t,e){if(null==e)return;const{timeInfo:r}=this.i3slayer;if(null==r)return;const{startField:s,endField:i,useTime:o}=r;if(!o||null==s&&null==i)return;const n=r.toJSON(),l=e.toJSON();t.push(((t,e)=>m(t,e,n,l)))}};return t([e(i)],n.prototype,"timeExtent",void 0),t([e()],n.prototype,"mergedFilter",null),n=t([r("esri.views.3d.layers.support.TemporalSceneLayerView")],n),n};function m(t,e,r,i){const o=e.attributeInfo?.attributeData;if(null==o)return;const{startTimeField:l,endTimeField:u}=r;if(!!(null!=l&&null==o[l]||null!=u&&null==o[u]))return;const m=s(r,i,new a(o));if(null==m)return;const{featureIds:c}=e;n(t,c,m)}class a{constructor(t){this.attributeData=t}getAttribute(t,e){return l(this.attributeData[e],t)}getAttributeAsTimestamp(t,e){const r=this.getAttribute(t,e);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}}export{u as TemporalSceneLayerView};
