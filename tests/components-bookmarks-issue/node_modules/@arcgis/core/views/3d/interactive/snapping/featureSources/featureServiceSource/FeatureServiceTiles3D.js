/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import t from"../../../../../../core/Accessor.js";import{watch as r,initial as i}from"../../../../../../core/reactiveUtils.js";import{property as s}from"../../../../../../core/accessorSupport/decorators/property.js";import"../../../../../../core/has.js";import"../../../../../../core/Logger.js";import"../../../../../../core/RandomLCG.js";import{subclass as o}from"../../../../../../core/accessorSupport/decorators/subclass.js";import{TileKey as n}from"../../../../../../layers/support/TileKey.js";import{Visibility as l}from"../../../../layers/support/FeatureTileDescriptor3D.js";import{distanceToTile as c}from"../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils.js";let p=class extends t{get tiles(){const e=this.tilesCoveringView,t=this._effectivePointOfInterest;if(null!=t){const r=e.map((e=>c(t,e)));for(let i=1;i<r.length;i++)if(r[i-1]>r[i])return e.sort(((e,r)=>c(t,e)-c(t,r))),e.slice()}return e}get tilesCoveringView(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(u)}get tileInfo(){return this.view.featureTiles?.tilingScheme?.toTileInfo()??null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){const e=this.pointOfInterest;return null!=e?e:this.view.pointsOfInterest?.focus.location}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles(r((()=>this.view.featureTiles),(e=>{this.removeHandles(f),e&&this.addHandles(e.addClient(),f)}),i))}_filterTiles(e){if(null==e)return[];return e.filter((e=>{const t=e.measures;if(t.visibility===l.VISIBLE_ON_SURFACE){const e=t.screenRect;return Math.abs(e[3]-e[1])>a}return!1}))}};function u({lij:[e,t,r],extent:i}){return new n(`${e}/${t}/${r}`,e,t,r,i)}e([s({readOnly:!0})],p.prototype,"tiles",null),e([s({readOnly:!0})],p.prototype,"tilesCoveringView",null),e([s({readOnly:!0})],p.prototype,"tileInfo",null),e([s({readOnly:!0})],p.prototype,"tileSize",null),e([s({constructOnly:!0})],p.prototype,"view",void 0),e([s()],p.prototype,"pointOfInterest",void 0),e([s()],p.prototype,"_effectivePointOfInterest",null),p=e([o("esri.views.3d.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],p);const a=50,f="feature-tiles";export{p as FeatureServiceTiles3D};
