/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../../../core/arrayUtils.js";import{VVBinding as i}from"../../../../engine/webgl/enums.js";import{simplifyVisualVariables as n}from"../../support/rendererUtils.js";import{getWebGLCapabilities as r}from"../../../../../webgl/capabilities.js";function t(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:r().maxTextureSize},bindings:a(e)}}function s(e){switch(e){case"opacity":return i.OPACITY;case"color":return i.COLOR;case"rotation":return i.ROTATION;case"size":return i.SIZE;default:return null}}function a(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":return o(e);case"pie-chart":return l(e);case"heatmap":return u(e)}}function o(e){const i=[];for(const n of e.attributes)i.push({binding:i.length,expression:n.valueExpression,field:n.field});return i}function l(e){const i=c(e);let n=4;for(const r of e.attributes)i.push({binding:n++,expression:r.valueExpression,field:r.field});return i}function u({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function c(i){if(!("visualVariables"in i)||!i.visualVariables?.length)return[];return n(i.visualVariables).map((e=>x(e))).filter(e)}function p(e){return"$view.scale"===e.valueExpression?null:{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function f(e){return{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function d(e){return{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function m(e){return{binding:s(e.type),expression:e.valueExpression,field:e.field}}function x(e){switch(e.type){case"size":return p(e);case"color":return f(e);case"opacity":return d(e);case"rotation":return m(e)}}export{o as createDotDensityBindings,u as createHeatmapBindings,l as createPieChartBindings,t as createStorageSchema,c as createVVBindings};
