/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{JSONMap as t}from"../../../../core/jsonMap.js";import e from"../../engine/webgl/effects/highlight/HighlightGradient.js";import{MultiHighlightGradient as i}from"../../engine/webgl/effects/highlight/MultiHighlightGradient.js";import{getFeaturePipelineState as n}from"../../engine/webgl/shaderGraph/techniques/featureTechniqueUtils.js";const l=new t({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function s(t){return l.toJSON(t)}function o(t,e,i){const n=[],l=[];let s=0,o=0;for(const r of t){const t=o;let h=r[0][0],a=r[0][1];n[o++]=h,n[o++]=a;let g=0;for(let e=1;e<r.length;++e){const t=h,i=a;h=r[e][0],a=r[e][1],g+=a*t-h*i,n[o++]=h,n[o++]=a}e(g/2),g>0?(t-s>0&&(i(s,t,n,l),s=t),l.length=0):g<0&&t-s>0?l.push(.5*(t-s)):o=t}o-s>0&&i(s,o,n,l)}function r(t){const{bandCount:e,attributeTable:i,colormap:n,pixelType:l}=t.raster.rasterInfo;return 1===e&&(null!=i||null!=n||"u8"===l||"s8"===l)}function h(t,n){return"single"===t?.type&&n.multiHighlightEnabled&&(t.destroy(),t=null),"multi"!==t?.type||n.multiHighlightEnabled||(t.destroy(),t=null),t||(t=n.multiHighlightEnabled?new i:new e),t.setHighlightOptions(n),t}function a(t,e,i){const{painter:l,highlightGradient:s}=t,{highlight:o}=l.effects;if(!s)return;const r=t.passOptions,h=s.getReasonsWithGradients();for(let a=0;a<h.length;a++){const s={...t,passOptions:{type:"highlight",activeGradient:h[a].activeGradient,activeReasons:h[a].activeReasons,stepType:"burn",highlightAll:e}};if(o.bind(s),i(s),a<h.length-1){let n=0;for(let t=a+1;t<h.length;t++)n|=h[t].activeReasons;i({...t,passOptions:{type:"highlight",activeGradient:h[a].activeGradient,activeReasons:n,stepType:"clear",highlightAll:e}})}const r={...t,passOptions:{type:"highlight",activeGradient:h[a].activeGradient,activeReasons:h[a].activeReasons,stepType:"draw",highlightAll:e}};l.setPipelineState(n(t)),l.updatePipelineState(t.context),o.draw(r),o.unbind()}t.passOptions=r}export{o as analyzeRings,r as canUseMajorityInterpolationOnDataSource,h as createOrReuseHighlightGradient,a as renderHighlight,s as toJSONGeometryType};
