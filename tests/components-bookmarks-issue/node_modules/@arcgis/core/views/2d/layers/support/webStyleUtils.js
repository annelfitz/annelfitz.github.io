/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{isDevEnvironment as t,adjustStaticAGOUrl as r}from"../../../../core/devEnvironmentUtils.js";import o from"../../../../core/Error.js";import{throwIfAbortError as e}from"../../../../core/promiseUtils.js";import{urlToObject as s}from"../../../../core/urlUtils.js";import l from"../../../../portal/Portal.js";import{f as n}from"../../../../chunks/persistableUrlUtils.js";import{fetchStyle as m,Style2DUrlTemplate as a,requestJSON as i,makeCIMSymbolRef as c,symbolUrlFromStyleItem as y}from"../../../../symbols/support/styleUtils.js";import{getStyleItemFromStyle as u}from"../../../../symbols/support/webStyleSymbolUtils.js";async function f(t,r,s){if(!t.name)throw new o("style-symbol-reference-name-missing","Missing name in style symbol reference");if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return p(t,s);try{return b(await m(t,r,s),t.name,r,s)}catch(l){return e(l),null}}async function p(t,r){const o=a.replaceAll(/\{SymbolName\}/gi,t.name);try{const t=await i(o,r);return c(t.data)}catch(s){return e(s),null}}async function b(m,a,f,p){const b={portal:null!=f?.portal?f.portal:l.getDefault(),url:s(m.baseUrl),origin:"portal-item"},j=u(a,m.data);if(!j){throw new o("symbolstyleutils:symbol-name-not-found",`The symbol name '${a}' could not be found`,{symbolName:a})}let w=n(y(j,"cimRef"),b);t()&&(w=r(w));try{const t=await i(w,p);return c(t.data)}catch(U){return e(U),null}}export{f as fetchCIMSymbolReference};
