/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{createVisualVariableUniforms as e,noVisualVariables as a}from"./VisualVariablesSchema.js";import{createSymbolMeshSchemas as i,createDotDensityMeshSchemas as l,createHeatmapMeshSchemas as n,createPieChartMeshSchemas as s}from"./symbols/SymbolSchema.js";async function r(e,a){if(!a)return{type:"simple",meshes:[]};switch(a.type){case"simple":return o(e,a);case"dot-density":return u(e,a);case"class-breaks":return m(e,a);case"unique-value":return c(e,a);case"dictionary":return p(a);case"heatmap":return f(e,a);case"pie-chart":return y(e,a)}}async function t(e,a,l){return{type:"simple",meshes:await i(a,{schemaOptions:e,path:l,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}}async function o(a,l){const n=l.getSymbols(),s=n.length?n[0]:null,r=e(l),t="renderer.symbol";return{type:"simple",meshes:await i(s,{schemaOptions:a,uniforms:r,path:t})}}async function u(a,i){const n=e(i),s="renderer.symbol";return{type:"dot-density",meshes:await l(i,{schemaOptions:a,uniforms:n,path:s})}}async function m(l,n){const s=e(n),r=n.backgroundFillSymbol,t=n.normalizationType,o="log"===t?"esriNormalizeByLog":"percent-of-total"===t?"esriNormalizeByPercentOfTotal":"field"===t?"esriNormalizeByField":null,u=n.classBreakInfos.map((async e=>({meshes:await i(e.symbol,{path:`renderer-stop-${e.minValue}-${e.maxValue}`,schemaOptions:l,uniforms:s}),min:e.minValue,max:e.maxValue}))),m=(await Promise.all(u)).sort(((e,a)=>e.min-a.min)),c=await i(r,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...a,visualVariableSizeOutlineScaleStops:s.visualVariableSizeOutlineScaleStops}}),p=await i(n.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:s});return{type:"interval",field:n.field,expression:n.valueExpression,backgroundFill:c,defaultSymbol:p,intervals:m,normalizationField:n.normalizationField,normalizationTotal:n.normalizationTotal,normalizationType:o,isMaxInclusive:n.isMaxInclusive}}async function c(l,n){const s=[],r=e(n),t=await i(n.backgroundFillSymbol,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...a,visualVariableSizeOutlineScaleStops:r.visualVariableSizeOutlineScaleStops}}),o=await i(n.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:r});for(const e of n.uniqueValueInfos??[]){const a=await i(e.symbol,{path:`renderer-unique-value-${e.value}`,schemaOptions:l,uniforms:r});s.push({value:""+e.value,symbol:a})}return{type:"map",field:n.field,expression:n.valueExpression,field2:n.field2,field3:n.field3,fieldDelimiter:n.fieldDelimiter,backgroundFill:t,defaultSymbol:o,map:s}}function p(a){const i=e(a),l=a.scaleExpression,n=null!=l&&"1"!==l?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:a.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",fieldMap:a.fieldMap,scaleExpression:n,visualVariableUniforms:i}}async function f(e,a){return{type:"heatmap",meshes:await n(a,e)}}async function y(e,a){return{type:"pie-chart",meshes:s(a,e)}}export{r as createMatcherSchema,t as createSimpleMatcherSchemaFromSymbol};
