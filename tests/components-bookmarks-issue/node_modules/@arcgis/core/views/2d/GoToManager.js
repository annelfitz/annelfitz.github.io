/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import o from"../../core/Accessor.js";import e from"../../core/Error.js";import i from"../../core/Logger.js";import{throwIfAborted as r,whenOrAbort as s}from"../../core/promiseUtils.js";import{whenOnce as n}from"../../core/reactiveUtils.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/RandomLCG.js";import{subclass as c}from"../../core/accessorSupport/decorators/subclass.js";import p from"../ViewAnimation.js";import{create as m}from"./viewpointUtils.js";let l=class extends o{constructor(t){super(t),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(t,o){if(!t)return void i.getLogger(this).error("#goTo()","target cannot be null or undefined");const e=new p;this.view.animation=e,await n((()=>this.view.ready),o);const r={animate:!0,...o},{extent:s,spatialReference:a,size:c,viewpoint:l,constraints:h,padding:g,allLayerViews:w}=this.view,d=m(t,{extent:s,spatialReference:a,size:c,viewpoint:l,constraints:h,padding:g,allLayerViews:w,pickClosestTarget:o?.pickClosestTarget??!0});return e?.update(d),this._gotoTask={},r.animate?this._gotoAnimated(d,r):this._gotoImmediate(d,r)}_gotoImmediate(t,o){const i=this._gotoTask,s=this.view.animation,n=t.then((t=>{if(r(o),i!==this._gotoTask)throw new e("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=t,s.finish()}));return this._cancellableGoTo(i,s,n,o)}_gotoAnimated(t,o){const i=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const n=t.then((t=>{if(r(o),i!==this._gotoTask)throw new e("view:goto-interrupted","Goto was interrupted");return s.update(t),this.view.animationManager.animate(s,this.view.viewpoint,o),s.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,s,n,o)}_cancellableGoTo(t,o,e,i){const r=()=>t===this._gotoTask;return s(e,i).finally((()=>{r()&&(o.done||o.stop())}))}};t([a({constructOnly:!0})],l.prototype,"view",void 0),l=t([c("esri.views.2d.GoToManager")],l);export{l as GoToManager};
