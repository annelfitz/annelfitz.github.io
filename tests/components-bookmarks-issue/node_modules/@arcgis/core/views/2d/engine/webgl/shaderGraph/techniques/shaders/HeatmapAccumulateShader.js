/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t,a as e}from"../../../../../../../chunks/tslib.es6.js";import{location as s,UniformGroup as i,uniform as o,define as l,input as r}from"../../GraphShaderModule.js";import{Float as p,Vec3 as a,Vec4 as n,length as u,step as m,Vec2 as d}from"../../graph/glsl.js";import{FeatureVertexInput as y,FeatureFragmentInput as f,AFeatureShader as h}from"./AFeatureShader.js";import{getHeatmapCompressionFactor as c}from"./heatmapUtils.js";import{hittestMarker as w}from"./hittestUtils.js";class v extends y{}t([s(5,d)],v.prototype,"offset",void 0);class x extends f{}class g extends i{}t([o(p)],g.prototype,"radius",void 0),t([o(p)],g.prototype,"isFieldActive",void 0);class F extends h{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:s}=this.kernelControls,i=t.offset,o=s.multiply(this.storage.getVVData(t.id).x).add(new p(1).subtract(s)),l=this.view.displayViewScreenMat3.multiply(new a(t.pos,1)).add(this.view.displayViewMat3.multiply(new a(i,0)).multiply(e)),r=this.clip(t.id);return{glPosition:new n(l.xy,r,1),offset:i,fieldValue:o,color:new n(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:s}=t,i=u(e),o=m(i,new p(1)),l=new p(1).subtract(i.multiply(i)),r=l.multiply(l),a=o.multiply(r).multiply(s).multiply(new p(c(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new n(a),t)}hittest(t){const{viewMat3:e,tileMat3:s}=this.view,i=e.multiply(s).multiply(new a(t.pos,1));return w(i.xy,this.kernelControls.radius,this.hittestRequest.position)}}t([l],F.prototype,"usesHalfFloatPrecision",void 0),t([o(g)],F.prototype,"kernelControls",void 0),t([e(0,r(v))],F.prototype,"vertex",null),t([e(0,r(x))],F.prototype,"fragment",null);export{x as HeatmapAccumulateFragmentInput,F as HeatmapAccumulateShader,v as HeatmapAccumulateVertexInput,g as KernelControls};
