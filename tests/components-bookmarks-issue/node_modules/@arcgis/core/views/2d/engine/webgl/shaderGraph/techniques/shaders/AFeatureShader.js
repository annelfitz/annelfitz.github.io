/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../../../chunks/tslib.es6.js";import{highlightReasons as i}from"../../../../highlightReasons.js";import{VertexInput as e,location as o,ComputeVertexInput as s,FragmentInput as r,GraphShaderModule as h,define as l,option as n,uniform as g,FragmentOutput as d}from"../../GraphShaderModule.js";import{Float as p,float as a,step as u,Vec4 as c,ifElse as m,greaterThan as y,Vec3 as w,Vec2 as v}from"../../graph/glsl.js";import{EntityStorage as b}from"./EntityStorage.js";import{ShaderHighlight as f}from"./ShaderHighlight.js";import{ShaderHittest as H}from"./ShaderHittest.js";import{getFilterBit as _,getHighlightBit as j,getBit as x,uvToClip as R}from"./utils.js";import{ViewInfo as k}from"./ViewInfo.js";class S extends e{}t([o(0,w)],S.prototype,"id",void 0),t([o(1,p)],S.prototype,"bitset",void 0),t([o(2,v)],S.prototype,"pos",void 0);class q extends s{}t([o(14,v)],q.prototype,"nextPos1",void 0),t([o(15,v)],q.prototype,"nextPos2",void 0);class F extends r{}class P extends h{clip(t,i){let e=new p(0);const o=this.storage.getFilterFlags(t);if(e=e.add(a(2).multiply(a(1).subtract(_(o,0)))),this.inside?e=e.add(a(2).multiply(a(1).subtract(_(o,1)))):this.outside?e=e.add(a(2).multiply(_(o,1))):this.highlight&&(e=e.add(a(2).multiply(a(1).subtract(this._checkHighlight(o))))),null!=i){const t=new p(1).subtract(u(i.x,this.view.currentZoom)),o=u(i.y,this.view.currentZoom);e=e.add(new p(2).multiply(t.add(o)))}return e}getFragmentOutput(t,i,e=new p(1/255)){const o=new d;return o.glFragColor=this._maybeWriteHittest(i)??this._maybeHighlight(t,e)??t,o}_maybeHighlight(t,i){return this.highlight?new c(t.rgb,u(i,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let o=1;o<i.length;o++)e=e.add(this._checkHighlightBit(t,o));return u(new p(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,i){return j(t,i).multiply(x(this.highlight.activeReasons,i))}maybeRunHittest(t,i,e){if(null==this.hittestRequest)return null;const o=this.hittest(t,i,e);let s=m(y(o,this.hittestRequest.distance),new p(2),new p(0));const r=this.storage.getAttributeDataCoords(t.id),h=R(r);s=s.add(this.clip(t.id,t.zoomRange));const l=new c(new p(1/255),0,0,0);return{glPointSize:new p(1),glPosition:new c(h,s,1),color:l}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}t([l],P.prototype,"inside",void 0),t([l],P.prototype,"outside",void 0),t([n(f)],P.prototype,"highlight",void 0),t([g(b)],P.prototype,"storage",void 0),t([g(k)],P.prototype,"view",void 0),t([n(H)],P.prototype,"hittestRequest",void 0);export{P as AFeatureShader,q as BaseHittestVertexInput,F as FeatureFragmentInput,S as FeatureVertexInput};
