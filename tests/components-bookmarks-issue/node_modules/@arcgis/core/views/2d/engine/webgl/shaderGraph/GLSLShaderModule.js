/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{numericHash as t}from"../../../../../core/string.js";import{TypedShaderProgram as o}from"./typed/TypedShaderProgram.js";class e{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const o in this.locations)t.set(o,this.locations[o].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const o=this.locationsMap,e=Array.from(o.entries()).map((([t,o])=>`${t}.${o}`)).join("."),n=t(e);this._locationInfo={hash:n,locations:o}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[o,e]of this.locationsMap.entries())t.set("a_"+o,e);return t}getShaderKey(t,o,e){const n=Object.keys(e).filter((t=>e[t])).map((t=>`${t}_${e[t].toString()}`)).join("."),r=Object.keys(o).filter((t=>this.optionPropertyKeys.has(t))).join(".");return`${t.hash}.${n}.${r}`}getProgram(t,e,n,r){let i="",s="";for(const o in n)if(n[o]){const t="boolean"==typeof n[o]?`#define ${o}\n`:`#define ${o} ${n[o]}\n`;i+=t,s+=t}return i+=this.vertexShader,s+=this.fragmentShader,new o(i,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const o=[];for(const e in this.required){const t=this.required[e];o.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:t.type,uniformArrayElementType:n(t),uniformArrayLength:r(t)})}for(const e in t){const i=this.options[e];if(t[e])for(const t in i){const s=i[t];o.push({uniformHydrated:null,shaderModulePath:`${e}.${t}`,uniformName:t,uniformType:s.type,uniformArrayElementType:n(s),uniformArrayLength:r(s)})}}return o}}const n=t=>"array"===t.type?t.elementType?.type:void 0,r=t=>"array"===t.type?t.size:void 0;export{e as GLSLShaderModule};
