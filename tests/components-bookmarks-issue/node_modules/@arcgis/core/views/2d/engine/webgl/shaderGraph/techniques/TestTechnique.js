/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{Technique as e}from"./Technique.js";import{MeshWriter as t}from"./mesh/MeshWriter.js";import{TestShader as r}from"./shaders/TestShader.js";import{CompareFunction as o,StencilOperation as i,DataType as s}from"../../../../../webgl/enums.js";const n={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:o.EQUAL,mask:255,op:{fail:i.KEEP,zFail:i.KEEP,zPass:i.REPLACE}}}};class a extends e{constructor(){super(...arguments),this.meshWriter={name:"TestMeshWriter",constructor:p},this.shaders={geometry:new r}}render(e,t){const{context:r,painter:o}=e,i=t.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{dataDrivenColor:i.geometry.dataDrivenColor,view:{zoomLevel:1}},defines:{returnRed:!1},optionalAttributes:t.instance.optionalAttributes,useComputeBuffer:!1}),o.setPipelineState(n),o.submitDraw(r,t)}}const c={createComputedParams:e=>e,attributes:{pos:{type:s.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:s.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:s.UNSIGNED_BYTE,count:1},size:{type:s.UNSIGNED_BYTE,count:1,packPrecisionFactor:10,pack:e=>.2},offset:{type:s.INT,count:2,packPrecisionFactor:10,packAlternating:{count:4,pack:()=>[[-1,1],[1,1],[-1,-1],[1,-1]]}},color:{type:s.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>e}}};class p extends t{constructor(){super(...arguments),this.vertexSpec=c}_write(e,t){e.recordStart(this.instanceId,this.attributeLayout);const r=655360,o=e.vertexCount(),i=t.readXForDisplay(),s=t.readYForDisplay();this._writeVertex(e,r,i,s),e.indexWrite(o+0),e.indexWrite(o+1),e.indexWrite(o+2),e.indexWrite(o+1),e.indexWrite(o+3),e.indexWrite(o+2),e.recordEnd()}}export{p as TestMeshWriter,a as TestTechnique};
