/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{createMeshWriterGroupFromSchema as t}from"../shaderGraph/techniques/mesh/createMeshWriter.js";import{FeatureMatcher as e}from"./Matcher.js";class s extends e{static async fromDictionaryRenderer(t,e,r){return new s(t,e,r)}constructor(t,e,s){super(),this._storage=t,this._schema=e,this._viewParams=s,this._hashToGroup=new Map}get fieldMap(){return this._schema.fieldMap}async fetchResources(t,e){const s=e.getCursor(),r=[];for(;s.next();)r.push(this._updateMeshWriterGroup(t,s));await Promise.all(r)}match(t,e){const s=t.getAttributeHash();return this._hashToGroup.get(s)}async _updateMeshWriterGroup(e,s){const r=s.readLegacyFeatureForDisplay(),a=s.getAttributeHash();if(this._hashToGroup.has(a))return;this._hashToGroup.set(a,null);const h=await e.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:r});if(!h)return;const i=await t(this._storage,e,h.meshes,this._viewParams);this._hashToGroup.set(a,i)}}export{s as DictionaryMatcher};
