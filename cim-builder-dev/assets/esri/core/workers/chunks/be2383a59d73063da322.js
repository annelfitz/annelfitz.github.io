self.webpackChunkRemoteClient([29,60],{100:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return g})),i.d(t,"i",(function(){return a})),i.d(t,"j",(function(){return p})),i.d(t,"k",(function(){return s})),i.d(t,"l",(function(){return r})),i.d(t,"m",(function(){return m})),i.d(t,"n",(function(){return d})),i.d(t,"o",(function(){return b})),i.d(t,"p",(function(){return n}));const s=1e-30,r=4294967295,n=512,o=128,a=29,c=1,l=16,u=50,h=10,d=8,f=1,_=2,p=2,g=1,b=2.5,m=2},112:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(3),i(4)),o=i(20),a=i(52),c=i(54),l=i(53),u=i(19),h=(i(24),i(34),i(35),i(50)),d=i(146),f=i(166);const _=new a.a({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let p=s=class extends h.a{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch(e){}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch(e){}return i?_.fromJSON(i.fieldValueType):null}clone(){return new s({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],p.prototype,"alias",void 0),Object(r.a)([Object(o.b)({type:[String,Number],json:{write:{allowNull:!0}}})],p.prototype,"defaultValue",void 0),Object(r.a)([Object(o.b)()],p.prototype,"description",void 0),Object(r.a)([Object(l.a)("description")],p.prototype,"readDescription",null),Object(r.a)([Object(o.b)({types:d.d,json:{read:{reader:d.b},write:!0}})],p.prototype,"domain",void 0),Object(r.a)([Object(o.b)({type:Boolean,json:{write:!0}})],p.prototype,"editable",void 0),Object(r.a)([Object(o.b)({type:n.a,json:{write:!0}})],p.prototype,"length",void 0),Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],p.prototype,"name",void 0),Object(r.a)([Object(o.b)({type:Boolean,json:{write:!0}})],p.prototype,"nullable",void 0),Object(r.a)([Object(c.a)(f.a)],p.prototype,"type",void 0),Object(r.a)([Object(o.b)()],p.prototype,"valueType",void 0),Object(r.a)([Object(l.a)("valueType",["description"])],p.prototype,"readValueType",null),p=s=Object(r.a)([Object(u.a)("esri.layers.support.Field")],p);var g=p;t.a=g},114:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(3),i(4),i(20),i(54)),o=i(19),a=(i(24),i(34),i(35),i(84));let c=s=class extends a.a{constructor(e){super(e),this.type="inherited"}clone(){return new s}};Object(r.a)([Object(n.a)({inherited:"inherited"})],c.prototype,"type",void 0),c=s=Object(r.a)([Object(o.a)("esri.layers.support.InheritedDomain")],c);var l=c;t.a=l},115:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(3),i(4),i(20)),o=i(54),a=i(19),c=(i(24),i(34),i(35),i(84));let l=s=class extends c.a{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new s({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};Object(r.a)([Object(n.b)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],l.prototype,"maxValue",void 0),Object(r.a)([Object(n.b)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],l.prototype,"minValue",void 0),Object(r.a)([Object(o.a)({range:"range"})],l.prototype,"type",void 0),l=s=Object(r.a)([Object(a.a)("esri.layers.support.RangeDomain")],l);var u=l;t.a=u},117:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(5)),o=(i(3),i(4),i(20)),a=i(54),c=i(19),l=(i(24),i(34),i(35),i(50));let u=s=class extends l.a{constructor(e){super(e),this.name=null,this.code=null}clone(){return new s({name:this.name,code:this.code})}};Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],u.prototype,"name",void 0),Object(r.a)([Object(o.b)({type:[String,Number],json:{write:!0}})],u.prototype,"code",void 0),u=s=Object(r.a)([Object(c.a)("esri.layers.support.CodedValue")],u);var h,d=u,f=i(84);let _=h=class extends f.a{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(e=>(String(e.code)===i&&(t=e.name),!!t))}return t}clone(){return new h({codedValues:Object(n.a)(this.codedValues),name:this.name})}};Object(r.a)([Object(o.b)({type:[d],json:{write:!0}})],_.prototype,"codedValues",void 0),Object(r.a)([Object(a.a)({codedValue:"coded-value"})],_.prototype,"type",void 0),_=h=Object(r.a)([Object(c.a)("esri.layers.support.CodedValueDomain")],_);var p=_;t.a=p},122:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l}));var s=i(18),r=i(20),n=i(19),o=i(25),a=i(79),c=i(243);const l=e=>{let t=class extends e{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new a.a}get updatingHandles(){return this._get("updatingHandles")||new c.a}};return Object(s.a)([Object(r.b)({readOnly:!0})],t.prototype,"handles",null),Object(s.a)([Object(r.b)({readOnly:!0})],t.prototype,"updatingHandles",null),t=Object(s.a)([Object(n.a)("esri.core.HandleOwner")],t),t};let u=class extends(l(o.a)){};u=Object(s.a)([Object(n.a)("esri.core.HandleOwner")],u)},123:function(e,t,i){"use strict";t.a=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}},124:function(e,t,i){"use strict";var s,r,n,o,a,c,l;i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return c})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"}(s||(s={})),function(e){e[e.SUCCEEDED=0]="SUCCEEDED",e[e.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(n||(n={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(a||(a={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(c||(c={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(l||(l={}))},132:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const s=new Float32Array(1);new Uint32Array(s.buffer);function r(e,t){return 65535&e|t<<16}function n(e,t,i,s){return 255&e|(255&t)<<8|(255&i)<<16|s<<24}},139:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return a}));var s=i(1),r=i(2),n=i(55);i(58);let o;async function a(){return o||(o=(async()=>{const e=await Promise.all([i.e(13),i.e(60)]).then(i.bind(null,437));return await e.arcade.load(),{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),o}const c=(e,t,i)=>h.create(e,t,i,null,["$feature"]),l=(e,t,i)=>h.create(e,t,i,null,["$feature","$view"]),u=(e,t,i,s)=>h.create(e,t,i,s,["$feature","$view"]);class h{constructor(e,t,i,s,r,n,o,a){this.script=e,this.evaluate=r,this.fields=o,this._syntaxTree=s,this._arcade=t,this._arcadeDictionary=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=t.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,t,i,o,c,l){const{arcade:u,Feature:d,Dictionary:f}=await a(),_=n.a.fromJSON(t),p=u.parseScript(e,l),g=c.reduce((e,t)=>({...e,[t]:null}),{});let b=null;Object(s.g)(o)&&(b=new f(o),b.immutable=!0,g.$config=null);const m=u.scriptUsesGeometryEngine(p)&&u.enableGeometrySupport(),y=u.scriptUsesFeatureSet(p)&&u.enableFeatureSetSupport(),x=u.scriptIsAsync(p)&&u.enableAsyncSupport(),T={vars:g,spatialReference:_,useAsync:!!x},v=new f;v.immutable=!1,v.setField("scale",0);const O=u.compileScript(p,T);return await Object(r.b)([m,y,x]),new h(e,u,f,p,e=>("$view"in e&&e.$view&&(v.setField("scale",e.$view.scale),e.$view=v),b&&(e.$config=b),O({vars:e,spatialReference:_})),new d,i,_)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)}}},146:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return l}));i(7);var s,r,n=i(84),o=i(117),a=i(114),c=i(115);function l(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return s.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every(e=>null==e||e.code!==t))return s.INVALID_CODED_VALUE}return null}(r=s||(s={})).VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",r.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";const u={key:"type",base:n.a,typeMap:{range:c.a,"coded-value":o.a,inherited:a.a}};function h(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}function d(e){if(!e||!e.type)return null;switch(e.type){case"range":return c.a.fromJSON(e);case"codedValue":return o.a.fromJSON(e);case"inherited":return a.a.fromJSON(e)}return null}},147:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return c}));var s=i(132);function r(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function n(e,t=0,i=!1){const s=e[t+3];return e[t+0]*=s,e[t+1]*=s,e[t+2]*=s,i||(e[t+3]*=255),e}function o(e){return n(r([],e))}function a(e){if(!e)return 0;const{r:t,g:i,b:r,a:n}=e;return Object(s.b)(t*n,i*n,r*n,255*n)}function c(e){if(!e)return 0;const[t,i,r,n]=e;return Object(s.b)(t*(n/255),i*(n/255),r*(n/255),n)}},165:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return T})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return o})),i.d(t,"i",(function(){return h})),i.d(t,"j",(function(){return f})),i.d(t,"k",(function(){return p})),i.d(t,"l",(function(){return n})),i.d(t,"m",(function(){return y}));var s=i(118);function r(e,t){return e[0]=t[0],e[1]=t[1],e}function n(e,t,i){return e[0]=t,e[1]=i,e}function o(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function a(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function c(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function l(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function u(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function h(e,t){const i=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(i*i+s*s)}function d(e,t){const i=t[0]-e[0],s=t[1]-e[1];return i*i+s*s}function f(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function _(e){const t=e[0],i=e[1];return t*t+i*i}function p(e,t){return e[0]=-t[0],e[1]=-t[1],e}function g(e,t){const i=t[0],s=t[1];let r=i*i+s*s;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function m(e,t,i){const s=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=s,e}function y(e,t,i){const s=t[0],r=t[1];return e[0]=i[0]*s+i[2]*r+i[4],e[1]=i[1]*s+i[3]*r+i[5],e}const x=f,T=a,v=c,O=l,w=h,S=d,E=_;Object.freeze({__proto__:null,copy:r,set:n,add:o,subtract:a,multiply:c,divide:l,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:u,scaleAndAdd:function(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e},distance:h,squaredDistance:d,length:f,squaredLength:_,negate:p,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:g,dot:b,cross:m,lerp:function(e,t,i,s){const r=t[0],n=t[1];return e[0]=r+s*(i[0]-r),e[1]=n+s*(i[1]-n),e},random:function(e,t){t=t||1;const i=2*Object(s.b)()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},transformMat2:function(e,t,i){const s=t[0],r=t[1];return e[0]=i[0]*s+i[2]*r,e[1]=i[1]*s+i[3]*r,e},transformMat2d:y,transformMat3:function(e,t,i){const s=t[0],r=t[1];return e[0]=i[0]*s+i[3]*r+i[6],e[1]=i[1]*s+i[4]*r+i[7],e},transformMat4:function(e,t,i){const s=t[0],r=t[1];return e[0]=i[0]*s+i[4]*r+i[12],e[1]=i[1]*s+i[5]*r+i[13],e},rotate:function(e,t,i,s){const r=t[0]-i[0],n=t[1]-i[1],o=Math.sin(s),a=Math.cos(s);return e[0]=r*a-n*o+i[0],e[1]=r*o+n*a+i[1],e},angle:function(e,t){const i=e[0],s=e[1],r=t[0],n=t[1];let o=i*i+s*s;o>0&&(o=1/Math.sqrt(o));let a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));const c=(i*r+s*n)*o*a;return c>1?0:c<-1?Math.PI:Math.acos(c)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){const i=e[0],r=e[1],n=t[0],o=t[1];return Math.abs(i-n)<=s.a*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=s.a*Math.max(1,Math.abs(r),Math.abs(o))},len:x,sub:T,mul:v,div:O,dist:w,sqrDist:S,sqrLen:E})},166:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const s=new(i(52).a)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},202:function(e,t,i){"use strict";function s(){return new Float32Array(2)}function r(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function n(){return s()}function o(){return r(1,1)}function a(){return r(1,0)}function c(){return r(0,1)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}));const l=n(),u=o(),h=a(),d=c();Object.freeze({__proto__:null,create:s,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:r,createView:function(e,t){return new Float32Array(e,t,2)},zeros:n,ones:o,unitX:a,unitY:c,ZEROS:l,ONES:u,UNIT_X:h,UNIT_Y:d})},203:function(e,t,i){"use strict";var s=i(1),r=i(70);class n{constructor(e,t,i=null){this._context=null,this._glName=null,this.id=o++,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,e.instanceCounter.increment(0,this),this._context=e,this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){if(this._context&&this._context.gl){if(this._glName){const e=this._context.gl;this._boundToUnits.forEach(e=>{this._context.bindTexture(null,e)}),e.deleteTexture(this._glName),this._glName=null}this._context.instanceCounter.decrement(0,this),this._context=null}}release(){this.dispose()}resize(e,t){const i=this._descriptor;i.width===e&&i.height===t||(i.width=e,i.height=t,this.setData(null))}setData(e){if(!this._context||!this._context.gl)return;const t=this._context.gl;this._glName||(this._glName=t.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const i=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const r=this._descriptor;n._validateTexture(r),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipped?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.preMultiplyAlpha?1:0);const o=r.pixelFormat;let a=r.internalFormat?r.internalFormat:o;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let i=e.width,s=e.height;e instanceof HTMLVideoElement&&(i=e.videoWidth,s=e.videoHeight),r.width&&r.height&&console.assert(i===r.width&&s===r.height),t.texImage2D(t.TEXTURE_2D,0,a,o,r.dataType,e),r.hasMipmap&&this.generateMipmap(),void 0===r.width&&(r.width=i),void 0===r.height&&(r.height=s)}else{null!=r.width&&null!=r.height||console.error("Width and height must be specified!"),t.DEPTH24_STENCIL8&&a===t.DEPTH_STENCIL&&(a=t.DEPTH24_STENCIL8);let i=r.width,n=r.height;if(function(e){return Object(s.g)(e)&&"type"in e&&"compressed"===e.type}(e)){const s=Math.round(Math.log(Math.max(i,n))/Math.LN2)+1;r.hasMipmap=r.hasMipmap&&s===e.levels.length;for(let s=0;;++s){const o=e.levels[Math.min(s,e.levels.length-1)];if(t.compressedTexImage2D(t.TEXTURE_2D,s,a,i,n,0,o),1===i&&1===n||!r.hasMipmap)break;i=Math.max(1,i>>1),n=Math.max(1,n>>1)}}else if(Object(s.g)(e))t.texImage2D(t.TEXTURE_2D,0,a,i,n,0,o,r.dataType,e),r.hasMipmap&&this.generateMipmap();else for(let e=0;t.texImage2D(t.TEXTURE_2D,e,a,i,n,0,o,r.dataType,null),(1!==i||1!==n)&&r.hasMipmap;++e)i=Math.max(1,i>>1),n=Math.max(1,n>>1)}n._applySamplingMode(t,this._descriptor),n._applyWrapMode(t,this._descriptor),n._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(i,0)}updateData(e,t,i,s,r,n){n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,a=this._descriptor,c=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||i<0||s>a.width||r>a.height||t+s>a.width||i+r>a.height)&&console.error("An attempt to update out of bounds of the texture!"),o.pixelStorei(o.UNPACK_ALIGNMENT,a.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0),n instanceof ImageData||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement?o.texSubImage2D(o.TEXTURE_2D,e,t,i,a.pixelFormat,a.dataType,n):o.texSubImage2D(o.TEXTURE_2D,e,t,i,s,r,a.pixelFormat,a.dataType,n),this._context.bindTexture(c,0)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,n._validateTexture(e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(t,0)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,n._validateTexture(this._descriptor),this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,n._validateTexture(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(n._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(n._applyWrapMode(e,t),this._wrapModeDirty=!1)}setBoundToUnit(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)}static _validateTexture(e){(e.width<0||e.height<0)&&console.error("Negative dimension parameters are not allowed!"),Object(r.f)(e.width)&&Object(r.f)(e.height)||("number"==typeof e.wrapMode?33071!==e.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===e.wrapMode.s&&33071===e.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,s=t.samplingMode;9985===i||9987===i?(i=9729,t.hasMipmap||(s=9729)):9984!==i&&9986!==i||(i=9728,t.hasMipmap||(s=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){if(null==t.maxAnisotropy)return;const i=e.capabilities.textureFilterAnisotropic;if(!i)return;const s=e.gl;s.texParameterf(s.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}let o=0;t.a=n},207:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return T})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return y})),i.d(t,"h",(function(){return b}));i(7);var s=i(3),r=i(14),n=(i(70),i(68),i(379),i(203),i(352),i(436),i(124)),o=(i(147),i(21));class a{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,i,s,r,n,o,a,c){this.color=e,this.haloColor=t,this.haloSize=i,this.size=s,this.angle=r,this.offsetX=n,this.offsetY=o,this.hAnchor=a,this.vAnchor=c}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}a.pool=new o.a(a);const c=s.a.getLogger("esri.views.2d.engine.webgl.Utils");function l(e){const t={};for(const i of e)t[i.name]=i.strideInBytes;return t}const u=l([{name:"geometry",strideInBytes:32,divisor:0}]),h=l([{name:"geometry",strideInBytes:32,divisor:0}]),d=l([{name:"geometry",strideInBytes:12,divisor:0}]),f=l([{name:"geometry",strideInBytes:36,divisor:0}]),_=l([{name:"geometry",strideInBytes:32,divisor:0}]),p=l([{name:"geometry",strideInBytes:36,divisor:0}]);function g(e,t){switch(e){case n.b.MARKER:return u;case n.b.FILL:return t?d:h;case n.b.LINE:return f;case n.b.TEXT:return _;case n.b.LABEL:return p}}function b(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function m(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function y(e){return"number"==typeof e}function x(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return c.error(new r.a("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function T(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return c.error(new r.a("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function v(e){switch(e){case"opacity":return n.a.OPACITY;case"color":return n.a.COLOR;case"rotation":return n.a.ROTATION;case"size":return n.a.SIZE;default:return c.error("Cannot interpret unknown vv: "+e),null}}function O(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void c.error(new r.a("webgl-utils","Unable to handle type "+e))}}new Map},211:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o}));var s=i(70),r=i(73),n=i(76);function o(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],s=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(Math.max(t,i),s))}function a(e,t){const i=Object(n.m)(e),r=Object(s.b)(e[2]/i),o=Math.atan2(e[1]/i,e[0]/i);return Object(n.r)(t,i,r,o),t}function c(e,t,i){const s=i[0]-t[0],r=i[1]-t[1],n=i[2]-t[2];let o=s*s+r*r+n*n;return o?(o=1/Math.sqrt(o),e[0]=s*o,e[1]=r*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}class l{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,s=0,r=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),r&&i===t&&(i=e),i+s}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return Object(s.c)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,s=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}Object(r.e)(),Object(r.e)();function u(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}u(new l(0,2*Math.PI)),u(new l(-Math.PI,Math.PI));const h=u(new l(0,360));Object(r.e)(),Object(r.e)(),Object(r.e)()},213:function(e,t,i){"use strict";var s=i(21);class r{constructor(e,t,i,s){this.set(e,t,i,s)}static getId(e,t,i,s){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${i}/${s}`}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}acquire(e,t,i,s){this.set(e,t,i,s)}contains(e){const t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new r(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,i,s){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,i,s,r]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(i),this.col=parseFloat(s),this.world=parseFloat(r)}else this.level=+e,this.row=+t,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new r(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,t=this.row<<1,i=this.col<<1,s=this.world;return[new r(e,t,i,s),new r(e,t,i+1,s),new r(e,t+1,i,s),new r(e,t+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}r.pool=new s.a(r,null,null,25,50),t.a=r},243:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var s=i(18),r=i(8),n=i(20),o=i(19),a=i(38),c=i(33),l=i(25),u=i(79),h=i(36);let d=class extends l.a{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new u.a,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i,s=0){const r=0!=(1&s),n=++this.handleId;r||this.installSyncUpdatingWatch(e,t,n);const o=0!=(2&s)?Object(h.a)(e,t,i,r):e.watch(t,i,r);return this.handles.add(o,n),{remove:()=>{this.handles.remove(n)}}}addOnCollectionPropertyChange(e,t,i,s=0){const r=0!=(2&s),n=++this.handleId;return this.handles.add([Object(h.b)(e,t,"after-changes",this.createSyncUpdatingCallback()),Object(h.b)(e,t,"change",i,r?e=>{i({added:e.items,removed:[],moved:[],target:e})}:void 0)],n),{remove:()=>{this.handles.remove(n)}}}addOnCollectionChange(e,t,i=0){const s=0!=(2&i),r=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],r),s&&t({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(r)}}}addPromise(e){if(!e)return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(f)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(e,t,i){const s=this.createSyncUpdatingCallback(),n=Object(c.a)(()=>Object(r.c)(e,t),s);return this.handles.add(n,i),n}createSyncUpdatingCallback(){return()=>{this.handles.remove(f),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Object(a.b)(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(f))}),f)}}};Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"updating",void 0),d=Object(s.a)([Object(o.a)("esri.views.support.WatchUpdatingTracking")],d);const f=-42},244:function(e,t,i){"use strict";function s(){return[0,0]}function r(e,t){return[e,t]}function n(e,t){return new Float64Array(e,t,2)}function o(){return r(1,1)}function a(){return r(1,0)}function c(){return r(0,1)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r}));const l=o(),u=a(),h=c();Object.freeze({__proto__:null,create:s,clone:function(e){return[e[0],e[1]]},fromValues:r,fromArray:function(e){const t=[0,0],i=Math.min(2,e.length);for(let s=0;s<i;++s)t[s]=e[s];return t},createView:n,zeros:function(){return[0,0]},ones:o,unitX:a,unitY:c,ZEROS:[0,0],ONES:l,UNIT_X:u,UNIT_Y:h})},245:function(e,t,i){"use strict";function s(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function r(e,t,i,s){const r=t[s],n=t[s+1];e[s]=i[0]*r+i[2]*n+i[4],e[s+1]=i[1]*r+i[3]*n+i[5]}function n(e,t,i,s=0,n=0,o=2){const a=n||t.length/o;for(let n=s;n<a;n++)r(e,t,i,n*o)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,create:s,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fromValues:function(e,t,i,s,r,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=s,o[4]=r,o[5]=n,o},createView:function(e,t){return new Float32Array(e,t,6)},transform:r,transformMany:n})},246:function(e,t,i){"use strict";function s(e,t,i=32774,s=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:s[0],g:s[1],b:s[2],a:s[3]}}}function r(e,t,i,s,r=32774,n=32774,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:s,opRgb:r,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}i.d(t,"a",(function(){return N})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return r})),i.d(t,"f",(function(){return s}));const n={zNear:0,zFar:1},o={r:!0,g:!0,b:!0,a:!0};function a(e){return m.intern(e)}function c(e){return x.intern(e)}function l(e){return v.intern(e)}function u(e){return w.intern(e)}function h(e){return E.intern(e)}function d(e){return I.intern(e)}function f(e){return M.intern(e)}function _(e){return R.intern(e)}function p(e){return D.intern(e)}class g{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function b(e){return"["+e.join(",")+"]"}const m=new g(y,e=>({__tag:"Blending",...e}));function y(e){return e?b([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const x=new g(T,e=>({__tag:"Culling",...e}));function T(e){return e?b([e.face,e.mode]):null}const v=new g(O,e=>({__tag:"PolygonOffset",...e}));function O(e){return e?b([e.factor,e.units]):null}const w=new g(S,e=>({__tag:"DepthTest",...e}));function S(e){return e?b([e.func]):null}const E=new g(F,e=>({__tag:"StencilTest",...e}));function F(e){return e?b([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const I=new g(j,e=>({__tag:"DepthWrite",...e}));function j(e){return e?b([e.zNear,e.zFar]):null}const M=new g(A,e=>({__tag:"ColorWrite",...e}));function A(e){return e?b([e.r,e.g,e.b,e.a]):null}const R=new g(C,e=>({__tag:"StencilWrite",...e}));function C(e){return e?b([e.mask]):null}const D=new g((function(e){return e?b([y(e.blending),T(e.culling),O(e.polygonOffset),S(e.depthTest),F(e.stencilTest),j(e.depthWrite),A(e.colorWrite),C(e.stencilWrite)]):null}),e=>({blending:a(e.blending),culling:c(e.culling),polygonOffset:l(e.polygonOffset),depthTest:u(e.depthTest),stencilTest:h(e.stencilTest),depthWrite:d(e.depthWrite),colorWrite:f(e.colorWrite),stencilWrite:_(e.stencilWrite)}));class N{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(e,t,i,s){return(i||e!==t)&&(s(e),this._pipelineInvalid=!0),e}}},252:function(e,t,i){"use strict";function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function r(e){return null!=e&&!isNaN(e)&&isFinite(e)}function n(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}function o(e,t){const i=t||n(e),s=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return r}))},290:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return c})),i.d(t,"g",(function(){return r}));var s=i(118);function r(e,t,i,s,r,n,o,a,c,l){return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e[4]=n,e[5]=o,e[6]=a,e[7]=c,e[8]=l,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function o(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=i[0],f=i[1],_=i[2],p=i[3],g=i[4],b=i[5],m=i[6],y=i[7],x=i[8];return e[0]=d*s+f*o+_*l,e[1]=d*r+f*a+_*u,e[2]=d*n+f*c+_*h,e[3]=p*s+g*o+b*l,e[4]=p*r+g*a+b*u,e[5]=p*n+g*c+b*h,e[6]=m*s+y*o+x*l,e[7]=m*r+y*a+x*u,e[8]=m*n+y*c+x*h,e}function a(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=i[0],f=i[1];return e[0]=s,e[1]=r,e[2]=n,e[3]=o,e[4]=a,e[5]=c,e[6]=d*s+f*o+l,e[7]=d*r+f*a+u,e[8]=d*n+f*c+h,e}function c(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=Math.sin(i),f=Math.cos(i);return e[0]=f*s+d*o,e[1]=f*r+d*a,e[2]=f*n+d*c,e[3]=f*o-d*s,e[4]=f*a-d*r,e[5]=f*c-d*n,e[6]=l,e[7]=u,e[8]=h,e}function l(e,t){const i=t[0],s=t[1],r=t[2],n=t[4],o=t[5],a=t[6],c=t[8],l=t[9],u=t[10],h=u*o-a*l,d=-u*n+a*c,f=l*n-o*c,_=i*h+s*d+r*f;if(!_)return null;const p=1/_;return e[0]=h*p,e[1]=(-u*s+r*l)*p,e[2]=(a*s-r*o)*p,e[3]=d*p,e[4]=(u*i-r*c)*p,e[5]=(-a*i+r*n)*p,e[6]=f*p,e[7]=(-l*i+s*c)*p,e[8]=(o*i-s*n)*p,e}function u(e,t){const i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],d=t[10],f=t[11],_=t[12],p=t[13],g=t[14],b=t[15],m=i*a-s*o,y=i*c-r*o,x=i*l-n*o,T=s*c-r*a,v=s*l-n*a,O=r*l-n*c,w=u*p-h*_,S=u*g-d*_,E=u*b-f*_,F=h*g-d*p,I=h*b-f*p,j=d*b-f*g;let M=m*j-y*I+x*F+T*E-v*S+O*w;return M?(M=1/M,e[0]=(a*j-c*I+l*F)*M,e[1]=(c*E-o*j-l*S)*M,e[2]=(o*I-a*E+l*w)*M,e[3]=(r*I-s*j-n*F)*M,e[4]=(i*j-r*E+n*S)*M,e[5]=(s*E-i*I-n*w)*M,e[6]=(p*O-g*v+b*T)*M,e[7]=(g*x-_*O-b*y)*M,e[8]=(_*v-p*x+b*m)*M,e):null}function h(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}let d=o,f=h;Object.freeze({__proto__:null,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:r,identity:n,transpose:function(e,t){if(e===t){const i=t[1],s=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=s,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){const i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,d=-u*n+a*c,f=l*n-o*c;let _=i*h+s*d+r*f;return _?(_=1/_,e[0]=h*_,e[1]=(-u*s+r*l)*_,e[2]=(a*s-r*o)*_,e[3]=d*_,e[4]=(u*i-r*c)*_,e[5]=(-a*i+r*n)*_,e[6]=f*_,e[7]=(-l*i+s*c)*_,e[8]=(o*i-s*n)*_,e):null},adjoint:function(e,t){const i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return e[0]=o*u-a*l,e[1]=r*l-s*u,e[2]=s*a-r*o,e[3]=a*c-n*u,e[4]=i*u-r*c,e[5]=r*n-i*a,e[6]=n*l-o*c,e[7]=s*c-i*l,e[8]=i*o-s*n,e},determinant:function(e){const t=e[0],i=e[1],s=e[2],r=e[3],n=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*n-o*c)+i*(-l*r+o*a)+s*(c*r-n*a)},multiply:o,translate:a,rotate:c,scale:function(e,t,i){const s=i[0],r=i[1],n=i[2];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e},scaleByVec2:function(e,t,i){const s=i[0],r=i[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){const i=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=i,e[2]=0,e[3]=-i,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){const i=t[0],s=t[1],r=t[2],n=t[3],o=i+i,a=s+s,c=r+r,l=i*o,u=s*o,h=s*a,d=r*o,f=r*a,_=r*c,p=n*o,g=n*a,b=n*c;return e[0]=1-h-_,e[3]=u-b,e[6]=d+g,e[1]=u+b,e[4]=1-l-_,e[7]=f-p,e[2]=d-g,e[5]=f+p,e[8]=1-l-h,e},normalFromMat4Legacy:l,normalFromMat4:u,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},subtract:h,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e[3]=t[3]+i[3]*s,e[4]=t[4]+i[4]*s,e[5]=t[5]+i[5]*s,e[6]=t[6]+i[6]*s,e[7]=t[7]+i[7]*s,e[8]=t[8]+i[8]*s,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=t[0],f=t[1],_=t[2],p=t[3],g=t[4],b=t[5],m=t[6],y=t[7],x=t[8];return Math.abs(i-d)<=s.a*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=s.a*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-_)<=s.a*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(o-p)<=s.a*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-g)<=s.a*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(c-b)<=s.a*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(l-m)<=s.a*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(u-y)<=s.a*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-x)<=s.a*Math.max(1,Math.abs(h),Math.abs(x))},mul:d,sub:f})},291:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return a})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return l}));var s=i(118);function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function n(e,t){const i=t[0],s=t[1],r=t[2],n=t[3],o=t[4],a=t[5];let c=i*n-s*r;return c?(c=1/c,e[0]=n*c,e[1]=-s*c,e[2]=-r*c,e[3]=i*c,e[4]=(r*a-n*o)*c,e[5]=(s*o-i*a)*c,e):null}function o(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=i[0],u=i[1],h=i[2],d=i[3],f=i[4],_=i[5];return e[0]=s*l+n*u,e[1]=r*l+o*u,e[2]=s*h+n*d,e[3]=r*h+o*d,e[4]=s*f+n*_+a,e[5]=r*f+o*_+c,e}function a(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=Math.sin(i),u=Math.cos(i);return e[0]=s*u+n*l,e[1]=r*u+o*l,e[2]=s*-l+n*u,e[3]=r*-l+o*u,e[4]=a,e[5]=c,e}function c(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=i[0],u=i[1];return e[0]=s*l,e[1]=r*l,e[2]=n*u,e[3]=o*u,e[4]=a,e[5]=c,e}function l(e,t,i){const s=t[0],r=t[1],n=t[2],o=t[3],a=t[4],c=t[5],l=i[0],u=i[1];return e[0]=s,e[1]=r,e[2]=n,e[3]=o,e[4]=s*l+n*u+a,e[5]=r*l+o*u+c,e}function u(e,t){const i=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=i,e[2]=-i,e[3]=s,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}let f=o,_=d;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:r,set:function(e,t,i,s,r,n,o){return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e[4]=n,e[5]=o,e},invert:n,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:o,rotate:a,scale:c,translate:l,fromRotation:u,fromScaling:h,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:d,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e[3]=t[3]+i[3]*s,e[4]=t[4]+i[4]*s,e[5]=t[5]+i[5]*s,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],c=e[5],l=t[0],u=t[1],h=t[2],d=t[3],f=t[4],_=t[5];return Math.abs(i-l)<=s.a*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=s.a*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-h)<=s.a*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-d)<=s.a*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=s.a*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(c-_)<=s.a*Math.max(1,Math.abs(c),Math.abs(_))},mul:f,sub:_})},292:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i(59),r=(i(58),i(119)),n=i(98),o=i(210);let a=0;class c{constructor(e){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._joined=[],this.instance=e}static createInstance(){return a++,a=a>65535?0:a,a}get _hasFilter(){return-1!==this._xmin}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t){const i=this.copy();return i._tx=e,i._ty=t,i}extent(e,t,i,s){const r=this.copy();return r._xmin=e,r._xmax=i,r._ymin=t,r._ymax=s,r}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){const i=this._readAttribute(e,t);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const s=i._readAttribute(e,t);if(void 0!==s)return s}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=Object(n.h)(e,this.geometryType,this.hasZ,this.hasM),i=Object(s.a)(t);return i.spatialReference=this._arcadeSpatialReference,i}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=this.getQuantizationTransform();return Object(o.a)(new r.a,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},352:function(e,t,i){"use strict";i(7);var s=i(3),r=i(203);let n=0;var o=class{constructor(e,t){this._context=e,this._desc=t,this.id=++n,this._context.instanceCounter.increment(5,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,t.internalFormat,t.width,t.height)}get descriptor(){return this._desc}resize(e,t){const i=this._desc;if(i.width===e&&i.height===t)return;i.width=e,i.height=t;const s=this._context.gl;this._context.bindRenderbuffer(this),s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(5,this),this._context=null)}};const a=s.a.getLogger("esri.views.webgl.FrameBufferObject");class c{constructor(e,t,i,s){if(this._context=null,this._glName=null,this.id=l++,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,e.instanceCounter.increment(4,this),this._context=e,this._desc={...t},i){let t;var n;if(Array.isArray(i))for(const s of i){const{attachmentPoint:i,texture:n}=s,o=n instanceof r.a?n:new r.a(e,n);t=o.descriptor,this._colorAttachments.set(i,o),this._validateColorAttachmentPoint(i),this._validateTextureDimensions(t,this._desc)}else i instanceof r.a?(t=i.descriptor,this._colorAttachments.set(36064,i)):(t=i,this._colorAttachments.set(36064,new r.a(e,i))),0!==(null==(n=this._desc)?void 0:n.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateTextureDimensions(t,this._desc)}if(s instanceof o){var a;const e=null!=(a=this._desc.depthStencilTarget)?a:3;2===e?this._stencilAttachment=s:1===e||3===e?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),c._validateBufferDimensions(s.descriptor,this._desc)}else if(s){let e;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),s instanceof r.a?(this._depthStencilTexture=s,e=this._depthStencilTexture.descriptor):(e=s,this._depthStencilTexture=new r.a(this._context,e)),this._validateTextureDimensions(e,this._desc)}}dispose(){if(!this._context)return;const e=this._context,t=e.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(e.gl.deleteFramebuffer(this._glName),this._glName=null),e.bindFramebuffer(t),e.instanceCounter.decrement(4,this),this._context=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(36064);return e&&e instanceof r.a?e:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&t instanceof r.a?t:null}attachColorTexture(e,t=36064){if(!e)return;this._validateColorAttachmentPoint(t);const i=e.descriptor;if(this._validateTextureDimensions(i,this._desc),this._disposeColorAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e.glName,0)}this._colorAttachments.set(t,e)}detachColorTexture(e=36064){const t=this._colorAttachments.get(e);if(t instanceof r.a){const i=t;if(this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,null,0)}return this._colorAttachments.delete(e),i}}attachDepthStencilTexture(e){if(!e)return;const t=e.descriptor;if(34041!==t.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==t.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(t,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,e.glName,0)}this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(!e)return;const t=e.descriptor;if(34041!==t.internalFormat&&33189!==t.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),c._validateBufferDimensions(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===t.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,i=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}copyToTexture(e,t,i,s,r,n,o){(e<0||t<0||r<0||n<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const a=this._desc,c=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+i>a.width||t+s>a.height||r+i>c.width||n+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const l=this._context;l.bindTexture(o,0),l.bindFramebuffer(this),l.gl.copyTexSubImage2D(3553,0,r,n,e,t,i,s)}readPixels(e,t,i,s,r,n,o){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,i,s,r,n,o)}resize(e,t){const i=this._desc;if(i.width!==e||i.height!==t){if(!this._initialized)return i.width=e,i.height=t,this._colorAttachments.forEach(i=>{i&&i.resize(e,t)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));i.width=e,i.height=t,this._colorAttachments.forEach(i=>{i&&i.resize(e,t)}),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initialize(){var e,t,i,s;if(this._initialized)return!1;const n=this._context,a=n.gl;this._glName&&a.deleteFramebuffer(this._glName);const c=a.createFramebuffer(),l=this._desc,h=null!=(e=l.colorTarget)?e:1,d=null!=(t=l.width)?t:1,f=null!=(i=l.height)?i:1;if(a.bindFramebuffer(a.FRAMEBUFFER,c),0===this._colorAttachments.size)if(0===h)this._colorAttachments.set(36064,u(n,l));else{const e=new o(n,{internalFormat:32854,width:d,height:f});this._colorAttachments.set(36064,e)}this._colorAttachments.forEach((e,t)=>{e&&(e instanceof r.a?a.framebufferTexture2D(a.FRAMEBUFFER,t,a.TEXTURE_2D,e.glName,0):a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,e.glName))});const _=null!=(s=l.depthStencilTarget)?s:0;switch(_){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new o(n,{internalFormat:1===l.depthStencilTarget?33189:34041,width:d,height:f}));const e=1===_?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;a.framebufferRenderbuffer(a.FRAMEBUFFER,e,a.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new o(n,{internalFormat:36168,width:d,height:f})),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){n.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const e={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d,height:f};this._depthStencilTexture=new r.a(n,e)}a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}return this._glName=c,this._initialized=!0,!0}_disposeColorAttachments(){this._colorAttachments.forEach((e,t)=>{if(e instanceof r.a){if(this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,null,0)}e.dispose()}else if(e instanceof WebGLRenderbuffer){const i=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(e)}}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}static _validateBufferDimensions(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateTextureDimensions(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateColorAttachmentPoint(e){if(-1===c._MAX_COLOR_ATTACHMENTS){const e=this._context.capabilities.drawBuffers;if(e){const t=this._context.gl;c._MAX_COLOR_ATTACHMENTS=t.getParameter(e.MAX_COLOR_ATTACHMENTS)}else c._MAX_COLOR_ATTACHMENTS=1}const t=e-36064;t+1>c._MAX_COLOR_ATTACHMENTS&&a.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${c._MAX_COLOR_ATTACHMENTS} color attachments`)}}c._MAX_COLOR_ATTACHMENTS=-1;let l=0;const u=(e,t)=>new r.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height});t.a=c},374:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return T})),i.d(t,"c",(function(){return x}));var s=i(14),r=i(152),n=i(119);function o(e){const t=[];return e.forEach(e=>t.push(e)),t}const a={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*c(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*l(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function u(e){for(;;){const{value:t,done:i}=e.next();if(i)return!1;if(t.length>2)return!0}}function h(e){let t=0;for(let i=0;i<e.length;i++){const s=e[i],r=e[(i+1)%e.length];t+=s[0]*r[1]-r[0]*s[1]}return t<=0}function d(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]||e.push(t),e}function f(e,t,i){switch(t.type){case"LineString":return function(e,t,i){return g(e,t.coordinates,i),e}(e,t,i);case"MultiLineString":return function(e,t,i){for(const s of t.coordinates)g(e,s,i);return e}(e,t,i);case"MultiPoint":return function(e,t,i){return g(e,t.coordinates,i),e}(e,t,i);case"MultiPolygon":return function(e,t,i){for(const s of t.coordinates){_(e,s[0],i);for(let t=1;t<s.length;t++)p(e,s[t],i)}return e}(e,t,i);case"Point":return function(e,t,i){return m(e,t.coordinates,i),e}(e,t,i);case"Polygon":return function(e,t,i){const s=t.coordinates;_(e,s[0],i);for(let t=1;t<s.length;t++)p(e,s[t],i);return e}(e,t,i)}}function _(e,t,i){const s=d(t);h(s)?g(e,s,i):b(e,s,i)}function p(e,t,i){const s=d(t);h(s)?b(e,s,i):g(e,s,i)}function g(e,t,i){for(const s of t)m(e,s,i);e.lengths.push(t.length)}function b(e,t,i){for(let s=t.length-1;s>=0;s--)m(e,t[s],i);e.lengths.push(t.length)}function m(e,t,i){const[s,r,n]=t;e.coords.push(s,r),i.hasZ&&e.coords.push(n||0)}function y(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function x(e){if(!e)throw new s.a("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new s.a("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const i="string"==typeof t?t:"name"===t.type?t.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!i||!r.test(i))throw new s.a("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function T(e,t={}){const i=c(e),s=[],r=new Set,n=new Set;let h=!1,d=Number.NEGATIVE_INFINITY,f=null,_=!1,p=void 0,{geometryType:g=null}=t,b=!1;for(;;){const{value:e,done:t}=i.next();if(t){const e=f&&1===f.length&&f[0]||null;if(e)for(const t of s)t.name===e&&(t.type="esriFieldTypeOID");return{fields:s,geometryType:g,hasZ:h,maxObjectId:Math.max(0,d),objectIdFieldName:e,objectIdFieldType:p,unknownFields:o(n)}}const{geometry:c,properties:m,id:x}=e;if((!c||(g||(g=a[c.type]),a[c.type]===g))&&(h||(h=u(l(c))),_||(_=null!=x,_&&(p=typeof x,"number"===p&&(f=Object.keys(m).filter(e=>m[e]===x)))),_&&"number"===p&&null!=x&&(d=Math.max(d,x),f.length>1?f=f.filter(e=>m[e]===x):1===f.length&&(f=m[f[0]]===x?f:[])),!b&&m)){let e=!0;for(const t in m){if(r.has(t))continue;const i=m[t];if(null==i){e=!1,n.add(t);continue}const o=y(i);"unknown"!==o?(n.delete(t),r.add(t),s.push({name:t,alias:t,type:o})):n.add(t)}b=e}}}function v(e,t){return function(e){const t=[];for(;;){const{value:i,done:s}=e.next();if(s)return t;t.push(i)}}(function*(e,t={}){const{geometryType:i,objectIdFieldName:s}=t;for(;;){const{value:o,done:c}=e.next();if(c)return;const{geometry:l,properties:u,id:h}=o;if(l&&a[l.type]!==i)continue;const d=u||{};s&&null!=h&&!d[s]&&(d[s]=h);const _=new r.a(l?f(new n.a,l,t):null,d);yield _}}(c(e),t))}},378:function(e,t,i){"use strict";var s=i(1);t.a=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(Object(s.c)(e)),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(t=>{e(t)||this._items.delete(t)}),this}}},379:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n}));var s=i(61),r=Object(s.b)((function(e){var t;void 0!==(t=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(e.exports=t)})),n=Object(s.b)((function(e){var t;void 0!==(t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"])&&(e.exports=t)})),o=Object(s.b)((function(e){var t;void 0!==(t=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"])&&(e.exports=t)}))},436:function(e,t,i){"use strict";i(7);var s=i(1),r=i(246);class n{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Map;this._current.length<6;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e])}decrement(e,t){--this._current[e]}get max(){return this._max}get current(){return this._current}printResourceCount(){if(console.log("Live objects:"),console.log("Textures: "+this._current[0]),console.log("Buffers: "+this._current[1]),console.log("VAOs: "+this._current[2]),console.log("Programs: "+this._current[3]),console.log("Framebuffers: "+this._current[4]),console.log("Renderbuffers: "+this._current[5]),this._allocations.size>0){console.log(this._allocations.size+" live object allocations:");const e=new Map;this._allocations.forEach(t=>{var i;e.set(t,(null!=(i=e.get(t))?i:0)+1)}),e.forEach((e,t)=>console.log(e," : ",t))}}}var o=i(123);class a{constructor(e,t,i,s,r,n,o,a){this.createQuery=e,this.resultAvailable=t,this.getResult=i,this.disjoint=s,this.beginTimeElapsed=r,this.endTimeElapsed=n,this.createTimestamp=o,this.timestampBits=a}}function c(e,t){const i=t&&t.disabledExtensions||{},s=t&&t.debugWebGLExtensions||{};let r,n,c,u,h,d,f,_,p,g,b=null,m=null,y=null,x=null;return{get drawBuffers(){return g||(g=function(e,t){if(t.disjointTimerQuery)return null;if(Object(o.a)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(e,i)),g},get instancing(){return r||(r=function(e){if(Object(o.a)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(e)),r},get vao(){return n||(n=function(e,t){if(Object(o.a)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}(e,i)),n},get compressedTextureS3TC(){return c||(c=function(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,i)),c},get textureFilterAnisotropic(){return u||(u=function(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,i)),u},get disjointTimerQuery(){return h||(h=function(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Object(o.a)(e)?new a(()=>e.createQuery(),t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE),t=>e.getQueryParameter(t,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),t=>e.beginQuery(i.TIME_ELAPSED_EXT,t),()=>e.endQuery(i.TIME_ELAPSED_EXT),e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new a(()=>i.createQueryEXT(),e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),e=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,e),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}(e,i)),h},get textureFloat(){return d||(d=function(e,t){if(Object(o.a)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}(e,i)),d},get colorBufferFloat(){return f||(f=function(e,t){if(Object(o.a)(e)){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),s=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");return i||s?{textureFloat:!!s,textureHalfFloat:!!i,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),s=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return i||s?{textureFloat:!!s,textureHalfFloat:!!i,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:s?s.RGBA32F_EXT:void 0}:null}return null}(e,i)),f},get blendMinMax(){return _||(_=function(e,t){if(Object(o.a)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}(e,i)),_},get depthTexture(){return null===b&&(b=l(e,i,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),b},get standardDerivatives(){return null===m&&(m=l(e,i,"standardDerivatives",!0,["OES_standard_derivatives"])),m},get shaderTextureLOD(){return null===y&&(y=l(e,i,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),y},get fragDepth(){return null===x&&(x=l(e,i,"fragDepth",!0,["EXT_frag_depth"])),x},get loseContext(){return p||(p=function(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(e,s)),p}}}function l(e,t,i,s,r){if(s&&Object(o.a)(e))return!0;if(t[i])return!1;for(const t of r)if(e.getExtension(t))return!0;return!1}class u{constructor(e,t){this.gl=null,this.instanceCounter=new n,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=Object(o.a)(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=c(e,t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new r.a({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState()}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){if(!this._parameters){const e=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:e?this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters}dispose(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},this.gl=null,this._capabilities=null}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}setBlendColor(e,t,i,s){e===this._blendColorState.r&&t===this._blendColorState.g&&i===this._blendColorState.b&&s===this._blendColorState.a||(this.gl.blendColor(e,t,i,s),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=i,this._blendColorState.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,s){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===i&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===s||(this.gl.blendFuncSeparate(e,t,i,s),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=i,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,s){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===i&&this._colorMaskState.a===s||(this.gl.colorMask(e,t,i,s),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=i,this._colorMaskState.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,s){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===i&&this._clearColor.a===s||(this.gl.clearColor(e,t,i,s),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=i,this._clearColor.a=s)}setFaceCullingEnabled(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}setScissorRect(e,t,i,s){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===i&&this._scissorRect.height===s||(this.gl.scissor(e,t,i,s),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=i,this._scissorRect.height=s)}setDepthTestEnabled(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}setDepthFunction(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}setStencilFunction(e,t,i){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,s){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===i&&this._stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,t,i,s),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=i,this._stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,s){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===i&&this._stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,t,i,s),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=i,this._stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e){const t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(33984+e),this._activeTextureUnit=e),t}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,i){this.gl.drawArrays(e,t,i)}drawElements(e,t,i,s){5123!==i?5125===i&&this.gl.drawElements(e,t,i,s):this.gl.drawElements(e,t,i,s)}logIno(){}get capabilities(){return this._capabilities}setViewport(e,t,i,s){const r=this._viewport;r.x===e&&r.y===t&&r.width===i&&r.height===s||(r.x=e,r.y=t,r.width=i,r.height=s,this.gl.viewport(e,t,i,s))}getViewport(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}bindProgram(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)}bindTexture(e,t){-1===u._MAX_TEXTURE_IMAGE_UNITS&&(u._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),(t>=u._MAX_TEXTURE_IMAGE_UNITS||t<0)&&console.error("Input texture unit is out of range of available units!");const i=this._textureUnitMap[t];if(this.setActiveTexture(t),null==e||null==e.glName)return null!=i&&(this.gl.bindTexture(i.descriptor.target,null),i.setBoundToUnit(t,!1)),void(this._textureUnitMap[t]=null);i&&i.id===e.id?e.applyChanges():(i&&i.setBoundToUnit(t,!1),this.gl.bindTexture(e.descriptor.target,e.glName),e.setBoundToUnit(t,!0),e.applyChanges(),this._textureUnitMap[t]=e)}bindFramebuffer(e){if(Object(s.f)(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)}bindBuffer(e){e&&(34962===e.bufferType?this._activeVertexBuffer=u._bindBuffer(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=u._bindBuffer(this.gl,e,e.bufferType,this._activeIndexBuffer))}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}unbindBuffer(e){34962===e?this._activeVertexBuffer=u._bindBuffer(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=u._bindBuffer(this.gl,null,e,this._activeIndexBuffer)}bindVAO(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)}getBoundTexture(e){return this._textureUnitMap[e]}getBoundFramebufferObject(){return this._activeFramebuffer}getBoundVAO(){return this._activeVertexArrayObject}resetState(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(let t=0;t<this.parameters.maxVertexAttributes;t++)e.disableVertexAttribArray(t);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){const e=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(e)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(let t=0;t<this.parameters.maxTextureImageUnits;t++){e.activeTexture(33984+t),e.bindTexture(3553,null);const i=this._textureUnitMap[t];i&&e.bindTexture(i.descriptor.target,i.glName)}e.activeTexture(33984+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)}static _bindBuffer(e,t,i,s){return t?s!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}}u._MAX_TEXTURE_IMAGE_UNITS=-1},451:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i(3),r=i(14),n=i(124),o=i(207);const a=s.a.getLogger("esri.views.2d.engine.webgl");function c(e){return Object(o.g)(e.minDataValue)&&Object(o.g)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?n.c.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?n.c.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?n.c.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?n.c.SIZE_UNIT_VALUE:(a.error(new r.a("mapview-bad-type","Found invalid size VisualVariable",e)),n.c.NONE)}},452:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u}));var s=i(1),r=i(102),n=i(131),o=i(209),a=i(524);function c(e){return(4294901760&e)>>>16}function l(e){return 65535&e}const u={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class h extends a.a{constructor(e,t){super(e,t),this.featureAdapter=u,this.events=new r.a,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._index=Object(o.a)(9,e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))}get storeStatistics(){return{featureCount:0,vertexCount:0}}onTileData(e,t,i){if(Object(s.f)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=i,t.addOrUpdate._storage=i;const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getObjectId(),s=r.instance<<16|r.getIndex();let n=this._objectIdToDisplayId.get(t);n||(n=i.createDisplayId(),this._objectIdToDisplayId.set(t,n),this._spatialIndexInvalid=!0),r.setDisplayId(n),i.setInstanceId(n,s),this.setComputedAttributes(i,r,n,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t}forEach(e){this._objectIdToDisplayId.forEach(t=>{const i=this._storage.getInstanceId(t),s=this._lookupFeature(i);e(s)})}forEachUnsafe(e){this._objectIdToDisplayId.forEach(t=>{const i=this._storage.getInstanceId(t),s=c(i),r=l(i),n=this._getFeatureSet(s);n.setIndex(r),e(n)})}forEachInBounds(e,t){const i=this._searchIndex(e);for(const e of i){const i=this.lookupFeatureByDisplayId(e,this._storage);t(Object(s.m)(i))}}forEachBounds(e,t,i){this._rebuildIndex();const s=[0,0,0,0];for(const r of e){const e=r.getDisplayId();s[0]=this._storage.getXMin(e),s[1]=this._storage.getYMin(e),s[2]=this._storage.getXMax(e),s[3]=this._storage.getYMax(e),t(Object(n.g)(i,s))}}sweepFeatures(e,t){this._objectIdToDisplayId.forEach((i,s)=>{e.has(i)||(t.releaseDisplayId(i),this._objectIdToDisplayId.delete(s))}),this.events.emit("changed")}sweepFeatureSets(e){this._featureSetsByInstance.forEach((t,i)=>{e.has(i)||this._featureSetsByInstance.delete(i)})}lookupObjectId(e,t){const i=this.lookupFeatureByDisplayId(e,t);return Object(s.f)(i)?null:i.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const i=t.getInstanceId(e);return this._lookupFeature(i)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),i=c(t),s=l(t),r=this._getFeatureSet(i);return r?(r.setIndex(s),r):null}hasInstance(e){return this._featureSetsByInstance.has(e)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach(t=>{const i=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(i))&&e.push(t)}),this._index.load(e),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=c(e),i=l(e),s=this._getFeatureSet(t);if(!s)return null;const r=s.getCursor();return r.setIndex(i),r}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}},521:function(e,t,i){"use strict";i.d(t,"b",(function(){return m}));var s=i(7),r=i(1),n=i(3),o=i(14),a=i(2),c=i(70),l=i(178),u=i(111),h=i(100),d=i(207);i(68),i(124),i(147),i(451);const f=n.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),_=(b=f,!1&&((...e)=>b.warn("DEBUG:",...e))||(()=>null)),p=e=>(2147483648&e)>>>31,g=e=>2147483647&e;var b;function m(e){return 1===p(e)}const y={sharedArrayBuffer:Object(s.a)("esri-shared-array-buffer"),atomics:Object(s.a)("esri-atomics")};function x(e,t){return i=>t(e(i))}class T{constructor(e,t,i,s){this.size=0,this.texelSize=4;const{pixelType:r,layout:n,textureOnly:o}=s;this.textureOnly=o||!1,this.pixelType=r,this._ctype=t,this.layout=n,this._resetRange(),this._shared=e,this.size=i,o||(this.data=this._initData(r,i,e,t))}get buffer(){return Object(r.a)(this.data,e=>e.buffer)}unsetComponentAllTexels(e,t){const i=Object(r.m)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const i=Object(r.m)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,i){const s=Object(r.m)(this.data);for(const r of i)s[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(e,t,i){Object(r.m)(this.data)[i*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(e,t,i){Object(r.m)(this.data)[i*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(e,t){const i=g(e);return Object(r.m)(this.data)[i*this.texelSize+t]}setData(e,t,i){const s=g(e),r=1<<t;0!=(this.layout&r)?(this.data[s*this.texelSize+t]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)):f.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&y.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&y.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e,this._shared,this._ctype),i=Object(r.m)(this.data);t.set(i),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,i=this.texelSize;if(e>t)return null;this._resetRange();const s=!(this._shared||"local"===this._ctype),n=this.pixelType,o=this.layout,a=Object(r.m)(this.data);return a.slice?{start:e,end:t,data:s&&a.slice(e*i,(t+1)*i)||null,pixelType:n,layout:o}:s?{start:e,end:t,data:new(Object(d.d)(this.pixelType))(Array.prototype.slice.call(this.data,e*i,(t+1)*i)),pixelType:n,layout:o}:{start:e,end:t,data:null,pixelType:n,layout:o}}_initData(e,t,i,s){const r=i&&"local"!==s?SharedArrayBuffer:ArrayBuffer,n=Object(d.d)(e),o=new n(new r(t*t*4*n.BYTES_PER_ELEMENT));for(let e=0;e<o.length;e+=4)o[e+1]=255;return o}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}t.a=class{constructor(e,t){this._client=e,this.config=t,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(h.j),this._targetType=0,this._abortController=Object(a.d)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const i=t.supportsTextureFloat?5126:5121;_(`Creating AttributeStore ${y.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:i,layout:15},{pixelType:i,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){this.config=t;const i=t.schema.processors[0].storage,n=Object(l.a)(this._schema,i);if((e.targets.feature||e.targets.aggregate)&&(e.storage.data=!0),n&&(Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",n),e.storage.data=!0,this._schema=i,this._attributeComputeMap.clear(),!Object(r.f)(i))){switch(i.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(const e of i.mapping)this._bindAttribute(e)}}onTileData(e,t){if(Object(r.f)(t.addOrUpdate))return;const i=t.addOrUpdate.getCursor();for(;i.next();){const e=i.getDisplayId();this.setAttributeData(e,i)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(a.d)()}async setHighlight(e,t){const i=this._getBlock(0),s=t.map(e=>g(e));i.lock(),i.unsetComponentAllTexels(0,1),i.setComponent(0,1,s),i.unlock(),this._idsToHighlight.clear();for(const t of e)this._idsToHighlight.add(t);await this.sendUpdates()}async updateFilters(e,t){const{config:i,service:r,spatialReference:n}=t,{filters:o}=i,c=o.map((e,t)=>this._updateFilter(e,t,r,n));(await Object(a.b)(c)).some(e=>e)&&(e.storage.filters=!0,Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(e,t,i,s){const r=g(e);this._ensureSizeForTexel(r),this._getBlock(t).setData(e,i,s)}getData(e,t,i){return this._getBlock(t).getData(e,i)}getHighlightFlag(e){return this._idsToHighlight.has(e)?h.h:0}setAttributeData(e,t){const i=g(e);if(this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(t)),this._targetType!==p(e))return;const s=this._attributeComputeMap,r=this.config.supportsTextureFloat?1:2;s.size&&s.forEach((e,s)=>{const n=s*r%4,o=Math.floor(s*r/4),a=this._getBlock(o+h.b),l=e(t);if(this.config.supportsTextureFloat)a.setData(i,n,l);else if(l===h.k)a.setData(i,n,255),a.setData(i,n+1,255);else{const e=Object(c.c)(Math.round(l),-32767,32766)+32768,t=255&e,s=(65280&e)>>8;a.setData(i,n,t),a.setData(i,n+1,s)}})}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(a.g)(),this._nextUpdate.promise;const e={blocks:this._blocks.map(e=>Object(r.g)(e)?e.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>e.resolve())}},i=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),i}).catch(e=>Object(a.l)(e)?(this._createResourcesPromise=null,this._createResources()):(f.error(new o.a("mapview-attribute-store","Encountered an error during client update",e)),Object(a.s)())),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){let t;if(null!=e.fieldIndex)e.normalizationField&&f.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return;t=e.normalizationField?t=>{const i=t.readAttribute(e.normalizationField);return i?t.readAttribute(e.field)/i:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=x(t,t=>function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}(t,e.valueRepresentation))),this._attributeComputeMap.set(e.binding,x(t,e=>null===e||isNaN(e)||e===1/0?h.k:e))}_createResources(){if(Object(r.g)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(h.a),_("Initializing AttributeStore");const e={shared:y.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(r.i)(this._blocks,e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}))},t=this._client.initialize(e,this._signal).catch(e=>{Object(a.l)(e)?this._createResourcesPromise=null:f.error(new o.a("mapview-attribute-store","Encountered an error during client initialization",e))});return this._createResourcesPromise=t,t.then(()=>Object(r.f)(this._createResourcesPromise)?this._createResources():void 0),t}_getBlock(e){const t=this._blocks[e];if(Object(r.g)(t))return t;_("Initializing AttributeBlock at index "+e);const i=y.sharedArrayBuffer,s=this._client.type,n=new T(i,s,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n}_expand(){if(this._size<this.config.maxTextureSize){const e=this._size<<=1;return _("Expanding block size to",e,this._blocks),Object(r.d)(this._blocks,t=>t.expand(e)),this._createResourcesPromise=null,this._size=e,0}return f.error(new o.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(e,t,i,s){const n=this._filters[t],o=Object(r.g)(n)&&n.hash;if(!n&&!e)return!1;if(o===JSON.stringify(e))return!1;if(Object(r.f)(e)){const e=1<<t+1,i=this._getBlock(0);return this._filters[t]=null,i.setComponentAllTexels(0,e),this.sendUpdates(),!0}const a=await this._getFilter(t,i);return await a.update(e,s),!0}async _getFilter(e,t){const s=this._filters[e];if(Object(r.g)(s))return s;const{default:n}=await i.e(190).then(i.bind(null,675)),o=new n({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new u.a(t.fields)});return this._filters[e]=o,o}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){let t=0;const i=(s=e.getDisplayId(),1===p(s)?254:255);var s;for(let s=0;s<this._filters.length;s++){const n=!!(i&1<<s),o=this._filters[s];t|=(!n||Object(r.f)(o)||o.check(e)?1:0)<<s}let n=0;if(this._idsToHighlight.size){const t=e.getObjectId();n=this.getHighlightFlag(t)}return t<<1|n}}},524:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var s=i(7),r=i(1),n=i(2),o=i(139),a=i(178),c=i(3);var l=function(e,t,i){e.referencesGeometry();const s=t.readArcadeFeature();try{return e.evaluate({...i,$feature:s})}catch(e){return c.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}};const u=i.e(191).then(i.bind(null,547));class h{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}async updateSchema(e,t){const i=Object(a.a)(this._schema,t);if(this._schema=t,!t||Object(r.f)(i)||!Object(a.b)(i,"attributes"))return;Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",i),this._bitsets.computed.clear(),e.targets[t.name]=!0;const o=t.attributes,c=[],l=[];for(const e in o){const t=o[e];switch(t.type){case"field":break;case"expression":c.push(this._createArcadeComputedField(t));break;case"label-expression":c.push(this._createLabelArcadeComputedField(t));break;case"statistic":l.push(t)}}this._computedFields=await Object(n.b)(c),this._canCacheExpressionValue=!this._computedFields.some(e=>"expression"===e.type&&e.expression.referencesScale()),this._statisticFields=l}setComputedAttributes(e,t,i,s){const r=this._bitsets.computed;if(!this._canCacheExpressionValue||!r.has(i)){r.set(i);for(const r of this._computedFields){const n=this._evaluateField(t,r,s);switch(r.resultType){case"numeric":e.setComputedNumericAtIndex(i,r.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(i,r.fieldIndex,n)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fieldsIndex;return{...e,expression:await Object(o.d)(e.valueExpression,t,i)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fields,{createLabelFunction:s}=await u,r=await s(e.label,i,t);return{...e,builder:r}}_evaluateField(e,t,i){switch(t.type){case"label-expression":{const i=e.readArcadeFeature();return t.builder.evaluate(i)||""}case"expression":{const{expression:s}=t;return l(s,e,{$view:{scale:i}})}}}}},54:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i(20),r=i(52);function n(e,t={ignoreUnknown:!0}){const i=e instanceof r.a?e:new r.a(e,t),n={type:(null==t?void 0:t.ignoreUnknown)?i.apiValues:String,readOnly:null==t?void 0:t.readOnly,json:{type:i.jsonValues,read:!(null==t?void 0:t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return void 0!==(null==t?void 0:t.default)&&(n.json.default=t.default),Object(s.b)(n)}},65:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return f}));var s,r,n,o=i(0);let a=void 0,c=void 0;const l=null!=(s=null==(r=o.a.esriConfig)?void 0:r.locale)?s:null==(n=o.a.dojoConfig)?void 0:n.locale;function u(){var e,t;return null!=(e=null!=l?l:null==(t=o.a.navigator)?void 0:t.language)?e:"en"}function h(){return void 0===c&&(c=u()),c}const d=[];function f(e){return d.push(e),{remove(){d.splice(d.indexOf(e),1)}}}const _=[];function p(e){return _.push(e),{remove(){d.splice(_.indexOf(e),1)}}}function g(){var e;const t=null!=(e=a)?e:u();c!==t&&(c=t,[..._].forEach(e=>{e.call(null,t)}),[...d].forEach(e=>{e.call(null,t)}))}null==o.a.addEventListener||o.a.addEventListener("languagechange",g)},662:function(e,t,i){"use strict";i.r(t),i.d(t,"getInstances",(function(){return yi}));var s,r=i(18),n=i(7),o=i(3),a=i(4),c=i(20),l=i(19),u=(i(24),i(34),i(35),i(2)),h=i(122),d=i(77),f=i(50),_=i(60),p=i(56),g=i(58),b=i(118),m=i(1),y=i(72),x=i(59),T=i(53),v=i(57),O=i(70),w=i(211);let S=s=class extends f.a{constructor(...e){super(...e),this.position=new _.a([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,s){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const r={position:e};return null!=t&&(r.heading=t),null!=i&&(r.tilt=i),null!=s&&(r.fov=s),r}return e}writePosition(e,t,i,s){const r=e.clone();r.x=Object(a.i)(e.x||0),r.y=Object(a.i)(e.y||0),r.z=e.hasZ?Object(a.i)(e.z||0):e.z,t[i]=r.write(null,s)}readPosition(e,t){const i=new _.a;return i.read(e,t),i.x=Object(a.i)(i.x||0),i.y=Object(a.i)(i.y||0),i.z=i.hasZ?Object(a.i)(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}clone(){return new s({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};Object(r.a)([Object(c.b)({type:_.a,json:{write:{isRequired:!0}}})],S.prototype,"position",void 0),Object(r.a)([Object(v.a)("position")],S.prototype,"writePosition",null),Object(r.a)([Object(T.a)("position")],S.prototype,"readPosition",null),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(y.a)(e=>w.b.normalize(Object(a.i)(e)))],S.prototype,"heading",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Object(y.a)(e=>Object(O.c)(Object(a.i)(e),-180,180))],S.prototype,"tilt",void 0),Object(r.a)([Object(c.b)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],S.prototype,"fov",void 0),S=s=Object(r.a)([Object(l.a)("esri.Camera")],S);var E,F=S;let I=E=class extends f.a{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new E({rotation:this.rotation,scale:this.scale,targetGeometry:Object(m.g)(this.targetGeometry)?this.targetGeometry.clone():null,camera:Object(m.g)(this.camera)?this.camera.clone():null})}};function j(){return{enabled:!this.camera}}Object(r.a)([Object(c.b)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:j}}}}})],I.prototype,"rotation",void 0),Object(r.a)([Object(y.a)("rotation")],I.prototype,"castRotation",null),Object(r.a)([Object(c.b)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:j}}}}})],I.prototype,"scale",void 0),Object(r.a)([Object(c.b)({types:g.a,json:{read:x.a,write:!0,origins:{"web-scene":{read:x.a,write:{overridePolicy:j}}}}})],I.prototype,"targetGeometry",void 0),Object(r.a)([Object(c.b)({type:F,json:{write:!0}})],I.prototype,"camera",void 0),I=E=Object(r.a)([Object(l.a)("esri.Viewpoint")],I);var M=I,A=i(244),R=i(290),C=i(165),D=i(291);function N(){return[1,0,0,1,0,0]}Object.freeze({__proto__:null,create:N,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,i,s,r,n){return[e,t,i,s,r,n]},createView:function(e,t){return new Float64Array(e,t,6)}});var L=i(71),P=i(55),k=(i(86),i(164)),B=i(92),z=(i(62),i(87));const U=180/Math.PI;function G(e,t,i,s){return s&&i&&!s.equals(i)&&Object(B.a)(s,i)&&s.isWebMercator?s.isWebMercator?function(e,t){let i=t[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin(Object(b.d)(i)),Object(C.l)(e,Object(b.d)(t[0])*k.a.radius,.5*k.a.radius*Math.log((1+i)/(1-i)))}(e,t):function(e,t,i){const s=Object(b.c)(t[0]/k.a.radius);return Object(C.l)(e,s-360*Math.floor((s+180)/360),Object(b.c)(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/k.a.radius))))}(e,t):Object(C.c)(e,t)}function q(e){return e.wkid?e:e.spatialReference||P.a.WGS84}function V(e,t){return t.type?Object(C.l)(e,t.x,t.y):Object(C.c)(e,t)}function X(e){return Object(z.b)(e)}function W(e,t){const i=e.targetGeometry,s=t.targetGeometry;return i.x=s.x,i.y=s.y,i.spatialReference=s.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const H=function(){const e=Object(A.a)();return function(t,i,s){const r=i.targetGeometry;V(e,r);const n=.5*$(i);return t.xmin=e[0]-n*s[0],t.ymin=e[1]-n*s[1],t.xmax=e[0]+n*s[0],t.ymax=e[1]+n*s[1],t.spatialReference=r.spatialReference,t}}();const Q=function(){const e=Object(A.a)();return function(t,i,s){return Object(C.b)(t,function(e,t){return Object(C.a)(e,t,.5)}(t,i),function(e,t,i){return i?Object(C.l)(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):Object(C.a)(e,t,.5)}(e,i,s))}}(),Y=function(){const e=[1,0,0,1,0,0],t=Object(A.a)();return function(i,s,r,n){const o=$(s),a=Z(s);return Object(C.l)(t,o,o),Object(D.c)(e,t),Object(D.f)(e,e,a),Object(D.h)(e,e,Q(t,r,n)),Object(D.h)(e,e,[0,n.top-n.bottom]),Object(C.l)(i,e[4],e[5])}}();function $(e){return e.scale*(t=e.targetGeometry,Object(m.g)(t)&&Object(L.h)(t.spatialReference)?1/(39.37*X(t.spatialReference)*96):1);var t}function Z(e){return Object(b.d)(e.rotation)||0}const J=function(){const e=Object(A.a)(),t=Object(A.a)(),i=Object(A.a)();return function(s,r,n,o,a,c){return Object(C.k)(e,r),Object(C.a)(t,n,.5*c),Object(C.l)(i,1/o*c,-1/o*c),Object(D.d)(s),Object(D.h)(s,s,t),a&&Object(D.f)(s,s,a),Object(D.g)(s,s,i),Object(D.h)(s,s,e),s}}(),K=function(){const e=Object(A.a)();return function(t,i,s,r){const n=$(i),o=Z(i);return V(e,i.targetGeometry),J(t,e,s,n,o,r)}}(),ee=function(){const e=Object(A.a)();return function(t,i,s,r){const n=$(i);return V(e,i.targetGeometry),J(t,e,s,n,0,r)}}();function te(e,t){return Math.round(function(e){if(e.isWrappable){const t=Object(L.d)(e);return t.valid[1]-t.valid[0]}return 0}(e)/t)}(function(){const e=Object(A.a)(),t=Object(A.a)(),i=[0,0,0]})(),function(){const e=Object(A.a)()}(),function(){const e=Object(A.a)()}(),function(){const e=Object(A.a)()}();!function(){const e=Object(A.a)()}();const ie=function(){const e=Object(A.a)();return function(t,i,s,r,n){return W(t,i),isNaN(s)||0===s||(re(e,r,i,n),t.scale=i.scale*s,ne(e,e,t,n),oe(t,t,Object(C.l)(e,e[0]-r[0],r[1]-e[1]))),t}}();const se=function(){const e=Object(A.a)();return function(t,i,s,r,n,o){return W(t,i),isNaN(s)||0===s||(re(e,n,i,o),t.scale=i.scale*s,t.rotation+=r,ne(e,e,t,o),oe(t,t,Object(C.l)(e,e[0]-n[0],n[1]-e[1]))),t}}(),re=(function(){const e=Object(A.a)(),t=Object(A.a)()}(),function(){const e=[1,0,0,1,0,0];return function(t,i,s,r){return Object(C.m)(t,i,function(e,t,i,s){return K(e,t,i,1),Object(D.a)(e,e)}(e,s,r))}}()),ne=function(){const e=[1,0,0,1,0,0];return function(t,i,s,r){return Object(C.m)(t,i,K(e,s,r,1))}}(),oe=function(){const e=Object(A.a)(),t=[1,0,0,1,0,0];return function(i,s,r){W(i,s);const n=$(s),o=i.targetGeometry;return Object(D.b)(t,Z(s)),Object(D.g)(t,t,Object(A.c)(n,n)),Object(C.m)(e,r,t),o.x+=e[0],o.y+=e[1],i}}();var ae=i(245);function ce(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}Object.freeze({__proto__:null,create:ce,clone:function(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(e,t,i,s,r,n,o,a,c){const l=new Float32Array(9);return l[0]=e,l[1]=t,l[2]=i,l[3]=s,l[4]=r,l[5]=n,l[6]=o,l[7]=a,l[8]=c,l},createView:function(e,t){return new Float32Array(e,t,9)}});var le,ue=i(202);function he(e){return(t=e)instanceof Float32Array&&t.length>=2||function(e){return Array.isArray(e)&&e.length>=2}(e);var t}const de=[0,0];let fe=le=class extends f.a{constructor(...e){super(...e),this._viewpoint2D={center:Object(A.a)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new p.a,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=ce(),this.displayViewMat3=ce(),this.viewMat3=ce(),this.viewMat2d=Object(ae.a)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=W(i,e.viewpoint),this._set("size",Object(C.c)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new le({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return he(t)?Object(C.m)(e,t,this.inverseTransform):(de[0]=t,de[1]=i,Object(C.m)(e,de,this.inverseTransform))}toScreen(e,t,i){return he(t)?Object(C.m)(e,t,this.transform):(de[0]=t,de[1]=i,Object(C.m)(e,de,this.transform))}toScreenNoRotation(e,t,i){return he(t)?Object(C.m)(e,t,this.transformNoRotation):(de[0]=t,de[1]=i,Object(C.m)(e,de,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,r=this._get("size");return J(e,i,r,t,0,s),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:s}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size"),o=new M({targetGeometry:new _.a(e[0],e[1],t),scale:i,rotation:s});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=$(o),this.rotation=s,this.scale=i,this.spatialReference=t,Object(C.c)(this.center,e);const a=0!==n[0]?2/n[0]:0,c=0!==n[1]?-2/n[1]:0;Object(R.g)(this.displayMat3,a,0,0,0,c,0,-1,1,1);const l=Object(R.c)(this.viewMat3),u=Object(ue.b)(n[0]/2,n[1]/2),h=Object(ue.b)(-n[0]/2,-n[1]/2),d=Object(b.d)(s);Object(R.a)(l,l,u),Object(R.f)(l,l,d),Object(R.a)(l,l,h),Object(R.d)(this.displayViewMat3,this.displayMat3,l);const f=Object(D.d)(this.viewMat2d);return Object(D.h)(f,f,u),Object(D.f)(f,f,d),Object(D.h)(f,f,h),H(this.extent,o,n),K(this.transform,o,n,r),Object(D.a)(this.inverseTransform,this.transform),ee(this.transformNoRotation,o,n,r),this.worldScreenWidth=te(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};Object(r.a)([Object(c.b)({readOnly:!0})],fe.prototype,"id",void 0),Object(r.a)([Object(c.b)({value:1,json:{write:!0}})],fe.prototype,"pixelRatio",null),Object(r.a)([Object(c.b)({json:{write:!0}})],fe.prototype,"size",null),Object(r.a)([Object(c.b)({type:M,json:{write:!0}})],fe.prototype,"viewpoint",null),fe=le=Object(r.a)([Object(l.a)("esri.views.2d.ViewState")],fe);var _e=fe,pe=i(213);function ge(e,t){return[e,t]}function be(e,t,i){return e[0]=t,e[1]=i,e}const me=new pe.a("0/0/0/0");class ye{constructor(e,t,i,s,r,n,o,a,c,l,u,h){this.level=e,this.resolution=t,this.scale=i,this.origin=s,this.first=r,this.last=n,this.size=o,this.norm=a,this.worldStart=c,this.worldEnd=l,this.worldSize=u,this.wrap=h}static create(e,t,i){const s=Object(L.d)(e.spatialReference),r=ge(e.origin.x,e.origin.y),n=ge(e.size[0]*t.resolution,e.size[1]*t.resolution),o=ge(-1/0,-1/0),a=ge(1/0,1/0),c=ge(1/0,1/0);let l,u,h,d;return i&&(be(o,Math.max(0,Math.floor((i.xmin-r[0])/n[0])),Math.max(0,Math.floor((r[1]-i.ymax)/n[1]))),be(a,Math.max(0,Math.floor((i.xmax-r[0])/n[0])),Math.max(0,Math.floor((r[1]-i.ymin)/n[1]))),be(c,a[0]-o[0]+1,a[1]-o[1]+1)),e.isWrappable?(l=ge(Math.ceil(Math.round((s.valid[1]-s.valid[0])/t.resolution)/e.size[0]),c[1]),u=ge(Math.floor((s.origin[0]-r[0])/n[0]),o[1]),h=ge(l[0]+u[0]-1,a[1]),d=!0):(u=o,h=a,l=c,d=!1),new ye(t.level,t.resolution,t.scale,r,o,a,c,n,u,h,l,d)}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,i=!1){me.set(t);const s=i?me.col:this.denormalizeCol(me.col,me.world),r=me.row;return function(e,t,i,s,r){e[0]=t,e[1]=i,e[2]=s,e[3]=r}(e,this.getXForColumn(s),this.getYForRow(r+1),this.getXForColumn(s+1),this.getYForRow(r)),e}getTileCoords(e,t,i=!1){me.set(t);const s=i?me.col:this.denormalizeCol(me.col,me.world);return Array.isArray(e)?be(e,this.getXForColumn(s),this.getYForRow(me.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(me.row)),e}}var xe=ye,Te=i(21);class ve{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,t){const{spans:i,lodInfo:s}=this,{level:r}=s;if(0!==i.length)for(const{row:n,colFrom:o,colTo:a}of i)for(let i=o;i<=a;i++)e.call(t,r,n,s.normalizeCol(i),s.getWorldForColumn(i))}}ve.pool=new Te.a(ve);var Oe=ve,we=class{constructor(e,t,i){this.row=e,this.colFrom=t,this.colTo=i}};const Se=new pe.a("0/0/0/0");class Ee{constructor(e,t,i,s,r,n,o,a){this.x=e,this.ymin=t,this.ymax=i,this.invM=s,this.leftAdjust=r,this.rightAdjust=n,this.leftBound=o,this.rightBound=a}static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[i,s]=e,[r,n]=t,o=r-i,a=n-s,c=0!==a?o/a:0,l=(Math.ceil(s)-s)*c,u=(Math.floor(s)-s)*c;return new Ee(i,Math.floor(s),Math.ceil(n),c,o<0?l:u,o<0?u:l,o<0?r:i,o<0?i:r)}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const Fe=[[0,0],[0,0],[0,0],[0,0]];var Ie=i(102),je=i(209),Me=i(40),Ae=i(83),Re=i(450);class Ce{constructor(e,t){this.key=new pe.a(0,0,0,0),this.bounds=Object(Ae.c)(),this.objectIds=new Set,this.key.set(t);const i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return p.a.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){const e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new Ce(this.tileInfoView,this.key)}neighbor(e,t){const i=this.key.clone(),s=1<<i.level,r=i.col+e,n=i.row+t;return r<0?(i.col=r+s,i.world-=1):r>=s?(i.col=r-s,i.world+=1):i.col=r,i.row=n,new Ce(this.tileInfoView,i)}createChildTiles(){const e=this.key.getChildKeys(),t=Me.a.acquire();for(let i=0;i<e.length;i++)t[i]=new Ce(this.tileInfoView,e[i]);return t}getQuantizationParameters(){return Re.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}const De={added:[],removed:[]},Ne=new Set,Le=new pe.a(0,0,0,0);var Pe=class extends Ie.a{constructor(e){super(),this._tiles=new Map,this._index=Object(je.a)(9,Object(n.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}intersections(e,t){const i="string"==typeof e?this.get(e):e;if(!i)return[];const s=t*i.resolution,r=i.bounds[0]-s,n=i.bounds[1]-s,o=i.bounds[2]+s,a=i.bounds[3]+s,c=[];for(const e of this._index.search({minX:r,minY:n,maxX:o,maxY:a})){const t=e.bounds.slice();t[0]=Math.max(t[0],r),t[1]=Math.max(t[1],n),t[2]=Math.min(t[2],o),t[3]=Math.min(t[3],a),t[2]-t[0]>0&&t[3]-t[1]>0&&c.push({bounds:t,tile:e})}return c}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const e=new Ce(this.tileScheme,i);this._tiles.set(i,e),this._index.insert(e),t.added.push(e)}for(const i of e.removed)if(this.has(i)){const e=this.get(i);this._tiles.delete(i),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach(e=>this.tiles.push(e)),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:i,lodInfo:s}=t,{level:r}=s;if(i.length>0)for(const{row:e,colFrom:t,colTo:n}of i)for(let i=t;i<=n;i++){const t=Le.set(r,e,s.normalizeCol(i),s.getWorldForColumn(i)).id;if(Ne.add(t),!this.has(t)){const e=new Ce(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),De.added.push(e)}}for(let e=this.tiles.length-1;e>=0;e--){const t=this.tiles[e];Ne.has(t.id)||(this._tiles.delete(t.id),this.tiles.splice(e,1),this._index.remove(t),De.removed.push(t))}(De.added.length||De.removed.length)&&this.emit("update",De),Oe.pool.release(t),Ne.clear(),De.added.length=0,De.removed.length=0}};class ke{constructor(){this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}static create(e){const t=new ke;for(const i in e){const s=e[i];if("object"==typeof s)for(const e in s){const r=s[e];t[i][e]=r}t[i]=s}return t}static empty(){return ke.create({})}static all(){return ke.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){let e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(const e of this.why.mesh)t+=`    + ${e}\n`}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(const e of this.why.source)t+=`    + ${e}\n`}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed");const i=e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow";console.debug(`Applying ${i} update of cost ${e}/45 `),console.debug(t)}toJSON(){return{source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh,queryFilter:this.queryFilter}}}var Be=i(36),ze=i(98),Ue=i(111),Ge=i(292);class qe extends Ge.a{constructor(e,t,i){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=i,this._features=t}static fromFeatures(e,t,i){const s=Object(ze.c)([],e,t,!1,!1,i);for(let t=0;t<s.length;t++)s[t].displayId=e[t].displayId;return qe.fromOptimizedFeatures(s,t)}static fromFeatureSet(e,t){const i=Object(ze.b)(e,t);return qe.fromOptimizedFeatureSet(i)}static fromOptimizedFeatureSet(e){const{features:t,geometryType:i}=e,s=qe.fromOptimizedFeatures(t,i);s._exceededTransferLimit=e.exceededTransferLimit,s._transform=e.transform;for(const t of e.fields)"esriFieldTypeDate"===t.type&&s._dateFields.add(t.name);return s}static fromOptimizedFeatures(e,t,i){const s=Ge.a.createInstance(),r=new qe(s,e,t);return r._transform=i,r}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){const e=new qe(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(ze.f)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){const e=this.readGeometry();return e?{x:e.coords[0],y:e.coords[1]}:null}readLegacyGeometry(){const e=this.readGeometry();return Object(ze.h)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const e=this.readCentroid();return e?{x:e.coords[0],y:e.coords[1]}:null}readGeometryArea(){return Object(ze.p)(this._current.geometry,2)}readUnquantizedGeometry(){const e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;const t=e.clone();return function({coords:e,lengths:t}){let i=0;for(const s of t){for(let t=1;t<s;t++)e[2*(i+t)]+=e[2*(i+t)-2],e[2*(i+t)+1]+=e[2*(i+t)-1];i+=s}}(t),t}readHydratedGeometry(){const e=this._current.geometry;if(!e)return null;const t=e.clone();return Object(ze.v)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){const e=this._current.geometry.coords[0]+this._tx,t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._current.geometry.coords[1]+this._ty,t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]}readGeometry(){if(!this._current.hasGeometry)return null;const e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e;let t=0;for(const i of e.lengths)e.coords[2*t]+=this._tx,e.coords[2*t+1]+=this._ty,t+=i;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const e=this._computeCentroid();if(!e)return null;e.coords[0]-=this._tx,e.coords[1]-=this._ty,this._current.centroid=e}const e=this._current.centroid.clone();return e.coords[0]+=this._tx,e.coords[1]+=this._ty,e}_readAttribute(e,t){const i=this._current.attributes[e];if(void 0!==i)return t&&this._dateFields.has(e)?new Date(i):i;const s=this.readAttributes(),r=e.toLocaleLowerCase().trim();for(const e in s)if(e.toLocaleLowerCase().trim()===r){const t=this._current.attributes[e];return this._dateFields.has(e)?new Date(t):t}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;let e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":{const i=this._current.geometry;if(!i)return!1;[e,t]=i.coords;break}case"esriGeometryPolygon":{const i=this.readCentroid();if(!i)return!1;[e,t]=i.coords,e-=this._tx,t-=this._ty;break}default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}var Ve=i(38),Xe=i(378);class We{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class He{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Xe.a(e.peeker),this.process=e.process;const t=e.scheduler;e.task&&Object(m.g)(t)&&(this._task=t.registerTask(e.task,e=>this.update(e),()=>this.needsUpdate()))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,i)=>e(i))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,t){const i=this.get(e);if(i)return i;let s;const r=Object(u.d)();let n=null;t&&(n=Object(u.p)(t,()=>r.abort()));const o=()=>{a.remove(),Object(m.g)(n)&&n.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},a=Object(u.q)(r.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),s.reject(Object(u.e)())});return s=Object(u.f)(),this._deferreds.set(e,s),this._controllers.set(e,r),s.promise.then(o,o),this._queue.push(e),this._scheduleNext(),s.promise}reset(){const e=[];this._processingItems.forEach(t=>e.push(t)),this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}needsUpdate(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}update(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=Object(Ve.b)(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(Object(m.f)(e))return;let t;const i=Object(u.d)(),s=new We(e,i);this._processingItems.set(e,s);try{t=this.process(e,i.signal)}catch(e){this._processError(s,e)}var r;(r=t)&&"function"==typeof r.then?(s.promise=t,t.then(e=>this._processResult(s,e),e=>this._processError(s,e))):this._processResult(s,t)}get test(){return{update:e=>this.update(e)}}}var Qe=i(521);class Ye{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}class $e{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new $e(e,t)}static create(e,t=4294967295){const i=new Uint32Array(Math.ceil(e/32));return new $e(i,t)}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}set(e){const t=this._mask&e,i=this._getIndex(t),s=1<<t%32;this._buf[i]|=s}unset(e){const t=this._mask&e,i=this._getIndex(t),s=1<<t%32;this._buf[i]&=4294967295^s}resize(e){const t=this._buf,i=new Uint32Array(Math.ceil(e/32));i.set(t),this._buf=i}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new $e(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(let t=0;t<this._buf.length;t++){let i=this._buf[t],s=32*t;if(i)for(;i;)1&i&&e(s),i>>>=1,s++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}}function Ze(e,t,i){if(!(e.length>t))for(;e.length<=t;)e.push(i)}class Je{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new Ye,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push($e.create(this._allocatedSize,2147483647)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){this._allocatedSize<<=1;for(const e of this._bitsets)e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),Ze(this._numerics[e],t,0)}_ensureInstanceId(e){Ze(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),Ze(this._strings[e],t,null)}createDisplayId(e=!1){const t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(const t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(2147483647&e)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(2147483647&e,0)}setComputedNumeric(e,t,i){return this.setComputedNumericAtIndex(2147483647&e,i,0)}getComputedString(e,t){return this.getComputedStringAtIndex(2147483647&e,0)}setComputedString(e,t,i){return this.setComputedStringAtIndex(2147483647&e,0,i)}getComputedNumericAtIndex(e,t){const i=2147483647&e;return this._ensureNumeric(t,i),this._numerics[t][i]}setComputedNumericAtIndex(e,t,i){const s=2147483647&e;this._ensureNumeric(t,s),this._numerics[t][s]=i}getInstanceId(e){const t=2147483647&e;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){const i=2147483647&e;this._ensureInstanceId(i),this._instanceIds[i]=t}getComputedStringAtIndex(e,t){const i=2147483647&e;return this._ensureString(t,i),this._strings[t][i]}setComputedStringAtIndex(e,t,i){const s=2147483647&e;this._ensureString(t,s),this._strings[t][s]=i}getXMin(e){return this._bounds[4*(2147483647&e)]}getYMin(e){return this._bounds[4*(2147483647&e)+1]}getXMax(e){return this._bounds[4*(2147483647&e)+2]}getYMax(e){return this._bounds[4*(2147483647&e)+3]}setBounds(e,t){const i=t.readHydratedGeometry();if(!i||!i.coords.length)return!1;let s=1/0,r=1/0,n=-1/0,o=-1/0;i.forEachVertex((e,t)=>{s=Math.min(s,e),r=Math.min(r,t),n=Math.max(n,e),o=Math.max(o,t)});const a=2147483647&e;return Ze(this._bounds,4*a+4,0),this._bounds[4*a]=s,this._bounds[4*a+1]=r,this._bounds[4*a+2]=n,this._bounds[4*a+3]=o,!0}}var Ke=i(452),et=i(341),tt=i(178),it=i(204),st=i(105),rt=i(100),nt=i(133),ot=i(14),at=i(51),ct=i(174),lt=i(181),ut=(i(166),i(367)),ht=(i(103),i(177)),dt=i(374);i(286);o.a.getLogger("esri.layers.graphics.sources.ogcfeature");async function ft(e,t,i){var s;const{capabilities:{query:{maxRecordCount:r}},collectionId:n,layerDefinition:o,url:a}=e,c=`${a}/collections/${n}/items`,{geometry:l,num:u,start:h,timeExtent:d,where:f}=t,_=Object(m.g)(t.outSpatialReference)?t.outSpatialReference:L.a,p=function(e){if(Object(m.f)(e))return null;const{xmin:t,ymin:i,xmax:s,ymax:r}=e;return`${t},${i},${s},${r}`}(Object(ht.b)(l,L.a)),g=function(e){if(Object(m.f)(e))return null;const{start:t,end:i}=e;return`${t?t.toISOString():".."}/${i?i.toISOString():".."}`}(d),b=(M=f,Object(m.f)(M)||!M||"1=1"===M?null:M),y=null!=u?u:null!=h&&void 0!==h?10:r,{data:x}=await Object(at.default)(c,{...i,query:{bbox:p,datetime:g,query:b,limit:y,startindex:h,f:"json"}}),T=null==(s=x.links)?void 0:s.filter(e=>"next"===e.rel),v=0!==(null==T?void 0:T.length),{fields:O,globalIdField:w,hasM:S,hasZ:E,objectIdField:F}=o,I=o.geometryType,j=Object(dt.a)(x,{geometryType:I,hasZ:E,objectIdFieldName:F});var M;if(!Object(L.c)(_,L.a))for(const e of j)e.geometry&&(e.geometry=Object(ze.d)(Object(ht.b)(Object(ze.h)(e.geometry,I,E,!1),L.a,_)));for(const e of j)e.objectId=e.attributes[F];const A=new ut.a;return A.exceededTransferLimit=v,A.features=j,A.fields=O,A.geometryType=I,A.globalIdFieldName=w,A.hasM=S,A.hasZ=E,A.objectIdFieldName=F,A.spatialReference=_||L.a,A}var _t=i(152),pt=i(119),gt=i(212),bt=i(288);class mt{constructor(){this.hasFeatures=!1,this.fieldIndexMap=new Map,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.dateFields=new Set,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}hasFieldIndex(e){return this.fieldIndexMap.has(e)}isDateField(e){return this.dateFields.has(e)}getFieldIndex(e){return this.fieldIndexMap.get(e)}}function yt(e){const t=e.getLength(),i=e.pos()+t,s={name:"",isDate:!1};for(;e.pos()<i&&e.next();)switch(e.tag()){case 1:s.name=e.getString();break;case 2:"esriFieldTypeDate"===Object(bt.b)(e.getEnum())&&(s.isDate=!0);break;default:e.skip()}return s}const xt=o.a.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF");function Tt(e){for(;e.next();)switch(e.tag()){case 1:return e.getMessage();default:e.skip()}return null}class vt extends Ge.a{constructor(e,t,i,s){super(e),this._hasNext=!1,this._isPoints=!1,this._isPolygons=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._geometryType=s,this._reader=t,this._header=i,this._hasNext=i.hasFeatures,this._isPoints="esriGeometryPoint"===s,this._isPolygons="esriGeometryPolygon"===s}static fromBuffer(e,t){const i=function(e){try{const t=2,i=new gt.a(new Uint8Array(e),new DataView(e));for(;i.next();)switch(i.tag()){case t:return Tt(i.getMessage());default:i.skip()}}catch(e){const t=new ot.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});xt.error(t)}return null}(e),s=function(e,t){const i=e.pos(),s=new mt;let r=0,n=0,o=null,a=null,c=null,l=!1;for(;e.next();)switch(e.tag()){case 1:o=e.getString();break;case 3:a=e.getString();break;case 12:c=e.processMessage(bt.c);break;case 9:s.exceededTransferLimit=e.getBool(),s.exceededTransferLimit&&(s.offsets.geometry=new Int32Array(8e3),s.centroid=new Int32Array(16e3));break;case 13:{const t=yt(e),i=t.name.toLowerCase().trim(),n=r++;s.fieldIndexMap.set(t.name,n),s.fieldIndexMap.set(i,n),t.isDate&&(s.dateFields.add(t.name),s.dateFields.add(i));break}case 15:{const i=e.getLength(),o=e.pos()+i;if(!s.exceededTransferLimit){const e=s.offsets.geometry,t=s.centroid;e.push(0),t.push(268435455),t.push(268435455)}!l&&s.exceededTransferLimit&&(l=!0,s.offsets.attributes=new Uint32Array(8e3*r));let a=n*r;for(;e.pos()<o&&e.next();)switch(e.tag()){case 1:{l?s.offsets.attributes[a++]=e.pos():s.offsets.attributes.push(e.pos());const t=e.getLength();e.skipLen(t);break}case 2:if(t){const t=e.getLength(),i=e.pos()+t;for(;e.pos()<i&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),i=e.getSInt32();s.centroid[2*n]=t,s.centroid[2*n+1]=i;break}default:e.skip()}}else{s.offsets.geometry[n]=e.pos();const t=e.getLength();e.skipLen(t)}break;case 4:{const t=e.getLength(),i=e.pos()+t;for(;e.pos()<i&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),i=e.getSInt32();s.centroid[2*n]=t,s.centroid[2*n+1]=i;break}default:e.skip()}break}default:e.skip()}n++,s.hasFeatures=!0;break}default:e.skip()}const u=o||a;if(!u)throw new ot.a("FeatureSet has no objectId or globalId field name");return s.featureCount=n,s.fieldCount=r,s.objectIdFieldIndex=s.getFieldIndex(u),s.transform=c,s.displayIds=new Uint32Array(s.featureCount),s.groupIds=new Uint16Array(s.featureCount),e.move(i),s}(i,"esriGeometryPoint"===t),r=Ge.a.createInstance();return new vt(r,i,s,t)}get geometryType(){return this._geometryType}get size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getApproximateSize(){if(this._hasFilter){const e=Math.abs(this._xmax-this._xmin)*Math.abs(this._ymax-this._ymin),t=this.size*e/262144;return Math.max(Math.round(t),0)}return this.size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){let e="";return this._header.fieldIndexMap.forEach(t=>{e+=this._readAttributeAtIndex(t)+"."}),e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(e){this._header.groupIds[this._featureIndex]=e}readLegacyFeature(){if(void 0===this._cache.legacyFeature){var e;const t=this.readCentroid(),i={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!=(e=t&&{x:t.coords[0],y:t.coords[1]})?e:null};return this._cache.legacyFeature=i,i}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){const e=new _t.a(this.readGeometry(),this.readAttributes(),this.readCentroid());return this._cache.optFeature=e,e}return this._cache.optFeature}getXHydrate(){const e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]}getYHydrate(){const e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]}readLegacyPointGeometry(){return{x:this._header.centroid[2*this._featureIndex]+this._tx,y:this._header.centroid[2*this._featureIndex+1]+this._ty}}readLegacyGeometry(){const e=this.readGeometry();return Object(ze.h)(e,this.geometryType,!1,!1)}readLegacyCentroid(){const e=this.readCentroid();if(!e)return null;const[t,i]=e.coords;return{x:t,y:i}}readGeometryArea(){return this._cache.area||this.readGeometry(),this._cache.area}readUnquantizedGeometry(){if(void 0===this._cache.unquantGeometry){const e=this.readGeometry();if(!e)return this._cache.unquantGeometry=null,null;const t=e.clone(),i=t.lengths,s=t.coords;for(let e=0,t=2;e<i.length;e++,t+=2){const r=i[e];for(let e=1;e<r;e+=1,t+=2)s[t]+=s[t-2],s[t+1]+=s[t-1]}return this._cache.unquantGeometry=t,t}return this._cache.unquantGeometry}readHydratedGeometry(){const e=this.readGeometry();if(!e)return null;const t=e.clone();return this._isPoints&&(t.coords[0]-=this._tx,t.coords[1]-=this._ty),Object(ze.v)(t,t,this.hasZ,this.hasM,this.getQuantizationTransform()),t}readGeometry(){if(void 0===this._cache.geometry){let e=null;if(this._isPoints){const t=this._header.centroid[2*this._featureIndex]+this._tx,i=this._header.centroid[2*this._featureIndex+1]+this._ty;e=new pt.a([],[t,i])}else{const t=this._header.offsets.geometry[this._featureIndex],i=this._reader;if(0===t)return null;i.move(t);try{e=this._parseGeometry(i)}catch(e){return console.error("Failed to parse geometry!",e),null}}return this._cache.geometry=e,e}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){let e=null;const t=this._header.centroid[2*this._featureIndex]+this._tx,i=this._header.centroid[2*this._featureIndex+1]+this._ty;return 268435455===t?(e=this._computeCentroid(),e&&(this._header.centroid[2*this._featureIndex]=e.coords[0]-this._tx,this._header.centroid[2*this._featureIndex+1]=e.coords[1]-this._ty)):e=new pt.a([],[t,i]),this._cache.centroid=e,e}return this._cache.centroid}copy(){const e=this._reader.clone(),t=new vt(this.instance,e,this._header,this.geometryType);return this.copyInto(t),t}next(){if(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,!this._hasFilter)return++this._featureIndex<this.size;for(;++this._featureIndex<this.size&&!this._passesFilter(););return this._featureIndex<this.size}_readAttribute(e,t){const i=this._header.hasFieldIndex(e)?e:function(e){return e.toLowerCase().trim()}(e),s=this._header.getFieldIndex(i);if(null==s)return;const r=this._readAttributeAtIndex(s);return t&&this._header.isDateField(i)?new Date(r):r}_readAttributes(){const e={};return this._header.fieldIndexMap.forEach((t,i)=>{e[i]=this._readAttributeAtIndex(t)}),e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext}_passesFilter(){if(!this._hasFilter)return!0;let e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];if(268435455===e){if(this._isPolygons&&!this.readCentroid())return!1;e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1]}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_readAttributeAtIndex(e){const t=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],i=this._reader;return i.move(t),function(e){const t=e.getLength(),i=e.pos()+t;for(;e.pos()<i&&e.next();)switch(e.tag()){case 1:{const t=e.getString();return""===t?null:t}case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(i)}_preprocessPolygon(e,t){let i=0,s=0,r=0,n=!1,o=!1,a=!1,c=-1;const l=[];let u=0,h=!1;for(let d=0;d<t.length;d++){const f=t[d];let _=e[2*i],p=e[2*i+1],g=0;for(let t=1;t<f;t++){const s=_,r=p,n=_+e[2*(i+t)],o=p+e[2*(i+t)+1];_=n,p=o,g+=(n-s)*(o+r)*.5}const b=g>0;if(b&&h&&(s+=f),b||(c++,h=!1),c>=1e6)break;u+=g,n&&b&&o&&(a=!0);{e[2*r]=e[2*s],e[2*r+++1]=e[2*s+++1];let t=1,i=e[2*s],n=e[2*s+++1];for(let o=2;o<f;o++){const o=e[2*s],a=e[2*s+++1];i*a-o*n==0?(i+=o,n+=a):(e[2*r]=i,e[2*r+++1]=n,t++,i=o,n=a)}e[2*r]=i,e[2*r+++1]=n,t++,l.push(t)}n=!1,o=!0,i+=f}return l.length?(this._cache.area=Math.abs(u),new pt.a(l,e,a)):null}_parseGeometry(e){const t=e.getLength(),i=e.pos()+t,s=[],r=[];for(;e.pos()<i&&e.next();)switch(e.tag()){case 2:{const t=e.getUInt32(),i=e.pos()+t;for(;e.pos()<i;)r.push(e.getUInt32());break}case 3:{const t=e.getUInt32(),i=e.pos()+t;for(;e.pos()<i;)s.push(e.getSInt32()),s.push(e.getSInt32()),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();break}case 1:default:e.skip()}let n=0;for(const e of r)s[2*n]+=this._tx,s[2*n+1]+=this._ty,n+=e;return this._isPolygons?this._preprocessPolygon(s,r):new pt.a(r,s)}}class Ot{constructor(e){this.service=e}destroy(){}}class wt extends Ot{constructor(e){super(e),this._portsOpen=Object(ct.b)(e.source).then(e=>this.client=e)}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const i=await this.client.invoke("queryFeatures",e.toJSON(),t);return qe.fromFeatureSet(i,this.service.objectIdField)}}class St extends Ot{async executeQuery(e,t){const{data:i}=await Object(lt.executeQueryPBFBuffer)(this.service.source,e,t);return vt.fromBuffer(i,this.service.geometryType)}}class Et extends Ot{async executeQuery(e,t){const{source:i,capabilities:s,spatialReference:r,objectIdField:n}=this.service;if(e.quantizationParameters&&!s.query.supportsQuantization){const s=e.clone();s.quantizationParameters=null;const{data:o}=await Object(lt.executeQuery)(i,s,r,t),a=Object(ze.b)(o,n);return Object(ze.q)(t.transform,a),qe.fromOptimizedFeatureSet(a)}const{data:o}=await Object(lt.executeQuery)(i,e,this.service.spatialReference,t);return qe.fromFeatureSet(o,this.service.objectIdField)}}class Ft extends Ot{async executeQuery(e,t){const{capabilities:i}=this.service;if(e.quantizationParameters&&!i.query.supportsQuantization){e.clone().quantizationParameters=null;const i=await ft(this.service.source,e,t);return Object(ze.q)(t.transform,i),qe.fromOptimizedFeatureSet(i)}const s=await ft(this.service.source,e,t);return qe.fromOptimizedFeatureSet(s)}}class It{constructor(e){this._abortController=new AbortController,this.requests={pending:new Array,done:new Array},this.tile=e}get signal(){return this._abortController.signal}add(e){this.requests.done.push(e),e.request.end&&(this.resolved=!0)}abort(){this._abortController.abort()}}class jt{constructor(e){this.events=new Ie.a,this._subscriptions=new Map,this._serviceQueryInfo={outSpatialReference:e.outSR},this._serviceInfo=e.serviceInfo,this._onRequest=e.onRequest}async queryLastEditDate(){throw new Error("Service does not support query type")}async query(e,t){throw new Error("Service does not support query")}get geometryType(){return this._serviceInfo.geometryType}update(e){Object(tt.a)(e,this._sourceQueryInfo)&&(this._sourceQueryInfo=e)}updateSubscriptions(){}setViewState(e){}subscribe(e){const t=new It(e);this._subscriptions.set(e.id,t)}unsubscribe(e){const t=this.get(e.id);Object(m.g)(t)&&t.abort(),this._subscriptions.delete(e.id)}pause(){}resume(){}get(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null}enableEvent(e,t){}}const Mt=o.a.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource");class At extends jt{constructor(e){super(e),this.type="feature",this._adapter=function(e){const{capabilities:t}=e;return(i=e.source)&&i.capabilities&&i.collectionId&&i.layerDefinition&&i.url?new Ft(e):function(e){return Array.isArray(e.source)}(e)?new wt(e):t.query.supportsFormatPBF?new St(e):new Et(e);var i}(e.serviceInfo),this._queue=new He({concurrency:8,process:async e=>{Object(u.u)(e);const t=e.tile.key.id,{tile:i,signal:s}=e,r={query:Object(n.a)("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:s,transform:i.transform};return this._adapter.executeQuery(e.query,r)}}),this._patchQueue=new He({concurrency:8,process:async e=>{Object(u.u)(e);const t=e.tile.key.id,{tile:i,signal:s}=e,r={query:Object(n.a)("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:s,transform:i.transform};return this._adapter.executeQuery(e.query,r)}})}destroy(){this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()}setViewState(e){}get updating(){return!!this._queue.length}subscribe(e){super.subscribe(e),this._fetchDataTile(e).catch(t=>{Object(u.l)(t)||Mt.error(new ot.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t}))})}unsubscribe(e){super.unsubscribe(e)}pause(){this._queue.pause()}resume(){this._queue.resume()}async query(e,t){return this._adapter.executeQuery(e,t)}async queryLastEditDate(){const e=this._serviceInfo.source,t={...e.query,f:"json"};return(await Object(at.default)(e.path,{query:t,responseType:"json"})).data.editingInfo.lastEditDate}forEachRequest(e,t){const i=this._subscriptions.get(e),{requests:s,signal:r}=i;for(const e of s.done)t(e.request,{signal:r})}async _executePatchQuery(e,t,i,s){const r=t.clone();r.outFields=[this._serviceInfo.objectIdField,...i],r.returnCentroid=!1,r.returnGeometry=!1;const n=Object(m.g)(r.start)?r.start/8e3:0,o=s.signal;return this._patchQueue.push({tile:e,query:r,signal:o,depth:n})}async _resendRequest(e,t){const{query:i,request:s}=e,r=Object(m.g)(i.outFields)?i.outFields:[],n=this._sourceQueryInfo.outFields,o=n.filter(e=>-1===r.indexOf(e));if(!Object(m.f)(s.features))if(o.length)try{const e=await this._executePatchQuery(s.tile,i,o,t);Object(u.u)(t),i.outFields=n,s.features.joinAttributes(e),this._onRequest({...s,end:s.end||t.end},"new",t)}catch(e){}else this._onRequest({...s,end:s.end||t.end},"new",t)}async resend({dataTileOnly:e}){let t=0,i=!1;const s=[];for(this._subscriptions.forEach(e=>{if(!e.requests.done.length){const t=e.tile;this._onRequest({tile:t,id:t.id,features:null,noData:!0,end:!1},"new",{dataTileOnly:!0})}});!i;)i=!0,this._subscriptions.forEach(({requests:r,signal:n})=>{if(r.done.length>t){i=!1;const o=r.done.length===t+1;s.push(this._resendRequest(r.done[t],{signal:n,dataTileOnly:e,end:o}))}}),t++;await Object(u.b)(s)}_createQuery(e,t){const i=new st.a({...this._serviceQueryInfo,...this._sourceQueryInfo,...t});return this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,i.maxAllowableOffset=e.resolution),t.quantizationParameters&&"esriGeometryPolyline"===this.geometryType&&(i.maxAllowableOffset=e.resolution),i.resultType="tile",i.geometry=e.extent,i}}const Rt=Object(n.a)("esri-featurelayer-webgl"),Ct=Object(n.a)("esri-mobile"),Dt={maxDrillLevel:Rt&&"object"==typeof Rt&&null!=Rt.maxDrillLevel?Rt.maxDrillLevel:Ct?1:4,maxRecordCountFactor:Rt&&"object"==typeof Rt&&null!=Rt.maxRecordCountFactor?Rt.maxRecordCountFactor:Ct?1:3};class Nt extends At{constructor(e){super(e)}async _fetchDataTile(e){const t=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,i=this._subscriptions.get(e.key.id),s=i.signal,r=e.getQuantizationParameters();let n=0;const o=async(a,c)=>{const l=this._sourceQueryInfo,h=this._createQuery(a,{maxRecordCountFactor:t?Dt.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:r});n++;try{const t=await this._queue.push({tile:e,query:h,signal:s,depth:c});if(n--,Object(u.u)(s),!t)return;if(l!==this._sourceQueryInfo)return void o(a,c);if(t.exceededTransferLimit&&c<Dt.maxDrillLevel){for(const e of a.createChildTiles())o(e,c+1);return}const r={tile:e,id:e.id,features:t,end:0===n};i.requests.done.push({query:h,request:r}),this._onRequest(r,"new")}catch(t){Object(u.l)(t)||this._onRequest({tile:e,id:e.id,features:null,end:!0},"new")}};o(e,0)}}var Lt=class{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}clear(){for(;Object(m.g)(this.dequeue()););}};var Pt=i(153);let kt=class extends(Ie.a.EventedMixin(h.a)){onFeature(e){this.emit("feature",e)}};kt=Object(r.a)([Object(l.a)("esri.layers.graphics.sources.connections.StreamConnection")],kt);var Bt=kt;const zt=o.a.getLogger("esri.layers.graphics.sources.connections.WebSocketConnection");var Ut,Gt;(Gt=Ut||(Ut={}))[Gt.CONNECTING=0]="CONNECTING",Gt[Gt.OPEN=1]="OPEN",Gt[Gt.CLOSING=2]="CLOSING",Gt[Gt.CLOSED=3]="CLOSED";let qt=class extends Bt{constructor(e){super(),this.errorString=null;const{geometryType:t,spatialReference:i,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=Object(Pt.a)(t,s,i),this._open()}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){Object(m.g)(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(Object(m.f)(this._websocket))return"disconnected";switch(this._websocket.readyState){case Ut.CONNECTING:case Ut.OPEN:return"connected";case Ut.CLOSING:case Ut.CLOSED:return"disconnected"}}async _tryCreateWebSocket(e=this._config.source.path,t=1e3,i=0){try{if(this.destroyed)return;this._websocket=await this._createWebSocket(e),this.notifyChange("connectionStatus")}catch(s){const r=t/1e3;return this._config.maxReconnectionAttempts&&i>=this._config.maxReconnectionAttempts?(zt.error(new ot.a("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()):(zt.error(new ot.a("websocket-connection",`Failed to connect. Attempting to reconnect in ${r}s`,s)),await Object(u.a)(t),this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),i+1))}}_createWebSocket(e){const t=new WebSocket(e),i=Object(u.c)((e,i)=>{t.onopen=()=>e(t),t.onclose=e=>i(e)});return i.then(()=>{if(this.destroyed)return t.onclose=()=>{},void t.close();t.onclose=e=>this._onClose(e),t.onerror=e=>this._onError(e),t.onmessage=e=>this._onMessage(e)}),i}async _handshake(e=1e4){const t=this._websocket;if(Object(m.f)(t))return;const i=Object(u.g)(),s=t.onmessage,{filter:r,outFields:n,spatialReference:o}=this._config;return i.timeout(e),t.onmessage=e=>{var a;let c=null;try{c=JSON.parse(e.data)}catch(e){}c&&"object"==typeof c||(zt.error(new ot.a("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),i.reject(),this.destroy()),(null==(a=c.spatialReference)?void 0:a.wkid)!==(null==o?void 0:o.wkid)&&(zt.error(new ot.a("websocket-connection","Protocol violation. Handshake failed - expected wkid of "+o.wkid,e.data)),i.reject(),this.destroy()),"json"!==c.format&&(zt.error(new ot.a("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),i.reject(),this.destroy()),r&&c.filter!==r&&zt.error(new ot.a("websocket-connection","Tried to set filter, but server doesn't support it")),n&&c.outFields!==n&&zt.error(new ot.a("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=s,i.resolve()},t.send(JSON.stringify({filter:r,outFields:n,format:"json",spatialReference:{wkid:o.wkid}})),i.promise}_onMessage(e){try{const t=JSON.parse(e.data);if("featureResult"!==t.type)throw new ot.a("websocket-connection","Protocol violation - Expected to find message of type 'featureResult'",t);for(const e of t.features)this._featureZScaler&&this._featureZScaler(e.geometry),this.onFeature(e)}catch(e){return zt.error(new ot.a("websocket-connection","Failed to parse message",e)),void this.destroy()}}_onError(e){const t="Encountered an error over WebSocket connection";this._set("errorString",t),zt.error("websocket-connection",t)}_onClose(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&zt.error("websocket-connection","WebSocket closed unexpectedly with error code "+e.code),this.destroyed||this._open()}};Object(r.a)([Object(c.b)()],qt.prototype,"connectionStatus",null),Object(r.a)([Object(c.b)()],qt.prototype,"errorString",void 0),qt=Object(r.a)([Object(l.a)("esri.layers.graphics.sources.connections.WebSocketConnection")],qt);var Vt=i(116);const Xt=o.a.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection"),Wt={maxQueryDepth:5,maxRecordCountFactor:3};let Ht=class extends qt{constructor(e){super({...Wt,...e})}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||Xt.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");const t=await this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:i,outFields:s}=this._config;this.destroyed||this._setFilter(i,s)}_onMessage(e){let t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void Xt.error(new ot.a("geoevent-connection","Failed to parse message",e))}this.onFeature(t)}async _fetchServiceDefinition(e){const t=Object(at.default)(e.path,{query:{f:"json"},responseType:"json"}),i=(await t).data;return this._serviceDefinition=i,i}async _fetchWebSocketUrl(e,t){const i=e[0],{urls:s,token:r}=i;return`${this._inferWebSocketBaseUrl(s)}/subscribe?outSR=${t.wkid}${r?"&token="+r:""}`}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(-1!==t.indexOf("wss"))return t;return Xt.error(new ot.a("geoevent-connection","Unable to infer WebSocket url",e)),null}async _setFilter(e,t){const i=this._websocket;if(Object(m.f)(i)||Object(m.f)(e)&&Object(m.f)(t))return;const s=JSON.stringify({filter:this._serializeFilter(e,t)});let r=!1;const n=Object(u.g)();return i.onmessage=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(Xt.error(new ot.a("geoevent-connection","Failed to set service filter",t.error)),this._set("errorString","Could not set service filter - "+t.error),n.reject(t.error)),i.onmessage=this._onMessage.bind(this),r=!0,n.resolve())},i.send(s),setTimeout(()=>{r||(this.destroyed||this._websocket!==i||Xt.error(new ot.a("geoevent-connection","Server timed out when setting filter")),n.reject())},1e4),n.promise}_serializeFilter(e,t){const i={};if(Object(m.f)(e)&&Object(m.f)(t))return i;if(Object(m.g)(e)&&e.geometry)try{const t=Object(x.a)(e.geometry);if("extent"!==t.type)throw new ot.a("Expected extent but found type "+t.type);i.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(e){Xt.error(new ot.a("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return Object(m.g)(e)&&e.where&&"1 = 1"!==e.where&&(i.where=e.where),Object(m.g)(t)&&(i.outFields=t.join(",")),i}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,i=e.attributes[t];if(!this._relatedFeatures.has(i))return Xt.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;const{attributes:s,geometry:r}=this._relatedFeatures.get(i);for(const t in s)e.attributes[t]=s[t];return r&&(e.geometry=r),e.geometry||e.centroid||Xt.error(new ot.a("geoevent-connection","Found malformed feature - no geometry found",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,i=this._queryRelatedFeatures(e),s=this._queryArchive(t);await i;const r=await s;if(!r)return;for(const e of r.features)this.onFeature(this._enrich(e))}catch(e){Xt.error(new ot.a("geoevent-connection","Encountered an error when querying buddy services",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new Vt.default({url:e}),{capabilities:i}=await t.load(),s=i.query.supportsMaxRecordCountFactor,r=i.query.supportsPagination,n=i.query.supportsCentroid,o=this._config.maxRecordCountFactor,a=t.capabilities.query.maxRecordCount,c=s?a*o:a,l=new st.a;if(l.outFields=Object(m.n)(this._config.outFields,["*"]),l.where=Object(m.n)(Object(m.e)(this._config.filter,"where"),"1=1"),l.returnGeometry=!0,l.returnExceededLimitFeatures=!0,l.outSpatialReference=P.a.fromJSON(this._config.spatialReference),n&&(l.returnCentroid=!0),s&&(l.maxRecordCountFactor=o),r)return l.num=c,t.destroy(),this._queryPages(e,l);const u=await Object(lt.executeQuery)(e,l,this._config.sourceSpatialReference);return t.destroy(),u.data}async _queryPages(e,t,i=[],s=0){t.start=Object(m.g)(t.num)?s*t.num:null;const{data:r}=await Object(lt.executeQuery)(e,t,this._config.sourceSpatialReference);return r.exceededTransferLimit&&s<this._config.maxQueryDepth?(r.features.forEach(e=>i.push(e)),this._queryPages(e,t,i,s+1)):(i.forEach(e=>r.features.push(e)),r)}_addRelatedFeatures(e){const t=new Map,i=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const e of i){const i=e.attributes[s];t.set(i,e)}this._relatedFeatures=t}};Ht=Object(r.a)([Object(l.a)("esri.layers.graphics.sources.connections.GeoEventConnection")],Ht);var Qt=Ht;function Yt(e,t){const i=e.weakClone(),s=Object(ze.s)(t,e.geometry.coords[0]),r=Object(ze.t)(t,e.geometry.coords[1]);return i.geometry=new pt.a([],[s,r]),i}function $t(e,t){const i=Object(je.a)(9,function(e){switch(e){case"esriGeometryPoint":return e=>({minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]});default:return e=>{let t=1/0,i=1/0,s=-1/0,r=-1/0;return e.geometry.forEachVertex((e,n)=>{t=Math.min(t,e),i=Math.min(i,n),s=Math.max(s,e),r=Math.max(r,n)}),{minX:t,minY:i,maxX:s,maxY:r}}}}(t));return i.load(e),i}function Zt(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}class Jt{constructor(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map}get _features(){const e=[];return this._objectIdToFeature.forEach(t=>e.push(t)),e}add(e){this._objectIdToFeature.set(e.objectId,e),this._index=null}get(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null}forEach(e){this._objectIdToFeature.forEach(e)}search(e){return this._index||(this._index=$t(this._features,this._geometryType)),Zt(this._index,e)}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._objectIdToFeature.size}}class Kt extends jt{constructor(e){super(e),this.type="geoevent",this._dataReceiveEventEnabled=!1,this._updateInfo={websocket:0,client:0};const{outSR:t}=e,{geometryType:i,objectIdField:s,timeInfo:r,purgeOptions:n,source:o,spatialReference:a,serviceFilter:c,maxReconnectionAttempts:l,maxReconnectionInterval:u}=e.serviceInfo,h=new Jt(this._onUpdate.bind(this),i),d=new class{constructor(e,t,i,s,r=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=s,this.store=e,this.objectIdField=t,this.purgeInterval=r,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}add(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return;const t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){const e=Object(m.g)(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,i=Object(O.c)(e,0,1e3);this._trackIdToObservations.set(t,new Lt(i))}const i=this._trackIdToObservations.get(t).enqueue(e.objectId);Object(m.g)(i)&&(this._addOrUpdated.has(i)?this._addOrUpdated.delete(i):this._removed.push(i))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),i=performance.now();i-this._lastPurge>=this.purgeInterval&&(this._purge(i),this._lastPurge=i);const s=[];if(Object(m.g)(t))for(const e of t){const t=this.store.removeById(e);Object(m.g)(t)&&s.push(t)}if(Object(m.g)(e))for(const t of e)t.attributes.__esri_timestamp__=i,this.store.add(t);(e||s)&&this.store.update(e,s)}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach(i=>e[t++]=i),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;Object(m.g)(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;t>e.displayCount&&this._trackIdToObservations.forEach(i=>{if(t>e.displayCount&&i.size){const e=Object(m.m)(i.dequeue());this._removed.push(e),t--}})}_purgeByAge(e){var t;if(!e.age||!(null==(t=this._timeInfo)?void 0:t.startTimeField))return;const i=60*e.age*1e3,s=this._maxAge-i;this.store.forEach(e=>{e.attributes[this._timeInfo.startTimeField]<s&&this._removed.push(e.objectId)})}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const i=e+60*t.ageReceived*1e3;this.store.forEach(e=>{e.attributes.__esri_timestamp__<i&&this._removed.push(e.objectId)})}_purgeTracks(){this._trackIdToObservations.forEach((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)})}}(h,s,r,n),f=function(e,t,i,s,r,n,o){const a=0===e.path.indexOf("wss://")||0===e.path.indexOf("ws://"),c={source:e,sourceSpatialReference:t,spatialReference:i,geometryType:s,filter:r,maxReconnectionAttempts:n,maxReconnectionInterval:o};return a?new qt(c):new Qt(c)}(o,a,t,i,c,l,u);this._store=h,this._manager=d,this._connection=f,this._quantize=function(e){switch(e){case"esriGeometryPoint":return Yt;case"esriGeometryPolygon":case"esriGeometryPolyline":default:return(t,i)=>{const s=t.weakClone(),r=new pt.a,n=Object(ze.r)(r,t.geometry,!1,!1,e,i,!1,!1);return s.geometry=n,s}}}(i),this._handles=[this._connection.on("feature",e=>this._onFeature(e)),this._connection.watch("connectionStatus",e=>this.events.emit("connectionStatus",e)),this._connection.watch("errorString",e=>this.events.emit("errorString",e))];let _=performance.now();this._updateIntervalId=setInterval(()=>{const t=performance.now(),i=t-_;if(i>2500){_=t;const e=Math.round(this._updateInfo.client/(i/1e3)),s=Math.round(this._updateInfo.websocket/(i/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:e,websocket:s})}e.canAcceptRequest()&&this._manager.checkForUpdates()},16)}destroy(){clearInterval(this._updateIntervalId),this._handles.forEach(e=>e.remove()),this._connection.destroy()}_fetchDataTile(){}enableEvent(e,t){"data-received"===e&&(this._dataReceiveEventEnabled=t)}get updating(){return!1}subscribe(e){super.subscribe(e);const t=this._getTileFeatures(e);this._onRequest({tile:e,id:e.key.id,features:t,end:!0},"new")}unsubscribe(e){super.unsubscribe(e)}forEachRequest(e,t){const i=this._subscriptions.get(e),{tile:s,signal:r}=i;t({tile:s,id:e,features:this._getTileFeatures(s),end:!0},{signal:r})}async resend(e){this._subscriptions.forEach(t=>{const{tile:i}=t,s={tile:i,id:i.id,features:this._getTileFeatures(i),end:!0};this._onRequest(s,"update",e)})}_getTileFeatures(e){const t=this._store.search(e).map(t=>this._quantize(t,e.transform));return qe.fromOptimizedFeatures(t,this.geometryType,e.transform)}_onFeature(e){this._updateInfo.websocket++;try{this._dataReceiveEventEnabled&&this.events.emit("feature",e);const t=Object(ze.a)(e,this.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(e){}}async _onUpdate(e,t){const i=Object(m.a)(e,e=>$t(e,this.geometryType)),s=Object(m.a)(t,e=>$t(e,this.geometryType));Object(m.g)(e)&&(this._updateInfo.client+=e.length),this._subscriptions.forEach((e,t)=>{const r=e.tile,n=Object(m.a)(i,e=>Zt(e,r)),o=Object(m.a)(n,e=>e.map(e=>this._quantize(e,r.transform))),a=Object(m.a)(o,e=>qe.fromOptimizedFeatures(e,this.geometryType,r.transform)),c=Object(m.a)(s,e=>Zt(e,r)),l=Object(m.a)(c,e=>e.map(e=>e.objectId));this._onRequest({tile:r,id:t,features:a,remove:Object(m.n)(l,[]),end:!0},"update")})}}const ei=o.a.getLogger("esri.views.2d.layers.features.sources.FeatureSource");class ti extends At{constructor(e){super(e)}async _fetchDataTile(e){const t=this._subscriptions.get(e.key.id);let i=!1,s=0,r=0;const n=(s,n)=>{r--,Object(u.u)(t);const o=s.reader,a=s.query;if(!o.exceededTransferLimit){if(i=!0,0!==n&&!o.hasFeatures){const i={tile:e,id:e.id,features:o,end:0===r};return t.requests.done.push({request:i,query:a}),void this._onRequest(i,"new")}const s={tile:e,id:e.id,features:o,end:0===r};return t.requests.done.push({request:s,query:a}),void this._onRequest(s,"new")}const c={tile:e,id:e.id,features:o,end:i&&0===r};t.requests.done.push({request:c,query:a}),this._onRequest(c,"new")};let o=0,a=0;for(;!i&&a++<20;){let a;for(let c=0;c<o+1;c++){const o=s++;r++,a=this._fetchDataTilePage(e,o,t).then(e=>e&&n(e,o)).catch(t=>{i=!0,Object(u.l)(t)||(ei.error(new ot.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t})),this._onRequest({tile:e,id:e.id,features:null,end:i},"new"))})}await a,Object(u.u)(t),o=Math.min(o+2,6)}}async _fetchDataTilePage(e,t,i){const s=this._sourceQueryInfo,r=this._createQuery(e,{start:8e3*t,num:8e3,maxRecordCountFactor:3,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()});try{const n=i.signal,o=await this._queue.push({tile:e,query:r,signal:n,depth:t});return Object(u.u)(i),o?s!==this._sourceQueryInfo?this._fetchDataTilePage(e,t,i):{reader:o,query:r}:null}catch(e){return Object(u.v)(e),null}}}let ii=0;class si{constructor(e,t){this.didSend=!1,this.dataTileCount=0,this.update=ke.all(),this._abortController=new AbortController,this.invalid=!1,this.displayTile=e,this._pixelBuffer=t,this.partitions=ni(e,t)}setUpdate(e,t){this.update=e,this.dataTileCount=0,t!==this._pixelBuffer&&(this._pixelBuffer=t,this.partitions=ni(this.displayTile,t)),e.mesh&&(this.didSend=!1)}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}}class ri{constructor(e,t,i){this.resolved=!1,this.tile=t,this.offset=e,this.extent=i}reset(){this.resolved=!1}}function ni(e,t){const i=[];if(i.push(new ri([0,0],e,null)),0===t)return i;const s=Math.min(t,rt.p),r=rt.p;return i.push(new ri([-r,-r],e.neighbor(-1,-1),[r-s,r-s,r,r])),i.push(new ri([0,-r],e.neighbor(0,-1),[0,r-s,r,r])),i.push(new ri([r,-r],e.neighbor(1,-1),[0,r-s,s,r])),i.push(new ri([-r,0],e.neighbor(-1,0),[r-s,0,r,r])),i.push(new ri([r,0],e.neighbor(1,0),[0,0,s,r])),i.push(new ri([-r,r],e.neighbor(-1,1),[r-s,0,r,s])),i.push(new ri([0,r],e.neighbor(0,1),[0,0,r,s])),i.push(new ri([r,r],e.neighbor(1,1),[0,0,s,s])),i}class oi{constructor(e,t,i){this.type="remote",this._pendingEdits=new Set,this._queryInfo=null,this._subscriptions={display:new Map},this._invalid={outFields:!1,queryFilterParameters:!1};const s=this._onDataTileRequest.bind(this);this._source=function(e,t,i,s,r){const n=function(e,t,i,s,r){switch(e.type){case"stream":return{type:"geoevent",serviceInfo:e,onRequest:s,outSR:t,canAcceptRequest:r};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onRequest:s,outSR:t,origin:function(e){return Array.isArray(e)?"local":"path"in e&&Object(nt.c)(e.path)?"hosted":"unknown"}(e.source),tileInfoView:i,canAcceptRequest:r}}}(e,t,i,s,r);switch(n.type){case"feature":switch(n.origin){case"hosted":case"local":return new ti(n);case"unknown":return new Nt(n)}case"geoevent":return new Kt(n)}}(e,t,i,s,()=>this.canAcceptPatch()),this._serviceInfo=e,this._geometryType=e.geometryType,this._outSR=t}destroy(){this._getSubscriptions().map(({displayTile:e})=>this.unsubscribe(e)),this._source.destroy()}get updating(){return this._source.updating||this._getSubscriptions().some(e=>!e.didSend)}get isStream(){return"geoevent"===this._source.type}get sourceEvents(){return"geoevent"===this._source.type?{type:"geoevent",events:this._source.events}:{type:"feature",events:this._source.events}}enableEvent(e,t){this._source.enableEvent(e,t)}setViewState(e){this._source.setViewState(e)}update(e,t){var i,s,r,o;const a=this._serviceInfo.fields.length,c=null!=(i=null==(s=this._schema)?void 0:s.outFields)?i:[],l=null!=(r=null==(o=this._schema)?void 0:o.pixelBuffer)?r:0,u=t.outFields.filter(e=>-1===c.indexOf(e)),h=[...c,...u],d=0===t.pixelBuffer?0:Math.max(t.pixelBuffer,l);t.pixelBuffer=d,t.outFields=h.length>=.75*a?["*"]:h,t.outFields.sort();const f=Object(tt.a)(this._schema,t);if(this._subscriptions.display.forEach(t=>{t.invalid&&(e.queryFilter=!0)}),!f)return;const _=this._schema&&Object(tt.b)(f,"outFields"),p=this._schema&&Object(tt.b)(f,"pixelBuffer"),g=this._schema&&Object(tt.c)(f,["definitionExpression","gdbVersion","historicMoment"]);Object(n.a)("esri-2d-update-debug")&&console.debug("Applying Update - Source:",f);const b={returnCentroid:"esriGeometryPolygon"===this._geometryType,returnGeometry:!0,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:[this._serviceInfo.objectIdField+" ASC"],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?new Date(t.historicMoment):null,timeExtent:it.a.fromJSON(t.timeExtent)};e.source=!0,p&&(e.why.mesh.push("Pixel buffer changed"),e.mesh=!0),g&&(e.why.mesh.push("Layer filter changed"),e.why.source.push("Layer filter changed"),e.mesh=!0,e.queryFilter=!0,this._invalid.queryFilterParameters=!0),_&&(e.why.source.push("Layer required fields changed"),this._invalid.outFields=!0),this._schema=t,this._source.update(b),this._queryInfo=b}subscribe(e){this._subscriptions.display.has(e.id)||this._subscribeDisplayTile(e)}unsubscribe(e){if(!this._subscriptions.display.has(e.id))return;const t=this._subscriptions.display.get(e.id);this._subscriptions.display.delete(e.id),this._source.unsubscribe(e),t.abort()}forEachRequest(e,t){this._source.forEachRequest(e,t)}query(e){return this._source.query(e)}createQuery(){return new st.a({...this._queryInfo})}createTileQuery(e){if("stream"===this._serviceInfo.type)throw new Error("Service does not support tile  queries");const t=this.createQuery();return t.quantizationParameters=e.getQuantizationParameters(),t.resultType="tile",t.geometry=e.extent,"esriGeometryPolyline"===this._serviceInfo.geometryType&&(t.maxAllowableOffset=e.resolution),this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,t.maxAllowableOffset=e.resolution),t}invalidate(){this._subscriptions.display.forEach(e=>e.invalid=!0)}forEachPendingEdit(e){this._getSubscriptions().some(({invalid:e})=>e)?this._pendingEdits.forEach(e):this._pendingEdits.clear()}async onEdits(e){const t=e.addedFeatures.filter(e=>!e.error).map(e=>e.objectId),i=e.updatedFeatures.filter(e=>!e.error).map(e=>e.objectId),s=e.deletedFeatures.filter(e=>!e.error).map(e=>e.objectId),r=[...t,...i];s.forEach(e=>{this._pendingEdits.has(e)&&this._pendingEdits.delete(e)}),r.forEach(e=>this._pendingEdits.add(e));const n=this._getSubscriptions().map(({displayTile:e})=>e).map(e=>{const t=this.createTileQuery(e);return t.objectIds=r,{tile:e,query:t}}).map(async({tile:e,query:t})=>({tile:e,result:await this._source.query(t)}));(await Object(u.b)(n)).forEach(({tile:e,result:t})=>{const r=this._subscriptions.display.get(e.key.id);if(!r)return;const n=r.signal,o=ke.all();this.onDisplayTilePatch({type:"update",id:e.key.id,version:ii++,update:o,addOrUpdate:t,remove:[...i,...s],end:!0,noData:!1},{signal:n})}),this.invalidate()}async resubscribe(e,t=!1){const i=this._schema.pixelBuffer;this._subscriptions.display.forEach(t=>t.setUpdate(e,i));let s=!1;if(this._subscriptions.display.forEach(e=>{e.invalid&&(s=!0)}),this._invalid.outFields&&(this._invalid.outFields=!1),t||this._invalid.queryFilterParameters||s){const e=this._getSubscriptions().map(({displayTile:e})=>e);e.forEach(e=>this.unsubscribe(e)),e.forEach(e=>this.subscribe(e)),this._source.resume(),this._invalid.queryFilterParameters=!1}else e.mesh?await this._source.resend({dataTileOnly:!1}):await this._source.resend({dataTileOnly:!0})}pause(){this._source.pause()}resume(){this._source.resume()}_getSubscriptions(){const e=[];return this._subscriptions.display.forEach(t=>{e.push(t)}),e}_subscribeDisplayTile(e){const t=new si(e,this._schema.pixelBuffer);this._subscriptions.display.set(e.id,t),this._source.subscribe(e);for(const i of t.partitions){const t=i.tile,s=this._source.get(t.id);if(Object(m.g)(s))for(const t of s.requests.done)this._onPartitionMessage(e.id,i,t.request,"new")}}_onDataTileRequest(e,t,i){const s=this._subscriptions.display.get(e.id);if(i&&i.dataTileOnly){for(const i of s.partitions)if(i.tile.id===e.id){this._onPartitionMessage(e.id,i,e,t);break}}else{for(const i of s.partitions)if(i.tile.id===e.id){this._onPartitionMessage(e.id,i,e,t);break}this._subscriptions.display.forEach((i,s)=>{if(s!==e.id)for(const r of i.partitions)if(r.tile.id===e.id){this._onPartitionMessage(s,r,e,t);break}})}}_onPartitionMessage(e,t,i,s){const r=Object(m.a)(i.features,e=>function(e,t){if(Object(m.f)(t.extent))return e;const{offset:i,extent:s}=t,[r,n,o,a]=s,[c,l]=i;return e.extent(r,n,o,a).transform(c,l)}(e,t)),n=this._subscriptions.display.get(e),o=n.signal;let a=n.update;n.didSend||(s="replace"),Object(m.g)(r)&&!r.seen&&(a=ke.all(),r.seen=!0);let c=!1;i.end&&(t.resolved=!0,c=e===t.tile.id),n.didSend=!0,this.onDisplayTilePatch({type:s,id:e,version:ii++,update:a,addOrUpdate:r,remove:i.remove||[],noData:i.noData,end:c},{signal:o})}}new Float64Array(2),new Float64Array(2);function ai(e,t,i,s){s%2&&(s+=1);let r=0,n=0,o=-90,a=90,c=-180,l=180;for(let e=0;e<s/2;e++){for(let t=0;t<5;t++){const s=(c+l)/2,n=i>s?1:0;r|=n<<29-(t+5*e),c=(1-n)*c+n*s,l=(1-n)*s+n*l}for(let i=0;i<5;i++){const s=(o+a)/2,r=t>s?1:0;n|=r<<29-(i+5*e),o=(1-r)*o+r*s,a=(1-r)*s+r*a}}e.geohashX=r,e.geohashY=n}function ci(e,t,i,s,r){r%2&&(r+=1);let n=0,o=0,a=-90,c=90,l=-180,u=180;for(let e=0;e<r/2;e++){for(let t=0;t<5;t++){const i=(l+u)/2,r=s>i?1:0;n|=r<<29-(t+5*e),l=(1-r)*l+r*i,u=(1-r)*i+r*u}for(let t=0;t<5;t++){const s=(a+c)/2,r=i>s?1:0;o|=r<<29-(t+5*e),a=(1-r)*a+r*s,c=(1-r)*s+r*c}}e[2*t]=n,e[2*t+1]=o}class li{constructor(e=[],t=8096){this._nodes=0,this._root=new ui(0,0,0),this._statisticFields=e,this._pool=t?new Lt(8096):null}_acquire(e,t,i){this._nodes++;let s=null;return Object(m.g)(this._pool)&&(s=this._pool.dequeue()),Object(m.g)(s)?s.realloc(e,t,i):new ui(e,t,i)}_release(e){this._nodes--,Object(m.g)(this._pool)&&this._pool.enqueue(e)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){return Object(m.j)(this._pool,0,e=>e.size)}get depth(){let e=0;return this._forEachNode(t=>e=Math.max(e,t.depth)),e}dropLevels(e){this._forEachNode(t=>{if(t.depth>=e)for(let e=0;e<t.children.length;e++){const i=t.children[e];t.children[e]=null,i&&this._release(i)}})}clear(){this.dropLevels(0)}insert(e,t,i=0){const s=qe.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();s.next();const r=s.readGeometry();if(!r)return;const[n,o]=r.coords,a=e.geohashX,c=e.geohashY;this.insertCursor(s,e.displayId,n,o,a,c,t,i)}insertCursor(e,t,i,s,r,n,o,a=0){let c=this._root,l=0,u=0,h=0;for(;null!==c;){if(c.depth>=a&&(c.count+=1,c.xTotal+=i,c.yTotal+=s,c.xGeohashTotal+=r,c.yGeohashTotal+=n,c.displayId=t,this._updateStatisticsCursor(e,c,1)),l>=o)return void c.add(t);const d=Math.ceil((l+1)/2),f=Math.floor((l+1)/2),_=1-l%2,p=30-(3*d+2*f),g=30-(2*d+3*f),b=(r&7*_+3*(1-_)<<p)>>p,m=(n&3*_+7*(1-_)<<g)>>g,y=b+m*(8*_+4*(1-_));u=u<<3*_+2*(1-_)|b,h=h<<2*_+3*(1-_)|m,null==c.children[y]&&(c.children[y]=this._acquire(u,h,l+1)),l+=1,c=c.children[y]}}remove(e,t){const i=qe.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();i.next();const s=i.readGeometry();if(!s)return;const[r,n]=s.coords,o=e.geohashX,a=e.geohashY;this.removeCursor(i,r,n,o,a,t)}removeCursor(e,t,i,s,r,n){let o=this._root,a=0;for(;null!==o;){if(o.count-=1,o.xTotal-=t,o.yTotal-=i,o.xGeohashTotal-=s,o.yGeohashTotal-=r,this._updateStatisticsCursor(e,o,-1),a>=n)return void o.remove(e.getDisplayId());const c=Math.ceil((a+1)/2),l=Math.floor((a+1)/2),u=1-a%2,h=30-(3*c+2*l),d=30-(2*c+3*l),f=((s&7*u+3*(1-u)<<h)>>h)+((r&3*u+7*(1-u)<<d)>>d)*(8*u+4*(1-u)),_=o.children[f];1===_.count&&(this._release(_),o.children[f]=null),a+=1,o=_}}find(e,t,i){return this._root.find(e,t,i,0,0,0)}findSingleOccupancyNode(e,t,i,s,r){let n=this._root;for(;null!==n;){const o=n.depth,a=n.xNode,c=n.yNode,l=1-o%2,u=n.xGeohashTotal/n.count,h=n.yGeohashTotal/n.count;if(1===n.count&&e<u&&u<=i&&t<h&&h<=s)return n;if(o>=r){n=n.next;continue}const d=Math.ceil((o+1)/2),f=Math.floor((o+1)/2),_=30-(3*d+2*f),p=30-(2*d+3*f),g=~((1<<_)-1),b=~((1<<p)-1),m=(e&g)>>_,y=(t&b)>>p,x=(i&g)>>_,T=(s&b)>>p,v=a<<3*l+2*(1-l),O=c<<2*l+3*(1-l),w=v+8*l+4*(1-l),S=O+4*l+8*(1-l),E=Math.max(v,m),F=Math.max(O,y),I=Math.min(w,x),j=Math.min(S,T);let M=null,A=null;for(let e=F;e<=j;e++)for(let t=E;t<=I;t++){const i=t-v+(e-O)*(8*l+4*(1-l)),s=n.children[i];s&&(M||(M=s,M.next=n.next),A&&(A.next=s),A=s,s.next=n.next)}n=M||n.next}return null}getRegionDisplayIds(e,t,i,s,r){let n=this._root;const o=[];for(;null!==n;){const a=n.depth,c=n.xNode,l=n.yNode;if(a>=r){const r=n.xGeohashTotal/n.count,a=n.yGeohashTotal/n.count;e<=r&&r<=i&&t<=a&&a<=s&&n.displayIds.forEach(e=>o.push(e)),n=n.next;continue}const u=Math.ceil((a+1)/2),h=Math.floor((a+1)/2),d=1-a%2,f=30-(3*u+2*h),_=30-(2*u+3*h),p=~((1<<f)-1),g=~((1<<_)-1),b=(e&p)>>f,m=(t&g)>>_,y=(i&p)>>f,x=(s&g)>>_,T=c<<3*d+2*(1-d),v=l<<2*d+3*(1-d),O=T+8*d+4*(1-d),w=v+4*d+8*(1-d),S=Math.max(T,b),E=Math.max(v,m),F=Math.min(O,y),I=Math.min(w,x);let j=null,M=null;for(let e=E;e<=I;e++)for(let t=S;t<=F;t++){const i=t-T+(e-v)*(8*d+4*(1-d)),s=n.children[i];s&&(j||(j=s,j.next=n.next),M&&(M.next=s),M=s,s.next=n.next)}n=j||n.next}return o}getRegionStatistics(e,t,i,s,r){let n=this._root,o=0,a=0,c=0;const l={};let u=0;for(;null!==n;){const h=n.depth,d=n.xNode,f=n.yNode;if(h>=r){const r=n.xGeohashTotal/n.count,h=n.yGeohashTotal/n.count;e<r&&r<=i&&t<h&&h<=s&&(o+=n.count,a+=n.xTotal,c+=n.yTotal,1===n.count&&(u=n.displayId),this._aggregateStatistics(l,n.statistics)),n=n.next;continue}const _=Math.ceil((h+1)/2),p=Math.floor((h+1)/2),g=1-h%2,b=30-(3*_+2*p),m=30-(2*_+3*p),y=~((1<<b)-1),x=~((1<<m)-1),T=(e&y)>>b,v=(t&x)>>m,O=(i&y)>>b,w=(s&x)>>m,S=d<<3*g+2*(1-g),E=f<<2*g+3*(1-g),F=S+8*g+4*(1-g),I=E+4*g+8*(1-g),j=Math.max(S,T),M=Math.max(E,v),A=Math.min(F,O),R=Math.min(I,w);let C=null,D=null;for(let r=M;r<=R;r++)for(let h=j;h<=A;h++){const d=h-S+(r-E)*(8*g+4*(1-g)),f=n.children[d];if(f){if(r!==M&&r!==R&&h!==j&&h!==A){const r=f.xGeohashTotal/f.count,n=f.yGeohashTotal/f.count;e<r&&r<=i&&t<n&&n<=s&&(o+=f.count,a+=f.xTotal,c+=f.yTotal,1===f.count&&(u=f.displayId),this._aggregateStatistics(l,f.statistics));continue}C||(C=f,C.next=n.next),D&&(D.next=f),D=f,f.next=n.next}}n=C||n.next}return{count:o,attributes:this._normalizeStatistics(l,o),xTotal:a,yTotal:c,referenceId:u}}_forEachNode(e){let t=this._root;for(;null!==t;){const i=this._linkChildren(t)||t.next;e(t),t=i}}_linkChildren(e){let t=null,i=null;for(let s=0;s<=e.children.length;s++){const r=e.children[s];r&&(t||(t=r,t.next=e.next),i&&(i.next=r),i=r,r.next=e.next)}return t}_updateStatisticsCursor(e,t,i){for(const s of this._statisticFields){const r=s.name,n=s.inField?e.readAttribute(s.inField):e.getComputedNumericAtIndex(s.inFieldIndex);switch(s.statisticType){case"norm":{t.statistics[r]||(t.statistics[r]={});const o=s.inNormalizationField,a=e.readAttribute(o),c=t.statistics[r].onStatisticField||0,l=t.statistics[r].onStatisticNormalizationField||0;null==n||isNaN(n)||null==a||0===a||isNaN(a)||(t.statistics[r].onStatisticField=c+i*n,t.statistics[r].onStatisticNormalizationField=l+i*a);break}case"sum":case"avg":{t.statistics[r]||(t.statistics[r]={value:0,nanCount:0});const e=t.statistics[r].value,s=t.statistics[r].nanCount;null==n||isNaN(n)?t.statistics[r].nanCount=s+i:t.statistics[r].value=e+i*n;break}case"avg_angle":{t.statistics[r]||(t.statistics[r]={x:0,y:0,nanCount:0});const e=t.statistics[r].x,s=t.statistics[r].y,o=t.statistics[r].nanCount,a=Math.PI/180;null==n||isNaN(n)?t.statistics[r].nanCount=o+i:(t.statistics[r].x=e+i*Math.cos(n*a),t.statistics[r].y=s+i*Math.sin(n*a));break}case"mode":{t.statistics[r]||(t.statistics[r]={});const e=t.statistics[r][n]||0;t.statistics[r][n]=e+i;break}}}}_aggregateStatistics(e,t){for(const i of this._statisticFields){const s=i.name;switch(i.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":e[s]||(e[s]={});for(const i in t[s]){const r=e[s][i]||0;e[s][i]=r+t[s][i]}}}}_normalizeStatistics(e,t){const i={};for(const s of this._statisticFields){const r=s.name;switch(s.statisticType){case"norm":{const s=e[r];if(t&&null==s.onStatisticNormalizationField)break;if(t&&s.onStatisticNormalizationField){i[r]=s.onStatisticField/s.onStatisticNormalizationField;break}i[r]=0;break}case"sum":{if(!t)break;const{value:s,nanCount:n}=e[r];if(!(t-n))break;i[r]=s;break}case"avg":{if(!t)break;const{value:s,nanCount:n}=e[r];if(!(t-n))break;i[r]=s/(t-n);break}case"avg_angle":{if(!t)break;const{x:s,y:n,nanCount:o}=e[r];if(!(t-o))break;const a=s/(t-o),c=n/(t-o),l=180/Math.PI,u=Math.atan2(c,a)*l;i[r]=u;break}case"mode":{const t=e[r];let s=0,n=null;for(const e in t){const i=t[e];i>s&&(s=i,n=e)}i[r]="null"===n?null:n;break}}}return i}}class ui{constructor(e,t,i){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.displayIds=new Set,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(let e=0;e<this.children.length;e++)this.children[e]=null;this.xNode=e,this.yNode=t,this.depth=i}realloc(e,t,i){for(let e=0;e<this.children.length;e++)this.children[e]=null;return this.xNode=e,this.yNode=t,this.depth=i,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this.displayIds.clear(),this}add(e){this.displayIds.add(e)}remove(e){this.displayIds.delete(e)}getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),i=Math.floor(e/2),s=30-(3*t+2*i),r=30-(2*t+3*i);return function(e,t){let i=-90,s=90,r=-180,n=180;for(let o=0;o<t;o++){const t=Math.ceil((o+1)/2),a=Math.floor((o+1)/2),c=1-o%2,l=30-(3*t+2*a),u=30-(2*t+3*a),h=3*c+2*(1-c),d=2*c+3*(1-c),f=3*c+7*(1-c)<<u,_=(7*c+3*(1-c)<<l&e.geohashX)>>l,p=(f&e.geohashY)>>u;for(let e=h-1;e>=0;e--){const t=(r+n)/2,i=_&1<<e?1:0;r=(1-i)*r+i*t,n=(1-i)*t+i*n}for(let e=d-1;e>=0;e--){const t=(i+s)/2,r=p&1<<e?1:0;i=(1-r)*i+r*t,s=(1-r)*t+r*s}}return[r,i,n,s]}({geohashX:this.xNode<<s,geohashY:this.yNode<<r},this.depth)}find(e,t,i,s,r,n){if(s>=i)return this;const o=1-s%2,a=3*o+2*(1-o),c=2*o+3*(1-o),l=30-r-a,u=30-n-c,h=((e&7*o+3*(1-o)<<l)>>l)+((t&3*o+7*(1-o)<<u)>>u)*(8*o+4*(1-o)),d=this.children[h];return null==d?null:d.find(e,t,i,s+1,r+a,n+c)}}var hi=i(524);class di extends _t.a{constructor(e,t,i,s,r){super(new pt.a([],[t,i]),s,null,e),this.geohashBoundsInfo=r}get count(){return this.attributes.cluster_count}static create(e,t,i,s,r,n,o,a){const c=new di(t,i,s,n,o);return c.displayId=e.createDisplayId(!0),c.referenceId=a,c.tileLevel=r,c}update(e,t,i,s,r,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=i,this.attributes=s,this.geohashBoundsInfo=r,this.referenceId=null,this.referenceId=n,this}toJSON(){return{objectId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null,attributes:{...this.attributes,clusterId:this.objectId},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}}function fi(e){return 57.29577951308232*e}class _i extends hi.a{constructor(e,t,i){super(e,i),this.events=new Ie.a,this._geohashLevel=0,this._aggregateValueRanges={},this._aggregateValueRangesChanged=!1,this._geohashBuf=[],this._clusters=new Map,this._tiles=new Map,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=Object(ht.a)(t,P.a.WGS84),this._bitsets.geohash=i.getBitset(i.createBitset()),this._bitsets.inserted=i.getBitset(i.createBitset())}async updateSchema(e,t){const i=this._schema;try{await super.updateSchema(e,t),await this._projectionSupportCheck}catch(e){}const s=Object(tt.a)(i,t);e.mesh&&(e.targets.aggregate=!0),t&&(!Object(m.f)(s)||e.source||e.storage.filters)&&((Object(tt.b)(s,"params.fields")||!this._tree||e.source)&&(this._tree=new li(this._statisticFields),this._rebuildTree(),Object(n.a)("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),Object(n.a)("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",s),e.mesh=!0,e.targets[t.name]=!0,this._aggregateValueRanges={})}sweepFeatures(e,t){this._bitsets.inserted.forEachSet(i=>{if(!e.has(i)){const e=t.lookupByDisplayIdUnsafe(i);this._remove(e)}})}sweepClusters(e,t){this._clusters.forEach((i,s)=>{i&&i.tileLevel!==t&&(e.releaseDisplayId(i.displayId),this._clusters.delete(s))})}onTileData(e,t,i,s,r){if(!this._schema||Object(m.f)(t.addOrUpdate))return t;const n=this._tree,o=this._getTransforms(e,this._spatialReference);{const e=t.addOrUpdate.getCursor();for(;e.next();)this._update(e,s,n)}if(!r)return t;const a=new Array,c=this._schema.params.clusterRadius;this._getClustersForTile(a,e,c,i,n,o),t.type="replace"===t.type?"replace":"update",t.addOrUpdate=qe.fromOptimizedFeatures(a,"esriGeometryPoint"),t.addOrUpdate._storage=i;{const s=t.addOrUpdate.getCursor();for(;s.next();){const t=s.getDisplayId();this._bitsets.computed.unset(t),this.setComputedAttributes(i,s,t,e.scale)}}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t}onTileUpdate({added:e,removed:t}){if(e.length){const t=e[0].level;this._setGeohashLevel(t)}if(!this._schema)return;const i=this._schema.params.clusterRadius;t.forEach(e=>{this._tiles.delete(e.key.id),this._markTileClustersForDeletion(e,i)})}getAggregate(e){let t=null;return this._clusters.forEach(i=>{i&&i.displayId===e&&(t=i.toJSON())}),t}getDisplayId(e){const t=this._clusters.get(e);return t?t.displayId:null}getFeatureDisplayIdsForAggregate(e){const t=this._clusters.get(e);if(!t)return[];const i=t.geohashBoundsInfo;return this._tree.getRegionDisplayIds(i.xLL,i.yLL,i.xTR,i.yTR,i.level)}getDisplayIdForReferenceId(e){let t;return this._clusters.forEach(i=>{i&&i.referenceId===e&&(t=i.displayId)}),t}getAggregateValueRanges(){return this._aggregateValueRanges}forEach(e){this._clusters.forEach((t,i)=>{t&&e(t,i)})}size(){let e=0;return this.forEach(t=>e++),e}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),i=e.getXHydrate(),s=e.getYHydrate(),r=this._geohashBuf[2*t],n=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,i,s,r,n,this._geohashLevel))}_update(e,t,i){const s=e.getDisplayId(),r=this._bitsets.inserted,n=t.isVisible(s);if(n===r.has(s))return;if(!n)return void this._remove(e);const o=e.getXHydrate(),a=e.getYHydrate();if(!this._setGeohash(s,o,a))return;const c=this._geohashBuf[2*s],l=this._geohashBuf[2*s+1];i.insertCursor(e,s,o,a,c,l,this._geohashLevel),r.set(s)}_setGeohash(e,t,i){if(this._bitsets.geohash.has(e))return!0;const s=this._geohashBuf;if(this._spatialReference.isWebMercator){const r=fi(t/k.a.radius),n=r-360*Math.floor((r+180)/360);ci(s,e,fi(Math.PI/2-2*Math.atan(Math.exp(-1*i/k.a.radius))),n,12)}else{const r=Object(ht.b)({x:t,y:i},this._spatialReference,P.a.WGS84);if(!r)return!1;ci(s,e,r.y,r.x,12)}return this._bitsets.geohash.set(e),!0}_getClustersForTile(e,t,i,s,r,n,o=!0){const a=this._schema.params.clusterPixelBuffer,c=2*i,l=this._getGeohashLevel(t.key.level),u=Math.ceil(Math.pow(2,t.key.level)*rt.p/c),h=Math.ceil(a/c)+0,d=Math.ceil(rt.p/c),{row:f,col:_}=t.key,p=_*rt.p,g=f*rt.p,b=Math.floor(p/c)-h,y=Math.floor(g/c)-h,x=b+d+2*h,T=y+d+2*h,v=t.tileInfoView.getLODInfoAt(t.key.level);for(let i=b;i<=x;i++)for(let a=y;a<=T;a++){let c=i;v.wrap&&(c=i<0?i+u:i%u);const h=v.wrap&&i<0,d=v.wrap&&i%u!==i,f=this._lookupCluster(s,v,t.key.level,c,a,l,r);if(Object(m.g)(f)){const t=Object(m.a)(n,e=>h?e.left:d?e.right:e.tile);if(o&&Object(m.f)(t))continue;if(!f.count)continue;if(Object(m.g)(t)&&o){const i=f.geometry.clone();let s=f.attributes;i.coords[0]=Object(ze.s)(t,i.coords[0]),i.coords[1]=Object(ze.t)(t,i.coords[1]),1===f.count&&Object(m.g)(f.referenceId)&&(s={...f.attributes,referenceId:f.referenceId});const r=new _t.a(i,s);r.displayId=f.displayId,e.push(r)}}}}_getGeohashLevel(e){return Math.min(Math.ceil(e/2+2),12)}_setGeohashLevel(e){const t=this._getGeohashLevel(e),i=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==i)return this._geohashLevel=i,void this._rebuildTree()}_getTransforms(e,t){const i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},s=Object(L.d)(t);if(!s)return{tile:i,left:null,right:null};const[r,n]=s.valid;return{tile:i,left:{...i,translate:[n,e.bounds[3]]},right:{...i,translate:[r-n+e.bounds[0],e.bounds[3]]}}}_getClusterId(e,t,i){return(15&e)<<28|(16383&t)<<14|16383&i}_markForDeletion(e,t,i){const s=this._getClusterId(e,t,i);this._clusters.delete(s)}_getClusterBounds(e,t,i){const s=this._schema.params.clusterRadius,r=2*s;let n=i%2?t*r:t*r-s;const o=i*r;let a=n+r;const c=o-r,l=Math.pow(2,e.level)*rt.p;e.wrap&&n<0&&(n=0),e.wrap&&a>l&&(a=l);const u=n/rt.p,h=o/rt.p,d=a/rt.p,f=c/rt.p;return[e.getXForColumn(u),e.getYForRow(h),e.getXForColumn(d),e.getYForRow(f)]}_lookupCluster(e,t,i,s,r,n,o){const a=this._getClusterId(i,s,r),c=this._clusters.get(a),[l,u,h,d]=this._getClusterBounds(t,s,r),f={x:l,y:u},_={x:h,y:d};let p=0,g=0,b=0,y=0;if(this._spatialReference.isWebMercator){{const e=fi(f.x/k.a.radius);p=e-360*Math.floor((e+180)/360),g=fi(Math.PI/2-2*Math.atan(Math.exp(-1*f.y/k.a.radius)))}{const e=fi(_.x/k.a.radius);b=e-360*Math.floor((e+180)/360),y=fi(Math.PI/2-2*Math.atan(Math.exp(-1*_.y/k.a.radius)))}}else{const e=Object(ht.b)(f,this._spatialReference,P.a.WGS84),t=Object(ht.b)(_,this._spatialReference,P.a.WGS84);if(!e||!t)return null;p=e.x,g=e.y,b=t.x,y=t.y}const x={geohashX:0,geohashY:0},T={geohashX:0,geohashY:0};ai(x,g,p,n),ai(T,y,b,n);const v=x.geohashX,O=x.geohashY,w=T.geohashX,S=T.geohashY,E={xLL:v,yLL:O,xTR:w,yTR:S,level:n},F=o.getRegionStatistics(v,O,w,S,n),{count:I,xTotal:j,yTotal:M,referenceId:A}=F,R=I?j/I:0,C=I?M/I:0;if(0===I)return this._clusters.set(a,null),null;const D={cluster_count:I,...F.attributes},N=Object(m.g)(c)?c.update(R,C,i,D,E,A):di.create(e,a,R,C,i,D,E,A);return 0===I&&(N.geometry.coords[0]=(l+h)/2,N.geometry.coords[1]=(u+d)/2),this._clusters.set(a,N),this._updateAggregateValueRangeForCluster(N,N.tileLevel),N}_updateAggregateValueRangeForCluster(e,t){const i=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},s=i.minValue,r=i.maxValue;i.minValue=Math.min(s,e.count),i.maxValue=Math.max(r,e.count),this._aggregateValueRanges[t]=i,s===i.minValue&&r===i.maxValue||(this._aggregateValueRangesChanged=!0)}_markTileClustersForDeletion(e,t){const i=2*t,s=Math.ceil(rt.p/i),{row:r,col:n}=e.key,o=n*rt.p,a=r*rt.p,c=Math.floor(o/i),l=Math.floor(a/i);for(let t=c;t<c+s;t++)for(let i=l;i<l+s;i++)this._markForDeletion(e.key.level,t,i)}}function pi(e){if(!Object(u.l)(e)&&!function(e){return"worker:port-closed"===e.name}(e))throw e}let gi=class extends h.a{constructor(){super(...arguments),this._storage=new Je,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null,this._editing=!1}initialize(){this._initAttributeStore(),this._initStores(),this._initQueryEngine(),this._initSource(),this._updateQueue=new He({concurrency:4,process:(e,t)=>this._onDisplayTilePatch(e,{signal:t})}),this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this)),this.watch("updating",e=>!e&&this.onIdle())])}async startup(){this._initAttributeStore()}_initSource(){this._source=new oi(this.service,this.spatialReference,this.tileStore.tileScheme),this._source.onDisplayTilePatch=(e,t)=>(this._invalidated=!0,this._patchTile(e,t)),this._source.canAcceptPatch=()=>this._updateQueue.length<50;const e=this._source.sourceEvents;if("geoevent"===e.type){const t=e.events;this.handles.add([t.on("connectionStatus",e=>this.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:e}).catch(pi)),t.on("errorString",e=>this.remoteClient.invoke("setProperty",{propertyName:"errorString",value:e}).catch(pi)),t.on("feature",e=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(pi)),t.on("updateRate",e=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...e}}).catch(pi))])}}_initAttributeStore(){this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new Qe.a({type:"remote",initialize:(e,t)=>Object(u.k)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t}).catch(pi)),update:(e,t)=>Object(u.k)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t}).catch(pi)),render:e=>Object(u.k)(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}).catch(pi))},this.config)}_initStores(){const e={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new Ke.a(e,this._storage),this.aggregateStore=new _i(e,this.spatialReference,this._storage),this.handles.add(this.aggregateStore.events.on("valueRangesChanged",e=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}}).catch(pi)}))}_initQueryEngine(){var e;const t=this;null==(e=this.queryEngine)||e.destroy(),this.queryEngine=new et.a({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds:e=>t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map(e=>t.getObjectId(e))},timeInfo:this.service.timeInfo})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy()}get fieldsIndex(){return new Ue.a(this.service.fields)}get hasAggregates(){return!!this.config.schema.targets.aggregate}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){return this._source.updating||!!this._updateQueue.length}enableEvent(e){this._source.enableEvent(e.name,e.value)}async invalidate(e){if(!e.any())return;Object(n.a)("esri-2d-update-debug")&&e.describe();const t=this.tileStore.tiles.map(({key:e})=>{const t=Object(u.g)();return this._tileToResolver.set(e.id,t),t.promise}),i=this._updateQueue.takeAll();this._updateQueue.resume(),this.hasAggregates&&e.mesh&&e.targets.aggregate&&!e.queryFilter?this._repushAggregateMeshTiles(e):(this._source.resubscribe(e),Object(u.b)(t).then(()=>{this._source.resume()}),e.mesh&&await Object(Be.g)(this,"updating")),this.notifyChange("updating"),await Object(u.b)(t),this._updateQueue.pause();for(const e of i)this._patchTile(e);e.source&&(this._cleanupNeeded=!0)}resume(){return this._updateQueue.resume(),this._source.resume()}async update(e,t,i=!1){this._editing&&await Object(Be.g)(this,"updating"),i&&(this._source.pause(),this._updateQueue.pause()),this._set("config",t),this._schema=t.schema,this._initQueryEngine(),await Object(u.b)([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t),this.attributeStore.updateFilters(e,this)]),await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate)}async refresh(){this._source.resubscribe(ke.all(),!0),this._cleanupNeeded=!0,this.notifyChange("updating"),await Object(Be.g)(this,"updating",!0)}onTileUpdate(e){this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange("updating")}onIdle(){this.hasAggregates&&this._invalidated&&(this._repushAggregateMeshTiles(),this._invalidated=!1),this._markAndSweep()}async onEdits(e){if(this._editing)return await Object(Be.g)(this,"updating"),await Object(u.a)(16),this.onEdits(e);this._editing=!0;try{await this._source.onEdits(e),await Object(Be.g)(this,"updating")}catch(e){}this._editing=!1}queryExtent(e){return this.queryEngine.executeQueryForExtent(e)}queryFeatures(e){return this.queryEngine.executeQuery(e)}queryFeatureCount(e){return this.queryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.queryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.queryEngine.executeQueryForIds(e)}async queryStatistics(){return{...this.featureStore.storeStatistics,displayedFeatureCount:0,displayedVertexCount:0,displayPreProcessTime:0}}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(this._schema.targets.aggregate){const t=this.aggregateStore.getDisplayId(e);if(Object(m.f)(t)){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)}getFeature(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(Object(m.f)(t))return null;const i=t.readHydratedGeometry(),s=Object(ze.h)(i,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:s}}getAggregate(e){return this.aggregateStore.getAggregate(e)}async setHighlight(e){const t=e.map(e=>this.getDisplayId(e));return this.attributeStore.setHighlight(e,t)}_repushAggregateMeshTiles(e){for(const t of this.tileStore.tiles)this._patchTile({type:"replace",id:t.key.id,addOrUpdate:qe.fromOptimizedFeatures([],this.service.geometryType),remove:[],end:!0,noData:!1,update:e||ke.create({mesh:!0,targets:{aggregate:!0}})})}_maybeForceCleanup(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()}_patchTile(e,t){const i=this._updateQueue.push(e,t).then(()=>{this.notifyChange("updating")}).catch(e=>{this.notifyChange("updating")});return this.notifyChange("updating"),i}async _onDisplayTilePatch(e,t){Object(u.u)(t);const i=this.tileStore.get(e.id);if(!i)return;const s=e.update;e.remove.length&&(this._cleanupNeeded=!0);const r=[];for(const t of e.remove)r.push(this.featureStore.lookupDisplayId(t));e.remove=r;try{if(Object(m.f)(e.addOrUpdate))return this.processor.onTileData(i,{...e,addOrUpdate:null},t).catch(e=>{Object(u.v)(e)}),void this._finishedPatch(e);e.addOrUpdate._storage=this._storage;const r=e.addOrUpdate.hasFilter(),n=e.addOrUpdate.instance;e.addOrUpdate._arcadeSpatialReference=this.spatialReference,(!this.featureStore.hasInstance(n)||s.targets.feature&&!r)&&this.featureStore.onTileData(i,e,this._storage),!s.storage.data&&!s.storage.filters||r||(this.attributeStore.onTileData(i,e),this._source.isStream?await this.attributeStore.sendUpdates():this.attributeStore.sendUpdates()),this.hasAggregates&&s.targets.aggregate&&(this.aggregateStore.onTileData(i,e,this._storage,this.attributeStore,s.mesh),s.mesh&&(this.attributeStore.onTileData(i,e),this.attributeStore.sendUpdates())),s.mesh&&await this.processor.onTileData(i,e,t),this._maybeForceCleanup(),this._finishedPatch(e)}catch(e){Object(u.v)(e)}}_finishedPatch(e){(e.noData||e.end)&&this._tileToResolver.has(e.id)&&(this._tileToResolver.get(e.id).resolve(),this._tileToResolver.delete(e.id))}_markAndSweep(){if(this._lastCleanup=performance.now(),!this._cleanupNeeded&&!this._source.isStream)return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();const i=i=>{const s=this.featureStore.lookupDisplayId(i),r=(4294901760&this._storage.getInstanceId(s))>>>16;s&&(t.add(r),e.set(s))};for(const e of this.tileStore.tiles)this._source.forEachRequest(e.key.id,e=>{if(Object(m.f)(e.features))return;const t=e.features.getCursor();for(;t.next();){const e=t.getObjectId();i(e)}});this._source.forEachPendingEdit(e=>i(e)),this._updateQueue.forEach(e=>{for(const t of e.remove)i(t)}),this.config.schema.targets.aggregate&&(this.aggregateStore.sweepFeatures(e,this.featureStore),this.aggregateStore.sweepClusters(this._storage,this._level)),this.featureStore.sweepFeatures(e,this._storage),this.featureStore.sweepFeatureSets(t)}};Object(r.a)([Object(c.b)({constructOnly:!0})],gi.prototype,"tileStore",void 0),Object(r.a)([Object(c.b)()],gi.prototype,"config",void 0),Object(r.a)([Object(c.b)({readOnly:!0,dependsOn:["service"]})],gi.prototype,"fieldsIndex",null),Object(r.a)([Object(c.b)()],gi.prototype,"processor",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],gi.prototype,"remoteClient",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],gi.prototype,"service",void 0),Object(r.a)([Object(c.b)({dependsOn:["tileStore"]})],gi.prototype,"spatialReference",null),Object(r.a)([Object(c.b)()],gi.prototype,"updating",null),gi=Object(r.a)([Object(l.a)("esri.views.2d.layers.features.controllers.FeatureController2D")],gi);var bi=gi;const mi=new Set;function yi(){return mi}let xi=class extends h.a{constructor(){super(...arguments),this.controller=null,this.processor=null,this.remoteClient=null,this.tileStore=null,this.service=null,this.viewState=null}initialize(){this.handles.add(this.watch("updating",e=>{this.remoteClient.invoke("setUpdating",e).catch(e=>{})}))}destroy(){var e,t,i;null==(e=this.controller)||e.destroy(),null==(t=this.processor)||t.destroy(),null==(i=this.tileStore)||i.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||this.controller.updating}async startup({service:e,config:t,tileInfo:i}){if(this.service=e,!this.tileStore){const e=new class{constructor(e,t){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};const i=e.lods.slice();i.sort((function(e,t){return t.scale-e.scale}));const s=this._lodInfos=i.map(i=>xe.create(e,i,t));i.forEach((e,t)=>{this._infoByLevel[e.level]=s[t],this._infoByScale[e.scale]=s[t],this.scales[t]=e.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,i=!1){Se.set(t);const s=this._infoByLevel[Se.level];return s?s.getTileBounds(e,Se,i):e}getTileCoords(e,t,i=!1){Se.set(t);const s=this._infoByLevel[Se.level];return s?s.getTileCoords(e,Se,i):e}getTileCoverage(e,t=192,i="closest"){const s="closest"===i?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),r=Oe.pool.acquire(s),n=this._wrap;let o,a,c,l=1/0,u=-1/0;const h=r.spans;Fe[0][0]=Fe[0][1]=Fe[1][1]=Fe[3][0]=-t,Fe[1][0]=Fe[2][0]=e.size[0]+t,Fe[2][1]=Fe[3][1]=e.size[1]+t;for(const t of Fe)e.toMap(t,t),t[0]=s.getColumnForX(t[0]),t[1]=s.getRowForY(t[1]);const d=[];let f=3;for(let e=0;e<4;e++){if(Fe[e][1]===Fe[f][1]){f=e;continue}const t=Ee.create(Fe[e],Fe[f]);l=Math.min(t.ymin,l),u=Math.max(t.ymax,u),void 0===d[t.ymin]&&(d[t.ymin]=[]),d[t.ymin].push(t),f=e}if(null==l||null==u||u-l>100)return null;let _=[];for(o=l;o<u;){null!=d[o]&&(_=_.concat(d[o])),a=1/0,c=-1/0;for(let e=_.length-1;e>=0;e--){const t=_[e];a=Math.min(a,t.getLeftCol()),c=Math.max(c,t.getRightCol())}if(a=Math.floor(a),c=Math.floor(c),o>=s.first[1]&&o<=s.last[1])if(n)if(s.size[0]<s.worldSize[0]){const e=Math.floor(c/s.worldSize[0]);for(let t=Math.floor(a/s.worldSize[0]);t<=e;t++)h.push(new we(o,Math.max(s.getFirstColumnForWorld(t),a),Math.min(s.getLastColumnForWorld(t),c)))}else h.push(new we(o,a,c));else a>s.last[0]||c<s.first[0]||(a=Math.max(a,s.first[0]),c=Math.min(c,s.last[0]),h.push(new we(o,a,c)));o+=1;for(let e=_.length-1;e>=0;e--){const t=_[e];t.ymax>=o?t.incrRow():_.splice(e,1)}}return r}getTileParentId(e){Se.set(e);const t=this._infoByLevel[Se.level],i=this._lodInfos.indexOf(t)-1;return i<0?null:(this._getTileIdAtLOD(Se,this._lodInfos[i],Se),Se.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){Se.set(t);const i=this._infoByLevel[Se.level],s=e.lodInfo;if(s.resolution>i.resolution){this._getTileIdAtLOD(Se,s,Se);const t=s.denormalizeCol(Se.col,Se.world);for(const i of e.spans)if(i.row===Se.row&&i.colFrom<=t&&i.colTo>=t)return!0}if(s.resolution<i.resolution){const[t,r,n,o]=e.spans.reduce((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e),[1/0,-1/0,1/0,-1/0]),a=i.denormalizeCol(Se.col,Se.world),c=s.getColumnForX(i.getXForColumn(a)),l=s.getRowForY(i.getYForRow(Se.row)),u=s.getColumnForX(i.getXForColumn(a+1))-1,h=s.getRowForY(i.getYForRow(Se.row+1))-1;return!(c>o||u<n||l>r||h<t)}const r=s.denormalizeCol(Se.col,Se.world);return e.spans.some(e=>e.row===Se.row&&e.colFrom<=r&&e.colTo>=r)}normalizeBounds(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=Object(L.d)(this.tileInfo.spatialReference),s=-i*(t.valid[1]-t.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let i=1;i<t.length-1;i++)if(e>t[i]+1e-6)return this._infoByScale[t[i-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t,t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=t.length-1;i>=0;i--)if(e<t[i])return i===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[i]].level+(t[i]-e)/(t[i]-t[i+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,t,i){const s=this._infoByLevel[i.level];return e.set(i),t.resolution<s.resolution?null:(t.resolution===s.resolution||(e.level=t.level,e.col=Math.floor(i.col*s.resolution/t.resolution+.01),e.row=Math.floor(i.row*s.resolution/t.resolution+.01)),e)}}(d.a.fromJSON(i));this.tileStore=new Pe(e)}await this._configure(t),this.tileStore.clear()}async updateTiles(e){this.tileStore.updateTiles(e)}async update({config:e,pause:t}){const i=ke.empty();return await Object(u.b)([this.processor.update(i,e),this.controller.update(i,e,t)]),i.toJSON()}async invalidate(e){const t=ke.create(e),i=this.controller.invalidate(t);return await this.remoteClient.invoke("setUpdating",this.updating),i}setViewState(e){const t=_e.fromJSON(e);this._set("viewState",t)}async _configure(e){await Object(u.b)([this._handleControllerConfig(e),this._handleProcessorConfig(e)]),this.controller.processor=this.processor,await this.update({config:e})}async _handleControllerConfig(e){const t=await this._createController(this.service,e);return await t.startup(),t}async _handleProcessorConfig(e){return this._createProcessor(this.service,e)}async _createController(e,t){this.controller&&this.controller.destroy();const{tileStore:i,remoteClient:s}=this,r=new bi({service:e,config:t,tileStore:i,remoteClient:s});return this.controller=r,r}async _createProcessor(e,t){const s=t.schema.processors[0].type,r=(await function(e){return"heatmap"===e?i.e(133).then(i.bind(null,674)):Promise.all([i.e(17),i.e(58)]).then(i.bind(null,660))}(s)).default,{remoteClient:n,tileStore:o}=this,a=new r({service:e,config:t,tileStore:o,remoteClient:n});return this.processor&&this.processor.destroy(),this.processor=a,a}};Object(r.a)([Object(c.b)()],xi.prototype,"controller",void 0),Object(r.a)([Object(c.b)()],xi.prototype,"processor",void 0),Object(r.a)([Object(c.b)({dependsOn:["controller.updating"]})],xi.prototype,"updating",null),Object(r.a)([Object(c.b)()],xi.prototype,"viewState",void 0),xi=Object(r.a)([Object(l.a)("esri.views.2d.layers.features.Pipeline")],xi);var Ti=xi;t.default=Ti},77:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(3),i(4)),o=i(20),a=i(52),c=i(53),l=i(19),u=i(57),h=(i(24),i(34),i(35),i(50)),d=i(71),f=i(55),_=i(92),p=i(60),g=(i(58),i(87)),b=i(83),m=i(99);const y=new a.a({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let x=s=class extends h.a{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={size:256,spatialReference:f.a.WebMercator}){const t=e.resolutionFactor||1,i=e.scales,r=e.size||256,n=e.spatialReference||f.a.WebMercator;if(!Object(d.h)(n)){const e=[];if(i)for(let t=0;t<i.length;t++){const s=i[t];e.push({level:t,scale:s,resolution:s})}else{let t=5e-4;for(let i=23;i>=0;i--)e.unshift({level:i,scale:t,resolution:t}),t*=2}return new s({dpi:96,lods:e,origin:new p.a(0,0,n),size:[r,r],spatialReference:n})}const o=Object(d.d)(n),a=e.origin?new p.a({x:e.origin.x,y:e.origin.y,spatialReference:n}):new p.a(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),c=1/(39.37*Object(g.b)(n)*96),l=[];if(i)for(let e=0;e<i.length;e++){const t=i[e],s=t*c;l.push({level:e,scale:t,resolution:s})}else{let e=Object(d.e)(n)?512/r*591657527.5917094:256/r*591657527.591555;const i=Math.ceil(24/t);l.push({level:0,scale:e,resolution:e*c});for(let s=1;s<i;s++){const i=e/Math.pow(2,t),r=i*c;l.push({level:s,scale:i,resolution:r}),e=i}}return new s({dpi:96,lods:l,origin:a,size:[r,r],spatialReference:n})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=Object(d.d)(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return p.a.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const s=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(e=>{s.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,this._levelToLOD[e.level]=e})),this._set("scales",s),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[0]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];{const i=Math.round(e-.5),s=Math.round(e);return t[s]+(s-e)*(t[i]-t[s])}}scaleToZoom(e){const t=this.scales,i=t.length-1;let s=0;for(;s<i;s++){const i=t[s],r=t[s+1];if(i<=e)return s;if(r===e)return s+1;if(i>e&&r<e)return s+1-(e-r)/(i-r)}return s}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,s){const r=this.lodAt(e);if(!r)return null;let n,o;if("number"==typeof t)n=t,o=i;else if(Object(d.c)(t.spatialReference,this.spatialReference))n=t.x,o=t.y,s=i;else{const e=Object(_.d)(t,this.spatialReference);if(!e)return null;n=e.x,o=e.y,s=i}const a=r.resolution*this.size[0],c=r.resolution*this.size[1];return s||(s={id:null,level:0,row:0,col:0,extent:Object(b.c)()}),s.level=e,s.row=Math.floor((this.origin.y-o)/c+.001),s.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(s),s}updateTileInfo(e){const t=this.lodAt(e.level);if(!t)return;const i=t.resolution*this.size[0],s=t.resolution*this.size[1];e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Object(b.c)()),e.extent[0]=this.origin.x+e.col*i,e.extent[1]=this.origin.y-(e.row+1)*s,e.extent[2]=e.extent[0]+i,e.extent[3]=e.extent[1]+s}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),s=i*this.size[0],r=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*r,e[2]=e[0]+s,e[3]=e[1]+r,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return s.fromJSON(this.write({}))}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const s=e[i];this._upsampleLevels[s.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/s.resolution:0},t=s}}};Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],x.prototype,"compressionQuality",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],x.prototype,"dpi",void 0),Object(r.a)([Object(o.b)({type:String,json:{read:y.read,write:y.write,origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"format",void 0),Object(r.a)([Object(o.b)({readOnly:!0,dependsOn:["spatialReference","origin"]})],x.prototype,"isWrappable",null),Object(r.a)([Object(o.b)({type:p.a,json:{write:!0}})],x.prototype,"origin",void 0),Object(r.a)([Object(c.a)("origin")],x.prototype,"readOrigin",null),Object(r.a)([Object(o.b)({type:[m.a],value:null,json:{write:!0}})],x.prototype,"lods",null),Object(r.a)([Object(o.b)({readOnly:!0})],x.prototype,"minScale",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],x.prototype,"maxScale",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],x.prototype,"scales",void 0),Object(r.a)([Object(o.b)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],x.prototype,"size",void 0),Object(r.a)([Object(c.a)("size",["rows","cols"])],x.prototype,"readSize",null),Object(r.a)([Object(u.a)("size",{cols:{type:n.a},rows:{type:n.a}})],x.prototype,"writeSize",null),Object(r.a)([Object(o.b)({type:f.a,json:{write:!0}})],x.prototype,"spatialReference",void 0),x=s=Object(r.a)([Object(l.a)("esri.layers.support.TileInfo")],x);var T=x;t.a=T},84:function(e,t,i){"use strict";var s=i(18),r=(i(7),i(3),i(4),i(20)),n=i(52),o=i(54),a=i(19),c=(i(24),i(34),i(35),i(50));const l=new n.a({inherited:"inherited",codedValue:"coded-value",range:"range"});let u=class extends c.a{constructor(e){super(e),this.name=null,this.type=null}};Object(s.a)([Object(r.b)({type:String,json:{write:!0}})],u.prototype,"name",void 0),Object(s.a)([Object(o.a)(l)],u.prototype,"type",void 0),u=Object(s.a)([Object(a.a)("esri.layers.support.Domain")],u);var h=u;t.a=h},88:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return _})),i.d(t,"d",(function(){return q})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return y})),i.d(t,"i",(function(){return g})),i.d(t,"j",(function(){return T})),i.d(t,"k",(function(){return b})),i.d(t,"l",(function(){return A})),i.d(t,"m",(function(){return R})),i.d(t,"n",(function(){return N})),i.d(t,"o",(function(){return L})),i.d(t,"p",(function(){return G}));var s=i(9),r=i(1),n=(i(14),i(2),i(146)),o=i(139);const a=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],c=["field","normalizationField"];function l(e,t){if(null!=e&&null!=t)for(const i of Array.isArray(e)?e:[e])if(u(a,i,t),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)u(c,e,t)}function u(e,t,i){if(e)for(const r of e){const e=Object(s.b)(r,t),n=e&&"function"!=typeof e&&g(i,e);n&&Object(s.c)(r,n.name,t)}}function h(e,t){if(null!=e&&null!=t)if("startField"in e){const i=g(t,e.startField),s=g(t,e.endField);e.startField=i&&i.name||null,e.endField=s&&s.name||null}else{const i=g(t,e.startTimeField),s=g(t,e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=s&&s.name||null}}const d=new Set;function f(e,t){return e&&t?(d.clear(),_(d,e,t),Array.from(d).sort()):[]}function _(e,t,i){if(i)if(t&&t.length)if(i.includes("*"))for(const{name:i}of t)e.add(i);else for(const s of i)p(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const t of i)e.add(t)}}function p(e,t,i){if(t&&t.length){const s=g(t,i);s&&e.add(s.name)}else"string"==typeof i&&e.add(i)}function g(e,t){if("string"!=typeof t)return null;if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}function b(e,t){if(!e||!t||"string"!=typeof t)return!1;t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return!0;return!1}async function m(e,t,i){if(!i)return;const{arcadeUtils:s}=await Object(o.e)(),r=s.extractFieldNames(i);for(const i of r)p(e,t,i)}function y({displayField:e,fields:t}){return e||(t&&t.length?x(t,"name-or-title")||x(t,"unique-identifier")||x(t,"type-or-category")||function(e){for(const t of e){if(!t||!t.name)continue;const e=t.name.toLowerCase();if(e.indexOf("name")>-1||e.indexOf("title")>-1)return t.name}return null}(t):null)}function x(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}function T(e){const t=e.defaultValue;return void 0!==t&&j(e,t)?t:e.nullable?null:void 0}function v(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function O(e){return null===e||v(e)}const w="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function S(e){return null===e||w(e)}function E(e){return null!=e&&"string"==typeof e}function F(e){return null===e||E(e)}function I(){return!0}function j(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?S:w;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?O:v;break;case"string":case"esriFieldTypeString":i=e.nullable?F:E;break;default:i=I}return 1===arguments.length?i:i(t)}const M=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function A(e){return null!=e&&M.has(e.type)}function R(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}var C,D;function N(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function L(e,t){return e.nullable&&null===t?null:A(e)&&!function(e,t){const i="string"==typeof e?P(e):e;return!!i&&(i.isInteger?w(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}(e.type,Number(t))?C.OUT_OF_RANGE:j(e,t)?e.domain?Object(n.e)(e.domain,t):null:D.INVALID_TYPE}function P(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return k;case"esriFieldTypeInteger":case"integer":return B;case"esriFieldTypeSingle":case"single":return z;case"esriFieldTypeDouble":case"double":return U}}(C||(C={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(D||(D={}));const k={min:-32768,max:32767,isInteger:!0},B={min:-2147483648,max:2147483647,isInteger:!0},z={min:-34e37,max:12e37,isInteger:!1},U={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function G(e,t,i){switch(e){case n.a.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case n.a.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case D.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case C.OUT_OF_RANGE:{const{min:e,max:s}=P(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${s}`}}}function q(e,t){return!function(e,t,i){if(!t||!t.attributes||!e){if(Object(r.g)(i))for(const t of e)i.add(t);return!0}const s=t.attributes;let n=!1;for(const t of e)if(!(t in s)){if(n=!0,!Object(r.g)(i))break;i.add(t)}return n}(e,t,null)}},99:function(e,t,i){"use strict";var s,r=i(18),n=(i(7),i(3),i(4)),o=i(20),a=i(19),c=(i(24),i(34),i(35),i(50));let l=s=class extends c.a{constructor(e){super(e),this.level=0,this.levelValue=null,this.resolution=0,this.scale=0}clone(){return new s({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})}};Object(r.a)([Object(o.b)({type:n.a,json:{write:!0}})],l.prototype,"level",void 0),Object(r.a)([Object(o.b)({type:String,json:{write:!0}})],l.prototype,"levelValue",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],l.prototype,"resolution",void 0),Object(r.a)([Object(o.b)({type:Number,json:{write:!0}})],l.prototype,"scale",void 0),l=s=Object(r.a)([Object(a.a)("esri.layers.support.LOD")],l);var u=l;t.a=u}});