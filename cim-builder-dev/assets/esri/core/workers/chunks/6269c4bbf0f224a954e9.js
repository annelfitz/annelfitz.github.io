"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[5679],{4095:(t,e,n)=>{n.d(e,{CW:()=>c,DE:()=>u,qH:()=>h});var r=n(44208),o=n(53966),s=(n(34727),n(74887)),l=n(87811);n(5443),n(21325);const i=()=>o.A.getLogger("esri.views.2d.engine.flow.dataUtils"),a=10;async function c(t,e,n,o){const c=performance.now(),f=u(e,n),d=performance.now(),p=h(e,f,n.width,n.height),w=performance.now(),m=function(t){const e=new l.A,n=t.reduce((t,e)=>t+e.length,0),r=new Float32Array(4*n),o=new Array(t.length);let s=0,i=0;for(const n of t){const t=s;for(const t of n)r[4*s]=t.x,r[4*s+1]=t.y,r[4*s+2]=t.t,r[4*s+3]=t.speed,s++;o[i++]={startVertex:t,numberOfVertices:n.length,totalTime:n[n.length-1].t,timeSeed:e.getFloat()}}return{lineVertices:r,lineDescriptors:o}}(p),y=performance.now(),g="Streamlines"===t?function(t,e){const{lineVertices:n,lineDescriptors:r}=t;let o=0,s=0;for(const t of r)o+=2*t.numberOfVertices,s+=6*(t.numberOfVertices-1);const l=new Float32Array(9*o),i=new Uint32Array(s);let a=0,c=0;function u(){i[c++]=a-2,i[c++]=a,i[c++]=a-1,i[c++]=a,i[c++]=a+1,i[c++]=a-1}function f(t,e,n,r,o,s,i,c){const u=9*a;let f=0;l[u+f++]=t,l[u+f++]=e,l[u+f++]=1,l[u+f++]=n,l[u+f++]=s,l[u+f++]=i,l[u+f++]=r/2,l[u+f++]=o/2,l[u+f++]=c,a++,l[u+f++]=t,l[u+f++]=e,l[u+f++]=-1,l[u+f++]=n,l[u+f++]=s,l[u+f++]=i,l[u+f++]=-r/2,l[u+f++]=-o/2,l[u+f++]=c,a++}for(const t of r){const{totalTime:r,timeSeed:o}=t;let s=null,l=null,i=null,a=null,c=null,h=null;for(let d=0;d<t.numberOfVertices;d++){const p=n[4*(t.startVertex+d)],w=n[4*(t.startVertex+d)+1],m=n[4*(t.startVertex+d)+2],y=n[4*(t.startVertex+d)+3];let g=null,M=null,b=null,x=null;if(d>0){g=p-s,M=w-l;const t=Math.sqrt(g*g+M*M);if(g/=t,M/=t,d>1){let t=g+c,n=M+h;const r=Math.sqrt(t*t+n*n);t/=r,n/=r;const o=Math.min(1/(t*g+n*M),e);t*=o,n*=o,b=-n,x=t}else b=-M,x=g;null!==b&&null!==x&&(f(s,l,i,b,x,r,o,y),u())}s=p,l=w,i=m,c=g,h=M,a=y}f(s,l,i,-h,c,r,o,a)}return{vertexData:l,indexData:i}}(m,a):function(t){const{lineVertices:e,lineDescriptors:n}=t;let r=0,o=0;for(const t of n){const e=t.numberOfVertices-1;r+=4*e*2,o+=6*e*2}const s=new Float32Array(16*r),l=new Uint32Array(o);let i,a,c,u,f,h,d,p,w,m,y,g,M,b,x=0,D=0;function S(){l[D++]=x-8,l[D++]=x-7,l[D++]=x-6,l[D++]=x-7,l[D++]=x-5,l[D++]=x-6,l[D++]=x-4,l[D++]=x-3,l[D++]=x-2,l[D++]=x-3,l[D++]=x-1,l[D++]=x-2}function v(t,e,n,r,o,l,i,a,c,u,f,h,d,p){const w=16*x;let m=0;for(const y of[1,2])for(const g of[1,2,3,4])s[w+m++]=t,s[w+m++]=e,s[w+m++]=n,s[w+m++]=r,s[w+m++]=i,s[w+m++]=a,s[w+m++]=c,s[w+m++]=u,s[w+m++]=y,s[w+m++]=g,s[w+m++]=d,s[w+m++]=p,s[w+m++]=o/2,s[w+m++]=l/2,s[w+m++]=f/2,s[w+m++]=h/2,x++}function V(t,e){let n=w+y,r=m+g;const o=Math.sqrt(n*n+r*r);n/=o,r/=o;const s=w*n+m*r;n/=s,r/=s;let l=y+M,x=g+b;const D=Math.sqrt(l*l+x*x);l/=D,x/=D;const V=y*l+g*x;l/=V,x/=V,v(i,a,c,u,-r,n,f,h,d,p,-x,l,t,e),S()}function A(t,e,n,r,o,s){if(w=y,m=g,y=M,g=b,null==w&&null==m&&(w=y,m=g),null!=f&&null!=h){M=t-f,b=e-h;const n=Math.sqrt(M*M+b*b);M/=n,b/=n}null!=w&&null!=m&&V(o,s),i=f,a=h,c=d,u=p,f=t,h=e,d=n,p=r}function E(t,e){w=y,m=g,y=M,g=b,null==w&&null==m&&(w=y,m=g),null!=w&&null!=m&&V(t,e)}for(const t of n){i=null,a=null,c=null,u=null,f=null,h=null,d=null,p=null,w=null,m=null,y=null,g=null,M=null,b=null;const{totalTime:n,timeSeed:r}=t;for(let o=0;o<t.numberOfVertices;o++)A(e[4*(t.startVertex+o)],e[4*(t.startVertex+o)+1],e[4*(t.startVertex+o)+2],e[4*(t.startVertex+o)+3],n,r);E(n,r)}return{vertexData:s,indexData:l}}(m),M=performance.now();return(0,r.A)("esri-2d-profiler")&&(i().info("I.1","_createFlowFieldFromData (ms)",Math.round(d-c)),i().info("I.2","_getStreamlines (ms)",Math.round(w-d)),i().info("I.3","createAnimatedLinesData (ms)",Math.round(y-w)),i().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(M-y)),i().info("I.5","createFlowMesh (ms)",Math.round(M-c)),i().info("I.6","Mesh size (bytes)",g.vertexData.buffer.byteLength+g.indexData.buffer.byteLength)),await Promise.resolve(),(0,s.Te)(o),g}function u(t,e){const n=function(t,e,n,r){if(0===r)return t;const o=Math.round(3*r),s=new Array(2*o+1);let l=0;for(let t=-o;t<=o;t++){const e=Math.exp(-t*t/(r*r));s[t+o]=e,l+=e}for(let t=-o;t<=o;t++)s[t+o]/=l;const i=new Float32Array(t.length);for(let r=0;r<n;r++)for(let n=0;n<e;n++){let l=0,a=0;for(let i=-o;i<=o;i++){if(n+i<0||n+i>=e)continue;const c=s[i+o];l+=c*t[2*(r*e+(n+i))],a+=c*t[2*(r*e+(n+i))+1]}i[2*(r*e+n)]=l,i[2*(r*e+n)+1]=a}const a=new Float32Array(t.length);for(let t=0;t<e;t++)for(let r=0;r<n;r++){let l=0,c=0;for(let a=-o;a<=o;a++){if(r+a<0||r+a>=n)continue;const u=s[a+o];l+=u*i[2*((r+a)*e+t)],c+=u*i[2*((r+a)*e+t)+1]}a[2*(r*e+t)]=l,a[2*(r*e+t)+1]=c}return a}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,r)=>{const o=Math.floor(t),s=Math.floor(r);if(o<0||o>=e.width)return[0,0];if(s<0||s>=e.height)return[0,0];const l=t-o,i=r-s,a=o,c=s,u=o<e.width-1?o+1:o,f=s<e.height-1?s+1:s,h=n[2*(c*e.width+a)],d=n[2*(c*e.width+u)],p=n[2*(f*e.width+a)],w=n[2*(f*e.width+u)],m=n[2*(c*e.width+a)+1],y=n[2*(c*e.width+u)+1];return[(h*(1-i)+p*i)*(1-l)+(d*(1-i)+w*i)*l,(m*(1-i)+n[2*(f*e.width+a)+1]*i)*(1-l)+(y*(1-i)+n[2*(f*e.width+u)+1]*i)*l]}:(t,r)=>{const o=Math.round(t),s=Math.round(r);return o<0||o>=e.width||s<0||s>=e.height?[0,0]:[n[2*(s*e.width+o)],n[2*(s*e.width+o)+1]]}}function f(t,e,n,r,o,s,l,i,a){const c=[];let u=n,f=r,h=0,[d,p]=e(u,f);d*=t.velocityScale,p*=t.velocityScale;const w=Math.sqrt(d*d+p*p);let m,y;c.push({x:u,y:f,t:h,speed:w});for(let n=0;n<t.verticesPerLine;n++){let[n,r]=e(u,f);n*=t.velocityScale,r*=t.velocityScale;const d=Math.sqrt(n*n+r*r);if(d<t.minSpeedThreshold)return c;const p=n/d,w=r/d;if(u+=p*t.segmentLength,f+=w*t.segmentLength,h+=t.segmentLength/d,Math.acos(p*m+w*y)>t.maxTurnAngle)return c;if(t.collisions){const t=Math.round(u*a),e=Math.round(f*a);if(t<0||t>l-1||e<0||e>i-1)return c;const n=s[e*l+t];if(-1!==n&&n!==o)return c;s[e*l+t]=o}c.push({x:u,y:f,t:h,speed:d}),m=p,y=w}return c}function h(t,e,n,r){const o=[],s=new l.A,i=1/Math.max(t.lineCollisionWidth,1),a=Math.round(n*i),c=Math.round(r*i),u=new Int32Array(a*c);for(let t=0;t<u.length;t++)u[t]=-1;const h=[];for(let e=0;e<r;e+=t.lineSpacing)for(let r=0;r<n;r+=t.lineSpacing)h.push({x:r,y:e,sort:s.getFloat()});h.sort((t,e)=>t.sort-e.sort);for(const{x:n,y:r}of h)if(s.getFloat()<t.density){const s=f(t,e,n,r,o.length,u,a,c,i);if(s.length<2)continue;o.push(s)}return o}},31635:(t,e,n)=>{function r(t,e,n,r){var o,s=arguments.length,l=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,r);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(l=(s<3?o(l):s>3?o(e,n,l):o(e,n))||l);return s>3&&l&&Object.defineProperty(e,n,l),l}function o(t,e,n){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var r,o;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(o=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");o&&(r=function(){try{o.call(this)}catch(t){return Promise.reject(t)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}n.d(e,{Cg:()=>r,hk:()=>l,mS:()=>o}),Object.create,Object.create;var s="function"==typeof SuppressedError?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function l(t){function e(e){t.error=t.hasError?new s(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var n,r=0;return function o(){for(;n=t.stack.pop();)try{if(!n.async&&1===r)return r=0,t.stack.push(n),Promise.resolve().then(o);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(o,function(t){return e(t),o()})}else r|=1}catch(t){e(t)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}},45679:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var r=n(31635),o=(n(53966),n(44208),n(87811),n(49186),n(40608)),s=n(4095),l=n(19419);let i=class{constructor(){this._tileData=new Map}async generateStreamlines(t){const{flowData:e,simulationSettings:n,size:r}=t,o=c((0,s.DE)(n,e),n,r);return{result:{streamlines:o},transferList:o?.map(t=>t.buffer)}}async generateTiledStreamlines(t){const{simulationSettings:e,size:n,reset:r,flowDataTiles:o,extent:i,pixelSize:a}=t;this._updateTileData(o,r);const u=c(function(t,e,n,r,o){const[i,a]=n;let c=null;const u=new Map;e.forEach(e=>{u.set(e.lij,(0,s.DE)(t,e))});const f=(t,e,n)=>(0,l.Rj)(t.extent,e,n);return(t,n)=>{const s=Math.round(t),h=Math.round(n);if(s<0||s>=i||h<0||h>=a)return[0,0];const d=t/i*(0,l.VL)(r)+r[0],p=(a-n)/a*(0,l.uJ)(r)+r[1];if(null==c||!f(c,d,p)){c=null;for(const[t,n]of e)if(f(n,d,p)){c=n;break}}if(null==c?.data)return[0,0];const w=u.get(c.lij);if(null==w)return[0,0];const m=c.extent;return w((d-m[0])/(0,l.VL)(m)*o,o-(p-m[1])/(0,l.uJ)(m)*o)}}(e,this._tileData,n,i,a),e,n);return{result:{streamlines:u},transferList:u?.map(t=>t.buffer)??[]}}_updateTileData(t,e){e&&this._tileData.forEach((e,n)=>{null==t.get(n)&&this._tileData.delete(n)}),t.forEach((t,e)=>{"delete"===t?this._tileData.delete(e):"on-worker"!==t&&this._tileData.set(e,t)})}};i=(0,r.Cg)([(0,o.$)("esri.views.3d.support.flow.FlowWorker")],i);const a=i;function c(t,e,n){if(null==t)return;const r=(0,s.qH)(e,t,n[0],n[1]),o=[];for(const t of r){const e=new Float32Array(3*t.length);for(let n=0;n<t.length;n++)e[3*n]=t[n].x,e[3*n+1]=t[n].y,e[3*n+2]=t[n].t;o.push(e)}return o}}}]);