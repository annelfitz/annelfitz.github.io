{"version":3,"sources":["../node_modules/@arcgis/core/geometry/support/meshUtils/loadGLTFMesh.js"],"names":["async","G","t","e","r","o","I","resolveFile","busy","request","s","a","i","responseType","signal","n","data","K","R","model","lods","shift","Map","u","textures","forEach","set","f","wrap","Y","parameters","Q","materials","$","tt","color","opacity","emissiveFactor","et","c","colorTexture","textureColor","get","normalTexture","textureNormal","emissiveColor","emissiveTexture","textureEmissive","occlusionTexture","textureOcclusion","alphaMode","X","alphaCutoff","doubleSided","metallic","metallicFactor","roughness","roughnessFactor","metallicRoughnessTexture","textureMetallicRoughness","H","l","tangent","normal","texCoord0","attributes","position","parts","count","writeIndex","vertexAttributes","B","p","d","g","x","b","components","P","J","typedBuffer","uv","F","transform","spatialReference","m","j","slice","y","L","dstIndex","A","U","_","z","elementCount","T","V","h","k","v","fromTypedArray","typedBufferStride","C","N","w","M","D","O","S","E","W","indices","primitiveType","length","push","faces","material","clone","trustSourceNormals","horizontal","Z","vertical","q"],"mappings":"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","file":"static/js/34.09062368.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../Color.js\";import e from\"../../../request.js\";import{unwrap as r,applySome as o,isSome as n}from\"../../../core/maybe.js\";import{a as s}from\"../../../chunks/mat3.js\";import{c as a}from\"../../../chunks/mat3f64.js\";import{f as i}from\"../../../chunks/vec3f64.js\";import{f as u}from\"../../../chunks/vec4f64.js\";import l from\"../MeshComponent.js\";import c from\"../MeshMaterialMetallicRoughness.js\";import f from\"../MeshTexture.js\";import m from\"../MeshVertexAttributes.js\";import{BufferViewVec3f64 as p,BufferViewVec3f as d,BufferViewVec4f as g,BufferViewVec4u8 as x,BufferViewVec2f as b,BufferViewVec4u16 as h,BufferViewVec3u8 as v,BufferViewVec3u16 as w}from\"../buffer/BufferView.js\";import{t as j,a as y,s as C,b as M}from\"../../../chunks/vec32.js\";import{t as A,s as T,a as k}from\"../../../chunks/vec42.js\";import{createBuffer as B}from\"../buffer/utils.js\";import{georeferenceByTransform as F}from\"./georeference.js\";import{DefaultLoadingContext as I}from\"../../../views/3d/glTF/DefaultLoadingContext.js\";import{load as R}from\"../../../views/3d/glTF/loader.js\";import{triangleFanToTriangles as E,triangleStripToTriangles as S,trianglesToTriangles as D}from\"../../../views/3d/glTF/internal/indexUtils.js\";import{generateIndexArray as O}from\"../../../views/3d/webgl-engine/lib/geometryDataUtils.js\";import{COLOR_GAMMA as q}from\"../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{f as L,c as N}from\"../../../chunks/vec33.js\";import{f as U,c as V}from\"../../../chunks/vec43.js\";import{n as _,f as z}from\"../../../chunks/vec22.js\";async function G(t,e,r){const o=new I(K(r)),s=(await R(o,e,r,!0)).model,a=s.lods.shift(),i=new Map,u=new Map;s.textures.forEach(((t,e)=>i.set(e,Q(t)))),s.materials.forEach(((t,e)=>u.set(e,H(t,i))));const l=P(a);for(const n of a.parts)J(l,n,u);const{position:c,normal:f,tangent:p,color:d,texCoord0:g}=l.vertexAttributes,x={position:c.typedBuffer,normal:n(f)?f.typedBuffer:null,tangent:n(p)?p.typedBuffer:null,uv:n(g)?g.typedBuffer:null,color:n(d)?d.typedBuffer:null},b=F(x,t,r);return{transform:b.transform,components:l.components,spatialReference:t.spatialReference,vertexAttributes:new m({position:b.vertexAttributes.position,normal:b.vertexAttributes.normal,tangent:b.vertexAttributes.tangent,color:x.color,uv:x.uv})}}function K(t){return null!=t&&t.resolveFile?{busy:!1,request:async(r,o,s)=>{const a=t.resolveFile(r),i=\"image\"===o?\"image\":\"binary\"===o?\"array-buffer\":\"json\";return(await e(a,{responseType:i,signal:n(s)?s.signal:null})).data}}:null}function P(t){let e=0;const r={color:!1,tangent:!1,normal:!1,texCoord0:!1};for(const{attributes:{position:o,normal:n,color:s,tangent:a,texCoord0:i}}of t.parts)e+=o.count,n&&(r.normal=!0),s&&(r.color=!0),a&&(r.tangent=!0),i&&(r.texCoord0=!0);return{writeIndex:0,vertexAttributes:{position:B(p,e),normal:r.normal?B(d,e):null,tangent:r.tangent?B(g,e):null,color:r.color?B(x,e):null,texCoord0:r.texCoord0?B(b,e):null},components:[]}}function Q(t){return new f({data:t.data,wrap:Y(t.parameters.wrap)})}function H(e,n){const s=new t(tt(e.color,e.opacity)),a=e.emissiveFactor?new t(et(e.emissiveFactor)):null;return new c({color:s,colorTexture:r(o(e.textureColor,(t=>n.get(t)))),normalTexture:r(o(e.textureNormal,(t=>n.get(t)))),emissiveColor:a,emissiveTexture:r(o(e.textureEmissive,(t=>n.get(t)))),occlusionTexture:r(o(e.textureOcclusion,(t=>n.get(t)))),alphaMode:X(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:r(o(e.textureMetallicRoughness,(t=>n.get(t))))})}function J(t,e,r){const{position:o,normal:i,tangent:u,color:c,texCoord0:f}=t.vertexAttributes,m=t.writeIndex,p=e.attributes.position.count;if(j(o.slice(m,p),e.attributes.position,e.transform),n(e.attributes.normal)&&n(i)){const t=s(a(),e.transform);y(i.slice(m,p),e.attributes.normal,t)}else n(i)&&L(i,0,0,1,{dstIndex:m,count:p});if(n(e.attributes.tangent)&&n(u)){const t=s(a(),e.transform);A(u.slice(m,p),e.attributes.tangent,t)}else n(u)&&U(u,0,0,1,1,{dstIndex:m,count:p});if(n(e.attributes.texCoord0)&&n(f)?_(f.slice(m,p),e.attributes.texCoord0):n(f)&&z(f,0,0,{dstIndex:m,count:p}),n(e.attributes.color)&&n(c)){const t=e.attributes.color,r=c.slice(m,p);if(4===t.elementCount)t instanceof g?T(r,t,255):t instanceof x?V(r,t):t instanceof h&&k(r,t,8);else{U(r,255,255,255,255);const e=v.fromTypedArray(r.typedBuffer,r.typedBufferStride);t instanceof d?C(e,t,255):t instanceof v?N(e,t):t instanceof w&&M(e,t,8)}}else n(c)&&U(c.slice(m,p),255,255,255,255);const b=W(e.indices||p,e.primitiveType);if(m)for(let n=0;n<b.length;n++)b[n]+=m;t.components.push(new l({faces:b,material:r.get(e.material).clone(),trustSourceNormals:!0})),t.writeIndex+=p}function W(t,e){switch(e){case 4:return D(t,O);case 5:return S(t);case 6:return E(t)}}function X(t){switch(t){case\"OPAQUE\":return\"opaque\";case\"MASK\":return\"mask\";case\"BLEND\":return\"blend\"}}function Y(t){return{horizontal:Z(t.s),vertical:Z(t.t)}}function Z(t){switch(t){case 33071:return\"clamp\";case 33648:return\"mirror\";case 10497:return\"repeat\"}}function $(t){return t**(1/q)*255}function tt(t,e){return u($(t[0]),$(t[1]),$(t[2]),e)}function et(t){return i($(t[0]),$(t[1]),$(t[2]))}export{G as loadGLTFMesh};\n"],"sourceRoot":""}