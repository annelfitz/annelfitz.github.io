{"version":3,"sources":["../node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js","../node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js"],"names":["i","t","renderer","type","symbol","e","n","o","s","r","indexOf","JSON","stringify","Function","u","name","description","prototype","attributes","F","Set","R","h","constructor","super","arguments","this","load","signal","addResolvingPromise","_fetchService","Promise","resolve","capabilities","query","supportsFormatPBF","parsedUrl","dynamicDataSource","a","gdbVersion","spatialReference","fieldsIndex","layer","f","url","path","format","sourceSpatialReference","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","c","body","_createFeatureEditResult","data","addAttachmentResult","_createAttachmentErrorResult","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","globalIdUsed","p","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","length","adds","updates","deletes","l","method","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","fetchRecomputedExtents","then","async","returnUpdates","layerId","id","extent","fullExtent","timeExtent","fromJSON","y","start","end","get","objectIds","all","parentObjectId","attachmentInfos","m","queryTask","executeAttachmentQuery","execute","customParameters","executeJSON","executeForIds","executeForCount","executeForExtent","executeRelationshipQuery","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","defaultSymbol","g","geometry","toJSON","feature","attachment","globalId","contentType","uploadId","parentGlobalId","globalIdField","FileReader","readAsDataURL","onload","result","onerror","b","mediaType","File","_canUseGlobalIds","_getGlobalIdsFromFeatureIdentifier","_getObjectIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","constructOnly","readOnly","q"],"mappings":"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","file":"static/js/133.e4ceecbc.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/has.js\";import{clone as r}from\"../../../../core/lang.js\";import{defaultPointSymbolJSON as e,defaultPolylineSymbolJSON as n,defaultPolygonSymbolJSON as o}from\"../../../../symbols/support/defaultsJSON.js\";function i(t){return{renderer:{type:\"simple\",symbol:\"esriGeometryPoint\"===t||\"esriGeometryMultipoint\"===t?e:\"esriGeometryPolyline\"===t?n:o}}}function s(r,e){if(t(\"csp-restrictions\"))return()=>({[e]:null,...r});try{let t=`this.${e} = null;`;for(const e in r){t+=`this${e.indexOf(\".\")?`[\"${e}\"]`:`.${e}`} = ${JSON.stringify(r[e])};`}const n=new Function(t);return()=>new n}catch(n){return()=>({[e]:null,...r})}}function u(t={}){return[{name:\"New Feature\",description:\"\",prototype:{attributes:r(t)}}]}export{s as createDefaultAttributesFunction,u as createDefaultTemplate,i as createDrawingInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{setDeepValue as a}from\"../../../core/object.js\";import{isSome as s,isNone as o}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as l}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import d from\"../../../geometry/Extent.js\";import c from\"../../../request.js\";import h from\"../../../core/Loadable.js\";import y from\"../../../TimeExtent.js\";import{unapplyEditsZUnitScaling as p}from\"../../../rest/query/operations/zscale.js\";import{processAttachmentQueryResult as m}from\"../../../rest/query/operations/queryAttachments.js\";import f from\"../../../tasks/QueryTask.js\";import{createDrawingInfo as g}from\"./support/clientSideDefaults.js\";async function b(e){if(\"string\"==typeof e){const t=l(e);return t||{data:e}}return new Promise(((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(l(a.result)),a.onerror=e=>r(e)}))}const F=new Set([\"Feature Layer\",\"Table\"]);let R=class extends h{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:a,gdbVersion:s,spatialReference:o,fieldsIndex:i}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new f({url:r.path,format:u,fieldsIndex:i,dynamicDataSource:a,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",s=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,s.query);try{const e=await c(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(i){throw this._createAttachmentErrorResult(r,i)}}async updateAttachment(e,t,r){await this.load();const a=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,o.query);try{const e=await c(s,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);p(r,a,this.layer.spatialReference);const o=[],i=[],u=[...e.deleteAttachments];for(const c of e.addAttachments)o.push(await this._serializeAttachment(c));for(const c of e.updateAttachments)i.push(await this._serializeAttachment(c));const n=o.length||i.length||u.length?{adds:o,updates:i,deletes:u}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:a.length?JSON.stringify(a):null,deletes:s.length?null!=t&&t.globalIdUsed?JSON.stringify(s):s.join(\",\"):null,gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:n&&JSON.stringify(n)}}),d=await c(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";try{return(await c(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(s){throw this._createAttachmentErrorResult(r,s)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:a}=this.layer,{data:s}=await c(`${a}/${r}`,t),{id:o,extent:i,fullExtent:u,timeExtent:n}=s,l=i||u;return{id:o,fullExtent:l&&d.fromJSON(l),timeExtent:n&&y.fromJSON({start:n[0],end:n[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,a=r.path;await this.load();const s=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,r=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";r.push(c(t,s))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>m(e,a)))}return this.queryTask.executeAttachmentQuery(e,s)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let r=this.layer.sourceJSON;if(!r){const{data:a}=await c(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}this.sourceJSON=this._patchServiceJSON(r);const a=r.type;if(!F.has(a))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${a}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=g(e.geometryType).renderer;a(\"drawingInfo.renderer\",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return o(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:a,name:s,contentType:o,data:i,uploadId:u}=r,n={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(i){const e=await b(i);n.contentType=e.mediaType,n.data=e.data,i instanceof File&&(n.name=i.name)}return s&&(n.name=s),o&&(n.contentType=o),n}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):\"objectId\"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&\"globalId\"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:a})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const a in t){const e=t[a];null!=e&&(r.set?r.set(a,e):r.append(a,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...e,query:r({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:\"json\"}}};e([i()],R.prototype,\"type\",void 0),e([i({constructOnly:!0})],R.prototype,\"layer\",void 0),e([i({readOnly:!0})],R.prototype,\"queryTask\",null),R=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],R);var q=R;export default q;\n"],"sourceRoot":""}