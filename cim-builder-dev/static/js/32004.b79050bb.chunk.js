"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[32004],{12838:(e,t,s)=>{s.d(t,{jX:()=>c,zo:()=>d,gd:()=>h,ph:()=>a,no:()=>p,kz:()=>l,ht:()=>u,yo:()=>g});var i=s(19247);var r=s(59844);const n=new Map,o=new class{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const s=e+"/"+t,i=this._cachedBlocks;if(i.has(s)){const e=i.get(s);return e.refCount--,e.refCount<=0&&(i.delete(s),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const s=e+"/"+t,i=this._cachedBlocks;if(i.has(s)){const e=i.get(s);return e.ts=Date.now(),e.refCount++,i.delete(s),i.set(s,e),e.block}return null}putBlock(e,t,s,i){const r=this._cachedBlocks,n=e+"/"+t;if(r.has(n)){const e=r.get(n);e.ts=Date.now(),e.refCount++}else r.set(n,{block:s,ts:Date.now(),refCount:1,controller:i});this._trim(),this._updateTimer()}deleteBlock(e,t){const s=this._cachedBlocks,i=e+"/"+t;s.has(i)&&s.delete(i)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),s=Date.now();for(let i=0;i<t.length&&t[i][1].ts<=s-this._duration;i++)e.delete(t[i][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let s=0;s<t.length-this._size;s++)e.delete(t[s][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function a(e,t,s){const i=[];return null!=t&&i.push(`sliceId=${t}`),null!=s&&i.push(`bandIds=${s.join(",")}`),i.length?`${e}?${i.join("&")}`:e}function l(e,t){const s={extent:null,rasterInfo:t,cache:new Map},i=n.get(e);return i?(i.push(s),i.length-1):(n.set(e,[s]),0)}function u(e,t){const s=n.get(e);s&&(s[t]=null,s.some((e=>null!=e))||n.delete(e))}function c(e,t,s){const i=n.get(e);if(!i)return null==t?o.decreaseRefCount(e,s):0;if(null==t||null==i[t])return o.decreaseRefCount(e,s);const r=i[t]?.cache,a=r?.get(s);if(r&&a){if(a.refCount--,0===a.refCount){r.delete(s);for(let e=0;e<i.length;e++)i[e]?.cache.delete(s);a.controller&&a.controller.abort()}return a.refCount}return 0}function h(e,t,s){const i=n.get(e);if(!i)return null==t?o.getBlock(e,s):null;if(null==t||null==i[t]){for(let e=0;e<i.length;e++){const t=i[e]?.cache.get(s);if(t)return t.refCount++,t.block}return o.getBlock(e,s)}const r=i[t]?.cache.get(s);if(r)return r.refCount++,r.block;for(let n=0;n<i.length;n++){if(n===t||!i[n])continue;const e=i[n]?.cache,r=e?.get(s);if(e&&r)return r.refCount++,e.set(s,r),r.block}return null}function p(e,t,s,i,r=null){const a=n.get(e);if(!a)return void(null==t&&o.putBlock(e,s,i,r));if(null==t||null==a[t])return void o.putBlock(e,s,i,r);const l={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:r};i.then((()=>l.isResolved=!0)).catch((()=>l.isRejected=!0)),a[t]?.cache.set(s,l)}function d(e,t,s){const i=n.get(e);i?null!=t&&null!=i[t]?i[t]?.cache.delete(s):o.deleteBlock(e,s):null==t&&o.deleteBlock(e,s)}function m(e,t){const s=n.get(e);return s?s[t]??null:null}function g(e,t,s,n,o,a,l=null){const u=m(e,t);if(!u)return;const c=u.extent,{cache:h,rasterInfo:p}=u;if(c&&c.xmin===s.xmin&&c.xmax===s.xmax&&c.ymin===s.ymin&&c.ymax===s.ymax)return;n=n??0;const d=s.clone().normalize(),{spatialReference:g,transform:f}=p,y=new Set;for(let m=0;m<d.length;m++){const e=d[m];if(e.xmax-e.xmin<=n||e.ymax-e.ymin<=n)continue;let t=(0,r._l)(e,g,l);if(null==t)continue;if(null!=f&&(t=f.inverseTransform(t),null==t))continue;const s=new i.A({x:n,y:n,spatialReference:e.spatialReference});if(null==o&&!(o=(0,r.Wo)(s,g,e,l)))return;const{pyramidLevel:u,pyramidResolution:c,excessiveReading:h}=(0,r.t$)(o,p,a||"closest");if(h)return;const{storageInfo:x}=p,{origin:w}=x,{x:b,y:_}=c,C=Math.max(0,Math.floor((t.xmin-w.x)/b)),v=Math.max(0,Math.floor((w.y-t.ymax)/_)),T=Math.ceil(t.width/b-.1),P=Math.ceil(t.height/_-.1),R=u>0?x.pyramidBlockWidth:x.blockWidth,S=u>0?x.pyramidBlockHeight:x.blockHeight,M=x.blockBoundary[u];if(!M)continue;const k=1,I=Math.max(M.minCol,Math.floor(C/R)-k),z=Math.max(M.minRow,Math.floor(v/S)-k),B=Math.min(M.maxCol,Math.floor((C+T-1)/R)+k),F=Math.min(M.maxRow,Math.floor((v+P-1)/S)+k);for(let i=z;i<=F;i++)for(let e=I;e<=B;e++)y.add(`${u}/${i}/${e}`)}h.forEach(((e,t)=>{if(!y.has(t)){const e=h.get(t);(null==e||e.isResolved||e.isRejected)&&h.delete(t)}})),u.extent={xmin:s.xmin,ymin:s.ymin,xmax:s.xmax,ymax:s.ymax}}},61229:(e,t,s)=>{s.d(t,{$Q:()=>a,Sd:()=>c,b5:()=>u,b7:()=>h});var i=s(31633),r=s(76797),n=s(19247),o=s(66486);async function a(e,t,i){if("extent"===i.type)return function(e,t,s){const{width:i,height:r}=e,n=new Uint8Array(i*r),a=t.width/i,l=t.height/r;if(s.width/a<.5||s.height/l<.5)return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,pixels:[...e.pixels]});const{xmin:u,xmax:c,ymin:h,ymax:p}=t,{xmin:d,xmax:m,ymin:g,ymax:f}=s,y=Math.max(u,d),x=Math.min(c,m),w=Math.max(h,g),b=Math.min(p,f),_=.5*a,C=.5*l;if(x-y<_||b-w<C||x<u+_||y>c-_||w>p-C||b<h+C)return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,pixels:[...e.pixels]});const v=Math.max(0,(y-u)/a),T=Math.min(i,Math.max(0,(x-u)/a)),P=Math.max(0,(p-b)/l),R=Math.min(r,Math.max(0,(p-w)/l)),S=Math.round(v),M=Math.round(T)-1,k=Math.round(P),I=Math.round(R)-1;if(S===M&&v%1>.5&&T%1<.5||k===I&&P%1>.5&&R%1<.5)return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,pixels:[...e.pixels]});if(0===S&&0===k&&M===i&&I===r)return e;const z=e.mask;for(let o=k;o<=I;o++)for(let e=S;e<=M;e++){const t=o*i+e;n[t]=z?z[t]:255}return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,pixels:[...e.pixels]})}(e,t,i);const{width:r,height:n}=e,a=new Uint8Array(r*n);return(await Promise.all([s.e(26871),s.e(16364),s.e(56175),s.e(48045),s.e(96483)]).then(s.bind(s,38165))).execute(t,i)?"polyline"===i.type?function(e,t,s){const{width:i,height:r}=e,n=new Uint8Array(i*r),a=t.width/i,l=t.height/r,{xmin:u,ymax:c}=t,{paths:h}=s,p=e.mask;for(let o=0;o<h.length;o++){const e=h[o];for(let t=0;t<e.length-1;t++){const[s,o]=e[t],[h,d]=e[t+1],m=Math.min(o,d),g=Math.max(o,d),f=Math.max(0,Math.floor((c-g)/l)),y=Math.min(r-1,Math.floor((c-m)/l));if(!(y<f))if(f===y){const e=Math.min(s,h),t=Math.max(s,h),r=Math.max(0,Math.floor((e-u)/a)),o=Math.min(i-1,Math.floor((t-u)/a));if(o<r)continue;const l=f*i;for(let s=l+r;s<=l+o;s++)n[s]=p?p[s]:255}else{const e=(s-u)/a,t=(h-s)/(d-o)/a,r=l*t;for(let s=f;s<=y;s++){const a=t*(c-s*l-o)+e,u=Math.max(0,Math.floor(r>0?a-r:a)),h=Math.min(i-1,Math.floor(r>0?a:a-r));if(h<u)continue;const d=s*i;for(let e=d+u;e<=d+h;e++)n[e]=p?p[e]:255}}}}return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,pixels:[...e.pixels]})}(e,t,i):(await Promise.all([s.e(26871),s.e(16364),s.e(56175),s.e(48045),s.e(3528)]).then(s.bind(s,32138))).execute(i,t)?e:l(e,t,i):new o.A({pixelType:e.pixelType,width:r,height:n,mask:a,maskIsAlpha:!1,pixels:[...e.pixels]})}function l(e,t,s){if(!e)return e;const{width:i,height:r}=e,n=u({geometry:s,size:[i,r],srcExtent:t,srcMask:e.mask});return new o.A({pixelType:e.pixelType,width:i,height:r,mask:n,maskIsAlpha:!1,pixels:[...e.pixels]})}function u(e){const{geometry:t,size:s,srcExtent:i,srcMask:r}=e,[n,o]=s;let a;const l=i.width/n,u=i.height/o,{xmin:c,ymax:h}=i;if("extent"===t.type){const e=(t.xmin-c)/l,s=(t.xmax-c)/l,i=(h-t.ymax)/u,r=(h-t.ymin)/u;a=[[[e,i],[e,r],[s,r],[s,i],[e,i]]]}else a=t.rings.map((e=>e.map((([e,t])=>[(e-c)/l,(h-t)/u]))));return function(e,t,s){const[i,r]=t,n=new OffscreenCanvas(i,r).getContext("2d");n.fillStyle="#f00",n.beginPath(),e.forEach((e=>{n.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t++)n.lineTo(e[t][0],e[t][1]);n.closePath()})),n.fill();const o=n.getImageData(0,0,i,r).data,a=i*r,l=new Uint8Array(a);let u=!1;for(let c=0;c<a;c++)s&&!s[c]||(o[4*c+3]>127?l[c]=255:u=!0);return u||s?l:void 0}(a,s,r)}function c(e,t){const{extent:s}=h(e,t,new n.A({x:e.pixelSize.x,y:e.pixelSize.y,spatialReference:e.spatialReference})),{extent:i}=e.extent;if(s.xmax=Math.min(s.xmax,i.xmax),s.ymax=Math.min(s.ymax,i.ymax),s.xmin<s.xmax&&s.ymin<s.ymax){const{x:t,y:i}=e.pixelSize,r=Math.round(s.width/t),n=Math.round(s.height/i);e.extent=s,e.width=r,e.height=n}}function h(e,t,s,n=!0){const{spatialReference:o}=e,{x:a,y:l}=function(e,t){if(e.spatialReference.equals(t))return e;const s=(0,i.GA)(e.spatialReference),r=(0,i.GA)(t);if(s===r)return e;const n=s/r;return{x:e.x*n,y:e.y*n}}(s,o);let u,c,h;const p="extent"===t.type?t:t.extent;let{xmin:d,xmax:m,ymax:g,ymin:f}=p;const{xmin:y,ymax:x}=e.extent;return n?(d=y+(d>y?a*Math.round((d-y)/a):0),g=x-(g<x?l*Math.round((x-g)/l):0),m=y+(m>y?a*Math.round((m-y)/a):0),f=x-(f<x?l*Math.round((x-f)/l):0),u=new r.A({xmin:d,ymax:g,xmax:m,ymin:f,spatialReference:o}),c=Math.round(u.width/a),h=Math.round(u.height/l)):(c=Math.floor((m-d)/a+.8),h=Math.floor((g-f)/l+.8),d=y+(d>y?a*Math.floor((d-y)/a+.1):0),g=x-(g<x?l*Math.floor((x-g)/l+.1):0),m=d+c*a,f=g-h*l,u=new r.A({xmin:d,ymax:g,xmax:m,ymin:f,spatialReference:o})),{extent:u,width:c,height:h}}},46550:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(81806),r=s(36201),n=s(90548),o=s(44595);const a=(e,t)=>e.key.level-t.key.level!==0?e.key.level-t.key.level:e.key.row-t.key.row!==0?e.key.row-t.key.row:e.key.col-t.key.col;class l extends r.A{constructor(e){super(),this.tileInfoView=e,this.sortFunction=a}renderChildren(e){this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,s=super.createRenderParams(e);return s.requiredLevel=this.tileInfoView.getClosestInfoForScale(t.scale).level,s.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(t.scale),s}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[n.A],drawPhase:83,target:()=>this.getStencilTarget()})),(0,i.A)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[o.A],drawPhase:64,target:()=>this.children})),t}getStencilTarget(){return this.children}setStencilReference(e){let t=1;for(const s of this.children)s.stencilRef=t++}}},90113:(e,t,s)=>{s.d(t,{$w:()=>u,Fb:()=>o,Fz:()=>g,J5:()=>a,M:()=>h,Ni:()=>c,V5:()=>n,Xx:()=>m,YV:()=>b,au:()=>l,b5:()=>y,bB:()=>T,bg:()=>x,cZ:()=>C,cn:()=>d,eo:()=>_,kx:()=>f,os:()=>i,qM:()=>p,rp:()=>r,ti:()=>w,v9:()=>v});const i=3.14159265359/180,r=3.14159265359/128,n=1,o=1.1,a=1,l=24,u=8,c=1e-5,h=.05,p=1e-30,d=4,m=0,g=2,f=2,y=3,x=0,w=3,b=16777216,_=1.1,C=16,v=128,T=1},60853:(e,t,s)=>{s.d(t,{K5:()=>h,Kt:()=>m,M8:()=>a,Rj:()=>g,_9:()=>o,i6:()=>p,mh:()=>c,nb:()=>u,p8:()=>x,tL:()=>l,xf:()=>f,yS:()=>d,zb:()=>y,zy:()=>w});var i=s(5095),r=s(60984),n=s(90113);function o(e){const t=(0,r.fV)(12.9898),s=(0,r.fV)(78.233),i=(0,r.fV)(43758.5453),n=(0,r.Om)(e,(0,r.Zc)(t,s)),o=(0,r.zi)(n,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(i))}function a(e){return(0,r.LC)(e,(0,r.fV)(n.qM))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function u(e){return e.multiply(2).subtract(1)}function c(e,t){const s=(0,r.fV)(2**t);return(0,r.zi)((0,r.RI)(e.divide(s)),(0,r.fV)(2))}function h(e,t){return(0,r.MM)(c(e,t),(0,r.fV)(.5))}function p(e,t){return c(e,t+i.U5)}function d(e,t){return c(e,t)}function m(e){const t=c(e.z,7),s=(0,r.fV)(1).subtract(t),i=e.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return s.multiply(e).add(t.multiply(i))}function g(e){const t=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(e,t)}function f(e){return(0,r.T9)((0,r.T9)((0,r.T9)(e.x,e.y),e.z),e.w)}function y(e){return new r.nt(1).subtract(e)}function x(e){return e.subtract(new r.nt(1))}function w(e,t){return e.subtract(new r.nt(t))}},32004:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Ht});var i=s(6326),r=s(54901),n=s(76460),o=s(50346),a=s(68134),l=s(46053),u=s(81806),c=(s(47249),s(85842)),h=s(68347),p=s(64022),d=s(23246),m=s(69539),g=s(15941),f=s(17775),y=s(52297),x=s(61229),w=s(52494),b=s(2413),_=s(28632),C=s(85827),v=s(30726),T=s(63919),P=s(59422),R=s(8794),S=s(71853);const M={bandCount:3,minOutput:0,maxOutput:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class k extends R.q{constructor(e=null,t=null,s=null){super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._maskTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._mask=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=e,this.transformGrid=t,this.interpolation=s}destroy(){super.destroy(),this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}get rasterTexture(){return this._rasterTexture}set rasterTexture(e){this._rasterTexture!==e&&(this._rasterTexture?.dispose(),this._rasterTexture=e),null==e&&(this.projected=!1)}get processed(){return this._processed}set processed(e){this._processed=e,e||(this.processedTexture=(0,v.WD)(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||M}set symbolizerParameters(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0)}get source(){return this._source}set source(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture=(0,v.WD)(this._rasterTexture),this._rasterTextureBandIds=null),this.projected=!1,this.invalidateTexture())}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._maskTexture=(0,v.WD)(this._maskTexture))}get suspended(){return this._suspended}set suspended(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}get bandIds(){return this._bandIds}set bandIds(e){this._bandIds=e,this._isBandIdsChanged(e)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?9729:9728)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid!==e&&(this._transformGrid=e,this._transformGridTexture=(0,v.WD)(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(e=!1){const t=e||this.projected;return[t?this.width:this.source?.width||this.width,t?this.height:this.source?.height||this.height]}getRasterCellSize(){const e=this.rawPixelData?.srcPixelSize,{projected:t,resolution:s}=this;return e&&!t?[e.x,e.y]:[s,s]}_createTransforms(){return{displayViewScreenMat3:(0,C.vt)()}}setTransform(e){const t=(0,T.D_)(this.transforms.displayViewScreenMat3),[s,i]=e.toScreenNoRotation([0,0],[this.x,this.y]),r=this.resolution/this.pixelRatio/e.resolution,n=r*this.width,o=r*this.height,a=Math.PI*this.rotation/180;(0,T.Tl)(t,t,(0,P.fA)(s,i)),(0,T.Tl)(t,t,(0,P.fA)(n/2,o/2)),(0,T.e$)(t,t,-a),(0,T.Tl)(t,t,(0,P.fA)(-n/2,-o/2)),(0,T.Oe)(t,t,(0,P.fA)(n,o)),(0,T.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}getTextures({forProcessing:e=!1,useProcessedTexture:t=!1}={}){const s=t?this._processedTexture??this._rasterTexture:this._rasterTexture,i=[],r=[];return s?(this._transformGridTexture&&!this.projected&&(r.push(this._transformGridTexture),i.push("u_transformGrid")),r.push(s),i.push("u_image"),!this._colormapTexture||!t&&e||(r.push(this._colormapTexture),i.push("u_colormap")),this._maskTexture&&(r.push(this._maskTexture),i.push("u_mask")),{names:i,textures:r}):{names:i,textures:r}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:e}){if(!this.stage)return void this._disposeTextures();const t=this._isValidSource(this.source);t&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(e)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(e),this._rasterTexture&&(t?(this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,S.kc)(e,this.transformGrid)),this._mask&&!this._maskTexture&&(this._maskTexture=(0,S.WL)(e,this._mask,[this.width,this.height]))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){const{functionTextures:e}=this;0!==e.length&&(this.processedTexture=e.shift(),e.forEach((e=>e?.dispose())),e.length=0,this.processed=!!this.processedTexture)}_createOrDestroyRasterTexture(e){const t=this.source?.extractBands(this.bandIds);if(!this._isValidSource(t))return void(this._rasterTexture&&(this._rasterTexture=(0,v.WD)(this._rasterTexture),this._rasterTextureBandIds=null));const s=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(s)return;this._rasterTexture=(0,v.WD)(this._rasterTexture),this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!e.capabilities.textureFloatLinear;const i=this._getTextureSamplingMethod(this.interpolation),r=this.isRendereredSource;this._rasterTexture=(0,S.b4)(e,t,i,r),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(e){const t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}_isValidSource(e){return null!=e&&e.pixels?.length>0}_getTextureSamplingMethod(e){const{type:t}=this.symbolizerParameters,s="lut"===t&&!this.symbolizerParameters.isClassBreaks||"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||s||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,s=this.symbolizerParameters.colormap;return s?t?s.length!==t.length||s.some(((e,s)=>e!==t[s]))?(this._colormapTexture&&(this._colormapTexture=(0,v.WD)(this._colormapTexture)),this._colormapTexture=(0,S.hE)(e,s),void(this._colormap=s)):void 0:(this._colormapTexture=(0,S.hE)(e,s),void(this._colormap=s)):(this._colormapTexture&&(this._colormapTexture=(0,v.WD)(this._colormapTexture)),void(this._colormap=null))}_disposeTextures(e=!1){e?this.projected&&(this._transformGridTexture=(0,v.WD)(this._transformGridTexture)):(this._rasterTexture=(0,v.WD)(this._rasterTexture),this._colormapTexture=(0,v.WD)(this._colormapTexture),this._transformGridTexture=(0,v.WD)(this._transformGridTexture),this._maskTexture=(0,v.WD)(this._maskTexture),this._rasterTextureBandIds=null,this._colormap=null,this._colormapTextureInvalidated=!0),this._processedTexture=(0,v.WD)(this._processedTexture)}}var I=s(78440);class z extends I.Y{constructor(e,t,s,i,r,n,o=null){super(e,t,s,i,r,n),this.bitmap=null,this.bitmap=new k(o,null,null),this.bitmap.coordScale=[r,n],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:(0,C.vt)(),tileMat3:(0,C.vt)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var B=s(46550),F=s(70479),A=s(6951),V=s(60984),Z=s(60853);class O extends A.k2{}function D(e,t){const{transformTexture:s,targetImageSize:i,transformSpacing:r}=t,n=(0,V.RI)(e.multiply(i)),o=new V.ZY(4,1),a=(0,V.RI)(n.divide(r)).multiply(o),l=(0,V.jc)(n.add(new V.ZY(.5,.5)).divide(r)),u=new V.Cq((0,V.Wh)(a.x),(0,V.Wh)(a.y)),c=new V.eB(l,1);return(0,V.Tk)((0,V.$5)(l.x,l.y),function(e,t,s){const i=(0,V.nP)(e,t,new V.Ai(0)),r=new V.Cq(t.x.add(1),t.y),n=(0,V.nP)(e,r,new V.Ai(0));return new V.ZY((0,V.Om)(i.rgb,s),(0,V.Om)(n.rgb,s))}(s,u,c),function(e,t,s){const i=new V.Cq(t.x.add(2),t.y),r=(0,V.nP)(e,i,new V.Ai(0)),n=new V.Cq(t.x.add(3),t.y),o=(0,V.nP)(e,n,new V.Ai(0));return new V.ZY((0,V.Om)(r.rgb,s),(0,V.Om)(o.rgb,s))}(s,u,c))}function E(e,t,s=!1){return t?s?function(e,t){const s=(0,V.US)(t.transformTexture,e);return new V.ZY(s.r,s.g)}(e,t):D(e,t):e}function U(e,t,s){const{bicubic:i=!1,bilinear:r=!1,nearestOnEdge:n=!1}=s??{};return i||r?function(e,t,s,i){const r=(0,V.RI)(t.multiply(s)),n=new V.Cq(new V.Ai(r.x),new V.Ai(r.y)),o=new V.Cq(n.x.add(1),n.y),a=new V.Cq(n.x,n.y.add(1)),l=new V.Cq(n.x.add(1),n.y.add(1)),u=(0,V.nP)(e,n,new V.Ai(0)),c=(0,V.nP)(e,o,new V.Ai(0)),h=(0,V.nP)(e,a,new V.Ai(0)),p=(0,V.nP)(e,l,new V.Ai(0)),d=(0,V.jc)(t.multiply(s)),m=(0,V.jh)(u,c,d.x),g=(0,V.jh)(h,p,d.x),f=(0,V.jh)(m,g,d.y);if(!i)return f;const y=new V.Zb(u.a,c.a,h.a,p.a),x=y.xy.multiply(y.zw),w=(0,V.RI)(x.x.multiply(x.y).add(.5)),b=f.multiply(w),_=(0,Z.zb)(w).multiply((0,V.US)(e,t));return b.add(_)}(t.texture,e,t.srcImageSize,n):(0,V.US)(t.texture,e)}function j(e){const t=(0,V._S)(e),s=e.add((0,V.tn)(t).subtract(1));return t.multiply(t).divide(s)}function q(e){return new V.Zb((0,V.RI)(e.rgb.add(.5)),e.a)}function G(e,t){return(0,V.PM)(t.x,e).multiply((0,V.PM)(e,t.y))}(0,i.Cg)([(0,A.Pi)(V.z7)],O.prototype,"transformTexture",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],O.prototype,"targetImageSize",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],O.prototype,"transformSpacing",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],O.prototype,"transformGridSize",void 0);class L extends A.ZA{}(0,i.Cg)([(0,A.C5)(0,V.ZY)],L.prototype,"position",void 0);class H extends A.HS{}class W extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.z7)],W.prototype,"texture",void 0),(0,i.Cg)([(0,A.Pi)(V.U)],W.prototype,"dvsMat3",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],W.prototype,"coordScale",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],W.prototype,"srcImageSize",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],W.prototype,"opacity",void 0);class Y extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.z7)],Y.prototype,"maskTexture",void 0);class N extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,2*w.et))],N.prototype,"ranges",void 0),(0,i.Cg)([(0,A.Pi)(V.U)],N.prototype,"bandSwap",void 0),(0,i.Cg)([(0,A.Pi)(V.Zb)],N.prototype,"color",void 0);class $ extends A.A{constructor(){super(...arguments),this.applyProjection=!0,this.lookupProjection=!1,this.bilinear=!1,this.bicubic=!1,this.nearestOnEdge=!1,this.applyPixelMask=!1,this.applyPixelHighlights=!1}vertex(e){const t=e.position,{dvsMat3:s,coordScale:i}=this.config,r=s.multiply(new V.eB(t.multiply(i),1));return{uv:t,glPosition:new V.Zb(r,1)}}fragment(e){const t=new A.mm,s=E(e.uv,this.applyProjection?this.projectionConfig:void 0,this.lookupProjection);let i=this._colorize(s);this.applyPixelHighlights&&(i=this._highlightPixels(s,i));const r=(0,V.Tk)(function(e){const t=(0,V.PM)(new V.ZY(-1e-5,-1e-5),e).multiply((0,V.PM)(e,new V.ZY(1.00001,1.00001))),s=(0,Z.zb)(t.x.multiply(t.y));return new V.x(s)}(s),new V.Zb(0),i);let n=r.a.multiply(this.config.opacity);if(this.applyPixelMask){const t=this._getPixelMask(e.uv);n=n.multiply(t)}return t.fragColor=new V.Zb(r.rgb,1).multiply(n),t}_getPixel(e){const{config:t,bicubic:s,bilinear:i,nearestOnEdge:r}=this;return U(e,t,{bicubic:s,bilinear:i,nearestOnEdge:r})}_getPixelMask(e){const{maskTexture:t}=this.pixelMaskConfig,s=(0,V.US)(t,e);return(0,V._S)(s.a)}_highlightPixels(e,t){const s=this._getPixel(e),{ranges:i,color:r,bandSwap:n}=this.highlightConfig,o=function(e,t){let s=new V.eB(0,0,0);const i=new V.eB(e);for(let r=0;r<w.et/3;r++){const e=6*r,n=new V.eB(t[e],t[e+2],t[e+4]),o=new V.eB(t[e+1],t[e+3],t[e+5]);s=s.add((0,V.PM)(n,i).multiply((0,V.PM)(i,o)))}return(0,V._S)((0,V.Om)(s,new V.eB(1,1,1)))}(n.multiply(s.rgb).x,i).multiply(s.a);return(0,V.jh)(t,r,o)}}(0,i.Cg)([A.E8],$.prototype,"applyProjection",void 0),(0,i.Cg)([A.E8],$.prototype,"lookupProjection",void 0),(0,i.Cg)([A.E8],$.prototype,"bilinear",void 0),(0,i.Cg)([A.E8],$.prototype,"bicubic",void 0),(0,i.Cg)([A.E8],$.prototype,"nearestOnEdge",void 0),(0,i.Cg)([A.E8],$.prototype,"applyPixelMask",void 0),(0,i.Cg)([A.E8],$.prototype,"applyPixelHighlights",void 0),(0,i.Cg)([(0,A.Pi)(W)],$.prototype,"config",void 0),(0,i.Cg)([(0,A.uK)(O)],$.prototype,"projectionConfig",void 0),(0,i.Cg)([(0,A.uK)(Y)],$.prototype,"pixelMaskConfig",void 0),(0,i.Cg)([(0,A.uK)(N)],$.prototype,"highlightConfig",void 0),(0,i.Cg)([(0,i.Qj)(0,(0,A.hF)(L))],$.prototype,"vertex",null),(0,i.Cg)([(0,i.Qj)(0,(0,A.hF)(H))],$.prototype,"fragment",null);class Q extends A.k2{}function K(e,t,s,i=!0){const{colormapTexture:r,colormapOffset:n,colormapMaxIndex:o}=s,a=e.r.multiply(t).subtract(n),l=(0,V.qE)(a,new V.nt(0),o),u=new V.ZY(l.add(.5).divide(o.add(1)),0),c=(0,V.US)(r,u),h=new V.Zb(c.rgb,c.a.multiply(e.a));if(i)return h;const p=(0,V.PM)(new V.nt(0),a).multiply((0,V.PM)(a,s.colormapMaxIndex));return h.multiply(p)}(0,i.Cg)([(0,A.Pi)(V.z7)],Q.prototype,"colormapTexture",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Q.prototype,"colormapOffset",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Q.prototype,"colormapMaxIndex",void 0);class X extends ${constructor(){super(...arguments),this.type="RasterColorizerLUTShader"}_colorize(e){return K(this._getPixel(e),new V.nt(1),this.colormapConfig,!1)}}function J(e){const t=new V.Zb(0,-1/3,2/3,-1),s=(0,V.Tk)((0,V.Xe)(e.y,e.z),new V.Zb(e.zy,t.wz),new V.Zb(e.yz,t.xy)),i=(0,V.Tk)((0,V.Xe)(e.x,s.x),new V.Zb(s.xyw,e.x),new V.Zb(e.x,s.yzx)),r=i.x.subtract((0,V.jk)(i.w,i.y)),n=new V.nt(1e-10),o=i.w.subtract(i.y),a=r.multiply(6).add(n),l=(0,V.tn)(o.divide(a).add(i.z)),u=i.x.add(n),c=(0,V.jk)(r.divide(u),new V.nt(1));return new V.eB(l,c,i.x)}function ee(e){const t=new V.Zb(1,2/3,1/3,3),s=(0,V.tn)((0,V.jc)(e.xxx.add(t.xyz)).multiply(6).subtract(t.www)),i=(0,V.qE)(s.subtract(t.xxx),new V.eB(0,0,0),new V.eB(1));return e.z.multiply((0,V.jh)(t.xxx,i,e.y))}(0,i.Cg)([(0,A.Pi)(Q)],X.prototype,"colormapConfig",void 0);class te extends A.k2{}function se(e){const t=(0,V.tn)(e),s=(0,V.PM)(t,new V.ZY(1,1)).multiply(t),i=new V.nt(2).subtract(t),r=(0,V.PM)(new V.nt(1),t).multiply(i);return s.add(r)}function ie(e,t,s){const i=new V.nt(1).divide(s),r=(0,V.US)(e,se(i.multiply(new V.ZY(-1,-1)).add(t))),n=(0,V.US)(e,se(i.multiply(new V.ZY(0,-1)).add(t))),o=(0,V.US)(e,se(i.multiply(new V.ZY(1,-1)).add(t))),a=(0,V.US)(e,se(i.multiply(new V.ZY(-1,0)).add(t))),l=(0,V.US)(e,se(t)),u=(0,V.US)(e,se(i.multiply(new V.ZY(1,0)).add(t))),c=(0,V.US)(e,se(i.multiply(new V.ZY(-1,1)).add(t))),h=(0,V.US)(e,se(i.multiply(new V.ZY(0,1)).add(t))),p=(0,V.US)(e,se(i.multiply(new V.ZY(1,1)).add(t))),d=new V.Zb(r.a,n.a,o.a,a.a),m=new V.Zb(u.a,c.a,h.a,p.a),g=d.multiply(m),f=g.xy.multiply(g.zw),y=f.x.multiply(f.y).multiply(l.a),x=new V.My(new V.nt(0),10);return x[0]=r.r,x[1]=n.r,x[2]=o.r,x[3]=a.r,x[4]=l.r,x[5]=u.r,x[6]=c.r,x[7]=h.r,x[8]=p.r,x[9]=y,x}function re(e,t){const s=new V.Zb(e[5],e[3],e[7],e[1]).multiply(2),i=new V.eB(e[2],s[0],e[8]),r=new V.eB(e[0],s[1],e[6]),n=(0,V.Om)(i.subtract(r),new V.eB(1)),o=new V.eB(e[6],s[2],e[8]),a=new V.eB(e[0],s[3],e[2]),l=(0,V.Om)(o.subtract(a),new V.eB(1));return new V.ZY(n,l).multiply(t)}function ne(e,t,s){const{factor:i}=t,r=re(e,i),n=(0,V.RZ)((0,V.Om)(r,r).add(1)),o=e[9],{sinZsinAs:a,sinZcosAs:l,cosZs:u,weights:c}=t;if(!s){const e=oe({sinZsinA:a[0],sinZcosA:l[0],cosZ:u[0],weights:new V.nt(1),dzxy:r,dzd:n});return new V.Zb(e,e,e,o)}const h=oe({sinZsinA:new V.eB(a[0],a[1],a[2]),sinZcosA:new V.eB(l[0],l[1],l[2]),cosZ:new V.eB(u[0],u[1],u[2]),weights:new V.eB(c[0],c[1],c[2]),dzxy:r,dzd:n}),p=oe({sinZsinA:new V.eB(a[3],a[4],a[5]),sinZcosA:new V.eB(l[3],l[5],l[5]),cosZ:new V.eB(u[3],u[4],u[5]),weights:new V.eB(c[3],c[4],c[5]),dzxy:r,dzd:n}),d=(0,V.Om)(h.add(p),new V.eB(1));return new V.Zb(d,d,d,o)}function oe(e){const t=e.sinZsinA.multiply(e.dzxy.y),s=e.sinZcosA.multiply(e.dzxy.x),i=t.subtract(s),r=e.cosZ.add(i).divide(e.dzd);return r.multiply((0,V.PM)(new V.nt(0),r)).multiply(e.weights)}function ae(e,t){const{pixelSizeFactor:s}=e,i=[e.factor[0]/t[0],e.factor[1]/t[1]];if(s>0){const{zFactor:r,pixelSizePower:n,gcsFactor:o}=e,a=t[0]*o,l=t[1]*o;i[0]=(r+a**n*s)/(8*a),i[1]=(r+l**n*s)/(8*l)}return i}(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,6))],te.prototype,"sinZcosAs",void 0),(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,6))],te.prototype,"sinZsinAs",void 0),(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,6))],te.prototype,"cosZs",void 0),(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,6))],te.prototype,"weights",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],te.prototype,"minValue",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],te.prototype,"maxValue",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],te.prototype,"factor",void 0);class le extends ${constructor(){super(...arguments),this.type="RasterColorizerShadedReliefShader",this.applyColormap=!1,this.isMultidirectional=!1}_colorize(e){const{texture:t}=this.config,s=ne(ie(t,e,this.config.srcImageSize),this.hillshadeConfig,this.isMultidirectional);if(!this.applyColormap)return new V.Zb(s.x,s.x,s.x,s.a);const{minValue:i,maxValue:r}=this.hillshadeConfig,n=this._getPixel(e),o=r.subtract(i),a=n.r.subtract(i),l=(0,V.qE)(a.divide(o),new V.nt(0),new V.nt(1)),u=K(new V.Zb(l,l,l,1),new V.nt(255),this.colormapConfig),c=J(u.xyz),h=ee(new V.eB(c.xy,s.x));return new V.Zb(h,u.a.multiply(s.a))}}(0,i.Cg)([A.E8],le.prototype,"applyColormap",void 0),(0,i.Cg)([A.E8],le.prototype,"isMultidirectional",void 0),(0,i.Cg)([(0,A.Pi)(te)],le.prototype,"hillshadeConfig",void 0),(0,i.Cg)([(0,A.uK)(Q)],le.prototype,"colormapConfig",void 0);class ue extends A.k2{}function ce(e,t,s,i=255){const r=s?function(e,t){const{minCutOff:s,maxCutOff:i,minOutput:r,maxOutput:n,gamma:o,gammaCorrection:a}=t,l=(0,V.qE)(e,s,i).subtract(s),u=i.subtract(s),c=l.divide(u),h=(0,V.PM)(new V.nt(1),o),p=(0,V._S)(o.subtract(1)),d=n.subtract(r),m=new V.eB(1),g=(0,V.n7)(m.divide(d),c.multiply(a)),f=(0,Z.zb)(h.multiply(p).multiply(g)),y=(0,V.n7)(c,m.divide(o)),x=f.multiply(d).multiply(y).add(r);return(0,V.qE)(x,r,n)}(e.rgb,t).divide(i):function(e,t){const{minCutOff:s,maxCutOff:i,factor:r,minOutput:n}=t;return(0,V.qE)(e,s,i).subtract(s).multiply(r).add(n)}(e.rgb,t);return new V.Zb(r,e.a)}(0,i.Cg)([(0,A.Pi)(V.nt)],ue.prototype,"minOutput",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],ue.prototype,"maxOutput",void 0),(0,i.Cg)([(0,A.Pi)(V.eB)],ue.prototype,"minCutOff",void 0),(0,i.Cg)([(0,A.Pi)(V.eB)],ue.prototype,"maxCutOff",void 0),(0,i.Cg)([(0,A.Pi)(V.eB)],ue.prototype,"factor",void 0),(0,i.Cg)([(0,A.Pi)(V.eB)],ue.prototype,"gamma",void 0),(0,i.Cg)([(0,A.Pi)(V.eB)],ue.prototype,"gammaCorrection",void 0);class he extends ${constructor(){super(...arguments),this.type="RasterColorizerStretchShader",this.isMultiband=!0,this.applyColormap=!1,this.useGamma=!1,this.noOp=!1}_colorize(e){const t=this._getPixel(e);if(this.noOp)return t;let s=ce(t,this.stretchConfig,this.useGamma);if(this.isMultiband)return s;if(s=new V.Zb(s.rrr,s.a),this.applyColormap){const e=this.useGamma?255:1;s=K(s,new V.nt(e),this.colormapConfig)}return s}}(0,i.Cg)([A.E8],he.prototype,"isMultiband",void 0),(0,i.Cg)([A.E8],he.prototype,"applyColormap",void 0),(0,i.Cg)([A.E8],he.prototype,"useGamma",void 0),(0,i.Cg)([A.E8],he.prototype,"noOp",void 0),(0,i.Cg)([(0,A.Pi)(ue)],he.prototype,"stretchConfig",void 0),(0,i.Cg)([(0,A.uK)(Q)],he.prototype,"colormapConfig",void 0);class pe extends F.j{constructor(){super(...arguments),this.name="BrushRasterColorizer",this.type=0,this.shaders={lut:new X,stretch:new he,shadedRelief:new le}}render(e,t){for(const s of t.bitmaps){if(!s.source||s.suspended)continue;e.timeline.begin(this.name);const{painter:t}=e;t.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:s.stencilRef,compare:514,op:{fail:7680,zFail:7680,zPass:7680}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"composite"}}),s.updateTexture(e),s.processedTexture||s.updateProcessedTexture();const{type:i}=s.symbolizerParameters,r="stretch"===i?this._getStretchOptions(s):"lut"===i?this._getLutOptions(s):this._getShadedReliefOptions(s);"bilinear"!==s.interpolation||e.context.capabilities.textureFloatLinear||(r.defines.bilinear=!0);const{pixelHighlightOptions:n}=e;if(n&&!s.isRendereredSource){const e=s.bandIds?.length?s.bandIds.indexOf(n.bandId):0;if(e>=0&&e<=2){r.defines.applyPixelHighlights=!0;const t=new Float32Array(9);t[3*e]=1,r.uniforms.highlightConfig={...n,bandSwap:t}}}t.submitDrawMesh(e.context,r,t.quadMesh),e.timeline.end(this.name)}}_getLutOptions(e){const{config:t,projectionConfig:s,colormapConfig:i,pixelMaskConfig:r,projectionDefines:n}=this._getCommonConfig(e),o=this._getInterpolationDefines("nearest",!1);return{shader:this.shaders.lut,uniforms:{projectionConfig:s,config:t,colormapConfig:i,pixelMaskConfig:r},defines:{...n,...o,applyPixelMask:!!r,applyPixelHighlights:!1},optionalAttributes:null,useComputeBuffer:!1}}_getStretchOptions(e){const t=e.symbolizerParameters,{config:s,projectionConfig:i,colormapConfig:r,pixelMaskConfig:n,projectionDefines:o}=this._getCommonConfig(e),a=this._getInterpolationDefines(e.interpolation,1===t.bandCount);return{shader:this.shaders.stretch,uniforms:{projectionConfig:i,config:s,stretchConfig:t,colormapConfig:r,pixelMaskConfig:n},defines:{...o,...a,isMultiband:t.bandCount>1,applyColormap:!!r,useGamma:t.useGamma,noOp:e.isRendereredSource&&!e.processed,applyPixelMask:!!n,applyPixelHighlights:!1},optionalAttributes:null,useComputeBuffer:!1}}_getShadedReliefOptions(e){const t=e.symbolizerParameters,{config:s,projectionConfig:i,colormapConfig:r,pixelMaskConfig:n,projectionDefines:o}=this._getCommonConfig(e),a=this._getInterpolationDefines(e.interpolation,!0);return{shader:this.shaders.shadedRelief,uniforms:{projectionConfig:i,config:s,hillshadeConfig:t,colormapConfig:r,pixelMaskConfig:n},defines:{...o,...a,isMultidirectional:t.hillshadeType>0,applyColormap:!!r,applyPixelMask:!!n,applyPixelHighlights:!1},optionalAttributes:null,useComputeBuffer:!1}}_getCommonConfig(e){const{coordScale:t,computedOpacity:s,transforms:i}=e,{names:r,textures:n}=e.getTextures({useProcessedTexture:e.processed}),o=n[r.indexOf("u_image")],a=e.getRasterTextureSize(),l={texture:{texture:o,unit:0},dvsMat3:i.displayViewScreenMat3,coordScale:t,srcImageSize:a,opacity:s},u=n[r.indexOf("u_transformGrid")],{transformGrid:c}=e,h=!(!u||!c),p=h?{transformTexture:{texture:u,unit:2},targetImageSize:[e.width,e.height],transformSpacing:c.spacing,transformGridSize:c.size}:void 0,d=n[r.indexOf("u_colormap")],{colormap:m,colormapOffset:g}=e.symbolizerParameters,f=d&&m?{colormapTexture:{texture:d,unit:1},colormapOffset:g??0,colormapMaxIndex:m.length/4-1}:void 0,y=n[r.indexOf("u_mask")];return{config:l,projectionConfig:p,colormapConfig:f,pixelMaskConfig:y?{maskTexture:{texture:y,unit:3}}:void 0,projectionDefines:{applyProjection:h,lookupProjection:h&&1===c.spacing[0]}}}_getInterpolationDefines(e,t){const s="bilinear"===e&&t;return{bilinear:s,bicubic:"cubic"===e,nearestOnEdge:s}}}var de=s(5095),me=s(93345),ge=s(12331),fe=s(80895),ye=s(96673);function xe(e,t){const s=new ye.R(e,t);return s.internalFormat=me.H0.RGBA32F,s.samplingMode=9728,s.dataType=me.ld.FLOAT,s.isImmutable=!0,s.wrapMode=33071,s}function we(e,t,s){const i=xe(t,s);return new fe.g(e,i)}function be(e,t,s){const i=xe(t,s);return new ge.H(e,i)}class _e extends F.j{shutdown(e){super.shutdown(e),this._fbo?.dispose(),this._fbo=void 0}render(e,t){const{rasterFunction:s}=e;if(!s)return;const{context:i}=e,r="indexedColormap"in s.parameters?(0,S.hE)(i,s.parameters.indexedColormap):void 0,n="Reproject"===s.name,o=i.getBoundFramebufferObject(),a=i.getViewport();for(const l of t.bitmaps){const o=n?!(l.rasterTexture&&l.projected):!l.processed;if(!l.source||!o||l.suspended)continue;e.timeline.begin(this.name);const{painter:a}=e;a.setPipelineState({depth:!1,stencil:{test:!1,write:!1},color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0}}}),n||(l.processedTexture=(0,v.WD)(l.processedTexture)),l.updateTexture(e);const[u,c]=l.getRasterTextureSize(n),h=u===de.CQ&&c===de.CQ,p=h?t.processorFbo:be(i,u,c);i.bindFramebuffer(p),i.setViewport(0,0,p.width,p.height),this._process(e,l,r);const d=we(e.context,u,c);if(p.copyToTexture(0,0,u,c,0,0,d),n)l.rasterTexture=d;else{const t=e.hasBranches?s.id:0;l.functionTextures[t]=d}h||p.dispose(),e.timeline.end(this.name)}r?.dispose(),i.bindFramebuffer(o),i.setViewport(a.x,a.y,a.width,a.height)}_getCommonConfig(e,t){const{rasterFunction:s,hasBranches:i}=e,{raster:r,rasters:n}=s.parameters,o=i?r?.id??n?.filter((e=>"Constant"!==e.name))?.[0]?.id??-1:0,a=t.functionTextures[o]??t.rasterTexture,l="Reproject"===s.name;return{texture:{texture:a,unit:0},srcImageSize:t.getRasterTextureSize(l)}}_getMultipleInputConfig(e,t){return t?.length?2===t.length?{twoRasterConfig:this._getTwoInputConfig(t,e)}:3===t.length?{threeRasterConfig:this._getThreeInputConfig(t,e)}:{}:{}}_getConstantCount(e){return e?.filter((e=>"Constant"===e.name)).length??0}_getTextures(e,t){return e.filter((e=>"Constant"!==e.name)).map((e=>null!=e.id&&"Identity"!==e.name?t.functionTextures[e.id]:t.rasterTexture))}_getTwoInputConfig(e,t){const s=this._getTextures(e,t),i=s[1]?{texture:s[1],unit:1}:void 0,r=e.findIndex((e=>"Constant"===e.name)),n=0===r?new Float32Array([0,1,0,1,0,0,0,0,0]):new Float32Array([1,0,0,0,1,0,0,0,0]);return{image1:i,image1Const:r>-1?e[r].parameters.value:0,imageSwap:n}}_getThreeInputConfig(e,t){const s=this._getTextures(e,t);let i=0,r=0,n=new Float32Array([1,0,0,0,1,0,0,0,1]);const o=s[1]?{texture:s[1],unit:1}:void 0,a=s[2]?{texture:s[2],unit:2}:void 0,l=[];if(e.forEach(((e,t)=>"Constant"===e.name&&l.push(t))),1===l.length)i=e[l[0]].parameters.value,n=0===l[0]?new Float32Array([0,1,0,0,0,1,1,0,0]):1===l[0]?new Float32Array([1,0,0,0,0,1,0,1,0]):new Float32Array([1,0,0,0,1,0,0,0,1]);else if(2===l.length){i=e[l[0]].parameters.value,r=e[l[1]].parameters.value;const t=e.findIndex((e=>"Constant"!==e.name));n=0===t?new Float32Array([1,0,0,0,1,0,0,0,1]):1===t?new Float32Array([0,1,0,1,0,0,0,0,1]):new Float32Array([0,0,1,1,0,0,0,1,0])}return{image1:o,image2:a,image1Const:i,image2Const:r,imageSwap:n}}}class Ce extends A.ZA{}(0,i.Cg)([(0,A.C5)(0,V.ZY)],Ce.prototype,"position",void 0);class ve extends A.HS{}class Te extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.z7)],Te.prototype,"texture",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],Te.prototype,"srcImageSize",void 0);class Pe extends A.A{vertex(e){return{uv:e.position,glPosition:new V.Zb((0,Z.nb)(e.position),0,1)}}fragment(e){const t=new A.mm,s=E(e.uv),i=this._process(s);return t.fragColor=new V.Zb(i.rgb,1).multiply(i.a),t}_getPixel(e){return U(e,this.config)}}(0,i.Cg)([(0,A.Pi)(Te)],Pe.prototype,"config",void 0),(0,i.Cg)([(0,i.Qj)(0,(0,A.hF)(Ce))],Pe.prototype,"vertex",null),(0,i.Cg)([(0,i.Qj)(0,(0,A.hF)(ve))],Pe.prototype,"fragment",null);class Re extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.ZY)],Re.prototype,"cellSize",void 0);class Se extends Pe{constructor(){super(...arguments),this.type="AspectShader"}_process(e){const{texture:t}=this.config,s=ie(t,e,this.config.srcImageSize),i=new V.ZY(1).divide(this.aspectConfig.cellSize.multiply(8)),{x:r,y:n}=re(s,i),o=(0,V.ze)(n),a=s[9].multiply((0,V._S)((0,V.tn)(r).add((0,V.tn)(o)))),l=(0,V.tn)((0,V._S)(r)),u=new V.nt(3.14159265359),c=new V.nt(0),h=(0,V.PM)(c,o).multiply(.5).multiply(u).add((0,V.PM)(o,c).multiply(1.5).multiply(u)),p=(0,V.zi)(new V.nt(2.5).multiply(u).add((0,V.rY)(o,(0,V.ze)(r))),new V.nt(2).multiply(u)),d=(0,V.jh)(h,p,l).multiply(180).divide(u);return new V.Zb(d,d,d,a)}}(0,i.Cg)([(0,A.Pi)(Re)],Se.prototype,"aspectConfig",void 0);class Me extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.U)],Me.prototype,"bandIndexMat3",void 0);class ke extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.eB)],ke.prototype,"adjustments",void 0);class Ie extends Pe{constructor(){super(...arguments),this.type="BandArithmeticShader",this.isOutputRounded=!1}_process(e){const t=this._getPixel(e),s=this.bandArithmeticConfig.bandIndexMat3.multiply(t.rgb),i=this._processIndex(s),r=new V.Zb(i,i,i,t.a);return this.isOutputRounded?q(r):r}_processIndex(e){const{r:t,g:s}=e,i=this.adjustmentConfig?.adjustments;switch(this.indexType){case"ndxi":{const e=t.subtract(s),i=t.add(s);return e.multiply(j(i))}case"sr":return t.multiply(j(s));case"ci":return t.multiply(j(s)).subtract(1);case"savi":{const{x:e}=i,r=t.subtract(s),n=t.add(s).add(e);return r.multiply(j(n)).multiply(e.add(1))}case"tsavi":{const{x:e,y:r,z:n}=i,o=n.multiply(e.multiply(e).add(1)).subtract(r.multiply(e)),a=e.multiply(t.subtract(e.multiply(s)).subtract(r)),l=r.multiply(t).add(s).add(o);return a.multiply(j(l))}case"msavi":{const e=t.multiply(2).add(1),i=e.multiply(e).subtract(t.subtract(s).multiply(8));return e.subtract((0,V.RZ)(i)).multiply(.5)}case"gemi":{const e=t.multiply(t).subtract(s.multiply(s)).multiply(2).add(t.multiply(1.5)).add(s.multiply(.5)),i=t.add(s).add(.5),r=e.multiply(j(i)),n=r.multiply((0,Z.zb)(r.multiply(.25))),o=s.subtract(.125).multiply(j((0,Z.zb)(s)));return n.subtract(o)}case"pvi":{const{x:e,y:r}=i,n=(0,V.RZ)(e.multiply(e).add(1));return t.subtract(s.multiply(e)).subtract(r).multiply(j(n))}case"vari":{const t=e.g.subtract(e.r),s=e.g.add(e.r).subtract(e.b);return t.multiply(j(s))}case"rtvicore":return t.subtract(s).multiply(100).subtract(t.subtract(e.b).multiply(10));case"bai":{const e=(0,V.n7)(new V.nt(.1).subtract(s),new V.nt(2)),i=(0,V.n7)(new V.nt(.06).subtract(t),new V.nt(2));return j(e.add(i))}case"evi":{const i=e.b,r=t.add(s.multiply(6)).subtract(i.multiply(7.5)).add(1);return t.subtract(s).multiply(2.5).multiply(j(r))}case"wndwi":{const{r:t,g:s,b:r}=e,n=i.x,o=n.multiply(s),a=n.multiply(r),l=t.add(o).add(r).subtract(a);return t.subtract(o).subtract(r).add(a).multiply(j(l))}case"mtvi":{const i=e.b,r=(0,V.n7)(t.multiply(2).add(1),new V.nt(2)),n=t.multiply(6).subtract((0,V.RZ)(s).multiply(5)),o=(0,V.RZ)(r.subtract(n).subtract(.5)),a=t.subtract(i).multiply(1.2),l=s.subtract(i).multiply(2.5);return a.subtract(l).multiply(1.5).multiply(j(o))}default:return t}}}(0,i.Cg)([A.E8],Ie.prototype,"indexType",void 0),(0,i.Cg)([A.E8],Ie.prototype,"isOutputRounded",void 0),(0,i.Cg)([(0,A.Pi)(Me)],Ie.prototype,"bandArithmeticConfig",void 0),(0,i.Cg)([(0,A.uK)(ke)],Ie.prototype,"adjustmentConfig",void 0);class ze extends Pe{constructor(){super(...arguments),this.type="ColormapToRGBShader"}_process(e){const t=K(this._getPixel(e),new V.nt(1),this.colormapConfig,!1);return new V.Zb(t.xyz.multiply(255),t.a)}}(0,i.Cg)([(0,A.Pi)(Q)],ze.prototype,"colormapConfig",void 0);class Be extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.z7)],Be.prototype,"image1",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Be.prototype,"image1Const",void 0),(0,i.Cg)([(0,A.Pi)(V.U)],Be.prototype,"imageSwap",void 0);class Fe extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.z7)],Fe.prototype,"image1",void 0),(0,i.Cg)([(0,A.Pi)(V.z7)],Fe.prototype,"image2",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Fe.prototype,"image1Const",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Fe.prototype,"image2Const",void 0),(0,i.Cg)([(0,A.Pi)(V.U)],Fe.prototype,"imageSwap",void 0);const Ae=e=>{const t=e;class s extends t{constructor(){super(...arguments),this.constantCount=0,this.imageCount=1}_getRasterValues(e){const{imageCount:t}=this;if(1===t){const t=(0,V.US)(this.config.texture,e);return{a:t.r,b:t.g,c:t.b,alpha:t.a}}if(2===t){const t=this._getTwoValues(e);return{a:t.a,b:t.b,c:t.b,alpha:t.alpha}}return this._getThreeValues(e)}_getTwoValues(e){const t=(0,V.US)(this.config.texture,e);if(1===this.constantCount){const{imageSwap:e,image1Const:s}=this.twoRasterConfig,i=e.multiply(new V.eB(t.r,s,0));return{a:i.x,b:i.y,alpha:t.a}}const{image1:s}=this.twoRasterConfig,i=(0,V.US)(s,e);return{a:t.r,b:i.r,alpha:t.a.multiply(i.a)}}_getThreeValues(e){const t=(0,V.US)(this.config.texture,e),{imageSwap:s,image1:i,image2:r,image1Const:n,image2Const:o}=this.threeRasterConfig;if(2===this.constantCount){const e=s.multiply(new V.eB(t.r,n,o));return{a:e.x,b:e.y,c:e.z,alpha:t.a}}if(1===this.constantCount){const r=(0,V.US)(i,e),o=s.multiply(new V.eB(t.r,r.r,n));return{a:o.x,b:o.y,c:o.z,alpha:t.a.multiply(r.a)}}const a=(0,V.US)(i,e),l=(0,V.US)(r,e);return{a:t.r,b:a.r,c:l.r,alpha:t.a.multiply(a.a).multiply(l.a)}}}return(0,i.Cg)([A.E8],s.prototype,"constantCount",void 0),(0,i.Cg)([A.E8],s.prototype,"imageCount",void 0),(0,i.Cg)([(0,A.uK)(Be)],s.prototype,"twoRasterConfig",void 0),(0,i.Cg)([(0,A.uK)(Fe)],s.prototype,"threeRasterConfig",void 0),s};class Ve extends(Ae(Pe)){constructor(){super(...arguments),this.type="CompositeBandShader"}_process(e){const{a:t,b:s,c:i,alpha:r}=this._getRasterValues(e);return new V.Zb(t,s,i,r)}}class Ze extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.ZY)],Ze.prototype,"domainRange",void 0);class Oe extends(Ae(Pe)){constructor(){super(...arguments),this.type="LocalShader",this.isOutputRounded=!1}_process(e){if("conditional"===this.operationName)return this._conditional(e);const{a:t,b:s,alpha:i}=this._getRasterValues(e),{value:r,alpha:n}=this._compute(t,s,i);return this._processResult(r,n)}_processResult(e,t){const s=G(e,this.domainRangeConfig.domainRange),i=new V.Zb(e,e,e,t).multiply(s);return this.isOutputRounded?q(i):i}_compute(e,t,s){const{operationName:i}=this;let r;switch(i){case"plus":r=e.add(t);break;case"minus":r=e.subtract(t);break;case"times":r=e.multiply(t);break;case"divide":case"floatdivide":r=e.multiply(j(t)),s=s.multiply((0,V.fV)((0,V.tn)((0,V._S)(t))));break;case"floordivide":r=(0,V.RI)(e.multiply(j(t))),s=s.multiply((0,V.fV)((0,V.tn)((0,V._S)(t))));break;case"square":r=e.multiply(e);break;case"sqrt":r=(0,V.RZ)(e);break;case"power":r=(0,V.n7)(e,t);break;case"ln":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.Rm)(e),new V.nt(0)),s=s.multiply(this._isAboveZero(e));break;case"log10":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.p6)(e).multiply(j((0,V.p6)(new V.nt(10)))),new V.nt(0)),s=s.multiply(this._isAboveZero(e));break;case"log2":r=(0,V.Tk)((0,V.MM)(e,new V.nt(0)),(0,V.p6)(e),new V.nt(0)),s=s.multiply(this._isAboveZero(e));break;case"exp":r=(0,V.oN)(e);break;case"exp10":r=(0,V.n7)(new V.nt(10),e);break;case"exp2":r=(0,V.n7)(new V.nt(2),e);break;case"rounddown":r=(0,V.RI)(e);break;case"roundup":r=(0,V.mk)(e);break;case"int":r=(0,V._S)(e).multiply((0,V.RI)((0,V.tn)(e)));break;case"mod":r=(0,V.zi)(e,t);break;case"negate":r=(0,V.ze)(e);break;case"abs":r=(0,V.tn)(e);break;case"acos":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.HQ)(e)),s=(0,V.Tk)(t,new V.nt(0),s);break}case"acosh":r=(0,V.YN)(e);break;case"asin":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.qR)(e)),s=(0,V.Tk)(t,new V.nt(0),s);break}case"asinh":r=(0,V.yH)(e);break;case"atan":r=(0,V.rY)(e);break;case"atanh":{const t=this._isAbsBiggerThanOne(e);r=(0,V.Tk)(t,new V.nt(0),(0,V.rf)(e)),s=(0,V.Tk)(t,new V.nt(0),s);break}case"atan2":r=(0,V.rY)(e,t);break;case"cos":r=(0,V.gn)(e);break;case"cosh":r=(0,V.yI)(e);break;case"sin":r=(0,V.F8)(e);break;case"sinh":r=(0,V.L0)(e);break;case"tan":r=(0,V.Ml)(e);break;case"tanh":r=(0,V.ym)(e);break;case"bitwiseand":r=new V.nt((0,V.nf)(new V.Ai(e),new V.Ai(t)));break;case"bitwiseor":r=new V.nt((0,V.pu)(new V.Ai(e),new V.Ai(t)));break;case"bitwiseleftshift":r=new V.nt((0,V.wH)(new V.Ai(e),new V.Ai(t)));break;case"bitwiserightshift":r=new V.nt((0,V.Sj)(new V.Ai(e),new V.Ai(t)));break;case"bitwisenot":r=new V.nt((0,V.FM)(new V.Ai(e)));break;case"bitwisexor":r=new V.nt((0,V.hC)(new V.Ai(e),new V.Ai(t)));break;case"booleanand":r=(0,V.fV)((0,V.Uo)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"booleanor":r=(0,V.fV)((0,V.or)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"booleannot":r=(0,V.fV)((0,V.LC)(e,new V.nt(0)));break;case"booleanxor":r=(0,V.fV)((0,V.I8)((0,V.Ec)(e,new V.nt(0)),(0,V.Ec)(t,new V.nt(0))));break;case"greaterthan":r=(0,V.fV)((0,V.MM)(e,t));break;case"greaterthanequal":r=(0,V.fV)((0,V.aX)(e,t));break;case"lessthan":r=(0,V.fV)((0,V.Xe)(e,t));break;case"lessthanequal":r=(0,V.fV)((0,V.$5)(e,t));break;case"equalto":r=(0,V.fV)((0,V.LC)(e,t));break;case"notequal":r=(0,V.fV)((0,V.Ec)(e,t));break;case"isnull":r=(0,V.fV)((0,V.LC)(s,new V.nt(0))),s=new V.nt(1);break;case"setnull":{const i=(0,V.fV)((0,V.LC)(e,new V.nt(0)));r=i.multiply(t),s=s.multiply(i);break}default:r=e}return{value:r,alpha:s}}_conditional(e){const{a:t,b:s,c:i,alpha:r}=this._getRasterValues(e),n=new V.nt((0,V.tn)((0,V._S)(t))),o=(0,V.jh)(i,s,n);return this._processResult(o,r)}_isAboveZero(e){return(0,V.fV)((0,V.MM)(e,new V.nt(0)))}_isAbsBiggerThanOne(e){return(0,V.MM)((0,V.tn)(e),new V.nt(1))}}(0,i.Cg)([A.E8],Oe.prototype,"operationName",void 0),(0,i.Cg)([A.E8],Oe.prototype,"isOutputRounded",void 0),(0,i.Cg)([(0,A.Pi)(Ze)],Oe.prototype,"domainRangeConfig",void 0);class De extends(Ae(Pe)){constructor(){super(...arguments),this.type="ComputeChangeShader",this.isOutputRounded=!1}_process(e){const{a:t,b:s,alpha:i}=this._getRasterValues(e);let r=t.subtract(s);"relative-difference"===this.method&&(r=r.multiply(j((0,V.T9)((0,V.tn)(t),(0,V.tn)(s)))));const n=G(r,this.domainRangeConfig.domainRange),o=new V.Zb(r,r,r,i).multiply(n);return this.isOutputRounded?q(o):o}}(0,i.Cg)([A.E8],De.prototype,"method",void 0),(0,i.Cg)([A.E8],De.prototype,"isOutputRounded",void 0),(0,i.Cg)([(0,A.Pi)(Ze)],De.prototype,"domainRangeConfig",void 0);class Ee extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.nt)],Ee.prototype,"contrastOffset",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],Ee.prototype,"brightnessOffset",void 0);class Ue extends Pe{constructor(){super(...arguments),this.type="ContrastBrightnessShader"}_process(e){const{rgb:t,a:s}=this._getPixel(e),{contrastOffset:i,brightnessOffset:r}=this.contrastBrightnessConfig,n=new V.nt(255),o=new V.nt(128),a=t.multiply(200),l=n.multiply(100),u=n.multiply(2).multiply(r),c=a.subtract(l).add(u),h=(0,V.j1)([(0,V.LC)(i,new V.nt(-100)),new V.eB(o)],[(0,V.LC)(i,new V.nt(100)),(0,V._S)(c).add(1).divide(2).multiply(n)],[(0,V.MM)(i,new V.nt(0)),c.divide(new V.nt(100).subtract(i).multiply(2)).add(o)],[!0,c.multiply(i.add(100)).divide(2e4).add(o)]);return q(new V.Zb(h,s))}}(0,i.Cg)([(0,A.Pi)(Ee)],Ue.prototype,"contrastBrightnessConfig",void 0);class je extends A.k2{}(0,i.Cg)([(0,A.Pi)(V._i.ofType(V.nt,5,5,!0))],je.prototype,"kernel",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],je.prototype,"clampRange",void 0);class qe extends Pe{constructor(){super(...arguments),this.type="ConvolutionShader",this.rows=3,this.cols=3}_process(e){const{rows:t,cols:s}=this,i=new V.ZY(Math.floor(t/2),Math.floor(s/2)),{texture:r,srcImageSize:n}=this.config,o=new V.nt(1).divide(n),{kernel:a}=this.convolutionConfig,l=(0,V.$T)(a,{initialValue:new V.Zb(0,0,0,1),xRange:[0,t],yRange:[0,s],callback:(t,s,n,a)=>{const l=new V.ZY(new V.nt(n),new V.nt(a)).subtract(i).multiply(o),u=(0,V.US)(r,se(e.add(l))),c=u.rgb.multiply(s).add(t.rgb),h=u.a.multiply(t.a);return new V.Zb(c,h)}}),{clampRange:u}=this.convolutionConfig;return new V.Zb((0,V.qE)(l.rgb,u.x,u.y),1).multiply(l.a)}}(0,i.Cg)([A.E8],qe.prototype,"rows",void 0),(0,i.Cg)([A.E8],qe.prototype,"cols",void 0),(0,i.Cg)([(0,A.Pi)(je)],qe.prototype,"convolutionConfig",void 0);class Ge extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.nt)],Ge.prototype,"zlFactor",void 0);class Le extends Pe{constructor(){super(...arguments),this.type="CurvatureShader"}_process(e){const{texture:t}=this.config,s=ie(t,e,this.config.srcImageSize),i=s[3].add(s[5]).multiply(.5).subtract(s[4]),r=s[1].add(s[7]).multiply(.5).subtract(s[4]),{zlFactor:n}=this.curvatureConfig,{curvatureType:o}=this;let a;if("standard"===o)a=(0,V.ze)(n).multiply(i.add(r));else{const e=s[2].subtract(s[0]).add(s[6]).subtract(s[8]).divide(4),t=s[5].subtract(s[3]).divide(2),l=s[1].subtract(s[7]).divide(2),u=t.multiply(t),c=l.multiply(l),h=t.multiply(l),p=n.divide(u.add(c));a="profile"===o?(0,V.Om)(new V.eB(i,r,e),new V.eB(u,c,h)).multiply(p):(0,V.Om)(new V.eB(i,r,(0,V.ze)(e)),new V.eB(c,u,h)).multiply((0,V.ze)(p))}return new V.Zb(a,a,a,s[9])}}(0,i.Cg)([A.E8],Le.prototype,"curvatureType",void 0),(0,i.Cg)([(0,A.Pi)(Ge)],Le.prototype,"curvatureConfig",void 0);class He extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.U)],He.prototype,"bandIndexMat3",void 0);class We extends Pe{constructor(){super(...arguments),this.type="ExtractBandShader"}_process(e){const t=this._getPixel(e),s=this.extractBandConfig.bandIndexMat3.multiply(t.rgb);return new V.Zb(s,t.a)}}(0,i.Cg)([(0,A.Pi)(He)],We.prototype,"extractBandConfig",void 0);class Ye extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.ZY)],Ye.prototype,"clampRange",void 0);class Ne extends Pe{constructor(){super(...arguments),this.type="FocalStatisticsShader",this.rows=3,this.cols=3,this.fill=!1}_process(e){const t=this._process1(e),s=(0,V.PM)(new V.nt(1),t.a);if(!this.fill)return this._clamp(t.rgb,s);const i=this._getPixel(e),r=(0,V.jh)(t.rgb,i.rgb,i.a);return this._clamp(r,s)}_clamp(e,t){const{clampRange:s}=this.focalStatisticsConfig;return new V.Zb((0,V.qE)(e,s.x,s.y),1).multiply(t)}_process1(e){const{texture:t,srcImageSize:s}=this.config,{rows:i,cols:r}=this,n=new V.ZY(Math.floor(i/2),Math.floor(r/2)),o=new V.nt(1).divide(s),a=this._getPixel(e),{statisticsType:l}=this,u="min"===l||"max"===l?new V.Zb(a.rgb,0):new V.Zb(0,0,0,0);switch(l){case"min":return this._stat(i,r,u,((s,i,r)=>{const a=new V.ZY(new V.nt(i),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,se(e.add(a))),u=(0,V.jk)(s.rgb,l.rgb);return new V.Zb(u,s.a.add(l.a))}));case"max":return this._stat(i,r,u,((s,i,r)=>{const a=new V.ZY(new V.nt(i),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,se(e.add(a))),u=(0,V.T9)(s.rgb,l.rgb);return new V.Zb(u,s.a.add(l.a))}));case"mean":{const s=this._stat(i,r,u,((s,i,r)=>{const a=new V.ZY(new V.nt(i),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,se(e.add(a))),u=s.rgb.add(l.rgb.multiply(l.a));return new V.Zb(u,s.a.add(l.a))})),a=s.rgb.multiply(j(s.a));return new V.Zb(a,s.a)}case"stddev":{const s=this._stat(i,r,u,((s,i,r)=>{const a=new V.ZY(new V.nt(i),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,se(e.add(a))),u=s.rgb.add(l.rgb.multiply(l.a));return new V.Zb(u,s.a.add(l.a))})),a=this._stat(i,r,u,((s,i,r)=>{const a=new V.ZY(new V.nt(i),new V.nt(r)).subtract(n).multiply(o),l=(0,V.US)(t,se(e.add(a))),u=s.rgb.add(l.a.multiply(l.rgb).multiply(l.rgb));return new V.Zb(u,s.a.add(l.a))})),l=j(a.a),c=(0,V.RZ)(a.subtract(s.multiply(s).multiply(l)).multiply(l));return new V.Zb(c.rgb,s.a)}default:return a}}_stat(e=3,t=3,s,i){const r=new V.Ai(0).setMutable().setDebugName("StatColIterator"),n=new V.Ai(0).setMutable().setDebugName("StatRowIterator"),o=s.setMutable().setDebugName("StatAccumulator"),a=i(o,r,n).setDebugName("StatPredicate"),l=(0,V.om)({iterX:r,iterY:n,accumulator:o},V.Zb,a,(({out:s,iterX:i,iterY:r,accumulator:n,subgraph:o})=>`\n  for (${r} = 0; ${r} < ${e}; ${r}++) {\n    for (${i} = 0; ${i} < ${t}; ${i}++) {\n  \n    ${o.body}\n  \n    ${n} = ${o.varName};\n    }\n  }\n  ${s} = ${n};\n  `)).setDebugName("statBody");return l}}(0,i.Cg)([A.E8],Ne.prototype,"rows",void 0),(0,i.Cg)([A.E8],Ne.prototype,"cols",void 0),(0,i.Cg)([A.E8],Ne.prototype,"statisticsType",void 0),(0,i.Cg)([A.E8],Ne.prototype,"fill",void 0),(0,i.Cg)([(0,A.Pi)(Ye)],Ne.prototype,"focalStatisticsConfig",void 0);class $e extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.eB)],$e.prototype,"weights",void 0);class Qe extends Pe{constructor(){super(...arguments),this.type="GrayscaleShader"}_process(e){const t=this._getPixel(e),{weights:s}=this.grayscaleConfig,i=(0,V.Om)(s,t.rgb);return new V.Zb(i,i,i,t.a)}}(0,i.Cg)([(0,A.Pi)($e)],Qe.prototype,"grayscaleConfig",void 0);class Ke extends Pe{constructor(){super(...arguments),this.type="HillshadeShader",this.isMultidirectional=!1}_process(e){const{texture:t}=this.config,s=ne(ie(t,e,this.config.srcImageSize),this.hillshadeConfig,this.isMultidirectional);return new V.Zb(s.rgb.multiply(255),s.a)}}(0,i.Cg)([A.E8],Ke.prototype,"isMultidirectional",void 0),(0,i.Cg)([(0,A.Pi)(te)],Ke.prototype,"hillshadeConfig",void 0);class Xe extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,6))],Xe.prototype,"includedRanges",void 0),(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,w.et))],Xe.prototype,"noDataValues",void 0);class Je extends Pe{constructor(){super(...arguments),this.type="MaskShader",this.isMultiband=!0}_process(e){const t=this._getPixel(e),s=this._computeNoDataFactor(t.r),i=this._computeRangeFactor(t.rgb);let r;if(this.isMultiband){const e=this._computeNoDataFactor(t.g),n=this._computeNoDataFactor(t.b),o=new V.eB(s,e,n).multiply(i);r=o.x.multiply(o.y).multiply(o.z)}else r=s.multiply(i.x);return t.multiply(r)}_computeNoDataFactor(e){const{noDataValues:t}=this.maskConfig;let s=new V.eB(1);for(let i=0;i<w.et/3;i++){const r=3*i,n=new V.eB(t[r+0],t[r+1],t[r+2]),o=(0,V.tn)((0,V._S)(n.subtract(e)));s=s.multiply(o)}return s.x.multiply(s.y).multiply(s.z)}_computeRangeFactor(e){const{includedRanges:t}=this.maskConfig,s=new V.eB(t[0],t[2],t[4]),i=new V.eB(t[1],t[3],t[5]);return(0,V.PM)(s,e).multiply((0,V.PM)(e,i))}}(0,i.Cg)([A.E8],Je.prototype,"isMultiband",void 0),(0,i.Cg)([(0,A.Pi)(Xe)],Je.prototype,"maskConfig",void 0);class et extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.U)],et.prototype,"bandIndexMat3",void 0);class tt extends Pe{constructor(){super(...arguments),this.type="NDVIShader",this.scaled=!0}_process(e){const t=this._getPixel(e),{r:s,g:i}=this.ndviConfig.bandIndexMat3.multiply(t.rgb),r=s.subtract(i),n=s.add(i),o=r.multiply(j(n));if(!this.scaled)return new V.Zb(o,o,o,t.a);const a=(0,V.RI)(o.multiply(100).add(100.5));return new V.Zb(a,a,a,t.a)}}(0,i.Cg)([A.E8],tt.prototype,"scaled",void 0),(0,i.Cg)([(0,A.Pi)(et)],tt.prototype,"ndviConfig",void 0);class st extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,3*w.et))],st.prototype,"rangeMaps",void 0),(0,i.Cg)([(0,A.Pi)(V.My.ofType(V.nt,2*w.et))],st.prototype,"noDataRanges",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],st.prototype,"unmatchMask",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],st.prototype,"replacementValue",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],st.prototype,"clampRange",void 0);class it extends Pe{constructor(){super(...arguments),this.type="RemapShader"}_process(e){const t=this._getPixel(e),{rangeMaps:s,unmatchMask:i,clampRange:r,replacementValue:n}=this.remapConfig,{mapValue:o,includeMask:a}=function(e,t,s){const i=new V.eB(e);let r=new V.eB(0,0,0),n=new V.nt(0);for(let o=0;o<s/3;o++){const e=9*o,s=new V.eB(t[e],t[e+3],t[e+6]),a=new V.eB(t[e+1],t[e+4],t[e+7]),l=(0,V.PM)(s,i).multiply((0,V.PM)(i,a)),u=new V.eB(t[e+2],t[e+5],t[e+8]);n=(0,V.jh)(n,u.x,l.x),n=(0,V.jh)(n,u.y,l.y),n=(0,V.jh)(n,u.z,l.z),r=r.add(l)}return{mapValue:n,includeMask:(0,V._S)((0,V.Om)(r,new V.eB(1,1,1)))}}(t.r,s,w.et),l=this.replaceUnmatched?n:i.multiply(t.r),u=(0,V.jh)(l,o,a),c=(0,V.qE)(u,r.x,r.y),h=this._computeNoDataFactor(t.rrr).multiply((0,V.T9)(i,a));return new V.Zb(c,c,c,t.a).multiply(h)}_computeNoDataFactor(e){const{noDataRanges:t}=this.remapConfig;let s=new V.eB(0,0,0);for(let i=0;i<w.et/3;i++){const r=6*i,n=new V.eB(t[r],t[r+2],t[r+4]),o=new V.eB(t[r+1],t[r+3],t[r+5]);s=s.add((0,V.PM)(n,e).multiply((0,V.PM)(e,o)))}return(0,Z.zb)((0,V._S)((0,V.Om)(s,new V.eB(1,1,1))))}}(0,i.Cg)([(0,A.Pi)(st)],it.prototype,"remapConfig",void 0),(0,i.Cg)([A.E8],it.prototype,"replaceUnmatched",void 0);class rt extends ${constructor(){super(...arguments),this.type="ReprojectShader"}_colorize(e){return this._getPixel(e)}}class nt extends Ke{constructor(){super(...arguments),this.type="ShadedReliefShader"}_process(e){const t=super._process(e),{minValue:s,maxValue:i}=this.hillshadeConfig,r=this._getPixel(e),n=i.subtract(s),o=r.r.subtract(s),a=(0,V.qE)(o.divide(n),new V.nt(0),new V.nt(1)),l=K(new V.Zb(a,a,a,1),new V.nt(255),this.colormapConfig),u=J(l.xyz),c=ee(new V.eB(u.xy,t.x.divide(255))).multiply(255);return new V.Zb(c,l.a.multiply(t.a))}}(0,i.Cg)([(0,A.Pi)(Q)],nt.prototype,"colormapConfig",void 0);class ot extends A.k2{}(0,i.Cg)([(0,A.Pi)(V.nt)],ot.prototype,"pixelSizePower",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],ot.prototype,"pixelSizeFactor",void 0),(0,i.Cg)([(0,A.Pi)(V.nt)],ot.prototype,"zFactor",void 0),(0,i.Cg)([(0,A.Pi)(V.ZY)],ot.prototype,"cellSize",void 0);class at extends Pe{constructor(){super(...arguments),this.type="SlopeShader",this.isOutputRounded=!1,this.percentRise=!1}_process(e){const{cellSize:t,pixelSizePower:s,pixelSizeFactor:i,zFactor:r}=this.slopeConfig,n=(0,V.n7)(t,new V.ZY(s)).multiply(i).add(r).divide(t.multiply(8)),{texture:o}=this.config,a=ie(o,e,this.config.srcImageSize),{x:l,y:u}=re(a,n),c=(0,V.RZ)(l.multiply(l).add(u.multiply(u))),h=this.percentRise?c.multiply(100):(0,V.rY)(c).multiply(57.2957795),p=new V.Zb(h,h,h,a[9]);return this.isOutputRounded?q(p):p}}(0,i.Cg)([A.E8],at.prototype,"isOutputRounded",void 0),(0,i.Cg)([A.E8],at.prototype,"percentRise",void 0),(0,i.Cg)([(0,A.Pi)(ot)],at.prototype,"slopeConfig",void 0);class lt extends Pe{constructor(){super(...arguments),this.type="StretchShader",this.isMultiband=!0,this.isOutputRounded=!1,this.useGamma=!1}_process(e){let t=ce(this._getPixel(e),this.stretchConfig,this.useGamma,1);return this.isMultiband||(t=new V.Zb(t.rrr,t.a)),this.isOutputRounded?q(t):t}}(0,i.Cg)([A.E8],lt.prototype,"isMultiband",void 0),(0,i.Cg)([A.E8],lt.prototype,"isOutputRounded",void 0),(0,i.Cg)([A.E8],lt.prototype,"useGamma",void 0),(0,i.Cg)([(0,A.Pi)(ue)],lt.prototype,"stretchConfig",void 0);const ut=new Map([["Aspect",class extends _e{constructor(){super(...arguments),this.name="RasterAspectProcessor",this.type=2,this.shaders={aspect:new Se}}_process(e,t){const s={cellSize:t.getRasterCellSize()},i=this._getCommonConfig(e,t),r={shader:this.shaders.aspect,uniforms:{config:i,aspectConfig:s},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["BandArithmetic",class extends _e{constructor(){super(...arguments),this.name="RasterBandArithmeticProcessor",this.type=3,this.shaders={bandArithmetic:new Ie}}_process(e,t){const s=e.rasterFunction.parameters,i={indexType:s.indexType,isOutputRounded:s.isOutputRounded},r={bandIndexMat3:s.bandIndexMat3},n=s.adjustments?{adjustments:[...s.adjustments]}:void 0,o=this._getCommonConfig(e,t),a={shader:this.shaders.bandArithmetic,uniforms:{config:o,bandArithmeticConfig:r,adjustmentConfig:n},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["ColormapToRGB",class extends _e{constructor(){super(...arguments),this.name="RasterColormapToRGBProcessor",this.type=4,this.shaders={colormapToRGB:new ze}}_process(e,t,s){const i=e.rasterFunction.parameters,r={colormapTexture:{texture:s,unit:1},colormapOffset:i.offset,colormapMaxIndex:i.indexedColormap.length/4-1},n=this._getCommonConfig(e,t),o={shader:this.shaders.colormapToRGB,uniforms:{config:n,colormapConfig:r},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["CompositeBand",class extends _e{constructor(){super(...arguments),this.name="RasterCompositeBandProcessor",this.type=5,this.shaders={compositeBand:new Ve}}_process(e,t){const{rasters:s}=e.rasterFunction.parameters,i={constantCount:this._getConstantCount(s),imageCount:s?.length??1},r=this._getMultipleInputConfig(t,s),n=this._getCommonConfig(e,t),o={shader:this.shaders.compositeBand,uniforms:{config:n,...r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["ComputeChange",class extends _e{constructor(){super(...arguments),this.name="RasterComputeChangeProcessor",this.type=6,this.shaders={computeChange:new De}}_process(e,t){const s=e.rasterFunction.parameters,{rasters:i}=s,r={constantCount:this._getConstantCount(i),imageCount:i.length,method:s.method,isOutputRounded:s.isOutputRounded},n={domainRange:s.domainRange},{twoRasterConfig:o}=this._getMultipleInputConfig(t,i),a=this._getCommonConfig(e,t),l={shader:this.shaders.computeChange,uniforms:{config:a,domainRangeConfig:n,twoRasterConfig:o},defines:r,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:c}=e;u.submitDrawMesh(c,l,u.quadMesh)}}],["ContrastBrightness",class extends _e{constructor(){super(...arguments),this.name="RasterContrastBrightnessProcessor",this.type=7,this.shaders={contrastBrightness:new Ue}}_process(e,t){const s=this._getCommonConfig(e,t),i=e.rasterFunction.parameters,r={shader:this.shaders.contrastBrightness,uniforms:{config:s,contrastBrightnessConfig:i},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Convolution",class extends _e{constructor(){super(...arguments),this.name="RasterConvolutionProcessor",this.type=8,this.shaders={convolution:new qe}}_process(e,t){const s=e.rasterFunction.parameters,i={rows:s.kernelRows,cols:s.kernelCols},r={kernel:[...s.kernel],clampRange:s.clampRange},n=this._getCommonConfig(e,t),o={shader:this.shaders.convolution,uniforms:{config:n,convolutionConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Curvature",class extends _e{constructor(){super(...arguments),this.name="RasterCurvatureProcessor",this.type=9,this.shaders={curvature:new Le}}_process(e,t){const s=e.rasterFunction.parameters,i={curvatureType:s.curvatureType},r=t.getRasterCellSize(),n={zlFactor:200*s.zFactor/r[0]/r[1]},o=this._getCommonConfig(e,t),a={shader:this.shaders.curvature,uniforms:{config:o,curvatureConfig:n},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["ExtractBand",class extends _e{constructor(){super(...arguments),this.name="RasterExtractBandProcessor",this.type=10,this.shaders={extractBand:new We}}_process(e,t){const s={bandIndexMat3:e.rasterFunction.parameters.bandIndexMat3},i=this._getCommonConfig(e,t),r={shader:this.shaders.extractBand,uniforms:{config:i,extractBandConfig:s},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Grayscale",class extends _e{constructor(){super(...arguments),this.name="RasterGrayscaleProcessor",this.type=11,this.shaders={grayscale:new Qe}}_process(e,t){const s={weights:e.rasterFunction.parameters.weights},i=this._getCommonConfig(e,t),r={shader:this.shaders.grayscale,uniforms:{config:i,grayscaleConfig:s},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:o}=e;n.submitDrawMesh(o,r,n.quadMesh)}}],["Hillshade",class extends _e{constructor(){super(...arguments),this.name="RasterHillshadeProcessor",this.type=12,this.shaders={hillshade:new Ke}}_process(e,t){const s=e.rasterFunction.parameters,i={isMultidirectional:s.hillshadeType>0},r=ae(s,t.getRasterCellSize()),n={...s,factor:r,minValue:0,maxValue:8e3},o=this._getCommonConfig(e,t),a={shader:this.shaders.hillshade,uniforms:{config:o,hillshadeConfig:n},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:u}=e;l.submitDrawMesh(u,a,l.quadMesh)}}],["Local",class extends _e{constructor(){super(...arguments),this.name="RasterLocalProcessor",this.type=13,this.shaders={local:new Oe}}_process(e,t){const s=e.rasterFunction.parameters,i={constantCount:this._getConstantCount(s.rasters),imageCount:s.imageCount,operationName:s.operationName,isOutputRounded:s.isOutputRounded},r={domainRange:s.domainRange},n="conditional"===s.operationName?s.rasters:s.rasters?.slice(0,2),o=this._getMultipleInputConfig(t,n),a=this._getCommonConfig(e,t),l={shader:this.shaders.local,uniforms:{config:a,domainRangeConfig:r,...o},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:c}=e;u.submitDrawMesh(c,l,u.quadMesh)}}],["Mask",class extends _e{constructor(){super(...arguments),this.name="RasterMaskProcessor",this.type=14,this.shaders={mask:new Je}}_process(e,t){const s=e.rasterFunction.parameters,i={isMultiband:s.bandCount>1},r={includedRanges:[...s.includedRanges],noDataValues:[...s.noDataValues]},n=this._getCommonConfig(e,t),o={shader:this.shaders.mask,uniforms:{config:n,maskConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["NDVI",class extends _e{constructor(){super(...arguments),this.name="RasterNDVIProcessor",this.type=15,this.shaders={ndvi:new tt}}_process(e,t){const s=e.rasterFunction.parameters,i={scaled:s.scaled},r={bandIndexMat3:s.bandIndexMat3},n=this._getCommonConfig(e,t),o={shader:this.shaders.ndvi,uniforms:{config:n,ndviConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Remap",class extends _e{constructor(){super(...arguments),this.name="RasterRemapProcessor",this.type=16,this.shaders={remap:new it}}_process(e,t){const s=e.rasterFunction.parameters,i={replaceUnmatched:s.allowUnmatched&&null!=s.replacementValue},r={rangeMaps:[...s.rangeMaps],noDataRanges:[...s.noDataRanges],unmatchMask:s.allowUnmatched?1:0,replacementValue:s.replacementValue??0,clampRange:s.clampRange},n=this._getCommonConfig(e,t),o={shader:this.shaders.remap,uniforms:{config:n,remapConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Reproject",class extends _e{constructor(){super(...arguments),this.name="RasterReprojectProcessor",this.type=17,this.shaders={reproject:new rt}}_process(e,t){const s=e.rasterFunction.parameters,i=this._getInterpolationDefines(t.interpolation,!!s.requireNNEdge),{config:r,projectionConfig:n,projectionDefines:o}=this._getReprojectConfig(t),a={shader:this.shaders.reproject,uniforms:{config:r,projectionConfig:n},defines:{...o,...i,applyPixelMask:!1,applyPixelHighlights:!1},optionalAttributes:null,useComputeBuffer:!1},{interpolation:l}=t;t.interpolation="nearest";const{painter:u,context:c}=e;u.submitDrawMesh(c,a,u.quadMesh),t.interpolation=l,t.projected=!0}_getReprojectConfig(e){const{source:t}=e,{names:s,textures:i}=e.getTextures({forProcessing:!0}),r={texture:{texture:i[s.indexOf("u_image")],unit:0},dvsMat3:new Float32Array([2,0,0,0,2,0,-1,-1,0]),coordScale:[1,1],srcImageSize:[t.width,t.height],opacity:1},n=i[s.indexOf("u_transformGrid")],{transformGrid:o}=e,a=!(!n||!o);return{config:r,projectionConfig:a?{transformTexture:{texture:n,unit:1},targetImageSize:[e.width,e.height],transformSpacing:o.spacing,transformGridSize:o.size}:void 0,projectionDefines:{applyProjection:a,lookupProjection:a&&1===o.spacing[0]}}}_getInterpolationDefines(e,t){const s="bilinear"===e&&t;return{bilinear:s,bicubic:"cubic"===e,nearestOnEdge:s}}}],["ShadedRelief",class extends _e{constructor(){super(...arguments),this.name="RasterShadedReliefProcessor",this.type=18,this.shaders={shadedRelief:new nt}}_process(e,t,s){const i=e.rasterFunction.parameters,r={isMultidirectional:i.hillshadeType>0},n=ae(i,t.getRasterCellSize()),o={...i,factor:n},a={colormapTexture:{texture:s,unit:1},colormapOffset:i.offset,colormapMaxIndex:i.indexedColormap.length/4-1},l=this._getCommonConfig(e,t),u={shader:this.shaders.shadedRelief,uniforms:{config:l,hillshadeConfig:o,colormapConfig:a},defines:r,optionalAttributes:null,useComputeBuffer:!1},{painter:c,context:h}=e;c.submitDrawMesh(h,u,c.quadMesh)}}],["Slope",class extends _e{constructor(){super(...arguments),this.name="RasterSlopeProcessor",this.type=19,this.shaders={slope:new at}}_process(e,t){const s=e.rasterFunction.parameters,i={isOutputRounded:s.isOutputRounded,percentRise:"percent-rise"===s.slopeType},r={cellSize:t.getRasterCellSize(),pixelSizePower:"adjusted"===s.slopeType?s.pixelSizePower:0,pixelSizeFactor:"adjusted"===s.slopeType?s.pixelSizeFactor:0,zFactor:s.zFactor},n=this._getCommonConfig(e,t),o={shader:this.shaders.slope,uniforms:{config:n,slopeConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Statistics",class extends _e{constructor(){super(...arguments),this.name="RasterFocalStatisticsProcessor",this.type=20,this.shaders={focalStatistics:new Ne}}_process(e,t){const s=e.rasterFunction.parameters,i={rows:s.kernelRows,cols:s.kernelCols,statisticsType:s.statisticsType,fill:s.fillNoDataOnly},r={clampRange:s.clampRange},n=this._getCommonConfig(e,t),o={shader:this.shaders.focalStatistics,uniforms:{config:n,focalStatisticsConfig:r},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:l}=e;a.submitDrawMesh(l,o,a.quadMesh)}}],["Stretch",class extends _e{constructor(){super(...arguments),this.name="RasterStretchProcessor",this.type=21,this.shaders={stretch:new lt}}_process(e,t){const s=e.rasterFunction.parameters,i={isMultiband:s.bandCount>1,isOutputRounded:s.isOutputRounded,useGamma:s.useGamma},r=this._getCommonConfig(e,t),n={shader:this.shaders.stretch,uniforms:{config:r,stretchConfig:s},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:a}=e;o.submitDrawMesh(a,n,o.quadMesh)}}]]);class ct extends F.j{constructor(){super(...arguments),this.type=1,this.shaders={},this._techniques=new Map}shutdown(e){super.shutdown(e),this._fbo?.dispose(),this._fbo=void 0;for(const t of this._techniques.values())t.shutdown();this._techniques.clear()}render(e,t){this._fbo??=be(e.context,de.CQ,de.CQ);let{name:s}=e.rasterFunction;if("Arithmetic"===s&&(s="Local"),!this._techniques.has(s)){const e=ut.get(s);if(!e)return;this._techniques.set(s,new e)}this._techniques.get(s).render(e,{...t,processorFbo:this._fbo})}}class ht extends B.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1}get pixelHighlightOptions(){return this._pixelHighlightOptions}set pixelHighlightOptions(e){this._pixelHighlightOptions=e,this.requestRender()}createTile(e){const t=this._getTileBounds(e),[s,i]=this.tileInfoView.tileInfo.size,r=this.tileInfoView.getTileResolution(e.level);return new z(e,r,t[0],t[3],s,i)}onAttach(){super.onAttach(),this._colorizerTechnique=new pe,this._processorTechnique=new ct}onDetach(){super.onDetach(),this._colorizerTechnique?.shutdown(),this._colorizerTechnique=void 0,this._processorTechnique?.shutdown(),this._processorTechnique=void 0}doRender(e){if(!this.visible||1!==e.drawPhase||!this._colorizerTechnique)return;const{rasterFunctionChain:t}=this;if(t?.functions?.length){if(!this._processorTechnique)return;const{functions:s,hasBranches:i}=t;for(const t of s){if("Constant"===t.name||"Identity"===t.name)continue;e.rasterFunction=t,e.hasBranches=i,super.doRender(e);const s=this.children.map((e=>e.bitmap));this._processorTechnique.render(e,{bitmaps:s})}}e.rasterFunction=null,e.pixelHighlightOptions=this.pixelHighlightOptions,super.doRender(e);const s=this.children.map((e=>e.bitmap));this._colorizerTechnique.render(e,{bitmaps:s})}_getTileBounds(e){const t=this.tileInfoView.getTileBounds((0,b.vt)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:s}=this.tileInfoView,i=(0,_.FT)(s.spatialReference);if(i){const r=s.lodAt(e.level);if(!r)return t;const{resolution:n}=r,o=n*s.size[0];t[0]=i*e.world+s.origin.x+e.col*o,t[2]=t[0]+o}}return t}}var pt=s(91967),dt=s(19451),mt=s(76797),gt=s(19247),ft=s(66486),yt=s(88235),xt=s(12838),wt=s(59844),bt=s(40181),_t=(s(93453),s(15302)),Ct=s(96345),vt=s(59752),Tt=s(9685);const Pt=[0,0];let Rt=class extends pt.A{constructor(){super(...arguments),this._updatingHandles=new dt.U,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=(0,o.sg)((async(e={})=>{const t=this._rasterFunctionState,s=e.reprocess||"gpu"===t&&!this.canUseWebGLForProcessing||"cpu"===t&&this.canUseWebGLForProcessing;if(s&&(await this._updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters()),!this.previousLOD||this.layerView.suspended)return;const i=this._rasterFunctionState,{type:r}=this;return e.refetch||"raster"!==r&&s||"cpu"===i||"cpu"===t?this._updatingHandles.addPromise(this.doRefresh()):this._updatingHandles.addPromise(this._redrawImage(e.signal))}))}destroy(){this._updatingHandles.destroy()}get canUseWebGLForProcessing(){return!1}get canUseLocalSymbolizerParams(){return(this.canUseWebGLForProcessing||"rasterVF"===this.type)&&!this.layerView.hasTilingEffects}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new Ct.A({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:s,scale:i}=e.state,r=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],i="toJSON"in t?t:mt.A.fromJSON(t);(0,xt.yo)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,i,s,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==r.level&&(this.previousLOD=r,null!=this._symbolizerParams&&this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){const e=(0,Tt.C)();this._maxIndexedColormapSize=4*(e.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new bt.A(this.layerView.tileInfo,this.layerView.fullExtent);const t=this._computeFetchConcurrency();this._fetchQueue=new _t.A({tileInfoView:this._tileInfoView,concurrency:t,process:(e,t)=>this._fetchTile(e,t),priority:vt.W6.MAPVIEW_FETCH_QUEUE,scheduler:this.scheduler});const s=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new Ct.A({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:s,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,xt.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[s,i]=e,r=new ft.A({width:s,height:i,pixels:[new Uint8Array(s*i)],mask:new Uint8Array(s*i),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=r),r}_getBandIds(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:e,raster:t}=this.layer,s="rasterFunction"in t?t.rasterFunction.rawInputBandIds:null;return e?.length&&s?.length&&1!==t.rasterInfo.bandCount?e.map((e=>s[Math.min(e,s.length-1)])):"rasterFunction"in t?s:e}updateRasterFunctionParameters(){}_fetchTile(e,t){const s=this._getFetchOptions(e.level,t.signal);return this.fetchTile(e,s)}_getFetchOptions(e,t){const{canUseWebGLForProcessing:s}=this,{layerView:i}=this,{tileInfo:r}=i,n=!r.isWrappable&&null!=(0,wt.FT)(i.view.spatialReference),o=s&&this.layer.raster.hasUniqueSourceStorageInfo,{layer:a}=this.layerView,l=a.serviceRasterInfo?.storageInfo.isBsqTile?a.bandIds:void 0;return{allowPartialFill:!0,datumTransformation:i.datumTransformation,interpolation:s?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:o,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:t,srcResolution:this._srcResolutions[e],timeExtent:i.timeExtent,tileInfo:r,bandIds:l,disableWrapAround:n}}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const{layerView:e}=this,t=e.view.spatialReference;if(this._canUseLayerLODs()){const{origin:s,lods:i}=this.layer.tileInfo,r=i.map((({scale:e})=>e)),n=yt.A.create({spatialReference:t,size:de.CQ,scales:r,origin:s});return e.set("tileInfo",n),void(this._srcResolutions=i.map((({resolution:e})=>({x:e,y:e}))))}const{scales:s,srcResolutions:i,isCustomTilingScheme:r}=(0,wt.dK)(this.layer.serviceRasterInfo,t,{tileSize:de.CQ,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),n=yt.A.create({spatialReference:t,size:de.CQ,scales:s}),o=0===n.origin.x;(0,v.Lw)(e.fullExtent);const{xmin:a,ymax:l}=e.fullExtent;(o||r&&n.origin.x>a)&&(n.origin=new gt.A({x:a,y:l,spatialReference:t})),this._isCustomTilingScheme=r,e.set("tileInfo",n),this._srcResolutions=i??[]}_canUseLayerLODs(){const{layer:e,layerView:t}=this;if("Map"!==e.raster.tileType)return!1;const{lods:s}=e.tileInfo,i=t.view.constraints?.effectiveLODs;return i?.length===s.length&&i.every((({scale:e},t)=>Math.abs(e-s[t].scale)<.001))}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.serviceRasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),i=this._getBandIds();let r=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){r=!1;try{await this._redrawImage(this._abortController?.signal)}catch(s){(0,o.zf)(s)&&n.A.getLogger(this).error(s)}this._globalUpdateRequested=!1}this.canUseLocalSymbolizerParams&&null==this._symbolizerParams&&this._updateSymbolizerParams();const a=this._tileInfoView.getTileCoords(Pt,e.key),l=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:r,bandIds:i,coords:a,resolution:l}),e.once("attach",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(s){(0,o.zf)(s)||n.A.getLogger(this).error(s)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await Promise.allSettled(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t=this._getFetchOptions(this.previousLOD.level,e),s=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{...t,interpolation:"nearest",requestRawData:!1,skipRasterFunction:!1});if(!s?.pixelBlock)return;const{resolution:i}=this.previousLOD,r=this._getBandIds(),n=this.layer.symbolizer.generateWebGLParameters({pixelBlock:s.pixelBlock.extractBands(r),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:i,y:i},bandIds:r});!this.canUseWebGLForProcessing&&n&&"stretch"===n.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(n.factor=n.factor.map((e=>255*e)),n.minOutput=Math.round(255*n.minOutput),n.maxOutput=Math.round(255*n.maxOutput)),this._globalSymbolizerParams=n}_updateSymbolizerParams(){const{resolution:e}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}_updateBlockCacheRegistry(e=!1){const{layer:t,layerView:s}=this,{raster:i}=t,{multidimensionalDefinition:r}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:s.timeExtent}),n=i.rasterInfo.multidimensionalInfo?i.getSliceIndex(r):null,o=i.rasterInfo.storageInfo.isBsqTile&&t.bandIds?.length?t.bandIds:null,a=(0,xt.ph)(i.rasterId,n,o);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,xt.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,xt.kz)(a,i.rasterInfo),e){const{view:e}=s,t=this._tileInfoView.getClosestInfoForScale(e.scale),r=this._srcResolutions[t.level];(0,xt.yo)(a,this._blockCacheRegistryId,e.extent,e.resolution,r,i.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){if(!this.attached||!this.previousLOD||this.layerView.suspended)return;await this.layer.updateRenderer(),this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.refresh((t=>e.push(this._enqueueTileFetch(t)))),await this._updatingHandles.addPromise(Promise.allSettled(e))}};(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"_globalUpdateRequested",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"attached",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"canUseWebGLForProcessing",null),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"canUseLocalSymbolizerParams",null),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"container",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"layer",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"layerView",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"scheduler",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"type",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"useWebGLForProcessing",null),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"useProgressiveUpdate",null),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"timeExtent",void 0),(0,i.Cg)([(0,l.MZ)()],Rt.prototype,"updating",null),Rt=(0,i.Cg)([(0,c.$)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],Rt);var St=s(13692),Mt=s(1723);let kt=class extends Rt{constructor(){super(...arguments),this.type="raster"}get canUseWebGLForProcessing(){const{loaded:e,symbolizer:t}=this.layer;if(!e||!t)return!1;const s=t.lookup.colormapLut?.indexedColormap,i=s&&s.length>this._maxIndexedColormapSize,r=(0,y.xN)(this.layer.serviceRasterInfo);return!((0,u.A)("ios")&&r>4)&&this.useWebGLForProcessing&&t.canRenderInWebGL&&!i&&!("majority"===this.layer.interpolation&&(0,St.H_)(this.layer))}attach(){super.attach(),this.container=new ht(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}updateRasterFunctionParameters(){const{raster:e,type:t}=this.layer,{container:s}=this;if("Function"!==e.datasetFormat||"wcs"===t)return s.rasterFunctionChain=null,s.children.forEach((e=>{const{bitmap:t}=e;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))})),void(this._rasterFunctionState="na");const i=this._rasterFunctionState,{rasterFunction:r,primaryRasters:n}=e,o=r.supportsGPU&&(!n||n.rasters.length<=1),a=o?r.flatWebGLFunctionChain:null,{renderer:l}=this.layer,u=!o||!a?.functions.length||"raster-stretch"===l?.type&&l.dynamicRangeAdjustment||!this.canUseWebGLForProcessing;s.rasterFunctionChain=u?null:this._addProjection(a);const c=null==r?"na":s.rasterFunctionChain?"gpu":"cpu",h=i===c||"na"===i&&"cpu"===c&&0===a?.functions?.length;s.children.forEach((e=>{const{bitmap:t}=e;t&&(t.suspended=!h,t.processed=!1,t.processedTexture=null)})),this._rasterFunctionState=c}async updateTileSource(e,t){const s=this._getBandIds(),i=this._getLayerInterpolation(),{canUseWebGLForProcessing:r}=this,{source:n,globalSymbolizerParams:o,suspended:a,coords:l,resolution:u}=t,c=this.layerView.hasTilingEffects?o:t.symbolizerParams,{bitmap:h}=e;if([h.x,h.y]=l,h.resolution=u,null!=n?.pixelBlock){const e={extent:n.extent,pixelBlock:n.pixelBlock,srcPixelSize:n.srcTilePixelSize};if(h.rawPixelData=e,r)h.source=n.pixelBlock,h.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===o?.type?o:void 0);h.source=t,h.isRendereredSource=!0}h.symbolizerParameters=r?c:null,h.transformGrid=r?n.transformGrid:null}else{const e=this.createEmptyTilePixelBlock();h.source=e,h.symbolizerParameters=r?c:null,h.transformGrid=null}h.bandIds=r?s:null,h.width=this._tileInfoView.tileInfo.size[0],h.height=this._tileInfoView.tileInfo.size[1],h.interpolation=i,h.suspended=a;const{raster:p}=this.layer;if((0,f.q)(p)){const t=p.getClippingGeometry(this.layerView.view.spatialReference);if(t){const s=p.getTileExtentFromTileInfo(e.key.level,e.key.row,e.key.col,this._tileInfoView.tileInfo);h.mask=(0,x.b5)({srcExtent:s,geometry:t,size:[h.width,h.height]})}}h.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:s,global:i}=t,r=this._getBandIds(),n=this._getLayerInterpolation(),{canUseWebGLForProcessing:o}=this,{bitmap:a}=e,{rawPixelData:l}=a;o||null==l?(a.isRendereredSource&&null!=l&&(a.source=l.pixelBlock),a.isRendereredSource=!1):(a.source=await this.layer.applyRenderer(l,"stretch"===i?.type?i:void 0),a.isRendereredSource=!0),a.symbolizerParameters=o?this.layerView.hasTilingEffects?i:s:null,a.bandIds=o?r:null,a.interpolation=n,a.suspended=!1}updateHighlightOptions(e,t){if(e){const{ranges:s}=e,i=Array.from({length:2*w.et},(()=>0));for(let e=0;e<s.length;e++)i[2*e]=s[e][0],i[2*e+1]=s[e][1];for(let e=s.length;e<w.et;e++)i[2*e]=g.pq,i[2*e+1]=-g.pq;const r=e.bandId??0,n=m.A.toUnitRGBA(t??Mt.fT);this.container.pixelHighlightOptions={ranges:i,color:n,bandId:r}}else this.container.pixelHighlightOptions=void 0}_getLayerInterpolation(){const{interpolation:e,renderer:t}=this.layer;if(!t)return e;const s=t.type;return"raster-colormap"===s||"unique-value"===s?"nearest":"raster-stretch"===t.type&&null!=t.colorRamp?"bilinear"===e||"cubic"===e?"bilinear":"nearest":e}_addProjection(e){return e?.functions?.length&&!e.hasFocalFunction&&e.functions.unshift({name:"Reproject",parameters:{targetImageSize:this._tileInfoView.tileInfo.size,requireNNEdge:e.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1}),e}};(0,i.Cg)([(0,l.MZ)()],kt.prototype,"canUseWebGLForProcessing",null),(0,i.Cg)([(0,l.MZ)()],kt.prototype,"container",void 0),(0,i.Cg)([(0,l.MZ)()],kt.prototype,"layer",void 0),(0,i.Cg)([(0,l.MZ)()],kt.prototype,"type",void 0),kt=(0,i.Cg)([(0,c.$)("esri.views.2d.layers.imagery.ImageryTileView2D")],kt);var It=s(99846),zt=s(17331),Bt=s(86386);class Ft extends I.Y{constructor(e,t,s,i,r,n,o=null){super(e,t,s,i,r,n),this.tileData=new Bt.X(o),this.tileData.coordScale=[r,n],this.tileData.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,C.vt)(),tileMat3:(0,C.vt)()}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[i,r]=this.tileData.offset,n=[this.x+i*this.resolution,this.y-r*this.resolution],[o,a]=e.toScreenNoRotation([0,0],n),{symbolTileSize:l}=this.tileData.symbolizerParameters,u=Math.round((this.width-this.tileData.offset[0])/l)*l,c=Math.round((this.height-this.tileData.offset[1])/l)*l,h=u/this.rangeX*t,p=c/this.rangeY*t;(0,T.hZ)(s,h,0,0,0,p,0,o,a,1),(0,T.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,s),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class At extends B.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this.tileInfoView.getTileBounds((0,b.vt)(),e),[s,i]=this.tileInfoView.tileInfo.size,r=this.tileInfoView.getTileResolution(e.level);return new Ft(e,r,t[0],t[3],s,i)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[zt.A],target:()=>this.children.map((e=>e.tileData)),drawPhase:1});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&1===e.drawPhase&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}}let Vt=class extends Rt{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}async fetchTile(e,t){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const s=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.serviceRasterInfo?.dataType&&s?.pixelBlock&&(s.pixelBlock=await this.layer.convertVectorFieldData(s.pixelBlock,"vector-magdir",t)),s}updateTileSource(e,t){const s=t.symbolizerParams,{tileData:i}=e;i.key=e.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:r}=s,{source:n}=t;if(i.offset=this._getTileSymbolOffset(i.key,r),null!=n?.pixelBlock){const e={extent:n.extent,pixelBlock:n.pixelBlock};i.rawPixelData=e,i.symbolizerParameters=s,i.source=this._sampleVectorFieldData(n.pixelBlock,s,i.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo.size[0]-i.offset[0])/r),Math.round((this._tileInfoView.tileInfo.size[1]-i.offset[1])/r)],t=this.createEmptyTilePixelBlock(e);i.source=t,i.symbolizerParameters=s}return i.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(e,t){const s=t.local,{symbolTileSize:i}=s,{tileData:r}=e;r.offset=this._getTileSymbolOffset(r.key,i);const n=r.symbolizerParameters.symbolTileSize;r.symbolizerParameters=s;const o=r.rawPixelData?.pixelBlock;return null!=o&&n!==i&&(r.source=this._sampleVectorFieldData(o,r.symbolizerParameters,r.offset)),Promise.resolve()}attach(){super.attach(),this.container=new At(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,a.wB)((()=>this.layer.renderer),(e=>this._updateSymbolType(e)))}detach(){super.detach(),this.container.removeAllChildren(),this._handle?.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(e,t){const s=e.col*this._tileInfoView.tileInfo.size[0]%t,i=e.row*this._tileInfoView.tileInfo.size[1]%t;return[s>t/2?t-s:-s,i>t/2?t-i:-i]}_sampleVectorFieldData(e,t,s){const{symbolTileSize:i}=t;return(0,It.Wu)(e,"vector-uv",i,s)}_updateSymbolType(e){"vector-field"===e?.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}};(0,i.Cg)([(0,l.MZ)()],Vt.prototype,"container",void 0),(0,i.Cg)([(0,l.MZ)()],Vt.prototype,"layer",void 0),(0,i.Cg)([(0,l.MZ)()],Vt.prototype,"type",void 0),Vt=(0,i.Cg)([(0,c.$)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],Vt);var Zt=s(39356),Ot=s(50076),Dt=s(51939),Et=s(31516),Ut=s(2257);const jt=e=>{const t=e;let s=class extends t{constructor(...e){super(...e),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return(0,Et.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?(0,wt.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!(0,wt.eh)(this.layer.serviceRasterInfo,e)}catch{return!1}}async fetchPopupFeaturesAtLocation(e,t){const{layer:s}=this;if(!e)throw new Ot.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:i}=s,r=(0,Ut.D8)(s,t);if(!i||null==r)return[];const n=[],{value:o,magdirValue:a,processedValue:l}=await s.identify(e,{timeExtent:this.timeExtent,signal:t?.signal});let u="";if(o?.length){u="imagery-tile"===s.type&&s.hasStandardTime()&&null!=o[0]?o.map((e=>s.getStandardTimeValue(e))).join(", "):o.join(", ");const e={ObjectId:0};e[Dt.F_.servicePixelValue]="imagery-tile"===s.type&&(0,f.q)(s.raster)?l?.join(", "):u,e[Dt.F_.rawServicePixelValue]=u;const t=s.raster?.rasterInfo??s.serviceRasterInfo,i=t?.attributeTable;if(null!=i){const{fields:t,features:s}=i,r=t.find((({name:e})=>"value"===e.toLowerCase())),n=e[Dt.F_.servicePixelValue],o=r?s.find((e=>String(e.attributes[r.name])===n)):null;if(o)for(const i in o.attributes)o.attributes.hasOwnProperty(i)&&(e[Dt.ER+i]=o.attributes[i])}const r=t?.dataType;"vector-magdir"!==r&&"vector-uv"!==r||(e[Dt.F_.magnitude]=a?.[0],e[Dt.F_.direction]=a?.[1]);const{multidimensionalDefinition:c}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});(0,Dt.eS)(s.rasterFields,e,c);const h=new Zt.A({geometry:this.fullExtent?.clone(),attributes:e,layer:s,sourceLayer:s});n.push(h)}return n}async getSourceScale(){return await this.layer.load(),(0,wt.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return(0,wt.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,i.Cg)([(0,l.MZ)()],s.prototype,"fullExtent",null),(0,i.Cg)([(0,l.MZ)()],s.prototype,"layer",void 0),(0,i.Cg)([(0,l.MZ)({readOnly:!0})],s.prototype,"timeExtent",null),(0,i.Cg)([(0,l.MZ)()],s.prototype,"tileInfo",void 0),(0,i.Cg)([(0,l.MZ)({readOnly:!0})],s.prototype,"hasTilingEffects",null),(0,i.Cg)([(0,l.MZ)()],s.prototype,"datumTransformation",null),s=(0,i.Cg)([(0,c.$)("esri.views.layers.ImageryTileLayerView")],s),s};var qt=s(91196),Gt=s(771);let Lt=class extends(jt((0,Gt.I)((0,d.e)(qt.A)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this._pixelHighlightId=-1,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}get displayParameters(){const{layer:e}=this,t=this._get("displayParameters");return e.renderer&&e.visible?{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition,rasterFunction:"imagery-tile"===e.type?e.rasterFunction:null}:t}update(e){this.subview?.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,a.wB)((()=>this.displayParameters),((e,t)=>{const s=e.interpolation!==t?.interpolation&&("majority"===e.interpolation||"majority"===t?.interpolation)&&(0,St.H_)(this.layer),i=!!this.layer.serviceRasterInfo?.storageInfo?.isBsqTile&&e.bandIds?.join()!==t?.bandIds?.join(),r=e.renderer!==t?.renderer&&this._getSubviewType(t?.renderer)!==this._getSubviewType(e.renderer);r&&this._updateSubview();const a=e.multidimensionalDefinition!==t?.multidimensionalDefinition,l=e.rasterFunction!==t?.rasterFunction,u=l&&!this._useWebGLForProcessing,c=a||s||r||u||i;this.subview.redrawOrRefetch({refetch:c,reprocess:l}).catch((e=>{(0,o.zf)(e)||n.A.getLogger(this).error(e)})),this.notifyChange("updating")})),(0,a.wB)((()=>this.layer.multidimensionalSubset??null),((e,t)=>{const{multidimensionalDefinition:s}=this.layer;null!=s&&(0,h.sx)(s,e)!==(0,h.sx)(s,t)&&(this.subview.redrawOrRefetch({refetch:!0}).catch((e=>{(0,o.zf)(e)||n.A.getLogger(this).error(e)})),this.notifyChange("updating"))}),a.OH),(0,a.wB)((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch((e=>{(0,o.zf)(e)||n.A.getLogger(this).error(e)}))}),a.Vh),(0,a.wB)((()=>this.view.highlights.items.map((({name:e,color:t})=>({name:e,color:t})))),(()=>{if("raster"===this.subview?.type&&this._pixelHighlightTarget){const e=this._getHighlightGroupColor();this.subview.updateHighlightOptions(this._pixelHighlightTarget,e)}}),a.Vh)])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}highlight(e,t){if(!e.ranges?.length)return(0,r.hA)();this._pixelHighlightTarget=e,this._pixelHighlightOptions=t;const{subview:s}=this;if("raster"===s?.type){const t=this._getHighlightGroupColor();s.updateHighlightOptions(e,t)}this._pixelHighlightId++;const i=this._pixelHighlightId;return(0,r.hA)((()=>{i===this._pixelHighlightId&&(this._pixelHighlightTarget=void 0,"raster"===this.subview?.type&&this.subview.updateHighlightOptions(null))}))}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:e}=this.layer;if(!e)return;const t=this._getSubviewType(e);if(this.subview){if(this.subview.type===t)return void this._attachSubview(this.subview);this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}const{layer:s}=this;let i;if(i="rasterVF"===t?new Vt({layer:s,layerView:this,scheduler:this.scheduler}):"flow"===t?new p.A({layer:s,layerView:this,scheduler:this.scheduler}):new kt({layer:s,layerView:this,scheduler:this.scheduler}),"useWebGLForProcessing"in i&&(i.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in i&&(i.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in i){const{subview:e}=this;i.previousLOD=e&&"previousLOD"in e?e.previousLOD:null}if(this._attachSubview(i),"raster"===i.type&&this._pixelHighlightTarget){const e=this._getHighlightGroupColor();i.updateHighlightOptions(this._pixelHighlightTarget,e)}this.subview=i,this.requestUpdate()}_getHighlightGroupColor(){const e=this._pixelHighlightOptions?.name??Mt.Tv;return this.view.highlights.find((t=>t.name===e))?.color}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}_getSubviewType(e){const t=e?.type;return"vector-field"===t?"rasterVF":"flow"===t?"flow":"raster"}};(0,i.Cg)([(0,l.MZ)()],Lt.prototype,"subview",void 0),(0,i.Cg)([(0,l.MZ)()],Lt.prototype,"useWebGLForProcessing",null),(0,i.Cg)([(0,l.MZ)()],Lt.prototype,"useProgressiveUpdate",null),(0,i.Cg)([(0,l.MZ)({readOnly:!0})],Lt.prototype,"displayParameters",null),Lt=(0,i.Cg)([(0,c.$)("esri.views.2d.layers.ImageryTileLayerView2D")],Lt);const Ht=Lt},771:(e,t,s)=>{s.d(t,{I:()=>l});var i=s(6326),r=s(76460),n=s(50346),o=s(68134),a=(s(81806),s(47249),s(50076),s(85842));const l=e=>{const t=e;let s=class extends t{initialize(){this.addHandles((0,o.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,n.zf)(e)||r.A.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return s=(0,i.Cg)([(0,a.$)("esri.views.layers.RefreshableLayerView")],s),s}},71853:(e,t,s)=>{s.d(t,{WL:()=>u,b4:()=>o,hE:()=>l,kc:()=>a});s(72745);var i=s(93345),r=s(80895),n=s(96673);function o(e,t,s="nearest",o=!1){const a=!(o&&"u8"===t.pixelType),l=a?i.ld.FLOAT:i.ld.UNSIGNED_BYTE,u=null==t.pixels||0===t.pixels.length?null:a?t.getAsRGBAFloat():t.getAsRGBA(),c=e.capabilities.textureFloatLinear,h=new n.R(t.width,t.height);return h.internalFormat=a?i.H0.RGBA32F:6408,h.samplingMode=!c||"bilinear"!==s&&"cubic"!==s?9728:9729,h.dataType=l,h.wrapMode=33071,new r.g(e,h,u)}function a(e,t){const{spacing:s,offsets:o,coefficients:a,size:[l,u]}=t,c=s[0]>1,h=new n.R(c?4*l:l,u);h.internalFormat=i.H0.RGBA32F,h.dataType=i.ld.FLOAT,h.samplingMode=9728,h.wrapMode=33071;const p=new Float32Array(c?l*u*16:2*o.length);if(c&&null!=a)for(let i=0,r=0;i<a.length;i++)p[r++]=a[i],i%3==2&&(p[r++]=1);else for(let i=0;i<u;i++)for(let e=0;e<l;e++){const t=4*(i*l+e),s=2*(e*u+i);p[t]=o[s],p[t+1]=o[s+1],p[t+3]=-1===o[s]?0:1}return new r.g(e,h,p)}function l(e,t){const s=new n.R(t.length/4,1);return s.internalFormat=6408,s.samplingMode=9728,s.wrapMode=33071,new r.g(e,s,t)}function u(e,t,s){const o=new n.R(s[0],s[1]);return o.internalFormat=6406,o.pixelFormat=6406,o.dataType=i.ld.UNSIGNED_BYTE,o.samplingMode=9728,o.wrapMode=33071,new r.g(e,o,t)}}}]);
//# sourceMappingURL=32004.b79050bb.chunk.js.map