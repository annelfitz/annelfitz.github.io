"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[94750],{29494:(t,e,i)=>{i.d(e,{H:()=>o});var s=i(81806);const o=new class{get forceStaticPath(){return"disabled"===(0,s.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,s.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,s.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,s.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,s.A)("esri-cim-animations-freeze-time")}}},64780:(t,e,i)=>{i.d(e,{e:()=>l});var s=i(4212),o=i(76718),n=(i(12331),i(44488),i(81806),i(62881),i(80895),i(36911)),r=i(89339),a=i(9243);class l{constructor(t,e){this._boundPart=null,this.vertexBuffers=new Map,this.indexBuffers=new Map,this.groups=[];for(const i in e.vertex){const{data:s,attributes:n}=e.vertex[i],r=o.g.createVertex(t,35044,s);this.vertexBuffers.set(i,{buffer:r,attributes:n})}for(const i in e.index){const{data:s}=e.index[i],n=o.g.createIndex(t,35044,s);this.indexBuffers.set(i,{buffer:n})}for(const i of e.groups)this.groups.push({...i,vertexArrays:new Map});this.parts=e.parts}bind(t,e,i){this._boundPart=i;const{group:o}=this.parts[this._boundPart],r=this.groups[o];if(!r)throw new Error(`Missing group ${o}.`);let l=r.vertexArrays.get(e.stringHash);if(!l){const i=new Set(e.locations.keys()),o=r.index?this.indexBuffers.get(r.index)?.buffer:null,u=new Map;for(const[t,{buffer:e,attributes:n}]of this.vertexBuffers){const o=(0,s.zI)(n.filter((t=>i.has(t.name))));o.length>0&&u.set(t,new a.R(o,e))}l=new n.Z(t,u,o),r.vertexArrays.set(e.stringHash,l)}t.bindVAO(l)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:e,count:i}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{primitive:o,index:n}=this.groups[s];if(n){const s=this.indexBuffers.get(n);if(!s)throw new Error(`Missing index buffer "${n}".`);const{indexType:a}=s.buffer;if(!a)throw new Error("Buffer type error.");t.drawElements(o,i,a,e*r.I[a])}else t.drawArrays(o,e,i)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArrays:t}of this.groups)for(const[e,i]of t)i.disposeVAOOnly();for(const{buffer:t}of this.vertexBuffers.values())t.dispose();for(const{buffer:t}of this.indexBuffers.values())t.dispose()}}},16946:(t,e,i)=>{i.d(e,{g:()=>l});var s=i(89339),o=i(64780),n=i(93345),r=i(21812);const a={position:{type:n.pe.SHORT,count:2}};class l extends o.e{static create(t,e){const i=[];let{stride:o}=e;if(null==o){o=0;for(const[t,{count:i,type:n,offset:r}]of Object.entries(e.layout)){if(null!=r)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=i*s.I[n]}}let n=0;for(const[l,{count:d,offset:h,type:y,normalized:m}]of Object.entries(e.layout)){null!=h&&(n=h);const t=new r._(l,d,y,n,o,null!=m&&m,0);i.push(t),n+=d*s.I[y]}const a={primitive:e.primitive};null!=e.index&&(a.index="indexData");let{count:u}=e;if(null==u&&(u=e.index?e.index.length:e.vertex.byteLength/o,Math.floor(u)!==u))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);const p={start:0,count:u,group:0,primitive:e.primitive},c={vertex:{vertexData:{data:e.vertex,attributes:i}},parts:[p],groups:[a]};return null!=e.index&&(c.index={indexData:{data:e.index}}),new l(t,c,e.layout)}static fromVertexStream(t,e){return l.create(t,{primitive:n.WR.TRIANGLE_STRIP,vertex:new Uint16Array(e),layout:a})}constructor(t,e,i){super(t,e),this._spec=i}bind(t,e,i=0){super.bind(t,e,i)}}},89339:(t,e,i)=>{i.d(e,{I:()=>o});var s=i(93345);const o={[s.pe.BYTE]:1,[s.pe.UNSIGNED_BYTE]:1,[s.pe.SHORT]:2,[s.pe.UNSIGNED_SHORT]:2,[s.pe.HALF_FLOAT]:2,[s.pe.INT]:4,[s.pe.UNSIGNED_INT]:4,[s.pe.FLOAT]:4}},59286:(t,e,i)=>{i.d(e,{YS:()=>Je,n_:()=>ei,Wn:()=>ti});var s=i(6326),o=i(6951),n=i(60984),r=i(29494),a=i(62484);class l extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.nt)],l.prototype,"globalTime",void 0),(0,s.Cg)([(0,o.Pi)(n.ZY)],l.prototype,"animationTextureSize",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],l.prototype,"animationTexture",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],l.prototype,"toScreen",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],l.prototype,"toNdc",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],l.prototype,"mapRotation",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],l.prototype,"pixelRatio",void 0);var u=i(43282),p=i(5095),c=i(81806),d=i(60853);class h extends o.k2{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=(0,n.US)(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=(0,d.Kt)(t),i=this.size,s=(0,n.Wh)(e.x),o=(0,n.Wh)(e.y).multiply((0,n.Wh)(256)),r=(0,n.Wh)(e.z).multiply((0,n.Wh)(256)).multiply((0,n.Wh)(256)),a=(0,n.fV)(s.add(o).add(r)),l=(0,n.zi)(a,i),u=a.subtract(l).divide(i);this._uv=new n.ZY(l,u).add(.5).divide(i)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.gpgpu,e).setDebugName("storage4")}getLocalTimeOrigin(t){const e=this.getAttributeDataCoords(t);return(0,n.US)(this.localTimeOrigin,e).x.setDebugName("storage5")}getFilterFlags(t){return(0,c.A)("webgl-ignores-sampler-precision")?(0,n.mk)(this.getFilterData(t).x.multiply((0,n.fV)(255))):this.getFilterData(t).x.multiply((0,n.fV)(255))}getLabelVisibility(t){const e=this.getFilterData(t).y.multiply(255);return new n.nt(1).subtract(e)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"filterFlags",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"animation",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"gpgpu",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"localTimeOrigin",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"visualVariableData",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"dataDriven0",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"dataDriven1",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],h.prototype,"dataDriven2",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],h.prototype,"size",void 0);class y extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.nt)],y.prototype,"activeReasons",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],y.prototype,"highlightAll",void 0);class m extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.ZY)],m.prototype,"position",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],m.prototype,"distance",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],m.prototype,"smallSymbolDistance",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],m.prototype,"smallSymbolSizeThreshold",void 0);class f extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.U)],f.prototype,"displayViewScreenMat3",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],f.prototype,"displayViewMat3",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],f.prototype,"displayMat3",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],f.prototype,"viewMat3",void 0),(0,s.Cg)([(0,o.Pi)(n.U)],f.prototype,"tileMat3",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"displayZoomFactor",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"requiredZoomFactor",void 0),(0,s.Cg)([(0,o.Pi)(n.ZY)],f.prototype,"tileOffset",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"currentScale",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"currentZoom",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"metersPerSRUnit",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"rotation",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],f.prototype,"pixelRatio",void 0);class g extends o.ZA{}(0,s.Cg)([(0,o.C5)(0,n.eB)],g.prototype,"id",void 0),(0,s.Cg)([(0,o.C5)(1,n.nt)],g.prototype,"bitset",void 0),(0,s.Cg)([(0,o.C5)(2,n.ZY)],g.prototype,"pos",void 0);class v extends o.Y7{}(0,s.Cg)([(0,o.C5)(14,n.ZY)],v.prototype,"nextPos1",void 0),(0,s.Cg)([(0,o.C5)(15,n.ZY)],v.prototype,"nextPos2",void 0);class b extends o.HS{}class x extends o.A{clip(t,e){let i=new n.nt(0);const s=this.storage.getFilterFlags(t);if(i=i.add((0,n.fV)(2).multiply((0,n.fV)(1).subtract((0,d.i6)(s,0)))),this.inside?i=i.add((0,n.fV)(2).multiply((0,n.fV)(1).subtract((0,d.i6)(s,1)))):this.outside?i=i.add((0,n.fV)(2).multiply((0,d.i6)(s,1))):this.highlight&&(i=i.add((0,n.fV)(2).multiply((0,n.fV)(1).subtract(this._checkHighlight(s))))),null!=e){const t=new n.nt(1).subtract((0,n.PM)(e.x,this.view.currentZoom)),s=(0,n.PM)(e.y,this.view.currentZoom);i=i.add(new n.nt(2).multiply(t.add(s)))}return i}getFragmentOutput(t,e,i=new n.nt(1/255)){const s=new o.mm;return s.fragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,i)??t,s}_maybeHighlight(t,e){return this.highlight?new n.Zb(t.rgb,(0,n.PM)(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let i=1;i<p.U5;i++)e=e.add(this._checkHighlightBit(t,i));return(0,n.PM)(new n.nt(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return(0,d.yS)(t,e).multiply((0,d.mh)(this.highlight.activeReasons,e))}maybeRunHittest(t,e,i){if(null==this.hittestRequest)return null;const s=this.hittest(t,e,i);let o=(0,n.Tk)((0,n.MM)(s,this.hittestRequest.distance),new n.nt(2),new n.nt(0));const r=this.storage.getAttributeDataCoords(t.id),a=(0,d.nb)(r);o=o.add(this.clip(t.id,t.zoomRange));const l=new n.Zb(new n.nt(1/255),0,0,0);return{glPointSize:new n.nt(1),glPosition:new n.Zb(a,o,1),color:l}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,s.Cg)([o.E8],x.prototype,"inside",void 0),(0,s.Cg)([o.E8],x.prototype,"outside",void 0),(0,s.Cg)([(0,o.uK)(y)],x.prototype,"highlight",void 0),(0,s.Cg)([(0,o.Pi)(h)],x.prototype,"storage",void 0),(0,s.Cg)([(0,o.Pi)(f)],x.prototype,"view",void 0),(0,s.Cg)([(0,o.uK)(m)],x.prototype,"hittestRequest",void 0);var w=i(90113);class S extends o.k2{getPatternOffsetAtTileOrigin(t,e=new n.nt(0),i=new n.nt(1)){const s=new n.ZY(w.YV).divide(t);let o=t.multiply((0,n.jc)(this.maxIntsToLocalOrigin.multiply(s))).add(this.tileOffsetFromLocalOrigin).subtract(new n.nt(.5).multiply(t));return o=new n.ZY(o.x.multiply(i).subtract(o.y.multiply(e)),o.x.multiply(e).add(o.y.multiply(i))),(0,n.zi)(o,t)}}(0,s.Cg)([(0,o.Pi)(n.ZY)],S.prototype,"tileOffsetFromLocalOrigin",void 0),(0,s.Cg)([(0,o.Pi)(n.ZY)],S.prototype,"maxIntsToLocalOrigin",void 0);class C extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.ZY)],C.prototype,"size",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],C.prototype,"texture",void 0);class z extends o.k2{getColor(t,e,i){return(0,n.j1)([(0,n.or)((0,d.M8)(t),i),e],[(0,n.$5)(t,this.values.first()),this.colors.first()],[(0,n.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,n.MM)(e,t))),i=this.values.get(e),s=e.subtract(1),o=this.values.get(s),r=t.subtract(o).divide(i.subtract(o));return(0,n.jh)(this.colors.get(s),this.colors.get(e),r)}])}}(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.Zb,8))],z.prototype,"colors",void 0),(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],z.prototype,"values",void 0);class V extends o.k2{getOpacity(t){return(0,n.j1)([(0,d.M8)(t),new n.nt(1)],[(0,n.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,n.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>(0,n.MM)(e,t))),i=this.opacityValues.get(e),s=e.subtract(1),o=this.opacityValues.get(s),r=t.subtract(o).divide(i.subtract(o));return(0,n.jh)(this.opacities.get(s),this.opacities.get(e),r)}])}}(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],V.prototype,"opacities",void 0),(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],V.prototype,"opacityValues",void 0);class P extends o.k2{getVVRotationMat4(t){return(0,n.Tk)((0,d.M8)(t),n.$I.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(w.os),i=(0,n.F8)(e),s=(0,n.gn)(e);return new n.$I(s,i,0,0,i.multiply(new n.nt(-1)),s,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return(0,n.Tk)((0,d.M8)(t),n.U.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(w.os),i=(0,n.F8)(e),s=(0,n.gn)(e);return new n.U(s,i,0,i.multiply(new n.nt(-1)),s,0,0,0,1)}))}getNormalizedAngle(t){const e=(0,n.LC)(this.rotationType,new n.nt(1));return(0,n.Tk)(e,new n.nt(90).subtract(t),t)}}(0,s.Cg)([(0,o.Pi)(n.nt)],P.prototype,"rotationType",void 0);class M extends o.k2{getSize(t,e){const i=this.minMaxValueAndSize.xy,s=this.minMaxValueAndSize.zw;return(0,n.Tk)((0,d.M8)(t),e,(()=>{const e=t.subtract(i.x).divide(i.y.subtract(i.x)),o=(0,n.qE)(e,new n.nt(0),new n.nt(1));return s.x.add(o.multiply(s.y.subtract(s.x)))}))}}(0,s.Cg)([(0,o.Pi)(n.Zb)],M.prototype,"minMaxValueAndSize",void 0);class T extends o.k2{getSizeForViewScale(t){return(0,n.j1)([(0,n.$5)(t,this.values.first()),this.sizes.first()],[(0,n.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,n.MM)(e,t))),i=this.values.get(e),s=e.subtract(1),o=this.values.get(s),r=t.subtract(o).divide(i.subtract(o));return(0,n.jh)(this.sizes.get(s),this.sizes.get(e),r)}])}}(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],T.prototype,"sizes",void 0),(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],T.prototype,"values",void 0);class A extends o.k2{getSize(t,e){const i=(0,n.j1)([(0,d.M8)(t),e],[(0,n.$5)(t,this.values.first()),this.sizes.first()],[(0,n.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,n.MM)(e,t))),i=this.values.get(e),s=e.subtract(1),o=this.values.get(s),r=t.subtract(o).divide(i.subtract(o));return(0,n.jh)(this.sizes.get(s),this.sizes.get(e),r)}]);return(0,n.Tk)((0,d.M8)(i),e,i)}}(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],A.prototype,"sizes",void 0),(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.nt,8))],A.prototype,"values",void 0);class _ extends o.k2{getSize(t,e){return(0,n.Tk)((0,d.M8)(t),e,t.multiply(this.unitValueToPixelsRatio))}}function F(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function R(t,e,i){if(F(t)){const s=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(s,i)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(s,i)??t.visualVariableSizeUnitValue?.getSize(s,i)}return i}function D(t,e,i,s=new n.x(!1)){if(null==t.visualVariableColor)return i;const o=t.storage.getColorValue(e);return t.visualVariableColor.getColor(o,i,s)}function O(t,e){if(null==t.visualVariableOpacity)return new n.nt(1);const i=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(i)}function I(t,e){if(null==t.visualVariableRotation)return n.U.identity();const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(i)}(0,s.Cg)([(0,o.Pi)(n.nt)],_.prototype,"unitValueToPixelsRatio",void 0);class k extends g{}(0,s.Cg)([(0,o.C5)(3,n.ZY)],k.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(4,n.Zb)],k.prototype,"sizing",void 0),(0,s.Cg)([(0,o.C5)(5,n.Zb)],k.prototype,"value1Position2Value2",void 0),(0,s.Cg)([(0,o.C5)(6,n.Zb)],k.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,s.Cg)([(0,o.C5)(7,n.ZY)],k.prototype,"zoomRange",void 0),(0,s.Cg)([(0,o.C5)(8,n.nt)],k.prototype,"lineLength",void 0);class Z extends b{}class B extends x{_vertexPreamble(t,e,i){const{id:s,offset:o,animationPointerAndBaseSizeAndReferenceSize:r,sizing:a}=t,l=r.xy,p=r.z,c=r.w,h=a.xy,y=this._getEvalParams(t,h,i);let m,f;if(t.value1Position2Value2){const e=L(l,6,y).a,i=t.pos,s=t.value1Position2Value2.yz,o=t.value1Position2Value2.x,r=t.value1Position2Value2.w,a=e.subtract(o).divide(r.subtract(o));f=i.add(s.subtract(i).multiply(a)),m=(0,n.PM)(new n.nt(1),a).add((0,n.PM)(new n.nt(0),(0,n.ze)(a)))}else f=t.pos,m=new n.nt(0);const g=a.z,v=(0,d.mh)(t.bitset,u.c.bitset.isStroke),b=a.w,x=(0,d.mh)(t.bitset,u.c.bitset.scaleSymbolsProportionally),S=L(l,0,y),C=(0,n.j1)([(0,n.LC)((0,d.mh)(t.bitset,u.c.bitset.isMapAligned),new n.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new n.nt(0)]),z=new n.Ny((0,n.gn)(C),(0,n.F8)(C.multiply(-1)),(0,n.F8)(C),(0,n.gn)(C)).multiply(S.xy),V=S.z.subtract(C).subtract(e.multiply(w.rp)),P=S.w,M=(0,d.mh)(t.bitset,u.c.bitset.isSDF),T=R(this,s,new n.nt(c)).divide(new n.nt(c));return{baseSize:p,animationPointer:l,strokeWidth:g,isOutline:v,unscaledDistanceToPx:b,scaleSymbolsProportionally:x,isSDF:M,position:this._getScreenPosition({id:s,pos:f,offset:o,referenceSize:c,translation:z,rotation:V,scale:P,vvScale:T}),evalParams:y,vvScale:T,scale:P,clip:m}}_getScreenPosition(t){const{pos:e,translation:i,rotation:s,scale:o,offset:r,id:a,vvScale:l}=t,u=function(t,e){if(null==t.visualVariableRotation)return new n.nt(0);const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getNormalizedAngle(i)}(this,a).multiply(Math.PI/180),p=i.x.multiply(4/3),c=i.y.multiply(-1).multiply(4/3),d=(0,n.F8)(u),h=(0,n.gn)(u),y=h.multiply(p).add((0,n.ze)(d).multiply(c)),m=d.multiply(p).add(h.multiply(c)),f=(0,n.F8)(s.subtract(u)),g=(0,n.gn)(s.subtract(u)),v=new n.nt(0),b=new n.nt(1),{pixelRatio:x}=this.animationInfo,w=new n.U(b,v,v,v,b,v,y.multiply(x),m.multiply(x),b),S=new n.U(g,f.multiply(-1),v,f,g,v,0,0,b),C=o.multiply(l).multiply(x).multiply(4/3),z=S.multiply(C),V=this.animationInfo.toScreen.multiply(new n.eB(e,1)),P=w.multiply(V).xy,M=z.multiply(new n.eB(r,0)).xy;return P.add(M)}_clip(t,e){let i=super.clip(t,e);const s=(0,n.$5)(this._getLocalTimeOrigin(t),new n.nt(0));return r.H.forceGlobalTimeOrigin||(i=i.add((0,n.j1)([s,()=>new n.nt(2)],[!0,()=>new n.nt(0)]))),i}_getLocalTimeOrigin(t){return this.storage.getLocalTimeOrigin(t)}_toNdc(t){return this.animationInfo.toNdc.multiply(new n.eB(t,1)).xy}_getEvalParams(t,e,i){const{globalTime:s,animationTextureSize:o,animationTexture:n}=this.animationInfo;return{globalTime:s,localTimeOrigin:this._getLocalTimeOrigin(t.id),animationTextureSize:o,animationTexture:n,pixelDimensions:e,lineLength:i}}_getColor(t,e){return(0,n.Tk)((0,n.LC)(e.isSDF,new n.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,n.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,n.US)(this.mosaicInfo.texture,t),s=new n.nt(.5).subtract((0,d.Rj)(i)).multiply(e.distanceToPx).multiply(w.V5),o=(0,n.qE)(new n.nt(.5).subtract(s),new n.nt(0),new n.nt(1)),r=e.color.multiply(o),a=e.outlineSize.multiply(.5),l=(0,n.tn)(s).subtract(a),u=(0,n.qE)(new n.nt(.5).subtract(l),new n.nt(0),new n.nt(1)),p=e.outlineColor.multiply(u);return new n.nt(1).subtract(p.a).multiply(r).add(p)}}function L(t,e,i){const s=t.add(new n.ZY(e,0)),o=(0,n.US)(i.animationTexture,s.add(.5).divide(i.animationTextureSize)).xy;return t=t.add(o),(0,n.om)({animationPointer:t,...i},n.Zb,null,(t=>{const{out:e}=t;if(!e)throw new Error("out is null");return(0,a.DW)({...t,out:e})}))}(0,s.Cg)([(0,o.Pi)(C)],B.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(l)],B.prototype,"animationInfo",void 0),(0,s.Cg)([(0,o.Pi)(S)],B.prototype,"localTileOffset",void 0),(0,s.Cg)([(0,o.uK)(z)],B.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],B.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,o.uK)(M)],B.prototype,"visualVariableSizeMinMaxValue",void 0),(0,s.Cg)([(0,o.uK)(T)],B.prototype,"visualVariableSizeScaleStops",void 0),(0,s.Cg)([(0,o.uK)(A)],B.prototype,"visualVariableSizeStops",void 0),(0,s.Cg)([(0,o.uK)(_)],B.prototype,"visualVariableSizeUnitValue",void 0),(0,s.Cg)([(0,o.uK)(P)],B.prototype,"visualVariableRotation",void 0);class U extends k{}(0,s.Cg)([(0,o.C5)(9,n.Zb)],U.prototype,"tlbr",void 0);class j extends o.Y7{}(0,s.Cg)([(0,o.C5)(13,n.ZY)],j.prototype,"nextPos1",void 0),(0,s.Cg)([(0,o.C5)(14,n.ZY)],j.prototype,"nextPos2",void 0);class E extends Z{}class Y extends B{_fragmentPoly(t){const e=(0,n.zi)(t.uv,new n.nt(1)),i=(0,n.jh)(t.tlbr.xy,t.tlbr.zw,e);return this._getColor(i,{color:t.color,distanceToPx:t.distanceToPx,isSDF:t.isSDF,outlineColor:t.outlineColor,outlineSize:t.strokeWidth})}_vertexPoly(t){const{position:e,animationPointer:i,evalParams:s,isOutline:o,unscaledDistanceToPx:r,vvScale:a,strokeWidth:l,scaleSymbolsProportionally:p,scale:c,isSDF:h,baseSize:y,clip:m}=this._vertexPreamble(t,new n.nt(0),t.lineLength||new n.nt(0)),f=this._toNdc(e);let g=L(i,1,s);g=new n.Zb(g.rgb.multiply(g.a),g.a);let v=L(i,2,s);v=new n.Zb(v.rgb.multiply(v.a),v.a);let b=L(i,3,s);b=new n.Zb(b.rgb.multiply(b.a),b.a);const x=L(i,4,s).a,w=L(i,5,s).a,S=D(this,t.id,g,(0,n.or)((0,d.K5)(t.bitset,u.c.bitset.colorLocked),new n.x(o))),C=(0,n.jh)(S,v,b),z=O(this,t.id),V=(0,n.jh)(z,x,w),P=C.multiply(V),M=this.clip(t.id,t.zoomRange).add(m.multiply(2)),T=r.multiply(a);return{unscaledDistanceToPx:r,vvScale:a,strokeWidth:l,scaleSymbolsProportionally:p,scale:c,isSDF:h,baseSize:y,ndc:f,color:P,z:M,isOutline:o,evalParams:s,distanceToPx:T}}}function Q(t,e,i){const s=i.subtract(e),o=function(t,e){return(0,n.Om)(t,(0,n.S8)(e))}(t.subtract(e),s),r=(0,n.qE)(o.divide((0,n.Bw)(s)),new n.nt(0),new n.nt(1));return(0,n.Io)(t,e.add(r.multiply(i.subtract(e))))}function q(t){const e=(0,n.tn)(t);return(0,n.PM)(e.x.add(e.y).add(e.z),new n.nt(1.05))}function H(t,e,i,s){const o=new n.U(i.x.multiply(s.y).subtract(s.x.multiply(i.y)),s.x.multiply(e.y).subtract(e.x.multiply(s.y)),e.x.multiply(i.y).subtract(i.x.multiply(e.y)),i.y.subtract(s.y),s.y.subtract(e.y),e.y.subtract(i.y),s.x.subtract(i.x),e.x.subtract(s.x),i.x.subtract(e.x)),r=e.x.multiply(i.y.subtract(s.y)),a=i.x.multiply(s.y.subtract(e.y)),l=s.x.multiply(e.y.subtract(i.y)),u=r.add(a).add(l);return new n.nt(1).divide(u).multiply(o.multiply(new n.eB(1,t)))}function N(t,e,i,s){return(0,n.LC)(q(H(t,e,i,s)),new n.nt(1))}function K(t,e,i,s){const o=i.subtract(e),r=s.subtract(e),a=(0,d.tL)(o,r),l=(0,n.Uo)((0,n.Xe)(a,new n.nt(w.M)),(0,n.MM)(a,new n.nt(-w.M)));return(0,n.j1)([(0,n.Uo)((0,n.AU)(l),N(t.xy,e,i,s)),new n.nt(-1)],[!0,()=>{const o=Q(t,e,i),r=Q(t,i,s),a=Q(t,s,e);return(0,n.jk)((0,n.jk)(o,r),a)}])}function W(t){return t.distance.add(1)}function G(t,e,i){const{viewMat3:s,tileMat3:o}=t.view,r=s.multiply(o),a=r.multiply(new n.eB(e.pos,1)),l=r.multiply(new n.eB(i.nextPos1,1)),u=r.multiply(new n.eB(i.nextPos2,1));return K(t.hittestRequest.position,a.xy,l.xy,u.xy)}class $ extends g{}(0,s.Cg)([(0,o.C5)(3,n.Zb)],$.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(4,n.ZY)],$.prototype,"zoomRange",void 0);class X extends x{constructor(){super(...arguments),this.type="FillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=O(this,t.id),s=D(this,t.id,t.color).multiply(i),o=this.view.displayViewScreenMat3.multiply(new n.eB(t.pos.xy,1)),r=this.clip(t.id,t.zoomRange);return{glPosition:new n.Zb(o.xy,r,1),color:s,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new n.nt(0))}hittest(t,e){return G(this,t,e)}}(0,s.Cg)([(0,o.uK)(z)],X.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],X.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)($)),(0,s.Qj)(1,(0,o.hF)(v))],X.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(b))],X.prototype,"fragment",null);class J extends ${}(0,s.Cg)([(0,o.C5)(5,n.Zb)],J.prototype,"tlbr",void 0),(0,s.Cg)([(0,o.C5)(6,n.nt)],J.prototype,"width",void 0),(0,s.Cg)([(0,o.C5)(7,n.nt)],J.prototype,"height",void 0),(0,s.Cg)([(0,o.C5)(8,n.ZY)],J.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(9,n.ZY)],J.prototype,"scale",void 0),(0,s.Cg)([(0,o.C5)(10,n.nt)],J.prototype,"angle",void 0);function tt(t,e,i,s,o){const r=(0,n.LC)((0,d.mh)(o,w.Fz),(0,n.fV)(1)),a=(0,d.Rj)(new n.Zb(t,0));return(0,n.Tk)(r,(0,n.w0)(s.divide(e.x),i.divide(e.y),0,(0,n.ze)(i.divide(e.x)),s.divide(e.y),0,(0,d._9)((0,n.Zc)(a,0)),(0,d._9)((0,n.Zc)(0,a)),1),(0,n.w0)(s.divide(e.x),i.divide(e.y),0,(0,n.ze)(i.divide(e.x)),s.divide(e.y),0,0,0,1))}function et(t,e){const i=t.view.requiredZoomFactor,s=new n.ZY(e.width,e.height),o=s.multiply(e.scale).multiply(i),r=e.angle.multiply(w.rp),a=(0,n.F8)(r),l=(0,n.gn)(r),u=tt(e.id,o,a,l,e.bitset),p=t.localTileOffset.getPatternOffsetAtTileOrigin(s,a,l),c=i.multiply(e.scale).multiply(e.offset.subtract(p)).divide(o),h=new n.eB(e.pos,1),y=u.multiply(h).xy.subtract(c),m=e.tlbr.divide(t.mosaicInfo.size.xyxy);let f=(0,d.mh)(e.bitset,w.cn);return null!=t.visualVariableColor&&(f=(0,n.Tk)((0,d.M8)(t.storage.getColorValue(e.id)),new n.nt(0),f)),{tileTextureCoord:y,tlbr:m,sampleAlphaOnly:f}}function it(t,e){const i=(0,n.zi)(e.tileTextureCoord,new n.nt(1)),s=(0,n.jh)(e.tlbr.xy,e.tlbr.zw,i);let o=(0,n.US)(t.mosaicInfo.texture,s);return o=(0,n.Tk)((0,n.MM)(e.sampleAlphaOnly,new n.nt(.5)),o.aaaa,o),e.color.multiply(o)}class st extends X{constructor(){super(...arguments),this.type="ComplexFillShader"}vertex(t,e){return{...super.vertex(t,e),...et(this,t)}}fragment(t){const e=it(this,t);return this.getFragmentOutput(e,t,new n.nt(0))}}(0,s.Cg)([(0,o.Pi)(C)],st.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(S)],st.prototype,"localTileOffset",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(J)),(0,s.Qj)(1,(0,o.hF)(v))],st.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],st.prototype,"fragment",null);class ot extends Y{constructor(){super(...arguments),this.type="AnimatedFillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const{distanceToPx:i,ndc:s,z:o,color:r,isOutline:a,strokeWidth:l,isSDF:u,baseSize:p,scale:c,scaleSymbolsProportionally:d}=this._vertexPoly(t),h=this.view.requiredZoomFactor,y=t.sizing.xy,m=y.multiply(h),f=new n.nt(0),g=(0,n.F8)(f),v=(0,n.gn)(f),b=tt(t.id,m,g,v,t.bitset),x=this.localTileOffset.getPatternOffsetAtTileOrigin(y,g,v),w=h.multiply(t.offset.subtract(x)).divide(m),S=new n.eB(t.pos,1),C=b.multiply(S).xy.subtract(w),z=t.tlbr.divide(this.mosaicInfo.size.xyxy);return{glPosition:new n.Zb(s,o,1),tlbr:z,uv:C,color:r.multiply(new n.nt(1).subtract(a)),outlineColor:r.multiply(a),distanceToPx:i,strokeWidth:l.multiply((0,n.jh)(new n.nt(1),c,d)),isOutline:a,isSDF:u,...this.maybeRunHittest(t,e,{pos:t.pos,size:p,sizeCorrection:new n.nt(1),isMapAligned:new n.nt(1),vvRotationMat3:new n.U(1,0,0,0,1,0,0,0,1),placementMat3:new n.U(1,0,0,0,1,0,0,0,1),outlineSize:new n.nt(1),distanceToPx:i,isSDF:u})}}fragment(t){const e=this._fragmentPoly(t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return G(this,t,e)}}(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(U)),(0,s.Qj)(1,(0,o.hF)(j))],ot.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(E))],ot.prototype,"fragment",null);class nt extends g{}(0,s.Cg)([(0,o.C5)(3,n.Zb)],nt.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(4,n.ZY)],nt.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(5,n.ZY)],nt.prototype,"normal",void 0),(0,s.Cg)([(0,o.C5)(6,n.nt)],nt.prototype,"halfWidth",void 0),(0,s.Cg)([(0,o.C5)(7,n.nt)],nt.prototype,"referenceHalfWidth",void 0),(0,s.Cg)([(0,o.C5)(8,n.ZY)],nt.prototype,"zoomRange",void 0);class rt extends b{}class at extends o.k2{}function lt(t){return(0,n.T9)(new n.nt(w.Fb).multiply((0,n.PM)(t,new n.nt(w.J5))),new n.nt(1))}function ut(t,e){const{halfWidth:i,normal:s}=t,o=lt(i),r=(0,n.Bw)(s).multiply(i);return(0,n.qE)(o.multiply(i.subtract(r)).divide(e.add(o).subtract(new n.nt(1))),new n.nt(0),new n.nt(1))}function pt(t,e){const{id:i,offset:s,pos:o,normal:r,zoomRange:a}=e,{displayViewScreenMat3:l,displayViewMat3:u}=t.view,p=D(t,i,e.color),c=O(t,i),d=function(t,e){const{id:i,halfWidth:s,referenceHalfWidth:o}=e;if(F(t)){const e=R(t,i,new n.nt(2).multiply(o));return new n.nt(.5).multiply(s.divide((0,n.T9)(o,new n.nt(w.Ni)))).multiply(e)}return s}(t,e),h=new n.nt(.5).multiply(t.antialiasingControls.antialiasing),y=(0,n.T9)(d.add(h),new n.nt(.45)).add(new n.nt(.1).multiply(h)),m=lt(y).multiply(y).multiply(s),f=u.multiply(new n.eB(m,new n.nt(0))),g=l.multiply(new n.eB(o,new n.nt(1))).add(f),v=new n.nt(2).multiply((0,n.PM)(d,new n.nt(0))).add(t.clip(i,a)),b=new n.Zb(g.xy,v,1);return{color:p,opacity:c,halfWidth:y,normal:r,scaledOffset:m,scaledHalfWidth:d,glPosition:new n.Zb(b.xy,v,1)}}function ct(t,e){const{opacity:i,color:s}=t,o=ut(t,e);return i.multiply(s).multiply(o)}(0,s.Cg)([(0,o.Pi)(n.nt)],at.prototype,"antialiasing",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],at.prototype,"blur",void 0);class dt extends x{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=pt(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=ct(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:s,tileMat3:o}=this.view,r=s.multiply(o),a=r.multiply(new n.eB(t.pos,1)),l=r.multiply(new n.eB(e.nextPos1,1)),u=r.multiply(new n.eB(e.nextPos2,1)),{distance:p,smallSymbolDistance:c,smallSymbolSizeThreshold:d}=this.hittestRequest,h=(0,n.PM)(i,d.multiply(.5)).multiply(p.subtract(c)),y=this.hittestRequest.position;return(0,n.jk)(Q(y,a.xy,l.xy),Q(y,a.xy,u.xy)).subtract(i).add(h)}}(0,s.Cg)([(0,o.Pi)(at)],dt.prototype,"antialiasingControls",void 0),(0,s.Cg)([(0,o.uK)(z)],dt.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],dt.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,o.uK)(M)],dt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,s.Cg)([(0,o.uK)(T)],dt.prototype,"visualVariableSizeScaleStops",void 0),(0,s.Cg)([(0,o.uK)(A)],dt.prototype,"visualVariableSizeStops",void 0),(0,s.Cg)([(0,o.uK)(_)],dt.prototype,"visualVariableSizeUnitValue",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(nt)),(0,s.Qj)(1,(0,o.hF)(v))],dt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(rt))],dt.prototype,"fragment",null);class ht extends U{}(0,s.Cg)([(0,o.C5)(10,n.nt)],ht.prototype,"accumulatedDistance",void 0),(0,s.Cg)([(0,o.C5)(11,n.ZY)],ht.prototype,"normal",void 0),(0,s.Cg)([(0,o.C5)(12,n.ZY)],ht.prototype,"segmentDirection",void 0);class yt extends Y{constructor(){super(...arguments),this.type="AnimatedLineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const{animationPointerAndBaseSizeAndReferenceSize:i}=t,s=i.xy,{distanceToPx:o,ndc:r,z:a,color:l,isOutline:u,strokeWidth:p,isSDF:c,baseSize:d,scale:h,scaleSymbolsProportionally:y,evalParams:m}=this._vertexPoly(t),f=t.sizing.xy,g=f.x.multiply(d).divide(f.y),v=L(s,6,m).a,b=t.accumulatedDistance.subtract(v),{normal:x}=t,w=t.normal.y,S=b.divide(this.view.displayZoomFactor).add((0,n.Om)(t.segmentDirection,t.offset)).divide(g),C=w.add(1).divide(2),z=new n.ZY(S,C),V=t.tlbr.divide(this.mosaicInfo.size.xyxy);return{glPosition:new n.Zb(r,a,1),tlbr:V,uv:z,color:l.multiply(new n.nt(1).subtract(u)),outlineColor:l.multiply(u),distanceToPx:o,strokeWidth:p.multiply((0,n.jh)(new n.nt(1),h,y)),isOutline:u,isSDF:c,halfWidth:d.divide(2),normal:x,...this.maybeRunHittest(t,e,{pos:t.pos,size:d,sizeCorrection:new n.nt(1),isMapAligned:new n.nt(1),vvRotationMat3:new n.U(1,0,0,0,1,0,0,0,1),placementMat3:new n.U(1,0,0,0,1,0,0,0,1),outlineSize:new n.nt(1),distanceToPx:o,isSDF:c})}}fragment(t){const e=this._fragmentPoly(t),{halfWidth:i,normal:s}=t,o=lt(i),r=(0,n.Bw)(s).multiply(i),a=(0,n.qE)(o.multiply(i.subtract(r)).divide(o.subtract(new n.nt(1))),new n.nt(0),new n.nt(1));return this.getFragmentOutput(e.multiply(a),t)}hittest(t,e,i){const{viewMat3:s,tileMat3:o}=this.view,r=s.multiply(o),a=r.multiply(new n.eB(t.pos,1)),l=r.multiply(new n.eB(e.nextPos1,1)),u=r.multiply(new n.eB(e.nextPos2,1)),{distance:p,smallSymbolDistance:c,smallSymbolSizeThreshold:d}=this.hittestRequest,h=(0,n.PM)(i,d.multiply(.5)).multiply(p.subtract(c)),y=this.hittestRequest.position;return(0,n.jk)(Q(y,a.xy,l.xy),Q(y,a.xy,u.xy)).subtract(i).add(h)}}(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(ht)),(0,s.Qj)(1,(0,o.hF)(j))],yt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends E{}))],yt.prototype,"fragment",null);class mt extends k{}(0,s.Cg)([(0,o.C5)(9,n.ZY)],mt.prototype,"uv",void 0),(0,s.Cg)([(0,o.C5)(10,n.nt)],mt.prototype,"angle",void 0);class ft extends o.Y7{}(0,s.Cg)([(0,o.C5)(11,n.ZY)],ft.prototype,"offsetNextVertex1",void 0),(0,s.Cg)([(0,o.C5)(12,n.ZY)],ft.prototype,"offsetNextVertex2",void 0),(0,s.Cg)([(0,o.C5)(13,n.ZY)],ft.prototype,"textureUVNextVertex1",void 0),(0,s.Cg)([(0,o.C5)(14,n.ZY)],ft.prototype,"textureUVNextVertex2",void 0);function gt(t,e,i,s){return e.multiply(t.x).add(i.multiply(t.y)).add(s.multiply(t.z))}class vt extends B{constructor(){super(...arguments),this.type="AnimatedMarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,e){const i=t.uv.divide(this.mosaicInfo.size),{position:s,animationPointer:o,evalParams:r,isOutline:a,unscaledDistanceToPx:l,vvScale:p,strokeWidth:c,scaleSymbolsProportionally:h,scale:y,isSDF:m,baseSize:f,clip:g}=this._vertexPreamble(t,t.angle,t.lineLength||new n.nt(0)),v=this._toNdc(s);let b=L(o,1,r);b=new n.Zb(b.rgb.multiply(b.a),b.a);let x=L(o,2,r);x=new n.Zb(x.rgb.multiply(x.a),x.a);let w=L(o,3,r);w=new n.Zb(w.rgb.multiply(w.a),w.a);const S=L(o,4,r).a,C=L(o,5,r).a,z=D(this,t.id,b,(0,n.or)((0,d.K5)(t.bitset,u.c.bitset.colorLocked),new n.x(a))),V=(0,n.jh)(z,x,w),P=O(this,t.id),M=(0,n.jh)(P,S,C),T=V.multiply(M),A=this.clip(t.id,t.zoomRange).add(g.multiply(2)),_=l.multiply(p);return{glPosition:new n.Zb(v,A,1),uv:i,color:T.multiply(new n.nt(1).subtract(a)),outlineColor:T.multiply(a),distanceToPx:_,strokeWidth:c.multiply((0,n.jh)(new n.nt(1),y,h)),isOutline:a,isSDF:m,...this.maybeRunHittest(t,e,{pos:t.pos,size:f,sizeCorrection:new n.nt(1),isMapAligned:new n.nt(1),vvRotationMat3:new n.U(1,0,0,0,1,0,0,0,1),placementMat3:new n.U(1,0,0,0,1,0,0,0,1),outlineSize:new n.nt(1),distanceToPx:_,isSDF:m})}}fragment(t){let e=this._getColor(t.uv,{color:t.color,distanceToPx:t.distanceToPx,isSDF:t.isSDF,outlineColor:t.outlineColor,outlineSize:t.strokeWidth});return r.H.spotlightAnimatedSymbols&&(e=e.add(new n.Zb(0,.3,0,.3))),this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,n.Tk)((0,n.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_hittestSmallMarker(t,e,i){const{position:s,distance:o,smallSymbolDistance:r}=this.hittestRequest,a=o.subtract(r),{viewMat3:l,tileMat3:u}=this.view,p=l.multiply(u).multiply(new n.eB(i.pos,1)).xy,c=i.size.multiply(.5);return(0,n.Io)(p,s).subtract(c).add(a)}_hittestMarker(t,e,i){const s=this._vertexPreamble({...t},t.angle,new n.nt(0)).position,o=this._vertexPreamble({...t,offset:e.offsetNextVertex1},t.angle,new n.nt(0)).position,r=this._vertexPreamble({...t,offset:e.offsetNextVertex2},t.angle,new n.nt(0)).position,a=this.hittestRequest.position,l=this.hittestRequest.distance,u=K(a,s,o,r);return(0,n.Tk)((0,n.MM)(u,l),u,this._hittestSamples(s,o,r,t,e,i))}_hittestSamples(t,e,i,s,o,r){const{outlineSize:a,isSDF:l,distanceToPx:u}=r,p=this.hittestRequest.position,c=this.hittestRequest.distance,d=H(p.add(new n.ZY((0,n.ze)(c),(0,n.ze)(c))),t,e,i),h=H(p.add(new n.ZY(0,(0,n.ze)(c))),t,e,i),y=H(p.add(new n.ZY(c,(0,n.ze)(c))),t,e,i),m=H(p.add(new n.ZY((0,n.ze)(c),0)),t,e,i),f=H(p,t,e,i),g=H(p.add(new n.ZY(c,0)),t,e,i),v=H(p.add(new n.ZY((0,n.ze)(c),c)),t,e,i),b=H(p.add(new n.ZY(0,c)),t,e,i),x=H(p.add(new n.ZY(c,c)),t,e,i),w=s.uv.divide(this.mosaicInfo.size),S=o.textureUVNextVertex1.divide(this.mosaicInfo.size),C=o.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new n.Zb(1,1,1,1),outlineSize:a,outlineColor:new n.Zb(1,1,1,1),isSDF:l,distanceToPx:u};let V=new n.nt(0);return V=V.add(q(d).multiply(this._getColor(gt(d,w,S,C),z).a)),V=V.add(q(h).multiply(this._getColor(gt(h,w,S,C),z).a)),V=V.add(q(y).multiply(this._getColor(gt(y,w,S,C),z).a)),V=V.add(q(m).multiply(this._getColor(gt(m,w,S,C),z).a)),V=V.add(q(f).multiply(this._getColor(gt(f,w,S,C),z).a)),V=V.add(q(g).multiply(this._getColor(gt(g,w,S,C),z).a)),V=V.add(q(v).multiply(this._getColor(gt(v,w,S,C),z).a)),V=V.add(q(b).multiply(this._getColor(gt(b,w,S,C),z).a)),V=V.add(q(x).multiply(this._getColor(gt(x,w,S,C),z).a)),(0,n.PM)(V,new n.nt(.05)).multiply(W(this.hittestRequest))}}(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(mt)),(0,s.Qj)(1,(0,o.hF)(ft))],vt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends Z{}))],vt.prototype,"fragment",null);var bt=i(63919),xt=i(85827),wt=i(70479);class St extends wt.j{constructor(){super(...arguments),this.symbologyPlane=0,this._input=null}}var Ct=i(63584);class zt extends St{render(t,e){const{context:i,painter:s}=t,{target:o}=e,{freezeGlobalTime:n}=r.H,a=s.textureManager.animationStore.getTexture(i,0),l=[2/t.state.size[0],0,0,0,-2/t.state.size[1],0,-1,1,1],u=Array.from((0,bt.B8)((0,xt.vt)(),l)),p=Array.from((0,bt.lw)((0,xt.vt)(),u,o.transforms.displayViewScreenMat3)),c=e.instance.getInput(),d=s.textureManager.getMosaicInfo(i,e.textureKey,!1),{optionalAttributes:h}=c,y=h.zoomRange,m=h.value1Position2Value2,f="accumulatedDistance"in h&&h.accumulatedDistance,g="segmentDirection"in h&&h.segmentDirection,v="normal"in h&&h.normal;s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,c.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:d,animationInfo:{globalTime:!1===n?t.time/1e3:n,animationTextureSize:[a.descriptor.width,a.descriptor.height],animationTexture:{unit:6,texture:a},toScreen:p,toNdc:l,mapRotation:t.state.rotation,pixelRatio:t.state.pixelRatio},localTileOffset:(0,Ct.Pr)(e.target)},defines:{...(0,Ct.vT)(t)},optionalAttributes:{zoomRange:y,value1Position2Value2:m,accumulatedDistance:f,segmentDirection:g,normal:v},useComputeBuffer:!0}),s.setPipelineState({...(0,Ct.Qu)(t)}),s.submitDraw(t,e),!1===n&&o.requestRender()}}class Vt extends o.ZA{}(0,s.Cg)([(0,o.C5)(0,n.ZY)],Vt.prototype,"pos",void 0);class Pt extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.nt)],Pt.prototype,"dotSize",void 0);class Mt extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.z7)],Mt.prototype,"locations",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],Mt.prototype,"pixelRatio",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],Mt.prototype,"tileZoomFactor",void 0);class Tt extends o.A{constructor(){super(...arguments),this.type="DotDensityPointShader"}vertex(t){const e=new n.U(1,0,0,0,-1,0,0,1,1).multiply(new n.eB(t.pos.xy.divide(p.CQ),1)),i=(0,n.US)(this.draw.locations,e.xy),s=(0,n.T9)(this.instance.dotSize.divide(2),new n.nt(1));let o=new n.nt(0);o=o.add((0,n.PM)(i.a,new n.nt(1e-6)).multiply(2));let r=s.add(this.instance.dotSize);const a=this.view.displayViewScreenMat3.multiply(new n.eB(t.pos.add(.5),1)),l=new n.Zb(a.xy,o,1),u=this.instance.dotSize.divide(r),c=new n.nt(-1).divide(s.divide(r));return r=r.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:r,color:i,ratio:u,invEdgeRatio:c}}fragment(t){const e=(0,n.Bw)(t.glPointCoord.subtract(.5)).multiply(2),i=(0,n.TF)(new n.nt(0),new n.nt(1),t.invEdgeRatio.multiply(e.subtract(t.ratio)).add(1)),s=new o.mm;return s.fragColor=t.color.multiply(i),s}}(0,s.Cg)([(0,o.Pi)(Pt)],Tt.prototype,"instance",void 0),(0,s.Cg)([(0,o.Pi)(Mt)],Tt.prototype,"draw",void 0),(0,s.Cg)([(0,o.Pi)(f)],Tt.prototype,"view",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Vt))],Tt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],Tt.prototype,"fragment",null);class At extends g{}(0,s.Cg)([(0,o.C5)(3,n.nt)],At.prototype,"inverseArea",void 0);class _t extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.Zb,2))],_t.prototype,"isActive",void 0),(0,s.Cg)([(0,o.Pi)(n.My.ofType(n.Zb,8))],_t.prototype,"colors",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],_t.prototype,"dotValue",void 0);class Ft extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.z7)],Ft.prototype,"dotTexture0",void 0),(0,s.Cg)([(0,o.Pi)(n.z7)],Ft.prototype,"dotTexture1",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],Ft.prototype,"tileZoomFactor",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],Ft.prototype,"pixelRatio",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],Ft.prototype,"tileDotsOverArea",void 0);class Rt extends x{constructor(){super(...arguments),this.type="DotDensityPolygonShader"}_dotThreshold(t,e,i){return t.divide(e).divide(i)}vertex(t){const e=new n.U(2/p.CQ,0,0,0,-2/p.CQ,0,-1,1,1).multiply(new n.eB(t.pos,1)),i=this.clip(t.id),s=new n.Zb(e.xy,i,1),o=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),r=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),a=this.draw.tileZoomFactor.multiply(p.CQ).divide(this.draw.pixelRatio),l=this._dotThreshold(o,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),c=t.pos.add(.5).divide(a);return{glPosition:s,color:new n.Zb(0,0,0,0),textureCoords:c,thresholds0:l,thresholds1:u}}fragment(t){const e=new o.mm,i=(0,n.US)(this.draw.dotTexture0,t.textureCoords),s=(0,n.US)(this.draw.dotTexture1,t.textureCoords),r=t.thresholds0.subtract(i),a=t.thresholds1.subtract(s);let l;const u=n.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),p=n.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=(0,n.PM)(new n.nt(0),r),e=(0,n.PM)(new n.nt(0),a),i=(0,n.Om)(t,r).add((0,n.Om)(e,a)),s=(0,n.PM)(i,new n.nt(0)),o=new n.nt(1).subtract(s),c=i.add(s),d=r.multiply(t).divide(c),h=a.multiply(e).divide(c),y=u.multiply(d).add(p.multiply(h));l=o.multiply(y)}else{const t=(0,n.T9)((0,d.xf)(r),(0,d.xf)(a)),e=(0,n.PM)(t,new n.nt(0)),i=new n.nt(1).subtract(e),s=(0,n.PM)(t,r),o=(0,n.PM)(t,a),c=u.multiply(s).add(p.multiply(o));l=i.multiply(c)}return e.fragColor=l,e}hittest(t){return W(this.hittestRequest)}}(0,s.Cg)([o.E8],Rt.prototype,"blending",void 0),(0,s.Cg)([(0,o.Pi)(_t)],Rt.prototype,"instance",void 0),(0,s.Cg)([(0,o.Pi)(Ft)],Rt.prototype,"draw",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(At))],Rt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(b))],Rt.prototype,"fragment",null);var Dt=i(47249),Ot=i(16946),It=i(93345),kt=i(12331),Zt=i(62881),Bt=i(88800),Lt=i(80895),Ut=i(96673);const jt={pos:{count:2,type:It.pe.UNSIGNED_SHORT}};class Et{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){const e=p.CQ,i=p.CQ,s=new Ut.R(e,i);s.samplingMode=9728,s.wrapMode=33071;const o=new Zt.l(t,new Bt.q(It.iE.DEPTH24_STENCIL8,e,i));this._dotFBO=new kt.H(t,s,o)}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){const e=p.CQ,i=e*e,s=2,o=new Int16Array(i*s);for(let t=0;t<e;t++)for(let i=0;i<e;i++)o[s*(i+t*e)]=i,o[s*(i+t*e)+1]=t;this._dotMesh=Ot.g.create(t,{primitive:It.WR.POINTS,vertex:o,count:i,layout:jt})}return this._dotMesh}getDotDensityTextures(t,e,i){if(this._dotTextureSize===e&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=e,this._seed=i),null===this._dotTextures){const s=new Dt.A(i);this._dotTextures=[this._allocDotDensityTexture(t,e,s),this._allocDotDensityTexture(t,e,s)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,e,i){const s=new Float32Array(e*e*4);for(let n=0;n<s.length;n++)s[n]=i.getFloat();const o=new Ut.R(e);return o.dataType=It.ld.FLOAT,o.samplingMode=9728,new Lt.g(t,o,s)}}function Yt(t){const e=1/t;return{antialiasing:e,blur:0+e}}class Qt extends g{}(0,s.Cg)([(0,o.C5)(3,n.ZY)],Qt.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(4,n.Zb)],Qt.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(5,n.ZY)],Qt.prototype,"normal",void 0),(0,s.Cg)([(0,o.C5)(6,n.nt)],Qt.prototype,"halfWidth",void 0),(0,s.Cg)([(0,o.C5)(7,n.nt)],Qt.prototype,"referenceHalfWidth",void 0),(0,s.Cg)([(0,o.C5)(8,n.ZY)],Qt.prototype,"zoomRange",void 0);class qt extends rt{}function Ht(t,e,i){const{id:s,bitset:o}=e,r=(0,d.mh)(o,w.Xx),a=(0,n.MM)(r,new n.nt(.5)),l=pt(t,e),u=(0,n.Tk)(a,l.halfWidth,new n.nt(0)),p=O(t,s),c=D(t,s,e.color),h=(0,n.Tk)(a,(0,n.Tk)((0,d.K5)(o,w.bB),c,e.color),c.multiply(p)),y=t.view.displayViewScreenMat3.multiply(new n.eB(e.pos.xy,1)),m=t.clip(e.id),f=new n.Zb(y.xy,m,1),g=(0,n.Tk)(a,l.glPosition,f),v=i&&t.maybeRunHittest(e,i,a);return{isOutline:r,color:h,opacity:new n.nt(1),halfWidth:u,normal:l.normal,glPosition:g,...v}}class Nt extends x{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,s.Cg)([(0,o.Pi)(at)],Nt.prototype,"antialiasingControls",void 0),(0,s.Cg)([(0,o.uK)(z)],Nt.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],Nt.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,o.uK)(M)],Nt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,s.Cg)([(0,o.uK)(T)],Nt.prototype,"visualVariableSizeScaleStops",void 0),(0,s.Cg)([(0,o.uK)(A)],Nt.prototype,"visualVariableSizeStops",void 0),(0,s.Cg)([(0,o.uK)(_)],Nt.prototype,"visualVariableSizeUnitValue",void 0);class Kt extends Nt{constructor(){super(...arguments),this.type="OutlineFillShader"}vertex(t,e){return Ht(this,t,e)}fragment(t){const{color:e,isOutline:i}=t,s=(0,n.MM)(i,new n.nt(.5)),o=ct(t,this.antialiasingControls.blur),r=(0,n.Tk)(s,o,e),a=(0,n.Tk)(s,new n.nt(1/255),new n.nt(0));return this.getFragmentOutput(r,t,a)}hittest(t,e,i){return(0,n.Tk)(i,W(this.hittestRequest),G(this,t,e))}}(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Qt)),(0,s.Qj)(1,(0,o.hF)(v))],Kt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(qt))],Kt.prototype,"fragment",null);class Wt extends ${}(0,s.Cg)([(0,o.C5)(5,n.Zb)],Wt.prototype,"tlbr",void 0),(0,s.Cg)([(0,o.C5)(6,n.nt)],Wt.prototype,"inverseRasterizationScale",void 0);function Gt(t,e){const i=e.tlbr.xy,s=e.tlbr.zw,o=s.x.subtract(i.x),r=i.y.subtract(s.y),a=new n.ZY(o,r).multiply(e.inverseRasterizationScale),l=a.multiply(t.view.requiredZoomFactor),u=function(t){const e=new n.nt(1),i=new n.nt(0);return new n.U(e.divide(t.x),i.divide(t.y),0,(0,n.ze)(i.divide(t.x)),e.divide(t.y),0,0,0,1)}(l),p=t.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),c=new n.eB(e.pos,1);return{tileTextureCoord:u.multiply(c).xy.subtract(p),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function $t(t,e){const i=(0,n.zi)(t.tileTextureCoord,new n.nt(1)),s=(0,n.jh)(t.tlbr.xy,t.tlbr.zw,i),o=(0,n.US)(e.texture,s);return t.color.multiply(o)}class Xt extends X{constructor(){super(...arguments),this.type="PatternFillShader"}vertex(t,e){return{...super.vertex(t,e),...Gt(this,t)}}fragment(t){const e=$t(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new n.nt(0))}}(0,s.Cg)([(0,o.Pi)(C)],Xt.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(S)],Xt.prototype,"localTileOffset",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Wt)),(0,s.Qj)(1,(0,o.hF)(v))],Xt.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],Xt.prototype,"fragment",null);class Jt extends Qt{}(0,s.Cg)([(0,o.C5)(9,n.Zb)],Jt.prototype,"tlbr",void 0),(0,s.Cg)([(0,o.C5)(10,n.nt)],Jt.prototype,"inverseRasterizationScale",void 0);class te extends qt{}class ee extends Kt{constructor(){super(...arguments),this.type="PatternOutlineFillShader"}vertex(t,e){return{...Ht(this,t,e),...Gt(this,t)}}fragment(t){const{isOutline:e}=t,i=(0,n.MM)(e,new n.nt(.5)),s=ct(t,this.antialiasingControls.blur),o=$t(t,this.mosaicInfo),r=(0,n.Tk)(i,s,o),a=(0,n.Tk)(i,new n.nt(1/255),new n.nt(0));return this.getFragmentOutput(r,t,a)}}(0,s.Cg)([(0,o.Pi)(C)],ee.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(S)],ee.prototype,"localTileOffset",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Jt)),(0,s.Qj)(1,(0,o.hF)(v))],ee.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(te))],ee.prototype,"fragment",null);const ie=1/w.cZ;class se extends g{}(0,s.Cg)([(0,o.C5)(3,n.Zb)],se.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(4,n.Zb)],se.prototype,"tlbr",void 0),(0,s.Cg)([(0,o.C5)(5,n.nt)],se.prototype,"angle",void 0),(0,s.Cg)([(0,o.C5)(6,n.nt)],se.prototype,"aux1",void 0),(0,s.Cg)([(0,o.C5)(7,n.nt)],se.prototype,"aux2",void 0),(0,s.Cg)([(0,o.C5)(8,n.ZY)],se.prototype,"aux3",void 0),(0,s.Cg)([(0,o.C5)(9,n.ZY)],se.prototype,"aux4",void 0),(0,s.Cg)([(0,o.C5)(10,n.ZY)],se.prototype,"zoomRange",void 0);class oe extends Nt{constructor(){super(...arguments),this.type="ComplexOutlineFillShader"}vertex(t,e){const{aux1:i,aux2:s,aux3:o,aux4:r}=t,a={...t,width:i,height:s,offset:o,scale:r.multiply(ie)},l=Ht(this,{...t,halfWidth:i,referenceHalfWidth:s,offset:o,normal:r.subtract(w.v9).multiply(ie)}),u=et(this,a),p=(0,n.MM)(l.isOutline,new n.nt(.5));return{...l,...u,...this.maybeRunHittest(t,e,p)}}fragment(t){const{isOutline:e}=t,i=(0,n.MM)(e,new n.nt(.5)),s=ct(t,this.antialiasingControls.blur),o=it(this,t),r=(0,n.Tk)(i,s,o),a=(0,n.Tk)(i,new n.nt(1/255),new n.nt(0));return this.getFragmentOutput(r,t,a)}hittest(t,e,i){return(0,n.Tk)(i,W(this.hittestRequest),G(this,t,e))}}(0,s.Cg)([(0,o.Pi)(C)],oe.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(S)],oe.prototype,"localTileOffset",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(se)),(0,s.Qj)(1,(0,o.hF)(v))],oe.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends te{}))],oe.prototype,"fragment",null);var ne=i(4037);class re extends ${}(0,s.Cg)([(0,o.C5)(5,n.Zb)],re.prototype,"tlbr",void 0),(0,s.Cg)([(0,o.C5)(6,n.ZY)],re.prototype,"relativePosition",void 0),(0,s.Cg)([(0,o.C5)(7,n.nt)],re.prototype,"gradientMethod",void 0),(0,s.Cg)([(0,o.C5)(8,n.ZY)],re.prototype,"relativeGradientSize",void 0);class ae extends X{constructor(){super(...arguments),this.type="GradientFillShader"}vertex(t,e){const{tlbr:i,relativePosition:s,gradientMethod:o,relativeGradientSize:r}=t,a=(0,n.Tk)((0,d.K5)(t.bitset,ne.Q.isAbsolute),this.view.displayZoomFactor,new n.nt(1));return{...super.vertex(t,e),tlbr:i,relativePosition:s,gradientMethod:o,gradientSize:r.multiply(a),isDiscrete:(0,d.mh)(t.bitset,ne.Q.isDiscrete)}}fragment(t){const{tlbr:e,relativePosition:i,gradientMethod:s,gradientSize:o,isDiscrete:r}=t,a=(0,n.Tk)((0,n.MM)(r,new n.nt(.5)),o.subtract(1),new n.ZY(0)),l=(0,n.j1)([(0,n.LC)(s,new n.nt(ne.m.rectangular)),()=>{const t=(0,n.tn)(i).add(a).divide(o);return(0,d.zb)((0,n.T9)(t.x,t.y))}],[(0,n.LC)(s,new n.nt(ne.m.circular)),(0,d.zb)((0,n.RZ)((0,n.Om)(i,i)).add(a.x).divide(o.x))],[!0,(0,d.zb)(i.x.add(a.x).divide(o.x))]),u=new n.ZY((0,n.qE)(l,new n.nt(0),new n.nt(1)),.5),p=(0,n.jh)(e.xy,e.zw,u).divide(this.mosaicInfo.size),c=(0,n.US)(this.mosaicInfo.texture,p),h=t.color.a;return this.getFragmentOutput(c.multiply(h),t,new n.nt(0))}}(0,s.Cg)([(0,o.Pi)(C)],ae.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(re)),(0,s.Qj)(1,(0,o.hF)(v))],ae.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],ae.prototype,"fragment",null);var le=i(76460),ue=i(30726),pe=i(50076);class ce{constructor(t,e,i,s){this.dataType=t,this.samplingMode=e,this.pixelFormat=i,this.internalFormat=s}}new ce(It.ld.HALF_FLOAT,9728,6408,6408);class de{destroy(){this._accumulateFramebuffer=(0,ue.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,ue.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(t){if(null==this._qualityProfile){const e=function(t,e){const{textureFloatLinear:i,colorBufferFloat:s}=t.capabilities,o=s?.textureFloat,n=s?.textureHalfFloat,r=s?.floatBlend,a=t.driverTest.floatBufferBlend.result;if(!o&&!n)throw new pe.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(r&&a||n))throw new pe.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(a?"":" This device claims support for EXT_float_blend, but does not actually support it."));const l=o&&r&&a,u=n,p=i,c=!!s?.R32F,d=!!s?.R16F;if(l&&p)return p||e.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new ce(It.ld.FLOAT,p?9729:9728,c?6403:6408,c?It.H0.R32F:6408);if(u)return new ce(It.ld.HALF_FLOAT,9729,d?6403:6408,d?It.H0.R16F:6408);throw new pe.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(t,le.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...e,defines:{usesHalfFloatPrecision:e.dataType!==It.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(t,e,i){if(null==this._accumulateFramebuffer){const{dataType:s,samplingMode:o,pixelFormat:n,internalFormat:r}=this.loadQualityProfile(t),a=new Ut.R(e,i);a.pixelFormat=n,a.internalFormat=r,a.dataType=s,a.samplingMode=o,a.wrapMode=33071;const l=new Bt.q(It.iE.DEPTH24_STENCIL8,e,i);this._accumulateFramebuffer=new kt.H(t,a,l)}else{const{width:t,height:s}=this._accumulateFramebuffer;t===e&&s===i||this._accumulateFramebuffer.resize(e,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(t,e,i){if(null==this._resolveGradientTexture){const e=new Ut.R;e.wrapMode=33071,this._resolveGradientTexture=new Lt.g(t,e),this._prevGradientHash=null}return this._prevGradientHash!==e&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=e),this._resolveGradientTexture}}function he(t){return t?.25:1}class ye extends g{}(0,s.Cg)([(0,o.C5)(5,n.ZY)],ye.prototype,"offset",void 0);class me extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.nt)],me.prototype,"radius",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],me.prototype,"isFieldActive",void 0);class fe extends x{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,s=t.offset,o=i.multiply(this.storage.getVVData(t.id).x).add(new n.nt(1).subtract(i)),r=this.view.displayViewScreenMat3.multiply(new n.eB(t.pos,1)).add(this.view.displayViewMat3.multiply(new n.eB(s,0)).multiply(e)),a=this.clip(t.id);return{glPosition:new n.Zb(r.xy,a,1),offset:s,fieldValue:o,color:new n.Zb(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,s=(0,n.Bw)(e),o=(0,n.PM)(s,new n.nt(1)),r=new n.nt(1).subtract(s.multiply(s)),a=r.multiply(r),l=o.multiply(a).multiply(i).multiply(new n.nt(he(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new n.Zb(l),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view;return function(t,e,i){return(0,n.Io)(t,i).subtract(e)}(e.multiply(i).multiply(new n.eB(t.pos,1)).xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,s.Cg)([o.E8],fe.prototype,"usesHalfFloatPrecision",void 0),(0,s.Cg)([(0,o.Pi)(me)],fe.prototype,"kernelControls",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(ye))],fe.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],fe.prototype,"fragment",null);class ge extends o.ZA{}(0,s.Cg)([(0,o.C5)(0,n.ZY)],ge.prototype,"position",void 0);class ve extends o.HS{}class be extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.z7)],be.prototype,"texture",void 0),(0,s.Cg)([(0,o.Pi)(n.ZY)],be.prototype,"minAndInvRange",void 0),(0,s.Cg)([(0,o.Pi)(n.nt)],be.prototype,"normalization",void 0);class xe extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.z7)],xe.prototype,"texture",void 0);class we extends o.A{constructor(){super(...arguments),this.type="HeatmapResolveShader",this.usesHalfFloatPrecision=!1}vertex(t){return{glPosition:new n.Zb(t.position.multiply(2).subtract(1),1,1),uv:t.position}}fragment(t){const{accumulatedDensity:e,gradient:i}=this;let s=(0,n.US)(e.texture,t.uv).r.divide(new n.nt(he(this.usesHalfFloatPrecision)));s=s.multiply(e.normalization),s=s.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const r=(0,n.US)(i.texture,new n.ZY(s,.5)),a=new o.mm;return a.fragColor=new n.Zb(r.rgb.multiply(r.a),r.a),a}}(0,s.Cg)([o.E8],we.prototype,"usesHalfFloatPrecision",void 0),(0,s.Cg)([(0,o.Pi)(be)],we.prototype,"accumulatedDensity",void 0),(0,s.Cg)([(0,o.Pi)(xe)],we.prototype,"gradient",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(ge))],we.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(ve))],we.prototype,"fragment",null);function Se(t){return t.key.level+1}const Ce={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Se,compare:518,mask:255,op:{fail:7680,zFail:7680,zPass:7681}}}},ze={...Ce,stencil:!1},Ve={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function Pe(t,e){const{referenceScale:i,radius:s}=t.uniforms;return s*(0!==i?i/e.scale:1)}const Me=360/254;class Te extends g{}(0,s.Cg)([(0,o.C5)(3,n.Zb)],Te.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(4,n.ZY)],Te.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(5,n.ZY)],Te.prototype,"textureUV",void 0),(0,s.Cg)([(0,o.C5)(6,n.ZY)],Te.prototype,"fontAndReferenceSize",void 0),(0,s.Cg)([(0,o.C5)(7,n.Zb)],Te.prototype,"outlineColor",void 0),(0,s.Cg)([(0,o.C5)(8,n.Zb)],Te.prototype,"haloColor",void 0),(0,s.Cg)([(0,o.C5)(9,n.ZY)],Te.prototype,"outlineAndHaloSize",void 0),(0,s.Cg)([(0,o.C5)(10,n.ZY)],Te.prototype,"zoomRange",void 0),(0,s.Cg)([(0,o.C5)(11,n.nt)],Te.prototype,"clipAngle",void 0),(0,s.Cg)([(0,o.C5)(12,n.Zb)],Te.prototype,"referenceSymbol",void 0),(0,s.Cg)([(0,o.C5)(15,n.nt)],Te.prototype,"visibility",void 0);class Ae extends o.Y7{}(0,s.Cg)([(0,o.C5)(13,n.ZY)],Ae.prototype,"offsetNextVertex1",void 0),(0,s.Cg)([(0,o.C5)(14,n.ZY)],Ae.prototype,"offsetNextVertex2",void 0);class _e extends x{constructor(){super(...arguments),this.type="TextShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=0,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(t,e){const{clipAngle:i,zoomRange:s,visibility:o}=t,r=i.multiply(Me),a=(0,n.tn)(this.view.rotation.subtract(r)),l=(0,n.jk)(new n.nt(360).subtract(a),a);let u=new n.nt(0);const c=(0,n.RI)(this.view.currentZoom.multiply(p.fq)).divide(p.fq),d=s.x,h=s.y,y=new n.nt(1).subtract((0,n.PM)(d,c)).multiply(2),m=(0,n.PM)(new n.nt(90),l).multiply(2),f=new n.nt(2).multiply(new n.nt(1).subtract((0,n.PM)(c,h)));return u=u.add(e.multiply(y)),u=u.add(e.multiply(m)),u=u.add(f),o&&(u=u.add(o)),u}vertex(t,e){const i=(0,d.mh)(t.bitset,w.bg),s=new n.nt(1).subtract(i);let o=t.fontAndReferenceSize[0];const r=t.fontAndReferenceSize[1];let a=o.divide(w.au);const l=1===this.textRenderPassType?t.outlineColor:2===this.textRenderPassType?t.haloColor:this._getVertexColor(t),u=this.view.displayViewScreenMat3.multiply(new n.eB(t.pos,1));let c=t.offset,h=new n.nt(1),y=n.U.identity(),m=new n.ZY(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,s=e.z,o=this._unpackDirection(e.w),n=R(this,t.id,s).divide(2),r=o.multiply(n.add(p.C2));m=i.add(r),c=c.add(m)}else h=R(this,t.id,r).divide(r),o=o.multiply(h),a=a.multiply(h),c=c.multiply(h),y=I(this,t.id),c=y.multiply(new n.eB(c,0)).xy;const f=(0,d.mh)(t.bitset,w.ti),g=this._getViewRotationMatrix(f).multiply(new n.eB(c,0));let v=this.isLabel?this.clipLabel(t,f):this.clip(t.id,t.zoomRange);v=this.isBackgroundPass?v.add(s.multiply(2)):v.add(i.multiply(2));let b=new n.nt(0);if(1===this.textRenderPassType&&(v=v.add((0,n.Tk)((0,n.LC)(t.outlineAndHaloSize.x,new n.nt(0)),new n.nt(2),new n.nt(0))),b=new n.nt(t.outlineAndHaloSize.x).divide(a).divide(w.$w)),2===this.textRenderPassType){const e=t.outlineAndHaloSize.x,i=new n.nt(t.outlineAndHaloSize.y);v=v.add((0,n.Tk)((0,n.LC)(i,new n.nt(0)),new n.nt(2),new n.nt(0))),b=i.add(e).divide(a).divide(w.$w)}const x=this.isLabel?(0,n.MM)(v,new n.nt(1)):new n.x(!1);return{glPosition:new n.Zb(u.xy.add(g.xy),v,1),color:l,size:a,textureUV:t.textureUV.divide(this.mosaicInfo.size),antialiasingWidth:new n.nt(.105*w.au).divide(o).divide(this.view.pixelRatio),outlineDistanceOffset:b,...this.maybeRunHittest(t,e,{vvSizeAdjustment:h,vvRotation:y,labelOffset:m,labelClipped:x})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,s=new n.nt(1).subtract(t);return e.multiply(t).add(i.multiply(s))}fragment(t){const e=new n.nt(2/8),i=new n.nt(1).subtract(e),s=(0,n.US)(this.mosaicInfo.texture,t.textureUV).a;let o=i.subtract(t.outlineDistanceOffset);this.highlight&&(o=o.divide(2));const r=t.antialiasingWidth,a=(0,n.TF)(o.subtract(r),o.add(r),s);return this.getFragmentOutput(t.color.multiply(a),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:s,labelOffset:o,labelClipped:r}){let a,l,u;this.isLabel?(a=new n.eB(t.offset.add(o),0),l=new n.eB(e.offsetNextVertex1.add(o),0),u=new n.eB(e.offsetNextVertex2.add(o),0)):(a=s.multiply(new n.eB(t.offset.multiply(i),0)),l=s.multiply(new n.eB(e.offsetNextVertex1.multiply(i),0)),u=s.multiply(new n.eB(e.offsetNextVertex2.multiply(i),0)));const{viewMat3:p,tileMat3:c}=this.view,d=p.multiply(c).multiply(new n.eB(t.pos,1)),h=d.add(c.multiply(a)).xy,y=d.add(c.multiply(l)).xy,m=d.add(c.multiply(u)).xy,f=K(this.hittestRequest.position,h.xy,y.xy,m.xy);return this.isLabel?(0,n.Tk)(r,W(this.hittestRequest),f):f}_unpackDirection(t){const e=new n.Ai(t),i=(0,n.Sj)(e,new n.Ai(2)),s=(0,n.nf)(e,new n.Ai(3));return new n.ZY(new n.nt(i).subtract(1),new n.nt(s).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new n.x(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),s=this.visualVariableOpacity.getOpacity(i);e=e.multiply(s)}return e}}(0,s.Cg)([(0,o.uK)(z)],_e.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],_e.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,o.uK)(P)],_e.prototype,"visualVariableRotation",void 0),(0,s.Cg)([(0,o.uK)(M)],_e.prototype,"visualVariableSizeMinMaxValue",void 0),(0,s.Cg)([(0,o.uK)(T)],_e.prototype,"visualVariableSizeScaleStops",void 0),(0,s.Cg)([(0,o.uK)(A)],_e.prototype,"visualVariableSizeStops",void 0),(0,s.Cg)([(0,o.uK)(_)],_e.prototype,"visualVariableSizeUnitValue",void 0),(0,s.Cg)([(0,o.Pi)(C)],_e.prototype,"mosaicInfo",void 0),(0,s.Cg)([o.E8],_e.prototype,"textRenderPassType",void 0),(0,s.Cg)([o.E8],_e.prototype,"isBackgroundPass",void 0),(0,s.Cg)([o.E8],_e.prototype,"isLabel",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Te)),(0,s.Qj)(1,(0,o.hF)(Ae))],_e.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],_e.prototype,"fragment",null);var Fe=i(89657);class Re extends nt{}(0,s.Cg)([(0,o.C5)(9,n.nt)],Re.prototype,"accumulatedDistance",void 0),(0,s.Cg)([(0,o.C5)(10,n.nt)],Re.prototype,"totalLength",void 0),(0,s.Cg)([(0,o.C5)(11,n.nt)],Re.prototype,"gradientSize",void 0),(0,s.Cg)([(0,o.C5)(12,n.ZY)],Re.prototype,"segmentDirection",void 0),(0,s.Cg)([(0,o.C5)(13,n.Zb)],Re.prototype,"tlbr",void 0);class De extends o.k2{}(0,s.Cg)([(0,o.Pi)(n.nt)],De.prototype,"isColorPass",void 0);class Oe extends dt{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(t,e){const{totalLength:i,gradientSize:s,segmentDirection:o,tlbr:r}=t,a=pt(this,t),l=(0,d.mh)(t.bitset,Fe.Q.isAlongLine),u=i.divide(this.view.displayZoomFactor),p=(0,n.Tk)((0,d.K5)(t.bitset,Fe.Q.isAbsoluteSize),(()=>{const t=(0,n.Tk)((0,n.MM)(l,new n.nt(.5)),u,a.halfWidth);return s.divide(t)}),s),c=t.accumulatedDistance.add((0,n.Om)(o,a.scaledOffset).divide(u)),h=r.divide(this.mosaicInfo.size.xyxy);return{...a,tlbr:h,relativePositionAlongLine:c,relativeGradientSize:p,isAlongLine:(0,d.mh)(t.bitset,Fe.Q.isAlongLine),isDiscrete:(0,d.mh)(t.bitset,Fe.Q.isDiscrete),...this.maybeRunHittest(t,e,a.halfWidth)}}fragment(t){const{isAlongLine:e,isDiscrete:i,relativePositionAlongLine:s,relativeGradientSize:o,normal:r,tlbr:a}=t,l=ut(t,this.antialiasingControls.blur),u=function(t){return(0,n.PM)(new n.nt(0),t).multiply(2).subtract(1)}(r.y).multiply((0,n.jk)((0,n.Bw)(r),new n.nt(1))),p=new n.nt(.5).multiply(u).add(new n.nt(.5)),h=(0,n.Tk)((0,n.MM)(e,new n.nt(.5)),s,p),y=(0,n.Tk)((0,n.MM)(i,new n.nt(.5)),o.subtract(1),new n.nt(0)),m=(0,d.zb)(h.add(y).divide(o)),f=(0,n.jh)(a.xy,a.zw,new n.ZY((0,n.qE)(m,new n.nt(0),new n.nt(1)),.5)),g=(0,n.US)(this.mosaicInfo.texture,f),v=t.opacity.multiply(l),b=this.getFragmentOutput(g.multiply(v),t),x=(0,n.PM)(new n.nt(.5),this.technique.isColorPass).multiply((0,c.A)("gradient-depth-epsilon")),w=(0,n.PM)(new n.nt(0),r.y).multiply(new n.nt((0,c.A)("gradient-depth-bias")).subtract(x));return b.glFragDepth=(0,n.qE)((0,n.Bw)(r).add(w),new n.nt(0),new n.nt(1)),b}}(0,s.Cg)([(0,o.Pi)(C)],Oe.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,o.Pi)(De)],Oe.prototype,"technique",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Re)),(0,s.Qj)(1,(0,o.hF)(v))],Oe.prototype,"vertex",null);var Ie=i(76931),ke=i(77555);class Ze extends nt{}(0,s.Cg)([(0,o.C5)(9,n.nt)],Ze.prototype,"accumulatedDistance",void 0),(0,s.Cg)([(0,o.C5)(10,n.ZY)],Ze.prototype,"segmentDirection",void 0),(0,s.Cg)([(0,o.C5)(11,n.nt)],Ze.prototype,"offsetAlongLine",void 0),(0,s.Cg)([(0,o.C5)(12,n.nt)],Ze.prototype,"capType",void 0),(0,s.Cg)([(0,o.C5)(13,n.Zb)],Ze.prototype,"tlbr",void 0);class Be extends dt{constructor(){super(...arguments),this.type="TexturedLineShader"}_getDistanceRatio(t,e){const i=(0,d.mh)(t.bitset,w.kx);return i.multiply((0,n.T9)(e,new n.nt(.25)).multiply(new n.nt(2))).add(new n.nt(1).subtract(i).multiply((0,Ie.Lz)(1)))}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:s,patternSize:o,accumulatedDistance:r,offsetAlongLine:a,dashToPx:l,capType:u}=t,p=o.x.divide(ke.zA).multiply(l),c=(0,n.jc)(r.add(a).divide(p)),h=(0,n.jh)(s.xy,s.zw,new n.ZY(c,.5)),y=(0,d.Rj)((0,n.US)(this.mosaicInfo.texture,h)).multiply(2).subtract(1).multiply(ke.gR).multiply(l),m=i.y.multiply(e),f=(0,n.j1)([(0,n.LC)(u,new n.nt(1)),y.subtract(e)],[(0,n.LC)(u,new n.nt(2)),(0,n.RZ)((0,n.n7)((0,n.T9)(y,new n.nt(0)),new n.nt(2)).add(m.multiply(m))).subtract(e)],[!0,y]),g=(0,n.qE)(new n.nt(.25).subtract(f),new n.nt(0),new n.nt(1));return new n.Zb(g)}_getPatternColor(t){const{halfWidth:e,normal:i,color:s,accumulatedDistance:o,patternSize:r,sampleAlphaOnly:a,tlbr:l}=t,u=r.y.multiply(new n.nt(2).multiply(e).divide(r.x)),p=(0,n.jc)(o.divide(u)),c=new n.nt(.5).multiply(i.y).add(new n.nt(.5)),d=(0,n.jh)(l.xy,l.zw,new n.ZY(c,p));let h=(0,n.US)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(h=(0,n.Tk)((0,n.MM)(a,new n.nt(.5)),new n.Zb(s.a),s)),h}vertex(t,e){const{segmentDirection:i,tlbr:s,bitset:o}=t,r=pt(this,t),a=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,n.Om)(i,r.scaledOffset)),l=new n.ZY(s.z.subtract(s.x),s.w.subtract(s.y)),u=s.divide(this.mosaicInfo.size.xyxy),p=(0,d.mh)(o,w.b5),c=(0,d.mh)(o,w.cn),h=(0,n.Tk)((0,n.MM)(p,new n.nt(.5)),this._getDistanceRatio(t,r.scaledHalfWidth),new n.nt(1));return{...r,tlbr:u,patternSize:l,accumulatedDistance:a,isSDF:p,sampleAlphaOnly:c,dashToPx:h,offsetAlongLine:t.offsetAlongLine,capType:t.capType,...this.maybeRunHittest(t,e,r.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:s}=t,o=ut(t,this.antialiasingControls.blur),r=(0,n.Tk)((0,n.MM)(s,new n.nt(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),a=e.multiply(i).multiply(o).multiply(r);return this.getFragmentOutput(a,t)}}(0,s.Cg)([(0,o.Pi)(C)],Be.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Ze)),(0,s.Qj)(1,(0,o.hF)(v))],Be.prototype,"vertex",null);class Le extends g{}(0,s.Cg)([(0,o.C5)(3,n.Zb)],Le.prototype,"color",void 0),(0,s.Cg)([(0,o.C5)(4,n.Zb)],Le.prototype,"outlineColor",void 0),(0,s.Cg)([(0,o.C5)(5,n.ZY)],Le.prototype,"offset",void 0),(0,s.Cg)([(0,o.C5)(6,n.ZY)],Le.prototype,"textureUV",void 0),(0,s.Cg)([(0,o.C5)(7,n.Zb)],Le.prototype,"sizing",void 0),(0,s.Cg)([(0,o.C5)(8,n.nt)],Le.prototype,"placementAngle",void 0),(0,s.Cg)([(0,o.C5)(9,n.nt)],Le.prototype,"sdfDecodeCoeff",void 0),(0,s.Cg)([(0,o.C5)(10,n.ZY)],Le.prototype,"zoomRange",void 0);class Ue extends o.Y7{}(0,s.Cg)([(0,o.C5)(11,n.ZY)],Ue.prototype,"offsetNextVertex1",void 0),(0,s.Cg)([(0,o.C5)(12,n.ZY)],Ue.prototype,"offsetNextVertex2",void 0),(0,s.Cg)([(0,o.C5)(13,n.ZY)],Ue.prototype,"textureUVNextVertex1",void 0),(0,s.Cg)([(0,o.C5)(14,n.ZY)],Ue.prototype,"textureUVNextVertex2",void 0);function je(t,e,i,s){return e.multiply(t.x).add(i.multiply(t.y)).add(s.multiply(t.z))}function Ee(t){return t.multiply(t).divide(128)}class Ye extends x{constructor(){super(...arguments),this.type="MarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,e){const i=Ee(t.sizing.x),s=Ee(t.sizing.y),o=Ee(t.sizing.z),r=t.placementAngle,a=(0,d.mh)(t.bitset,u.c.bitset.isSDF),l=(0,d.mh)(t.bitset,u.c.bitset.isMapAligned),p=(0,d.mh)(t.bitset,u.c.bitset.scaleSymbolsProportionally),c=(0,d.K5)(t.bitset,u.c.bitset.colorLocked),h=O(this,t.id),y=D(this,t.id,t.color,c).multiply(h),m=this.view.displayViewScreenMat3.multiply(new n.eB(t.pos.xy,1)),f=R(this,t.id,o).divide(o),g=i.multiply(f),v=t.offset.xy.multiply(f);let b=s.multiply(p.multiply(f.subtract(1)).add(1));b=(0,n.jk)(b,(0,n.T9)(g.subtract(.99),new n.nt(0)));const x=(0,n.T9)(b,new n.nt(1)),S=(0,n.jk)(b,new n.nt(1)),C=n.U.fromRotation(r.multiply(w.rp)),z=I(this,t.id),V=this._getViewRotationMatrix(l).multiply(z).multiply(C).multiply(new n.eB(v.xy,0)),P=this.clip(t.id,t.zoomRange),M=new n.Zb(m.xy.add(V.xy),P,1),T=t.textureUV.divide(this.mosaicInfo.size),A=t.outlineColor.multiply(S),_=(0,d.mh)(t.bitset,u.c.bitset.overrideOutlineColor),F=t.sdfDecodeCoeff.multiply(g);return{glPosition:M,color:y,textureUV:T,outlineColor:A,outlineSize:x,distanceToPx:F,isSDF:a,overrideOutlineColor:_,...this.maybeRunHittest(t,e,{pos:t.pos,size:g,sizeCorrection:f,isMapAligned:l,vvRotationMat3:z,placementMat3:C,outlineSize:x,distanceToPx:F,isSDF:a})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,n.Tk)((0,n.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,s=new n.nt(1).subtract(t);return e.multiply(t).add(i.multiply(s))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,s=new n.nt(1).subtract(t);return e.multiply(t).add(i.multiply(s))}_getColor(t,e){return(0,n.Tk)((0,n.LC)(e.isSDF,new n.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,n.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,n.US)(this.mosaicInfo.texture,t),s=new n.nt(.5).subtract((0,d.Rj)(i)).multiply(e.distanceToPx).multiply(w.V5),o=(0,n.qE)(new n.nt(.5).subtract(s),new n.nt(0),new n.nt(1)),r=e.color.multiply(o);let a=e.outlineSize;this.highlight&&(a=(0,n.T9)(a,e.overrideOutlineColor.multiply(4)));const l=a.multiply(.5),u=(0,n.tn)(s).subtract(l),p=(0,n.qE)(new n.nt(.5).subtract(u),new n.nt(0),new n.nt(1)),c=(0,n.jh)(e.outlineColor,e.color,e.overrideOutlineColor).multiply(p);return new n.nt(1).subtract(c.a).multiply(r).add(c)}_hittestSmallMarker(t,e,i){const{position:s,distance:o,smallSymbolDistance:r}=this.hittestRequest,a=o.subtract(r),{viewMat3:l,tileMat3:u}=this.view,p=l.multiply(u).multiply(new n.eB(i.pos,1)).xy,c=i.size.multiply(.5);return(0,n.Io)(p,s).subtract(c).add(a)}_hittestMarker(t,e,i){const{pos:s,sizeCorrection:o,isMapAligned:r}=i,a=new n.eB(t.offset.multiply(o),0),l=new n.eB(e.offsetNextVertex1.multiply(o),0),u=new n.eB(e.offsetNextVertex2.multiply(o),0),{viewMat3:p,tileMat3:c}=this.view,d=p.multiply(c).multiply(new n.eB(s,1)),h=this._getViewScreenMatrix(r).multiply(i.vvRotationMat3).multiply(i.placementMat3),y=d.add(h.multiply(a)).xy,m=d.add(h.multiply(l)).xy,f=d.add(h.multiply(u)).xy,g=this.hittestRequest.position,v=this.hittestRequest.distance,b=K(g,y,m,f);return(0,n.Tk)((0,n.MM)(b,v),b,this._hittestSamples(y,m,f,t,e,i))}_hittestSamples(t,e,i,s,o,r){const{outlineSize:a,isSDF:l,distanceToPx:u}=r,p=this.hittestRequest.position,c=this.hittestRequest.distance,d=H(p.add(new n.ZY((0,n.ze)(c),(0,n.ze)(c))),t,e,i),h=H(p.add(new n.ZY(0,(0,n.ze)(c))),t,e,i),y=H(p.add(new n.ZY(c,(0,n.ze)(c))),t,e,i),m=H(p.add(new n.ZY((0,n.ze)(c),0)),t,e,i),f=H(p,t,e,i),g=H(p.add(new n.ZY(c,0)),t,e,i),v=H(p.add(new n.ZY((0,n.ze)(c),c)),t,e,i),b=H(p.add(new n.ZY(0,c)),t,e,i),x=H(p.add(new n.ZY(c,c)),t,e,i),w=s.textureUV.divide(this.mosaicInfo.size),S=o.textureUVNextVertex1.divide(this.mosaicInfo.size),C=o.textureUVNextVertex2.divide(this.mosaicInfo.size),z={color:new n.Zb(1),outlineColor:new n.Zb(1),overrideOutlineColor:new n.nt(1),outlineSize:a,distanceToPx:u,isSDF:l};let V=new n.nt(0);return V=V.add(q(d).multiply(this._getColor(je(d,w,S,C),z).a)),V=V.add(q(h).multiply(this._getColor(je(h,w,S,C),z).a)),V=V.add(q(y).multiply(this._getColor(je(y,w,S,C),z).a)),V=V.add(q(m).multiply(this._getColor(je(m,w,S,C),z).a)),V=V.add(q(f).multiply(this._getColor(je(f,w,S,C),z).a)),V=V.add(q(g).multiply(this._getColor(je(g,w,S,C),z).a)),V=V.add(q(v).multiply(this._getColor(je(v,w,S,C),z).a)),V=V.add(q(b).multiply(this._getColor(je(b,w,S,C),z).a)),V=V.add(q(x).multiply(this._getColor(je(x,w,S,C),z).a)),(0,n.PM)(V,new n.nt(.05)).multiply(W(this.hittestRequest))}}(0,s.Cg)([(0,o.uK)(z)],Ye.prototype,"visualVariableColor",void 0),(0,s.Cg)([(0,o.uK)(V)],Ye.prototype,"visualVariableOpacity",void 0),(0,s.Cg)([(0,o.uK)(P)],Ye.prototype,"visualVariableRotation",void 0),(0,s.Cg)([(0,o.uK)(M)],Ye.prototype,"visualVariableSizeMinMaxValue",void 0),(0,s.Cg)([(0,o.uK)(T)],Ye.prototype,"visualVariableSizeScaleStops",void 0),(0,s.Cg)([(0,o.uK)(A)],Ye.prototype,"visualVariableSizeStops",void 0),(0,s.Cg)([(0,o.uK)(_)],Ye.prototype,"visualVariableSizeUnitValue",void 0),(0,s.Cg)([(0,o.Pi)(C)],Ye.prototype,"mosaicInfo",void 0),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(Le)),(0,s.Qj)(1,(0,o.hF)(Ue))],Ye.prototype,"vertex",null),(0,s.Cg)([(0,s.Qj)(0,(0,o.hF)(class extends b{}))],Ye.prototype,"fragment",null);var Qe=i(78492);class qe{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const e in this.locations)t.set(e,this.locations[e].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join(".");this._locationInfo={stringHash:e,locations:t,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[e,i]of this.locationsMap.entries())t.set("a_"+e,i);return t}getShaderKey(t,e,i){return`${Object.keys(t).map((e=>`${e}.${t[e]}`)).join(".")}.${Object.keys(i).filter((t=>i[t])).map((t=>`${t}_${i[t].toString()}`)).join(".")}.${Object.keys(e).filter((t=>this.optionPropertyKeys.has(t))).join(".")}`}getProgram(t,e,i,s){let o="",n="";for(const r in i)if(i[r]){const t="boolean"==typeof i[r]?`#define ${r}\n`:`#define ${r} ${i[r]}\n`;o+=t,n+=t}return o+=this.vertexShader,n+=this.fragmentShader,new Qe.K(o,n,this.renamedLocationsMap,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const e=[];for(const i in this.required){const t=this.required[i];e.push({uniformHydrated:null,shaderModulePath:i,uniformName:i,uniformType:t.type,uniformArrayElementType:He(t),uniformArrayLength:Ne(t)})}for(const i in t){const s=this.options[i];if(t[i])for(const t in s){const o=s[t];e.push({uniformHydrated:null,shaderModulePath:`${i}.${t}`,uniformName:t,uniformType:o.type,uniformArrayElementType:He(o),uniformArrayLength:Ne(o)})}}return e}}const He=t=>"array"===t.type?t.elementType?.type:void 0,Ne=t=>"array"===t.type?t.size:void 0;var Ke=i(35206);const We={hittestDist:n.nt,hittestPos:n.ZY},Ge={filterFlags:n.z7,animation:n.z7,visualVariableData:n.z7,dataDriven0:n.z7,dataDriven1:n.z7,dataDriven2:n.z7,gpgpu:n.z7,size:n.nt},$e={displayViewScreenMat3:n.U,displayViewMat3:n.U,displayMat3:n.U,viewMat3:n.U,tileMat3:n.U,displayZoomFactor:n.nt,requiredZoomFactor:n.nt,tileOffset:n.ZY,currentScale:n.nt,currentZoom:n.nt,metersPerSRUnit:n.nt};class Xe extends qe{constructor(){super(...arguments),this.vertexShader=(0,Ke.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,Ke.Q)("materials/pie/pie.frag"),this.required={...Ge,...$e,outlineWidth:n.nt,colors:n.My,defaultColor:n.Zb,othersColor:n.Zb,outlineColor:n.Zb,donutRatio:n.nt,sectorThreshold:n.nt},this.options={hittestUniforms:We,visualVariableSizeMinMaxValue:{minMaxValueAndSize:n.Zb},visualVariableSizeScaleStops:{sizes:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8},values:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8}},visualVariableSizeStops:{sizes:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8},values:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:n.nt},visualVariableOpacity:{opacities:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8},opacityValues:{...n.My.ofType(n.nt,8),type:"array",elementType:n.nt,size:8}},highlightUniforms:{highlightAll:n.nt,activeReasons:n.nt}},this.locations={pos:{index:0,type:n.ZY},id:{index:1,type:n.eB},bitset:{index:2,type:n.nt},offset:{index:3,type:n.ZY},texCoords:{index:4,type:n.ZY},size:{index:5,type:n.ZY},referenceSize:{index:6,type:n.nt},zoomRange:{index:7,type:n.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(t){this.required.colors={...n.My.ofType(n.Zb,t),type:"array",elementType:n.Zb,size:t}}}const Je={fill:new class extends St{constructor(){super(...arguments),this.type=9,this.shaders={geometry:new X}}render(t,e){const{painter:i}=t,s=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,s.uniforms),...(0,Ct.QA)(t,e.target)},defines:(0,Ct.vT)(t),optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),i.setPipelineState((0,Ct.Qu)(t)),i.submitDraw(t,e)}},patternFill:new class extends St{constructor(){super(...arguments),this.type=20,this.shaders={geometry:new Xt}}render(t,e){const{context:i,painter:s}=t,o=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,Ct.Pr)(e.target)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},complexFill:new class extends St{constructor(){super(...arguments),this.type=6,this.shaders={geometry:new st}}render(t,e){const{context:i,painter:s}=t,o=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,Ct.Pr)(e.target)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},gradientFill:new class extends St{constructor(){super(...arguments),this.type=10,this.shaders={geometry:new ae},this.symbologyPlane=0}render(t,e){const{context:i,painter:s}=t,o=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},outlineFill:new class extends St{constructor(){super(...arguments),this.type=18,this.shaders={geometry:new Kt}}render(t,e){const{painter:i,pixelRatio:s}=t,o=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(s)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),i.setPipelineState((0,Ct.Qu)(t)),i.submitDraw(t,e)}},patternOutlineFill:new class extends St{constructor(){super(...arguments),this.type=21,this.shaders={geometry:new ee}}render(t,e){const{context:i,painter:s,pixelRatio:o}=t,n=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,n.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(o),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,Ct.Pr)(e.target)},defines:{...(0,Ct.vT)(t)},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},complexOutlineFill:new class extends St{constructor(){super(...arguments),this.type=7,this.shaders={geometry:new oe}}render(t,e){const{context:i,painter:s,pixelRatio:o}=t,n=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,n.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(o),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,Ct.Pr)(e.target)},defines:{...(0,Ct.vT)(t)},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},marker:new class extends St{constructor(){super(...arguments),this.type=17,this.shaders={geometry:new Ye},this.symbologyPlane=2}render(t,e){const{context:i,painter:s}=t,o=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey,!0)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},pieChart:new class extends St{constructor(){super(...arguments),this.type=22,this.shaders={geometry:new Xe},this.symbologyPlane=2}render(t,e){const{painter:i}=t,{instance:s,target:o}=e,n=this.shaders.geometry,r=s.getInput(),a=r.uniforms.numberOfFields,l=(0,Ct.Eq)(t),u=(0,Ct.QA)(t,o),p=(0,Ct.vT)(t);n.setNumberOfFields(a),i.setShader({shader:n,uniforms:{...(0,Ct.r3)(t,e.target,r.uniforms.shader),...u.storage,...u.view,...u.highlight,highlightUniforms:u.highlight,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!r.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!r.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!r.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!r.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!r.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:u.highlight?1:0,...p,numberOfFields:a},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,Ct.Qu)(t)),i.submitDraw(t,e)}},line:new class extends St{constructor(){super(...arguments),this.type=15,this.shaders={geometry:new dt},this.symbologyPlane=1}render(t,e){const{painter:i,pixelRatio:s}=t,o=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,o.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(s)},defines:{...(0,Ct.vT)(t)},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),i.setPipelineState((0,Ct.Qu)(t)),i.submitDraw(t,e)}},texturedLine:new class extends St{constructor(){super(...arguments),this.type=25,this.shaders={geometry:new Be},this.symbologyPlane=1}render(t,e){const{context:i,painter:s,pixelRatio:o}=t,n=e.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,n.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(o),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...(0,Ct.vT)(t)},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e)}},gradientStroke:new class extends St{constructor(){super(...arguments),this.type=11,this.shaders={geometry:new Oe},this.symbologyPlane=1}_getShaderOptions(t,e,i){const{context:s,painter:o,pixelRatio:n}=t,r=e.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,r.uniforms),...(0,Ct.QA)(t,e.target),antialiasingControls:Yt(n),mosaicInfo:o.textureManager.getMosaicInfo(s,e.textureKey),technique:{isColorPass:i}},defines:{...(0,Ct.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)}}render(t,e){const{painter:i}=t;if((0,Ct.Eq)(t)||(0,Ct.dJ)(t)){const s=(0,Ct.Qu)(t);return i.setPipelineState(s),i.setShader(this._getShaderOptions(t,e,1)),void i.submitDraw(t,e)}t.context.setClearDepth(1),t.context.clear(256);i.setShader(this._getShaderOptions(t,e,0)),i.setPipelineState({color:!1,depth:{write:{zNear:0,zFar:1},test:513},stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:514,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}}),i.submitDraw(t,e);i.setShader(this._getShaderOptions(t,e,1)),i.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:515},stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:514,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}}),i.submitDraw(t,e)}},text:new class extends St{constructor(){super(...arguments),this.type=24,this.shaders={geometry:new _e},this.symbologyPlane=3}render(t,e){const{context:i,painter:s}=t,o=(0,Ct.vT)(t),n=e.instance.getInput(),r={shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,n.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...o,isBackgroundPass:!0,isLabel:!1,textRenderPassType:0},optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)};s.setShader(r),s.setPipelineState((0,Ct.Qu)(t)),s.submitDraw(t,e),s.setShader({...r,defines:{...o,isBackgroundPass:!1,isLabel:!1,textRenderPassType:2}}),s.submitDraw(t,e),s.setShader({...r,defines:{...o,isBackgroundPass:!1,isLabel:!1,textRenderPassType:1}}),s.submitDraw(t,e),s.setShader({...r,defines:{...o,isBackgroundPass:!1,isLabel:!1,textRenderPassType:0}}),s.submitDraw(t,e)}},label:new class extends St{constructor(){super(...arguments),this.type=14,this.shaders={geometry:new _e},this.drawPhase=14,this.symbologyPlane=3}render(t,e){const{context:i,painter:s}=t,o=(0,Ct.vT)(t),n={...(0,Ct.Qu)(t),stencil:{write:!1,test:{ref:()=>255,compare:516,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}},r=e.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...(0,Ct.r3)(t,e.target,r.uniforms),...(0,Ct.QA)(t,e.target),mosaicInfo:s.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...o,textRenderPassType:0,isBackgroundPass:!0,isLabel:!0},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,Ct.Eq)(t)};s.setPipelineState(n),s.setShader(a),s.submitDraw(t,e),s.setShader({...a,defines:{...o,textRenderPassType:2,isBackgroundPass:!1,isLabel:!0}}),s.submitDraw(t,e),s.setShader({...a,defines:{...o,textRenderPassType:0,isBackgroundPass:!1,isLabel:!0}}),s.submitDraw(t,e)}},heatmap:new class extends St{constructor(){super(...arguments),this.type=13,this.drawPhase=73,this.shaders={accumulate:new fe,resolve:new we},this._isBound=!1,this._resources=new Map}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t),this._prevFBO=null,this._unbind()}render(t,e){const{context:i,painter:s,state:o}=t,n=e.instance.getInput(),{isFieldActive:r}=n.uniforms,a=this._getOrCreateResourcesRecord(i),l=a.loadQualityProfile(i);(0,Ct.Eq)(t)||this._bind(t,a,n),s.setShader({shader:this.shaders.accumulate,uniforms:{...(0,Ct.QA)(t,e.target),kernelControls:{radius:Pe(n,o),isFieldActive:r?1:0}},defines:{...(0,Ct.vT)(t),...l.defines},optionalAttributes:{},useComputeBuffer:(0,Ct.Eq)(t)});const u=(0,Ct.Eq)(t)?ze:Ce;s.setPipelineState(u),s.submitDraw(t,e)}getStencilReference(t){return Se(t)}renderResolvePass(t,e){if((0,Ct.Eq)(t))return;const{context:i,painter:s}=t,o=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!o?.initialized)return;const{defines:n}=o.loadQualityProfile(i),{minDensity:r,maxDensity:a,radius:l}=e.getInput().uniforms,u=o.accumulateFramebuffer,p=o.resolveGradientTexture,c={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[r,1/(a-r)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:p}}},defines:n,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(p,9),s.setPipelineState(Ve),s.submitDrawMesh(i,c,s.quadMesh),this._unbind()}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new de,this._resources.set(t,e)),e}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(t,e,i){if(this._isBound)return;const{context:s,state:o,pixelRatio:n}=t,r=s.getBoundFramebufferObject(),a=s.getViewport();this._prevFBO=r,this._prevViewport=a;const{gradient:l,gradientHash:u}=i.uniforms;e.ensureResolveGradientTexture(s,u,l);const{width:p,height:c}=a,d=function(t,e){const i=e>1.5?.25:.5;return t<1/(2*i)?1:i}(Pe(i,o),n),h=p*d,y=c*d,m=e.ensureAccumulateFBO(s,h,y);s.blitFramebuffer(r,m,1024),s.bindFramebuffer(m),s.setViewport(0,0,m.width,m.height),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(16384),this._isBound=!0}},dotDensity:new class extends St{constructor(){super(...arguments),this.type=8,this.shaders={polygon:new Rt,point:new Tt,fill:new X},this._resources=new Map}render(t,e){(0,Ct.dJ)(t)||(0,Ct.Eq)(t)?this._renderPolygons(t,e):this._renderDotDensity(t,e)}_renderPolygons(t,e){const{painter:i}=t;i.setShader({shader:this.shaders.fill,uniforms:{...(0,Ct.QA)(t,e.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,Ct.vT)(t)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,Ct.Eq)(t)}),i.setPipelineState((0,Ct.Qu)(t)),i.submitDraw(t,e)}_renderDotDensity(t,e){const{context:i,painter:s,requiredLevel:o}=t,n=e.instance.getInput().uniforms,r=this._getOrCreateResourcesRecord(i),a=r.getDotDensityTextures(i,p.CQ,n.seed),l=1/2**(o-e.target.key.level),u=p.CQ,c=u*window.devicePixelRatio*u*window.devicePixelRatio,d=1/l*(1/l),h=n.dotScale?t.state.scale/n.dotScale:1,y=n.dotValue*h*d;s.setShader({shader:this.shaders.polygon,uniforms:{...(0,Ct.QA)(t,e.target),instance:{isActive:n.isActive,colors:n.colors,dotValue:Math.max(1,y)},draw:{dotTexture0:{unit:p.Cp,texture:a[0]},dotTexture1:{unit:p.vN,texture:a[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:c/(p.CQ*window.devicePixelRatio*p.CQ*window.devicePixelRatio)}},defines:{...(0,Ct.vT)(t),blending:n.blending},optionalAttributes:{},useComputeBuffer:!1});const m=i.getViewport();i.setViewport(0,0,p.CQ,p.CQ);const f=i.getBoundFramebufferObject(),g=r.getFBO(i);i.bindFramebuffer(g),i.setClearColor(0,0,0,0),i.clear(16384),s.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),s.updatePipelineState(i),s.submitDraw(t,e),i.bindFramebuffer(f),i.setViewport(m.x,m.y,m.width,m.height);const v=r.getFBO(i).colorTexture,b={shader:this.shaders.point,uniforms:{view:(0,Ct.L4)(t,e.target),instance:{dotSize:n.dotSize},draw:{locations:{unit:p.Cp,texture:v},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,Ct.vT)(t)},optionalAttributes:{},useComputeBuffer:!1};s.setPipelineState((0,Ct.Qu)(t)),s.submitDrawMesh(i,b,r.getDotDensityMesh(i))}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t)}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new Et,this._resources.set(t,e)),e}},animatedMarker:new class extends zt{constructor(){super(...arguments),this.type=2,this.symbologyPlane=2,this.shaders={geometry:new vt}}},animatedMarkerShift:new class extends zt{constructor(){super(...arguments),this.type=3,this.symbologyPlane=2,this.shaders={geometry:new vt}}},animatedFill:new class extends zt{constructor(){super(...arguments),this.type=0,this.symbologyPlane=0,this.shaders={geometry:new ot}}},animatedLine:new class extends zt{constructor(){super(...arguments),this.type=1,this.symbologyPlane=1,this.shaders={geometry:new yt}}}};function ti(){for(const t in Je)Je[t].startup()}function ei(t){for(const e in Je)Je[e].shutdown(t)}},60853:(t,e,i)=>{i.d(e,{K5:()=>c,Kt:()=>y,M8:()=>a,Rj:()=>m,_9:()=>r,i6:()=>d,mh:()=>p,nb:()=>u,p8:()=>v,tL:()=>l,xf:()=>f,yS:()=>h,zb:()=>g,zy:()=>b});var s=i(5095),o=i(60984),n=i(90113);function r(t){const e=(0,o.fV)(12.9898),i=(0,o.fV)(78.233),s=(0,o.fV)(43758.5453),n=(0,o.Om)(t,(0,o.Zc)(e,i)),r=(0,o.zi)(n,(0,o.fV)(3.14));return(0,o.jc)((0,o.F8)(r).multiply(s))}function a(t){return(0,o.LC)(t,(0,o.fV)(n.qM))}function l(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}function u(t){return t.multiply(2).subtract(1)}function p(t,e){const i=(0,o.fV)(2**e);return(0,o.zi)((0,o.RI)(t.divide(i)),(0,o.fV)(2))}function c(t,e){return(0,o.MM)(p(t,e),(0,o.fV)(.5))}function d(t,e){return p(t,e+s.U5)}function h(t,e){return p(t,e)}function y(t){const e=p(t.z,7),i=(0,o.fV)(1).subtract(e),s=t.xyz.subtract((0,o.eR)(0,0,(0,o.fV)(128)));return i.multiply(t).add(e.multiply(s))}function m(t){const e=(0,o.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,o.Om)(t,e)}function f(t){return(0,o.T9)((0,o.T9)((0,o.T9)(t.x,t.y),t.z),t.w)}function g(t){return new o.nt(1).subtract(t)}function v(t){return t.subtract(new o.nt(1))}function b(t,e){return t.subtract(new o.nt(e))}},13618:(t,e,i)=>{i.d(e,{Jz:()=>c,T9:()=>a,uH:()=>l});var s=i(18690),o=i(92045),n=i(18943),r=i(9685);function a(t,e){return{type:"simple",filters:e,capabilities:{maxTextureSize:(0,r.C)().maxTextureSize},bindings:p(t)}}function l(t,e){const i=(0,r.C)();return{type:"multi",target:"feature",keyField:o.EA,filters:e,capabilities:{maxTextureSize:i.maxTextureSize},bindings:{0:p(t.trackLines.renderer),1:p(t.latestObservations.renderer),2:p(t.previousObservations.renderer)}}}function u(t){switch(t){case"opacity":return 2;case"color":return 1;case"rotation":return 3;case"size":return 0;default:return null}}function p(t){if(!t)return[];switch(t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(t);case"dot-density":return function(t){const e=[];for(const i of t.attributes)e.push({binding:e.length,expression:i.valueExpression,field:i.field});return e}(t);case"pie-chart":return function(t){const e=c(t);let i=4;for(const s of t.attributes)e.push({binding:i++,expression:s.valueExpression,field:s.field});return e}(t);case"heatmap":return function({valueExpression:t,field:e}){return t||e?[{binding:0,expression:t,field:e}]:[]}(t)}}function c(t){return"visualVariables"in t&&t.visualVariables?.length?(0,n.R)(t.visualVariables).map((t=>function(t){switch(t.type){case"size":return function(t){return"$view.scale"===t.valueExpression?null:{binding:u(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression,valueRepresentation:t.valueRepresentation}}(t);case"color":case"opacity":return function(t){return{binding:u(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression}}(t);case"rotation":return function(t){return{binding:u(t.type),expression:t.valueExpression,field:t.field}}(t)}}(t))).filter(s.Ru):[]}},15698:(t,e,i)=>{i.d(e,{Dk:()=>b,K4:()=>w,j0:()=>x});i(81806);var s=i(76931),o=i(31633),n=i(3454),r=i(5095),a=i(81608),l=i(18943);const u=1.25,p=128,c=128;function d(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,a.r)(e,8),s=i.map((({value:t})=>t)),o=i.map((({color:t})=>(0,a.p)(t)));return{values:s,colors:o}}function h(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,a.r)(e,8);return{opacityValues:i.map((({value:t})=>t)),opacities:i.map((({opacity:t})=>t))}}function y(t){return{rotationType:"geographic"===t.rotationType?0:1}}function m(t){if(!t.stops?.length)return null;if(t.stops.some((t=>t.useMaxValue||t.useMinValue)))return(e,i)=>{const o=e.statisticsByLevel.get(i.key.level),n=t.stops.map((e=>({value:e.useMaxValue?o?.get(t.field)?.maxValue??0:e.useMinValue?o?.get(t.field)?.minValue??0:e.value,size:e.size?(0,s.Lz)(e.size):r.qM}))).sort(((t,e)=>t.value-e.value)),l=(0,a.r)(n,8);return{values:l.map((({value:t})=>t)),sizes:l.map((({size:t})=>t))}};const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,a.r)(e,8);return{values:i.map((({value:t})=>t)),sizes:i.map((({size:t})=>(0,s.Lz)(t)))}}function f(t){return e=>{const{state:i}=e;return{unitValueToPixelsRatio:(0,o.GA)(i.spatialReference)/n.j[t.valueUnit??"meters"]/i.resolution}}}function g(t,e){const i=e.length;if(t<e[0].value||1===i)return e[0].size;for(let s=1;s<i;s++)if(t<e[s].value){const i=(t-e[s-1].value)/(e[s].value-e[s-1].value);return e[s-1].size+i*(e[s].size-e[s-1].size)}return e[i-1].size}function v(t){const{minDataValue:e,maxDataValue:i,minSize:o,maxSize:n}=t;if("object"==typeof o&&"object"==typeof n)return(t,r)=>{const a=t.state.scale,l=(0,s.Lz)(g(a,o.stops)),u=(0,s.Lz)(g(a,n.stops));return{minMaxValueAndSize:[e,i,l,u]}};if("object"==typeof o||"object"==typeof n)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[e,i,(0,s.Lz)(o),(0,s.Lz)(n)]}}const b={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function x(t,e=c,i=u){if(t.visualVariableSizeMinMaxValue)return"function"==typeof t.visualVariableSizeMinMaxValue?p:Math.max(t.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,e);if(t.visualVariableSizeScaleStops){if("function"==typeof t.visualVariableSizeScaleStops)return p;const s=t.visualVariableSizeScaleStops.sizes;return Math.max(s[s.length-1]*i,e)}if(t.visualVariableSizeStops){if("function"==typeof t.visualVariableSizeStops)return p;const s=t.visualVariableSizeStops.sizes;return Math.max(s[s.length-1]*i,e)}return t.visualVariableSizeUnitValue?2*p:0}function w(t){const e={...b};if(!t||!("visualVariables"in t)||!t.visualVariables)return e;for(const i of(0,l.R)(t.visualVariables))switch(i.type){case"color":e.visualVariableColor=d(i);break;case"opacity":e.visualVariableOpacity=h(i);break;case"rotation":e.visualVariableRotation=y(i);break;case"size":switch(S(i)){case"field-stops":e.visualVariableSizeStops=m(i);break;case"scale-stops":"outline"===i.target?e.visualVariableSizeOutlineScaleStops=m(i):e.visualVariableSizeScaleStops=m(i);break;case"min-max":e.visualVariableSizeMinMaxValue=v(i);break;case"unit-value":e.visualVariableSizeUnitValue=f(i)}}return e}function S(t){return"number"==typeof t.minDataValue&&"number"==typeof t.maxDataValue&&null!=t.minSize&&null!=t.maxSize?"min-max":"$view.scale"===t?.valueExpression&&Array.isArray(t.stops)?"scale-stops":null==t.field&&"$view.scale"===t?.valueExpression||!(Array.isArray(t.stops)||"levels"in t&&t.levels)?null!=t.field||"$view.scale"!==t?.valueExpression?"unit-value":null:"field-stops"}},81608:(t,e,i)=>{function s(t,e){const i=t.slice(0,e),s=e-i.length;for(let o=0;o<s;o++){const t=i[i.length-1];i.push(t)}return i}function o(t){if(!t)return[0,0,0,0];const{r:e,g:i,b:s,a:o}=t;return[e*(o/255),i*(o/255),s*(o/255),o]}i.d(e,{p:()=>o,r:()=>s})},3289:(t,e,i)=>{i.d(e,{Dr:()=>M,EM:()=>V,Gn:()=>g,IQ:()=>A,Jk:()=>p,KK:()=>h,NZ:()=>z,TY:()=>l,Yg:()=>f,Zi:()=>y,gF:()=>d,mp:()=>w,oF:()=>b});var s=i(401),o=i(13442),n=i(59286),r=i(15698),a=i(74075);function l(t){return t.minScale||t.maxScale?{minScale:t.minScale??0,maxScale:t.maxScale??0}:null}function u(t){if(null==t)return null;if(Array.isArray(t)){const[e,i,s,o]=t;return[e,i,s,255*o]}return"string"==typeof t?t:{...t,defaultValue:u(t?.defaultValue)}}async function p(t,e){const{cimResourceManager:i,cimAnalyzer:o,scaleExpression:n}=e.schemaOptions;await Promise.all(s.wp.fetchResources(t.symbol,i,[]));const r=o.analyzeSymbolReference(t,!1),a={scaleInfo:l(t),scaleExpression:n},u=[];for(const s of r)switch(s.type){case"marker":u.push(...c(s,e,a));break;case"fill":u.push(...v(s,e,a));break;case"outlineFill":u.push(...m(s,e,a));break;case"gradientFill":u.push(...x(s,e,a));break;case"line":u.push(...S(s,e,a));break;case"gradientStroke":u.push(...P(s,e,a));break;case"text":u.push(...T(s,e,a))}return u}function c(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:a}=o,l=t.isOutline?{...r.Dk,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue,visualVariableRotation:s.visualVariableRotation};if(t.animationParams){const{hasShiftAnimation:e}=t.animationParams.params,s=e?n.YS.animatedMarkerShift:n.YS.animatedMarker;return d(a.ensureInstance(s,{uniforms:l,optionalAttributes:{zoomRange:!0,value1Position2Value2:t.animationParams.params.hasShiftAnimation,lineLength:e}}),t,r.Dk,i)}return y(a.ensureInstance(n.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,s,i)}function d(t,e,i,s){return e.animationParams?[t.createMeshInfo({pixelDimensions:e.pixelDimensions,texelDimensions:e.texelDimensions,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,sprite:(0,a.xi)(e),animations:e.animationParams,scaleInfo:s.scaleInfo,scaleSymbolsProportionally:e.scaleSymbolsProportionally,strokeWidth:e.outlineWidth,isMapAligned:1===e.alignment,colorLocked:e.colorLocked,isStroke:e.isStroke,baseSize:e.baseSize,placement:e.markerPlacement,referenceSize:e.referenceSize,angleToLine:!!e.markerPlacement&&e.markerPlacement.placement&&"angleToLine"in e.markerPlacement.placement&&e.markerPlacement.placement.angleToLine,sizeRatio:e.sizeRatio,patternHeight:null})]:[]}function h(t,e,i,s){return e.animationParams?[t.createMeshInfo({effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,sprite:(0,a.xi)(e),animations:e.animationParams,scaleInfo:s.scaleInfo,scaleSymbolsProportionally:!1,strokeWidth:1,isMapAligned:!0,colorLocked:e.colorLocked||!1,isStroke:!1,baseSize:"width"in e?e.width:-1,placement:null,referenceSize:2,angleToLine:!1,sizeRatio:1,patternHeight:"fill"===e.type&&e.spriteRasterizationParam?e.height:null,joinType:"join"in e?e.join:"round",capType:"cap"in e?e.cap:"round",miterLimit:"miterLimit"in e&&e.miterLimit||2})]:[]}function y(t,e,i,{scaleInfo:s,scaleExpression:n}){const l=(0,a.IY)(i);return[t.createMeshInfo({size:e.size,scaleX:e.scaleX,anchorX:e.anchorPoint.x,anchorY:e.anchorPoint.y,angle:e.rotation,color:u(e.color)??[0,0,0,0],colorLocked:e.colorLocked,frameHeight:e.frameHeight,widthRatio:e.widthRatio,scaleInfo:s,offsetX:e.offsetX,offsetY:e.offsetY,outlineColor:u(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineWidth,referenceSize:e.referenceSize||o.D.CIMVectorMarker.size,rotateClockwise:e.rotateClockwise,scaleFactor:n??1,sizeRatio:e.sizeRatio,alignment:e.alignment,isAbsoluteAnchorPoint:e.isAbsoluteAnchorPoint,scaleSymbolsProportionally:e.scaleSymbolsProportionally,sprite:e.spriteRasterizationParam,hasSizeVV:l,placement:e.markerPlacement,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,transforms:e.transform,minPixelBuffer:(0,r.j0)(i)})]}function m(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:r}=o;return f(r.ensureInstance(n.YS.outlineFill,{uniforms:{visualVariableColor:t.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}function f(t,e,i){const s=u(e.color)??[0,0,0,0],o=u(e.outlineColor)??[0,0,0,0];return[t.createMeshInfo({color:s,outlineColor:o,width:e.outlineWidth,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,outlineUsesColorVV:!e.outlineColorLocked,hasSizeVV:!1,scaleInfo:i.scaleInfo,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,outlineEffects:e.outlineEffects?{type:"cim-effect-infos",effectInfos:e.outlineEffects}:null})]}function g(t,e,{scaleInfo:i}){return[t.createMeshInfo({color:u(e.color)??[0,0,0,0],scaleInfo:i,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function v(t,e,i){if(!t.spriteRasterizationParam)return function(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:a}=o,l={visualVariableColor:t.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity};if(t.animationParams){const e=n.YS.animatedFill;return h(a.ensureInstance(e,{uniforms:{...l,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableSizeScaleStops:null,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),t,r.Dk,i)}return g(a.ensureInstance(n.YS.fill,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}(t,e,i);const{uniforms:s,schemaOptions:o}=e,{store:a}=o,l={visualVariableColor:t.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity};if(t.animationParams){const e=n.YS.animatedFill;return h(a.ensureInstance(e,{uniforms:{...l,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableSizeScaleStops:null,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),t,r.Dk,i)}return b(a.ensureInstance(n.YS.complexFill,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,null!=s.visualVariableColor,i)}function b(t,e,i,{scaleInfo:s}){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=!!e.hasUnresolvedReplacementColor&&(!i||e.colorLocked),n=e.sampleAlphaOnly&&!o,r=e.spriteRasterizationParam;return[t.createMeshInfo({color:u(e.color)??[0,0,0,0],height:e.height,aspectRatio:e.scaleX,offsetX:e.offsetX,offsetY:e.offsetY,scaleX:1,scaleY:1,angle:e.angle,applyRandomOffset:e.applyRandomOffset,sampleAlphaOnly:n,scaleProportionally:"CIMHatchFill"===r.resource.type,sprite:r,scaleInfo:s,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function x(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:r}=o;return w(r.ensureInstance(n.YS.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:s.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}function w(t,e,{scaleInfo:i}){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const s=e.spriteRasterizationParam;return[t.createMeshInfo({color:u(e.color)??[0,0,0,0],angle:e.angle,gradientMethod:e.gradientMethod,gradientSize:e.gradientSize,gradientSizeUnits:e.gradientSizeUnits,gradientType:e.gradientType,sprite:s,scaleInfo:i,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function S(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:a}=o,l=t.isOutline?{...r.Dk,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:t.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue};if(t.animationParams){const{hasShiftAnimation:e}=t.animationParams.params,s=n.YS.animatedLine;return h(a.ensureInstance(s,{uniforms:{...l,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,accumulatedDistance:!0,segmentDirection:!0,normal:!0,lineLength:e}}),t,r.Dk,i)}const u={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},p=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return t.spriteRasterizationParam?V(a.ensureInstance(n.YS.texturedLine,u),t,p,i):z(a.ensureInstance(n.YS.line,u),t,p,i)}function C(t,e,{scaleInfo:i}){return{color:u(t.color)??[0,0,0,0],width:t.width,referenceWidth:t.referenceWidth,capType:t.cap,joinType:t.join,miterLimit:t.miterLimit,scaleInfo:i,hasSizeVV:e,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}}function z(t,e,i,s){if(e.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const o=C(e,i,s);return[t.createMeshInfo(o)]}function V(t,e,i,s){const{spriteRasterizationParam:o,scaleDash:n,sampleAlphaOnly:r}=e;if(!o)throw new Error("InternalError: Sprite should be defined");return[t.createMeshInfo({...C(e,i,s),offsetAlongLine:e.offsetAlongLine??0,shouldScaleDash:n??!1,shouldSampleAlphaOnly:r,isSDF:"CIMPictureStroke"!==o.resource.type&&"CIMGradientStroke"!==o.resource.type,sprite:o})]}function P(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:a}=o;return M(a.ensureInstance(n.YS.gradientStroke,{uniforms:t.isOutline?{...r.Dk,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}function M(t,e,i){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const s=e.spriteRasterizationParam;return[t.createMeshInfo({...C(e,!1,i),gradientMethod:e.gradientMethod,gradientSize:e.gradientSize,gradientSizeUnits:e.gradientSizeUnits,gradientType:e.gradientType,sprite:s,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function T(t,e,i){const{uniforms:s,schemaOptions:o}=e,{store:r}=o;return A(r.ensureInstance(n.YS.text,{uniforms:{visualVariableColor:t.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1,visibility:!1}}),t,s,i)}function A(t,e,i,{scaleInfo:s,scaleExpression:o}){return[t.createMeshInfo({boxBackgroundColor:u(e.backgroundColor),boxBorderLineColor:u(e.borderLineColor),boxBorderLineSize:e.borderLineWidth??0,color:u(e.color)??[0,0,0,0],offsetX:e.offsetX,offsetY:e.offsetY,postAngle:e.angle,fontSize:e.size,referenceSize:e.referenceSize,decoration:e.decoration,haloColor:u(e.haloColor)??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:u(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineSize,lineWidth:e.lineWidth||512,lineHeightRatio:1,horizontalAlignment:e.horizontalAlignment??"center",verticalAlignment:e.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:e.textRasterizationParam,scaleInfo:s,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,placement:e.markerPlacement,transforms:e.transform,scaleFactor:o??1,minPixelBuffer:(0,r.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,labelClassId:-1})]}},74075:(t,e,i)=>{function s(t){return!!(t.visualVariableSizeMinMaxValue||t.visualVariableSizeScaleStops||t.visualVariableSizeStops||t.visualVariableSizeUnitValue||t.visualVariableSizeOutlineScaleStops)}function o(t){return!!t.visualVariableRotation}function n(t){return t.spriteRasterizationParam?t.spriteRasterizationParam:{type:"sprite-rasterization-param",resource:{type:"CIMPictureMarker",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAAsSURBVEhL7c0xAQAwDASh+jf9lcCU7TDA27ECKqACKqACKqACKqACKqDjYPuLVfSmMPfafQAAAABJRU5ErkJggg==",size:16,invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture"},overrides:[]}}i.d(e,{IY:()=>s,N7:()=>o,xi:()=>n})},18943:(t,e,i)=>{i.d(e,{R:()=>p,e:()=>d});var s=i(50076),o=i(76460),n=i(76931),r=i(9685);const a=8,l=a-2,u=()=>o.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function p(t){return t.map((t=>function(t){return("size"===t.type||"color"===t.type||"opacity"===t.type)&&null!=t.stops}(t)?function(t){return t.stops=function(t,e){return e.length<=a?e:(u().warn(`Found ${e.length} Visual Variable stops, but MapView only supports ${a}. Displayed stops will be simplified.`),e.length>2*a?function(t,e){const[i,...s]=e,o=s.pop(),r=s[0].value,a=s[s.length-1].value,u=(a-r)/l,p=[];for(let l=r;l<a;l+=u){let i=0;for(;l>=s[i].value;)i++;const o=s[i],r=e[i-1],a=l-r.value,u=o.value===r.value?1:a/(o.value-r.value);if("color"===t){const t=s[i],o=e[i-1],n=t.color.clone();n.r=c(o.color.r,n.r,u),n.g=c(o.color.g,n.g,u),n.b=c(o.color.b,n.b,u),n.a=c(o.color.a,n.a,u),p.push({value:l,color:n,label:t.label})}else if("size"===t){const t=s[i],o=e[i-1],r=(0,n.cr)(t.size),a=c((0,n.cr)(o.size),r,u);p.push({value:l,size:a,label:t.label})}else{const t=s[i],o=c(e[i-1].opacity,t.opacity,u);p.push({value:l,opacity:o,label:t.label})}}return[i,...p,o]}(t,e):function(t){const[e,...i]=t,s=i.pop();for(;i.length>l;){let t=0,e=0;for(let s=1;s<i.length;s++){const o=i[s-1],n=i[s],r=Math.abs(n.value-o.value);r>e&&(e=r,t=s)}i.splice(t,1)}return[e,...i,s]}(e))}(t.type,t.stops??[]),t}(t.clone()):t))}function c(t,e,i){return(1-i)*t+i*e}function d(t){if(!t)return!0;switch(t.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:t,supportsColorBufferFloatBlend:e,supportsColorBufferHalfFloat:i}=(0,r.C)();return t&&e||i}()){const t=(0,r.C)(),e=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!t[e])).join(", ");return u().errorOnce(new s.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${e}`)),!1}}return!0}},60401:(t,e,i)=>{i.d(e,{j:()=>a});var s=i(50346),o=i(34429),n=i(33817);class r{constructor(){this.type="override-batch",this.messages=[],this._resovler=(0,s.Tw)()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(t){this.messages.push(t)}}class a{constructor(t){this.updateTracking=new n.F({debugName:"FeatureCommandQueue"}),this.process=t.process,this._queueProcessor=new o.QueueProcessor({concurrency:1,process:async t=>{if("override-batch"===t.type){const t=this._nextOverrideBatch;if(null==t)throw new Error("InternalError: Override should be defined");return this._nextOverrideBatch=null,await this.process(t),void t.resolve()}return this.process(t)}})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(t){return(0,s.QZ)(this.updateTracking.addPromise(this._doPush(t)))}async _doPush(t){const e=this._queueProcessor,i=e.last();switch(t.type){case"update":case"highlight":if(i?.type===t.type)return;return e.push(t);case"override":case"edit":return this._pushOverride(t)}}_pushOverride(t){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new r,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(t),this._nextOverrideBatch.promise}}}}]);
//# sourceMappingURL=94750.f9e5db43.chunk.js.map