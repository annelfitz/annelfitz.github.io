"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[28675],{28675:(e,t,i)=>{i.d(t,{D:()=>d,previewCIMSymbol:()=>p});var l=i(76931),n=i(401),a=i(6840),o=i(48988),r=i(97763),s=i(26291);const h=new a.CIMSymbolRasterizer(null),c=(0,l.PN)(22),y=(0,l.PN)(120),m=(0,l.PN)(50),u=1;async function g(e,t,i){const l=t?.size;let n=null!=l&&"object"==typeof l&&"width"in l?l.width:l,a=null!=l&&"object"==typeof l&&"height"in l?l.height:l;if(!n||!a)if("esriGeometryPolygon"===i)n=a=t.maxSize?Math.min(t.maxSize,c):c;else{const l=await d(e,t,i);l&&(n=l.width,a=l.height),"esriGeometryPolyline"===i&&(n=t.maxSize?Math.min(t.maxSize,m):m),n=null!=n&&isFinite(n)?Math.min(n,y):c,a=null!=a&&isFinite(a)?Math.max(Math.min(a,y),u):c}return"legend"===t.style&&"esriGeometryPolyline"===i&&(n=m),{width:n,height:a}}async function d(e,t={},i){const l=t.cimOptions||t;i??=l.geometryType||(0,r.n5)(e?.data?.symbol);const{feature:a,fieldMap:s,viewParams:c}=l,y=await o.OverrideHelper.resolveSymbolOverrides(e.data,a,null,s,i,null,c);if(!y)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:y},e.data.primitiveOverrides=void 0;const m=[];return n.wp.fetchResources(y,h.resourceManager,m),n.wp.fetchFonts(y,h.resourceManager,m),m.length>0&&await Promise.all(m),n.wp.getEnvelope(y,null,h.resourceManager)}async function p(e,t={}){const{node:i,opacity:n,symbolConfig:a}=t,o=null!=a&&"object"==typeof a&&"isSquareFill"in a&&a.isSquareFill,c=t.cimOptions||t,y=c.geometryType||(0,r.n5)(e?.data?.symbol),m=await g(e,t,y),{feature:u,fieldMap:d}=c,p=t?.geometry||o||"esriGeometryPolygon"!==y?"preview":"legend";let w=m;const f=m;if(t?.geometry&&("esriGeometryPolygon"===y||"esriGeometryPolyline"===y)){const e=200;if((0,l.Lz)(m.width)<e||(0,l.Lz)(m.height)<e){const t=m.width>m.height?(0,l.PN)(e)*m.height/m.width:(0,l.PN)(e);w={width:m.width>m.height?(0,l.PN)(e):(0,l.PN)(e)*m.width/m.height,height:t}}}const b=await h.rasterizeCIMSymbolAsync(e,u,w,p,d,y,null,c.viewParams,c.allowScalingUp,t?.geometry?.toJSON());if(!b)return null;const{width:P,height:M}=b,v=document.createElement("canvas");v.width=P,v.height=M,v.getContext("2d").putImageData(b,0,0);const S=(0,l.Lz)(f.width),z=(0,l.Lz)(f.height),C=new Image(S,z);C.src=v.toDataURL(),C.ariaLabel=t.ariaLabel??null,C.alt=t.ariaLabel??"",null!=n&&(C.style.opacity=`${n}`);let L=C;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:S,height:z,src:C.src},fill:null,stroke:null,offset:[0,0]};L=(0,s.fz)([[e]],[S,z],t)}return i&&L&&i.appendChild(L),L}}}]);
//# sourceMappingURL=28675.ce2f88ef.chunk.js.map