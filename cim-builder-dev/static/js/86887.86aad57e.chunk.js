"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[86887],{37923:(e,t,r)=>{r.d(t,{C:()=>f,b:()=>_});var i=r(26917),s=r(59395),n=r(90080),a=r(54478),o=r(94192),h=r(66763),l=r(80883),c=r(42451),u=r(58350),d=r(86955),g=r(21670),p=r(2687);function _(e){const t=new p.N5,{vertex:r,fragment:_,attributes:f,varyings:v}=t,{hasVVColor:m,hasVertexColors:y}=e;return(0,c.NB)(r,e),t.include(s.d,e),t.include(a.c,e),t.include(h.A,e),t.include(n.g,e),_.include(i.HQ,e),t.include(g.z,e),t.include(o.Z,e),f.add("position","vec3"),m&&f.add("colorFeatureAttribute","float"),y||v.add("vColor","vec4"),v.add("vpos","vec3",{invariant:!0}),r.uniforms.add(new u.E("uColor",(e=>e.color))),r.main.add(d.H`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${y?"vColor *= uColor;":m?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),_.include(l.a),_.main.add(d.H`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},61157:(e,t,r)=>{r.d(t,{H:()=>p,b:()=>g});var i=r(47233),s=r(79138),n=r(56289),a=r(21390),o=r(86955),h=r(72790),l=r(70367),c=r(70571),u=r(21019),d=r(2687);function g(){const e=new d.N5;e.include(i.Q);const{fragment:t}=e;return t.uniforms.add(new l.N("blurInput",(e=>e.highlightBlurTexture)),new n.t("blurSize",(e=>e.blurSize)),new c.R("highlightTexture",(e=>e.highlightTexture)),new l.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new h.c("highlightLevel",(e=>e.highlightLevel)),new a.m("occludedIntensityFactor",(e=>e.occludedFactor))),t.constants.add("inner","float",1-(u.o-u.b)/u.o),e.include(s.y),t.main.add(o.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
uvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},43666:(e,t,r)=>{r.d(t,{H:()=>c,a:()=>d,b:()=>u});var i=r(72745),s=r(47233),n=r(56289),a=r(86955),o=r(27374),h=r(31432),l=r(2687);class c extends h.Y{constructor(){super(...arguments),this.blurSize=(0,i.vt)()}}function u(){const e=new l.N5;return e.include(s.Q),e.outputs.add("fragHighlight","vec2",0),e.fragment.uniforms.add(new n.t("blurSize",(e=>e.blurSize)),new o.o("blurInput",(e=>e.blurInput))).main.add(a.H`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 center = texture(blurInput, sUV).rg;
if (vOutlinePossible == 0.0) {
fragHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;
fragHighlight = sum;
}`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},21019:(e,t,r)=>{r.d(t,{H:()=>h,a:()=>g,b:()=>d,c:()=>l,g:()=>c,o:()=>u});var i=r(73398),s=r(86955),n=r(70571),a=r(31432),o=r(2687);class h extends a.Y{}function l(){const e=new o.N5,{outputs:t,fragment:r}=e;return e.include(i.c),r.uniforms.add(new n.R("highlightTexture",(e=>e.highlightTexture))),r.constants.add("outlineWidth","int",Math.ceil(u)),r.constants.add("cellSize","int",c),t.add("fragGrid","uvec2"),r.main.add(s.H`ivec2 inputTextureSize = textureSize(highlightTexture, 0);
ivec2 cellBottomLeftCornerInput = ivec2(ivec2(floor(gl_FragCoord.xy) * vec2(cellSize)));
ivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);
uvec2 centreTexel = texelFetch(highlightTexture, coordMid, 0).rg & uvec2(0x55u);
float marginSquare = float(outlineWidth*outlineWidth);
uvec2 outputValue = centreTexel & uvec2(0x55u);
for(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
ivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);
uvec2[4] texels = uvec2[4] (
texelFetch(highlightTexture,coord+ivec2(0,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,0),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(0,1),0).rg & uvec2(0x55u),
texelFetch(highlightTexture,coord+ivec2(1,1),0).rg & uvec2(0x55u)
);
if (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {
continue;
}
for (int i=0; i<4; ++i){
outputValue |= ((texels[i] ^ centreTexel) << 1);
outputValue |= texels[i];
}
}
}
fragGrid = outputValue;`),e}const c=32,u=9,d=.4,g=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:h,blurSize:d,build:l,gridCellPixelSize:c,outlineSize:u},Symbol.toStringTag,{value:"Module"}))},62854:(e,t,r)=>{r.d(t,{H:()=>c,b:()=>l});var i=r(47233),s=r(79138),n=r(86955),a=r(72790),o=r(70571),h=r(2687);function l(){const e=new h.N5;e.include(i.Q),e.include(s.y);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new o.R("highlightTexture",(e=>e.highlightTexture)),new a.c("highlightLevel",(e=>e.highlightLevel))),t.main.add(n.H`ivec2 iuv = ivec2(gl_FragCoord.xy);
uvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const c=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}))},80381:(e,t,r)=>{r.d(t,{O:()=>c,a:()=>d,b:()=>u});var i=r(73398),s=r(21390),n=r(86955),a=r(72790),o=r(70367),h=r(31432),l=r(2687);class c extends h.Y{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function u(){const e=new l.N5;return e.include(i.c),e.fragment.uniforms.add(new o.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new a.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.m("opacity",(e=>e.opacity))),e.fragment.main.add(n.H`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},53070:(e,t,r)=>{r.d(t,{T:()=>c,a:()=>d,b:()=>u});var i=r(9392),s=r(73398),n=r(5517),a=r(86955),o=r(70367),h=r(31432),l=r(2687);class c extends h.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function u(){const e=new l.N5;return e.include(s.c),e.fragment.uniforms.add(new o.N("tex",(e=>e.texture)),new n.t("uColor",(e=>e.color))),e.fragment.main.add(a.H`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},75941:(e,t,r)=>{r.d(t,{O:()=>i});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get outerSize(){return this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}forAll(e){this._outer.forEach(((t,r)=>t.forEach(((t,i)=>e(t,r,i)))))}}},87840:(e,t,r)=>{r.d(t,{$4:()=>y,O0:()=>x,O1:()=>w,Sw:()=>b,eH:()=>v,rc:()=>m});var i=r(28899),s=r(69539),n=r(3825),a=r(53521),o=r(76931),h=r(29632);const l="picture-fill",c="simple-fill",u="simple-line",d="simple-marker",g="text",p="cim",_=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),f=new a.q(1e3);function v(e){const t=e.style;let r=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(r=e.color);break;case c:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case l:r={type:"pattern",src:e.url,width:(0,o.Lz)(e.width)*e.xscale,height:(0,o.Lz)(e.height)*e.yscale,x:(0,o.Lz)(e.xoffset),y:(0,o.Lz)(e.yoffset)};break;case g:r=e.color;break;case p:r=(0,h.Nk)(e)}return r}function m(e,t){const r=e+"-"+t;return void 0!==f.get(r)?Promise.resolve(f.get(r)):(0,n.A)(e,{responseType:"image"}).then((e=>{const i=e.data,s=i.naturalWidth,n=i.naturalHeight,a=document.createElement("canvas");a.width=s,a.height=n;const o=a.getContext("2d");o.fillStyle=t,o.fillRect(0,0,s,n),o.globalCompositeOperation="destination-in",o.drawImage(i,0,0);const h=a.toDataURL();return f.put(r,h),h}))}function y(e){if(!e)return null;let t=null;switch(e.type){case c:case l:case d:t=y(e.outline);break;case u:{const r=(0,o.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==r&&(t={color:e.color,style:w(e.style),width:r,cap:e.cap,join:"miter"===e.join?(0,o.Lz)(e.miterLimit):e.join},t.dashArray=x(t).join(",")||"none");break}default:t=null}return t}function x(e){if(!e?.style)return[];const{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const s=i??0,n=_.has(r)?_.get(r).map((e=>e*s)):[];if("butt"!==e.cap)for(const[a,o]of n.entries())n[a]=a%2==1?o+s:Math.max(o-s,1);return n}const w=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),b=new s.A([128,128,128])},94439:(e,t,r)=>{r.d(t,{$d:()=>g,GG:()=>C,N7:()=>p,Sx:()=>_,UQ:()=>b,di:()=>T,dt:()=>v,f3:()=>S,k_:()=>d});var i=r(69539),s=r(98773),n=(r(81806),r(76931)),a=r(9392),o=r(44081),h=r(29632),l=r(87840),c=r(60697),u=r(94725);function d(e){if(!e)return 0;if((0,u.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,n.PN)((0,l.$4)(e)?.width)}function g(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function p(e){return e.resource?.href??""}function _(e,t){if(!e)return null;let r=null;return(0,u.wk)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)})),r?new i.A(r):null}(e):(0,u.$y)(e)&&(r="cim"===e.type?(0,h.Nk)(e):e.color?new i.A(e.color):null),r?f(r,t):null}function f(e,t){if(null==t||null==e)return e;const r=e.toRgba();return r[3]=r[3]*t,new i.A(r)}function v(e,t,r){e&&(t||null!=r)&&(t&&(t=new i.A(t)),(0,u.wk)(e)?function(e,t,r){const s=e.symbolLayers;if(!s)return;const n=(e,s=!1)=>{let n=t??e??null;return null!=r?.override&&(!n&&s&&(n=new i.A([255,255,255])),n&&(n.a=r.override)),f(n,r?.add)};s.forEach((e=>{if("water"===e.type)return void(e.color=f(e.color,r?.add));const t=null!=e.material?e.material.color:null,i=n(t,"icon"===e.type&&null!=e.resource?.href);null==e.material?e.material=new c.N({color:i}):e.material.color=i,"outline"in e&&e.outline?.color&&null!=r?.add&&(e.outline.color=f(e.outline.color,r.add)),"marker"in e&&null!=e.marker&&(e.marker.color=n(e.marker.color))}))}(e,t,r):(0,u.$y)(e)&&function(e,t,r){t=t??e.color,null!=r?.override&&t&&(t.a=r.override),t&&(e.color=f(t,r?.add)),"outline"in e&&e.outline?.color&&(e.outline.color=f(e.outline.color,r?.add))}(e,t,r))}async function m(e,t){const i=e.symbolLayers;i&&await(0,s.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){const r=t[2];"number"==typeof r&&(e.size=r)}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=y(t);null!=r&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=x(t,a.Un,[e.width,void 0,e.height]);null!=r&&(e.width=w(t[0],e.width,1,r),e.height=w(t[2],e.height,1,r))}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:s}=await async function(e){const{computeObjectLayerResourceSize:t}=await r.e(44374).then(r.bind(r,44374)),i=await t(e,10),{width:s,height:n,depth:a}=e,o=[s,a,n];let h=1;for(let r=0;r<3;r++){const e=o[r];if(null!=e){h=e/i[r];break}}for(let r=0;r<3;r++)null==o[r]&&(o[r]=i[r]*h);return{resourceSize:i,symbolSize:o}}(e),n=x(t,i,s);null!=n&&(e.width=w(t[0],s[0],i[0],n),e.depth=w(t[1],s[1],i[1],n),e.height=w(t[2],s[2],i[2],n))}(e,t)}}(e,t)))}function y(e){for(const t of e)if("number"==typeof t)return t;return null}function x(e,t,r){for(let i=0;i<3;i++){const s=e[i];switch(s){case"symbol-value":{const e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(s&&t[i])return s/t[i]}}return null}function w(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}async function b(e,t){if(e&&t)return(0,u.wk)(e)?m(e,t):void((0,u.$y)(e)&&function(e,t){const r=y(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function C(e,t,r){if(e&&null!=t)if((0,u.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if("object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,u.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function T(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,o.zu)(t)}function S(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}},317:(e,t,r)=>{r.d(t,{k9:()=>T,zF:()=>C});var i,s=r(6326),n=r(42553),a=r(46053),o=(r(81806),r(76460),r(47249),r(6409)),h=r(85842);let l=i=class extends n.o{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,s.Cg)([(0,o.e)({cloudy:"cloudy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"cloudCover",void 0),l=i=(0,s.Cg)([(0,h.$)("esri.views.3d.environment.CloudyWeather")],l);const c=l;var u;let d=u=class extends n.o{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new u({fogStrength:this.fogStrength})}};(0,s.Cg)([(0,o.e)({foggy:"foggy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],d.prototype,"type",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=u=(0,s.Cg)([(0,h.$)("esri.views.3d.environment.FoggyWeather")],d);const g=d;var p;let _=p=class extends n.o{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new p({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,s.Cg)([(0,o.e)({rainy:"rainy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],_.prototype,"type",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"cloudCover",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_.prototype,"precipitation",void 0),_=p=(0,s.Cg)([(0,h.$)("esri.views.3d.environment.RainyWeather")],_);const f=_;var v;let m=v=class extends n.o{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new v({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,s.Cg)([(0,o.e)({snowy:"snowy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),(0,s.Cg)([(0,a.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],m.prototype,"snowCover",void 0),m=v=(0,s.Cg)([(0,h.$)("esri.views.3d.environment.SnowyWeather")],m);const y=m;var x;let w=x=class extends n.o{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new x({cloudCover:this.cloudCover})}};(0,s.Cg)([(0,o.e)({sunny:"sunny"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],w.prototype,"type",void 0),(0,s.Cg)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"cloudCover",void 0),w=x=(0,s.Cg)([(0,h.$)("esri.views.3d.environment.SunnyWeather")],w);const b={key:"type",base:w,typeMap:{sunny:w,cloudy:c,rainy:f,snowy:y,foggy:g}};Object.keys(b.typeMap);const C=1e4,T=1e5},29889:(e,t,r)=>{r.d(t,{A:()=>l,C:()=>h});var i=r(45308),s=r(44815),n=r(99785),a=r(67425),o=r(3509);function h(e,t,r,i){const o="polygon"===e.type?1:0,h="polygon"===e.type?e.rings:e.paths,{position:l,outlines:u}=(0,n.oR)(h,!!e.hasZ,o,e.spatialReference),d=(0,s.jh)(l.length),g=(0,a.au)(l,e.spatialReference,0,d,0,l,0,l.length/3,t,r,i),p=null!=g;return{lines:p?c(u,l,d):[],projectionSuccess:p,sampledElevation:g}}function l(e,t){const r="polygon"===e.type?1:0,s="polygon"===e.type?e.rings:e.paths,{position:a,outlines:h}=(0,n.oR)(s,!1,r),l=(0,i.projectBuffer)(a,e.spatialReference,0,a,t,0);for(let i=2;i<a.length;i+=3)a[i]=o.bi;return{lines:l?c(h,a):[],projectionSuccess:l}}function c(e,t,r=null){const i=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,o=3*a;i.push({position:(0,s.l5)(t,3*n,3*a),mapPositions:null!=r?(0,s.l5)(r,e,o):void 0})}return i}},3509:(e,t,r)=>{r.d(t,{bi:()=>Tt});var i=r(6326),s=r(54099),n=r(81806),a=r(87663),o=r(30726),h=r(5457),l=r(68134),c=r(41289),u=r(46053),d=r(76460),g=(r(47249),r(85842)),p=r(34761),_=r(20664),f=r(9392),v=r(22955),m=r(2413),y=r(75507);class x{constructor(){this._extent=(0,m.vt)(),this.resolution=0,this.renderLocalOrigin=(0,y.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new w}get extent(){return this._extent}setupGeometryViews(e){if(this._setupGeometryView(),!e)return;const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,m.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,m.cY)(this._extent,-e.range,0,t)}}_setupGeometryView(){this.canvasGeometries.numViews=1,(0,m.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class w{constructor(){this.extents=[(0,m.vt)(),(0,m.vt)(),(0,m.vt)()],this.numViews=0}}class b{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,o.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}ensureFramebuffer(e,t){this._handle&&this._handle.fbo?.width===e&&this._handle.fbo?.height===t||(this._handle?.release(),this._handle=this._fbos.acquire(e,t,this._name,this._format))}bind(e){e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var C=r(61785);class T{constructor(e,t,r,i,s=1,n=6){this.output=r,this.content=i,this.redrawOnRequest=s,this.fbo=new b(e,n,t)}handleRenderRequest(e){return 1===e||e===this.redrawOnRequest}get valid(){return this.fbo.valid}}class S{constructor(e){this.targets=[new T(e,"overlay color",0,0),new T(e,"overlay IM color",0,1),new T(e,"overlay highlight",8,2,1,3),new T(e,"overlay water",3,3,0),new T(e,"overlay occluded",0,4)],(0,C.E)()&&this.targets.push(new T(e,"overlay olid",9,5,1,5))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(e){if(0!==e)for(const t of this.targets)t.fbo.dispose();else this.targets[3].fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var O=r(33062),P=r(53070),M=r(60586),R=r(19555),F=r(74628),z=r(36451),D=r(16506),V=r(59246),L=r(11850),I=r(61157),W=r(57162),q=r(75757);class A extends V.w{constructor(e,t){super(e,t,new D.$(I.H,(()=>r.e(82671).then(r.bind(r,82671)))),(0,q.Xk)(L.wR))}initializePipeline(){return(0,W.Ey)({blending:W.T8,colorWrite:W.kn})}}var H=r(43666);class k extends V.w{constructor(e,t){super(e,t,new D.$(H.a,(()=>r.e(9616).then(r.bind(r,9616)))),(0,q.Xk)(L.wR))}initializePipeline(){return(0,W.Ey)({colorWrite:W.kn})}}var E=r(21019);class j extends V.w{constructor(e,t){super(e,t,new D.$(E.a,(()=>r.e(51521).then(r.bind(r,51521)))),L.Nx)}initializePipeline(){return(0,W.Ey)({colorWrite:W.kn})}}var N=r(1723),B=r(31432);class G extends B.Y{constructor(){super(...arguments),this.occludedFactor=N.cD,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var Z=r(62854);class U extends V.w{constructor(e,t){super(e,t,new D.$(Z.H,(()=>r.e(37932).then(r.bind(r,37932)))),(0,q.Xk)(L.wR))}initializePipeline(){return(0,W.Ey)({colorWrite:W.kn})}}var $=r(69008),Q=r(76718),X=r(93345),Y=r(80895),K=r(96673),J=r(9243);let ee=class extends z.A{constructor(){super(...arguments),this.produces=F.OG.HIGHLIGHTS,this.consumes={required:[F.OG.HIGHLIGHTS,"highlights"]},this._downsampleDrawParameters=new E.H,this._passParameters=new G,this._highlightBlurDrawParameters=new H.H,this._grid=new te}initialize(){this.addHandles([(0,l.wB)((()=>this._updateOptionsTexture()),(()=>{}),l.Vh)])}destroy(){this._grid.coverage=(0,o.Gz)(this._grid.coverage),this._grid.vao=(0,o.WD)(this._grid.vao),this._passParameters.highlightOptionsTexture=(0,o.Gz)(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(null==this._passParameters.highlightOptionsTexture){const e=new K.R(16,2);e.internalFormat=6408,e.samplingMode=9728,this._passParameters.highlightOptionsTexture=new Y.g(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(function(e){const t=new Uint8Array(128);let r=0;for(const i of e){const e=4*r,s=4*r+64;++r;const{color:n}=i,a=i.haloColor??n;t[e+0]=n.r,t[e+1]=n.g,t[e+2]=n.b,t[e+3]=i.fillOpacity*n.a*255,t[s+0]=a.r,t[s+1]=a.g,t[s+2]=a.b,t[s+3]=i.haloOpacity*a.a*255}return t}(this.view.state.highlights)),this.requestRender(1)}precompile(){this.techniques.precompile(j),this.techniques.precompile(U),this.techniques.precompile(k),this.techniques.precompile(A)}render(e){const t=e.find((({name:e})=>e===F.OG.HIGHLIGHTS)),{techniques:r,bindParameters:i}=this;if(!i.decorations)return t;if(!r.get(j).compiled)return this.requestRender(1),t;const s=e.find((({name:e})=>"highlights"===e)).getTexture();return this._renderHighlightPostprocess(s,t),t}_prepareAndDownSample(e){this._gridUpdateResources(e);const t=this.techniques.get(j),r=this._gridComputeCoverage(t,e),{horizontalCellCount:i,verticalCellCount:s}=r,n=this._passParameters;return n.horizontalCellCount=i,n.verticalCellCount=s,n.coverageTexture=r.coverage?.getTexture(),r}_renderGrid(e){const t=e.verticalCellCount*e.horizontalCellCount;this.renderingContext.bindVAO(e.vao),this.renderingContext.drawElementsInstanced(X.WR.TRIANGLES,6,X.pe.UNSIGNED_BYTE,0,t)}_renderHighlightPostprocess(e,t){const{fboCache:r,techniques:i,bindParameters:s,_passParameters:n,renderingContext:a}=this,o=i.get(U),h=i.get(k),l=i.get(A);if(!l.compiled||!h.compiled||!o.compiled)return void this.requestRender(1);n.highlightTexture=e;const c=this._prepareAndDownSample(e),{width:u,height:d}=e.descriptor;n.highlightTexture=e;const{camera:g}=s,{fullWidth:p,fullHeight:_,pixelRatio:f,fullViewport:v}=g,m=Math.ceil(p/f),y=Math.ceil(_/f),{_highlightBlurDrawParameters:x}=this,w=this.view.stage.renderView.renderer,{highlights:b}=s;for(let C=0;C<b.length;++C){const{name:e}=b[C];if(!w.hasHighlight(e))continue;n.highlightLevel=C,a.setClearColor(0,0,0,0);const i=r.acquire(u,d,"single highlight",2);a.bindFramebuffer(i.fbo),a.setViewport(0,0,u,d),a.clear(16384),a.bindTechnique(o,s,n),this._renderGrid(c),x.blurInput=i.getTexture(),(0,R.hZ)(x.blurSize,1/m,0);const g=r.acquire(m,y,"single highlight blur h",2);a.unbindTexture(g.fbo?.colorTexture),a.bindFramebuffer(g.fbo),a.setViewport(0,0,m,y),a.clear(16384),a.bindTechnique(h,s,n,x),this._renderGrid(c),i.release(),(0,R.hZ)(x.blurSize,0,1/y),n.highlightBlurTexture=g.getTexture(),a.bindFramebuffer(t.fbo),a.setViewport4fv(v),a.bindTechnique(l,s,n,x),this._renderGrid(c),g.release()}n.coverageTexture=n.highlightTexture=null}_gridUpdateResources(e){const t=this._grid,{width:r,height:i}=e.descriptor;if(t.horizontalCellCount=Math.ceil(r/E.g),t.verticalCellCount=Math.ceil(i/E.g),t.vao)return;const s=this.renderingContext,n=Q.g.createIndex(s,35044,ie);t.vao=new $.Z(s,new J.R(L.wR,Q.g.createVertex(s,35044)),n)}_gridComputeCoverage(e,t){const r=this.renderingContext,i=this._grid,s=t.descriptor,n=Math.ceil(s.width/E.g),a=Math.ceil(s.height/E.g);this._downsampleDrawParameters.input=t;const{highlights:o}=this.bindParameters;i.coverage?.release();const h=this.fboCache.acquire(n,a,"highlight coverage",o.length>se?3:1);return i.coverage=h,r.bindFramebuffer(h.fbo),r.bindTechnique(e,this.bindParameters,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,n,a),r.screen.draw(),i}get test(){}};(0,i.Cg)([(0,u.MZ)()],ee.prototype,"produces",void 0),(0,i.Cg)([(0,u.MZ)()],ee.prototype,"consumes",void 0),ee=(0,i.Cg)([(0,g.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],ee);class te{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}let re=0;const ie=new Uint8Array([0,1,2,2,1,3]);const se=4;var ne=r(75941);class ae{constructor(e,t,r,i){this.material=e,this.output=t,this.techniques=r,this.textures=i}}var oe=r(86994);class he{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new ne.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(r))return null;let s=this._id2glMaterialRef.get(r,e.id);if(null==s){const t=e.createGLMaterial(new ae(e,r,this._techniques,this._textures));s=new le(t),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,o.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&d.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class le{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,oe.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var ce=r(97583),ue=r(91417),de=r(13191),ge=r(72745),pe=r(4212),_e=r(15941),fe=r(75540),ve=r(52896),me=r(14556);var ye=r(317);class xe{constructor(){this.startTime=0,this._data=(0,fe.v)(null),this.coverage=0,this.absorption=0,this._readChannels=0,this.parallax=new we,this.parallaxNew=new we,this._anchorPoint=(0,f.vt)(),this._fadeState=(0,fe.v)(0),this._fadeFactor=(0,fe.v)(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case 0:return 0;case 4:return 1-this.fadeFactor;case 1:return this.fadeFactor;case 2:case 3:return 1}}fade(e,t,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?(0,_e.qE)((t-this.startTime)/(Se*r),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(e,t),this._updateParallax(e)}_evaluateState(e,t){const r=e.relativeElevation,i=this._updateAnchorPoint(e);(r>1.7*ye.zF||r<-ye.zF||i>Pe)&&this.opacity>0?this._startFade(0,t):this.isFading||(r>ye.zF||r<-.35*ye.zF||i>Oe*Pe?this.opacity>0&&this._startFade(4,t):function(e){return null!=e&&!e.readyToRun}(this.data)&&(0===this.opacity?this._startFade(1,t):2===this.data.state&&(2===this.fadeState?this._startFade(3,t):this._startFade(2,t))))}_updateParallax(e){const t=(0,_.k)(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(t-me.$O.radius*me.$O.radius,0))/Math.sqrt(t),(0,ve.Cr)(be,this.parallax.anchorPoint,Ce),(0,p.e$)(this.parallax.transform,de.zK,Ce[3],(0,ve.yo)(Ce)),(0,ve.Cr)(be,this.parallaxNew.anchorPoint,Ce),(0,p.e$)(this.parallaxNew.transform,de.zK,Ce[3],(0,ve.yo)(Ce))}_updateAnchorPoint(e){return(0,_.n)(this._anchorPoint,e.eye),(0,_.g)(this._anchorPoint,this._anchorPoint,me.$O.radius),0===this.fadeState&&2===this.data?.state?((0,_.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,_.l)((0,_.d)(Te,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,t){switch(this._fadeState.value=e,this.startTime=t,e){case 3:this.requestFade(),this._switchReadChannels(),(0,_.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 1:this.requestFade(),this._switchReadChannels(),(0,_.c)(this.parallax.anchorPoint,this._anchorPoint),(0,_.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case 4:this.requestFade();break;case 2:this._switchReadChannels(),(0,_.c)(this.parallax.anchorPoint,this._anchorPoint),(0,_.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case 0:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&2!==this.data.state&&(this.data.state=0),this.fadeState){case 3:(0,_.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=2;break;case 1:this._fadeState.value=2;break;case 4:this._fadeState.value=0;break;case 2:case 0:break;default:(0,pe.Xb)(this.fadeState)}}_switchReadChannels(){2===this.data?.state&&(this._readChannels=1-this._readChannels,this.data.state=3)}get isFading(){return 4===this.fadeState||1===this.fadeState||3===this.fadeState}}class we{constructor(){this.anchorPoint=(0,f.vt)(),this.radiusCurvatureCorrection=0,this.transform=(0,de.vt)()}}const be=(0,f.fA)(0,0,1),Ce=(0,ve.vt)(),Te=(0,f.vt)(),Se=1.25,Oe=.5,Pe=2e5;var Me=r(4998);class Re{constructor(e){this.shadowMap=e,this.slot=2,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=0,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new O.A,this._inverseViewport=(0,ge.vt)(),this._oldLighting=new Me.TA,this._newLighting=new Me.TA,this._fadedLighting=new Me.TA,this._lighting=this._newLighting,this.ssr=new Fe,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=(0,ge.vt)(),this.highlightMixTexture=null,this.hudRenderStyle=0,this.hudOccludedFragmentOpacity=1,this.snowCover=!1,this.clouds=new xe,this.shadowHighlightsVisible=!1}destroy(){this._camera=null,this.contentCamera=null,this.depth=null,this.geometryDepth=null,this.mainDepth=null,this.overlay=null,this.ssao=null,this.terrainDepth=null}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,r,i){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=r,this._newLighting.set(e),1===i&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return null==this.highlightLevel?null:this.highlights[this.highlightLevel]}}class Fe{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,de.vt)()}}class ze{constructor(e,t,r){this.rctx=e,this.techniques=r,this.lastFrameCamera=new O.A,this.output=0,this.renderOccludedMask=De,this.time=(0,ue.l5)(0),this.bind=new Re(t),this.bind.alignPixelEnabled=!0}}const De=13;var Ve=r(44680),Le=r(43047),Ie=r(55855);let We=class extends O.A{constructor(){super(...arguments),this._projectionMatrix=(0,de.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,i.Cg)([(0,u.MZ)()],We.prototype,"_projectionMatrix",void 0),(0,i.Cg)([(0,u.MZ)({readOnly:!0})],We.prototype,"projectionMatrix",null),We=(0,i.Cg)([(0,g.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],We);var qe=r(81330);class Ae{constructor(){this.camera=new We,this.lightMat=(0,de.vt)()}}class He{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class ke{constructor(e,t){this._fbos=e,this._viewingMode=t,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new He,this._projectionView=(0,de.vt)(),this._projectionViewInverse=(0,de.vt)(),this._modelViewLight=(0,de.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,Ie.vt)(),this._cascades=[new Ae,new Ae,new Ae,new Ae],this._lastOrigin=null,this._enabled=!1,this._maxTextureWidth=Math.min((0,n.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture(X.nI)}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,Le.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeMainBuffer(){this._handle=(0,o.Gz)(this._handle)}disposeOffscreenBuffers(){this.disposeMainBuffer(),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,_e.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)Xe[e]=this._cascades[e];return Xe.length=this._numCascades,Xe}start(e,t,r,i,s){(0,oe.vA)(this.enabled);const{near:n,far:a}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(n,a,i),this._textureHeight=this._computeTextureHeight(e,s,i),this._setupMatrices(e,t);const{viewMatrix:o,projectionMatrix:h}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,h,o,t);this._lastOrigin=null,this.clear()}finish(){(0,oe.vA)(this.enabled)}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,_.q)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,f.vt)(),(0,_.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,p.Tl)(Ye,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Ke[16*t+e]=Ye[e]}}return Ke}moveSnapshot(e){(0,oe.vA)(this.enabled),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle?.setName(0===e?"shadow map highlight":"shadow map excluding highlight"),this._handle=null}copySnapshot(e){if(!this.enabled)return;const t=this._handle?.getTexture(X.nI)?.descriptor;if(!t)return;this._snapshots[e]?.release();const r=0===e?"shadow map highlight":"shadow map excluding highlight",i=this._acquireFBO(r);this._snapshots[e]=i;const s=this._handle?.fbo;if(!s||!i?.fbo)return void console.error("No FBO");const{rctx:n}=this._fbos;n.blitFramebuffer(s,i.fbo,256)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture(X.nI):null}clear(){this._ensureFbo(),this.bindFbo(),this._fbos.rctx.clear(256)}_computeTextureHeight({pixelRatio:e,fullWidth:t,fullHeight:r},i,s){const n=Math.min(window.devicePixelRatio,i)/e,a=s?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return(0,qe.Mv)(Math.max(t,r)*n*a,this._maxTextureWidth/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._acquireFBO("shadow map"))}_acquireFBO(e){const t=this._fbos.acquire(this._textureWidth,this._textureHeight,e,10);return t.getTexture(X.nI)?.setShadowFiltering(!0),t}_discardSnapshot(e){this._snapshots[e]=(0,o.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,r,i){const s=this._cascades[e],n=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],o=(t[10]*n+t[14])/Math.abs(t[11]*n+t[15]),h=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]);(0,oe.vA)(o<h);for(let d=0;d<8;++d){(0,Le.s)(je,d%4==0||d%4==3?-1:1,d%4==0||d%4==1?-1:1,d<4?o:h,1);const e=Ne[d];(0,Le.t)(e,je,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,_.u)(Qe,Ne[0]),s.camera.viewMatrix=(0,p.Tl)(Ee,this._modelViewLight,Qe);for(let d=0;d<8;++d)(0,_.t)(Ne[d],Ne[d],s.camera.viewMatrix);let l=Ne[0][2],c=Ne[0][2];for(let d=1;d<8;++d)l=Math.min(l,Ne[d][2]),c=Math.max(c,Ne[d][2]);l-=200,c+=200,s.camera.near=-c,s.camera.far=-l,function(e,t,r,i,s){const n=1/Ne[0][3],a=1/Ne[4][3];(0,oe.vA)(n<a);let o=n+Math.sqrt(n*a);const h=Math.sin((0,_e.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));o/=h,function(e,t,r,i,s,n,a,o){(0,R.hZ)(Je,0,0);for(let w=0;w<4;++w)(0,R.WQ)(Je,Je,e[w]);(0,R.hs)(Je,Je,.25),(0,R.hZ)(et,0,0);for(let w=4;w<8;++w)(0,R.WQ)(et,et,e[w]);(0,R.hs)(et,et,.25),(0,R.Cc)(tt[0],e[4],e[5],.5),(0,R.Cc)(tt[1],e[5],e[6],.5),(0,R.Cc)(tt[2],e[6],e[7],.5),(0,R.Cc)(tt[3],e[7],e[4],.5);let h=0,l=(0,R.hG)(tt[0],Je);for(let w=1;w<4;++w){const e=(0,R.hG)(tt[w],Je);e<l&&(l=e,h=w)}(0,R.Re)(rt,tt[h],e[h+4]);const c=rt[0];let u,d;rt[0]=-rt[1],rt[1]=c,(0,R.Re)(it,et,Je),(0,R.Om)(it,rt)<0&&(0,R.ze)(rt,rt),(0,R.Cc)(rt,rt,it,r),(0,R.S8)(rt,rt),u=d=(0,R.Om)((0,R.Re)(st,e[0],Je),rt);for(let w=1;w<8;++w){const t=(0,R.Om)((0,R.Re)(st,e[w],Je),rt);t<u?u=t:t>d&&(d=t)}(0,R.C)(i,Je),(0,R.hs)(st,rt,u-t),(0,R.WQ)(i,i,st);let g=-1,p=1,_=0,f=0;for(let w=0;w<8;++w){(0,R.Re)(nt,e[w],i),(0,R.S8)(nt,nt);const t=rt[0]*nt[1]-rt[1]*nt[0];t>0?t>g&&(g=t,_=w):t<p&&(p=t,f=w)}(0,oe.MX)(g>0,"leftArea"),(0,oe.MX)(p<0,"rightArea"),(0,R.hs)(at,rt,u),(0,R.WQ)(at,at,Je),(0,R.hs)(ot,rt,d),(0,R.WQ)(ot,ot,Je),ht[0]=-rt[1],ht[1]=rt[0];const v=(0,oe.L)(i,e[f],ot,(0,R.WQ)(st,ot,ht),1,s),m=(0,oe.L)(i,e[_],ot,st,1,n),y=(0,oe.L)(i,e[_],at,(0,R.WQ)(st,at,ht),1,a),x=(0,oe.L)(i,e[f],at,st,1,o);(0,oe.MX)(v,"rayRay"),(0,oe.MX)(m,"rayRay"),(0,oe.MX)(y,"rayRay"),(0,oe.MX)(x,"rayRay")}(Ne,o,h,Be,Ge,Ze,Ue,$e),function(e,t,r,i,s){(0,R.Re)(dt,r,i),(0,R.hs)(dt,dt,.5),gt[0]=dt[0],gt[1]=dt[1],gt[2]=0,gt[3]=dt[1],gt[4]=-dt[0],gt[5]=0,gt[6]=dt[0]*dt[0]+dt[1]*dt[1],gt[7]=dt[0]*dt[1]-dt[1]*dt[0],gt[8]=1,gt[lt(0,2)]=-(0,R.Om)(ut(gt,0),e),gt[lt(1,2)]=-(0,R.Om)(ut(gt,1),e);let n=(0,R.Om)(ut(gt,0),r)+gt[lt(0,2)],a=(0,R.Om)(ut(gt,1),r)+gt[lt(1,2)],o=(0,R.Om)(ut(gt,0),i)+gt[lt(0,2)],h=(0,R.Om)(ut(gt,1),i)+gt[lt(1,2)];n=-(n+o)/(a+h),gt[lt(0,0)]+=gt[lt(1,0)]*n,gt[lt(0,1)]+=gt[lt(1,1)]*n,gt[lt(0,2)]+=gt[lt(1,2)]*n,n=1/((0,R.Om)(ut(gt,0),r)+gt[lt(0,2)]),a=1/((0,R.Om)(ut(gt,1),r)+gt[lt(1,2)]),gt[lt(0,0)]*=n,gt[lt(0,1)]*=n,gt[lt(0,2)]*=n,gt[lt(1,0)]*=a,gt[lt(1,1)]*=a,gt[lt(1,2)]*=a,gt[lt(2,0)]=gt[lt(1,0)],gt[lt(2,1)]=gt[lt(1,1)],gt[lt(2,2)]=gt[lt(1,2)],gt[lt(1,2)]+=1,n=(0,R.Om)(ut(gt,1),t)+gt[lt(1,2)],a=(0,R.Om)(ut(gt,2),t)+gt[lt(2,2)],o=(0,R.Om)(ut(gt,1),r)+gt[lt(1,2)],h=(0,R.Om)(ut(gt,2),r)+gt[lt(2,2)],n=-.5*(n/a+o/h),gt[lt(1,0)]+=gt[lt(2,0)]*n,gt[lt(1,1)]+=gt[lt(2,1)]*n,gt[lt(1,2)]+=gt[lt(2,2)]*n,n=(0,R.Om)(ut(gt,1),t)+gt[lt(1,2)],a=(0,R.Om)(ut(gt,2),t)+gt[lt(2,2)],o=-a/n,gt[lt(1,0)]*=o,gt[lt(1,1)]*=o,gt[lt(1,2)]*=o,s[0]=gt[0],s[1]=gt[1],s[2]=0,s[3]=gt[2],s[4]=gt[3],s[5]=gt[4],s[6]=0,s[7]=gt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=gt[6],s[13]=gt[7],s[14]=0,s[15]=gt[8]}(Be,Ge,Ue,$e,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,l,c,s.camera),(0,p.lw)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const u=this._textureHeight;s.camera.viewport=[e*u,0,u,u]}_setupMatrices(e,t){(0,p.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,p.B8)(this._projectionViewInverse,this._projectionView);const r=1===this._viewingMode?e.eye:(0,_.i)(Qe,0,0,1);(0,p.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,oe.kL)(t/e,4)),i);const s=(t-e)/this._numCascades,n=(t/e)**(1/this._numCascades);let a=e,o=e;for(let h=0;h<this._numCascades+1;++h)this._cascadeDistances[h]=(0,_e.Cc)(a,o,this.settings.splitSchemeLambda),a*=n,o+=s}get test(){}}const Ee=(0,de.vt)(),je=(0,Ie.vt)(),Ne=[];for(let Pt=0;Pt<8;++Pt)Ne.push((0,Ie.vt)());const Be=(0,ge.vt)(),Ge=(0,ge.vt)(),Ze=(0,ge.vt)(),Ue=(0,ge.vt)(),$e=(0,ge.vt)(),Qe=(0,f.vt)(),Xe=[];const Ye=(0,de.vt)(),Ke=de.zK.concat(de.zK,de.zK,de.zK,de.zK),Je=(0,ge.vt)(),et=(0,ge.vt)(),tt=[(0,ge.vt)(),(0,ge.vt)(),(0,ge.vt)(),(0,ge.vt)()],rt=(0,ge.vt)(),it=(0,ge.vt)(),st=(0,ge.vt)(),nt=(0,ge.vt)(),at=(0,ge.vt)(),ot=(0,ge.vt)(),ht=(0,ge.vt)();function lt(e,t){return 3*t+e}const ct=(0,ge.vt)();function ut(e,t){return(0,R.hZ)(ct,e[t],e[t+3]),ct}const dt=(0,ge.vt)(),gt=(0,Ve.vt)();class pt extends V.w{constructor(e,t){super(e,t,new D.$(P.a,(()=>r.e(62553).then(r.bind(r,62553)))),L.Nx)}initializePipeline(e){return e.hasAlpha?(0,W.Ey)({blending:W.T8,colorWrite:W.kn}):(0,W.Ey)({colorWrite:W.kn})}}var _t=r(6485);class ft extends _t.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,i.Cg)([(0,_t.W)()],ft.prototype,"hasAlpha",void 0);var vt=r(71011),mt=r(80381);class yt extends V.w{constructor(e,t){super(e,t,new D.$(mt.a,(()=>r.e(71747).then(r.bind(r,71747)))),L.Nx)}}var xt=r(59752);let wt=class extends M.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new mt.O,this.hasHighlights=!1,this.renderOccludedFlags=1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new h.A,this._passParameters=new P.T,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new O.A,this.events=new s.bk,this.longitudeCyclical=null,this.produces=new Map([[17,e=>8!==e||this.hasHighlights],[18,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e.stage,r=t.renderer.fboCache,{waterTextures:i,techniques:s}=t.renderView;this._renderContext=new ze(this._rctx,new ke(r,e.state.viewingMode),s),this.addHandles([(0,l.wB)((()=>i.updating),(()=>this.events.emit("content-changed")),l.pc),(0,l.wB)((()=>this.spatialReference),(e=>this._localOriginFactory=new ce.g(e)),l.pc),(0,l.on)((()=>e.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,l.wB)((()=>function(e){let t=0;for(const i of e){const{name:e}=i;t+=e.length;const{color:r,fillOpacity:s,haloColor:n,haloOpacity:a}=i;t+=r.r+r.g+r.b+r.a+s,t+=n?n.r+n.g+n.b+n.a+a:0}const r=e.at(0);if(r){const{shadowOpacity:e,shadowDifference:i,shadowColor:s}=r;t+=e+i+s.r+s.g+s.b+s.a}return re+++(t>=0?0:1)}(e.state.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),l.Vh),(0,l.wB)((()=>e.state.highlights),(t=>{this._bindParameters.highlights=t,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap}),l.Vh),e.resourceController.scheduler.registerTask(xt.W6.OVERLAY_RENDERER,this)]);const{_bindParameters:n,_camera:a}=this;a.near=1,a.far=1e4,a.relativeElevation=null,n.slot=17,n.mainDepth=null,n.camera=a,n.oitPass=0,n.updateLighting([new vt.$p((0,f.S)())],0,0,0)}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._passParameters.texture=(0,o.WD)(this._passParameters.texture),this.disposeOverlays(),this._renderContext=null,this._sortedRenderers.prune()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view.stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._pluginContext.materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){const t=new he(this._view.stage.renderView.textures,this._techniques,(()=>{this._onMaterialOrContentChanged(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));this._pluginContext={...e,materials:t},this._techniques.precompile(yt)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,a.Bs)(this._renderers,(e=>e.updating||e.canCompact))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}registerDrapeSource(e,t){const r=this._renderers.get(e);null!=r&&r.destroy(),this._renderers.set(e,t),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,l.wB)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e)}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(e){this._renderTargets?.dispose(e)}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,c.bw)(e,(e=>1===e.drapeTargetType))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,c.bw)(e,(e=>1===e.drapeSourceType)),this._hasDrapedRasterSource=(0,c.bw)(e,(e=>0===e.drapeSourceType))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new S(this._stage.renderer.fboCache),this._overlays=[new x,new x]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets?.dispose(1),this._renderTargets=null,this.events.emit("textures-disposed")}_useOverlayColorInsteadOfColorNoRasterImage(e){return 1===e&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource}getTexture(e){return this._useOverlayColorInsteadOfColorNoRasterImage(e)?this._renderTargets?.getTexture(0):this._renderTargets?.getTexture(e)}get readyToRun(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_onMaterialOrContentChanged(){this.renderOccludedFlags=(0,a.Bs)(this._renderers,(e=>e.hasOccluders))?St:1}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers(),e.madeProgress()),this.compact(e),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this._onMaterialOrContentChanged(),this.hasHighlights=(0,a.Bs)(this._renderers,(e=>e.hasHighlights)),this.events.emit("content-changed"))}compact(e){let t=!1;for(const r of this._renderers.values()){if(e.done)break;t=r.compact(e)||t}return t&&this.notifyChange("updating"),t}hasHighlight(e){return(0,a.Bs)(this._renderers,(t=>t.hasHighlight(e)))}processSyncDrapeSources(){this._processDrapeSources(xt.Bb,(e=>1===e.updatePolicy))}get isEmpty(){return!v.b.OVERLAY_DRAW_DEBUG_TEXTURE&&(0,a.mt)(this._renderers,(e=>e.isEmpty))}get hasWater(){const e=(0,a.Bs)(this._renderers,(({hasWater:e})=>e));return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}renders(e){if(v.b.OVERLAY_DRAW_DEBUG_TEXTURE&&4!==e&&2!==e)return!0;if(!this._overlays)return!1;const t=this._overlays[0];for(const s of this._overlays)s.setupGeometryViews(this.longitudeCyclical);if(!t.hasSomeSizedView())return!1;const r=this._renderContext.output;this._renderContext.output=this._renderTargets?.targets.find((t=>t.content===e))?.output??0,++this._techniques.precompiling;const i=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,this._renderContext.output=r,i}get mode(){return this.isEmpty?0:this.hasWater&&this.renders(3)?2:this._renderTargets?.getTexture(0)?1:0}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t&&this.parent.requestRender(0),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(!this._overlays||!this._renderTargets)return!1;const t=this._bindParameters;t.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const r of this._renderTargets.targets){if(1===r.content&&!this._needsColorWithoutRasterImage)continue;const e=r.output;this._renderContext.output=e,t.slot=3===e?18:17,8===e&&(t.highlightMixTexture=t.highlights.length>1?this._rctx.emptyTexture:null);const i=this._renderContext.renderOccludedMask;4===r.content&&(this._renderContext.renderOccludedMask=St),this._sortedRenderers.forAll((({drapeSource:e,renderer:t})=>{1===r.content&&0===e.drapeSourceType||4===r.content&&t.hasOnlyOccluders||t.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=i,t.highlightMixTexture=null}return--this._techniques.precompiling,!0}drawOverlays(e,t){if(!this._overlays||!this._renderTargets)return;for(const i of this._overlays)i.setupGeometryViews(this.longitudeCyclical);this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;const r=this.allSourcesOccluders;for(const i of this._renderTargets.targets){if(!i.handleRenderRequest(t)||1===i.content&&!this._needsColorWithoutRasterImage||4===i.content&&r)continue;const e=this._drawTarget(0,i),s=this._drawTarget(1,i);(e||s)&&i.fbo.generateMipMap()}}_drawTarget(e,t){const r=this._overlays[e],i=r.canvasGeometries;if(0===i.numViews)return!1;const s=this._view.state.contentPixelRatio;this._screenToWorldRatio=s*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const{output:n}=t;if(this.isEmpty||3===n&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:a,_camera:o,_renderContext:h,_bindParameters:l}=this;if(o.pixelRatio=r.pixelRatio*s,h.output=n,l.screenToWorldRatio=this._screenToWorldRatio,l.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,l.slot=3===n?18:17,4===t.content&&(h.renderOccludedMask=St),!this.renders(t.content))return h.renderOccludedMask=De,!1;const{resolution:c}=r,u=0===e,d=u?0:c;if(a.setViewport(d,0,c,c),this._bindTargetFBO(t),u)if(8!==t.output)a.setClearColor(0,0,0,0),a.clear(16384);else{const{gl:e}=a;e.clearBufferuiv(e.COLOR,0,[0,0,0,0])}if(v.b.OVERLAY_DRAW_DEBUG_TEXTURE&&4!==t.content&&2!==t.content){this._techniques.precompile(pt,Ot);const t=this._techniques.get(pt,Ot);for(let s=0;s<i.numViews;s++)this._setViewParameters(i.extents[s],r),this._ensureDebugPatternResources(r.resolution,Ct[e]),a.bindTechnique(t,l,this._passParameters),a.screen.draw()}if(8===t.output){const{fboCache:r}=this._stage.renderer,i=this._resolution;this._bindTargetFBO(t),function(e,t,r,i,s,n=0){const{highlights:a}=i,o=a.length>1?t.acquire(r.width,r.height,"highlight mix",a.length>se?3:1):null,{gl:h}=e;if(o){const t=e.getBoundFramebufferObject();e.bindFramebuffer(o.fbo),h.clearBufferuiv(h.COLOR,0,[0,0,0,0]),e.bindFramebuffer(t)}const l=o?.getTexture();i.highlightMixTexture=l,(0,R.hZ)(i.highlightMixOrigin,n,0),a.forEach(((t,a)=>{if(a>0){const t=Y.g.TEXTURE_UNIT_FOR_UPDATES;e.bindTexture(l,t),e.setActiveTexture(t),h.copyTexSubImage2D(3553,0,0,0,n,0,r.width,r.height),e.bindTexture(null,t)}e.clear(256),i.highlightLevel=a,s()})),i.highlightLevel=null,i.highlightMixTexture=null,o?.release()}(a,r,{width:i,height:i},l,(()=>this._renderAllGeometry(e,t)),d)}else this._renderAllGeometry(e,t);return a.bindFramebuffer(null),h.renderOccludedMask=De,!0}get allSourcesOccluders(){return(0,a.mt)(this._renderers,(e=>e.hasOnlyOccluders))}_renderAllGeometry(e,t){const r=this._overlays[e],i=r.canvasGeometries;this._sortedRenderers.forAll((({drapeSource:s,renderer:n})=>{if(1===t.content&&0===s.drapeSourceType)return;const{fullOpacity:a}=s,o=null!=a&&a<1&&0===t.output&&this._bindTemporaryFBO();for(let e=0;e<i.numViews;e++)this._setViewParameters(i.extents[e],r),n.render(this._renderContext);if(o){this._bindTargetFBO(t),this._overlayParameters.texture=o.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const r=this._techniques.get(yt);this._rctx.bindTechnique(r,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),o.release()}}))}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.ensureFramebuffer(r,t),e.fbo.bind(this._rctx)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(16384),i}get _resolution(){return this._overlays?.[0].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:n}of this._sortedRenderers)s=n.intersect?.(e,t,r,i,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,a=i.renderGroup??(n?0:1),o=i.drapeSourcePriorityOffset??0,h=t*a+(n?s:0)+o;this._sortedRenderers.push(new bt(i,r,h))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,p.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,p.kN)(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if((0,_.i)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let n=0;n<e;n++)for(let t=0;t<e;t++){const s=Math.floor(t/10),a=Math.floor(n/10);s<2||a<2||10*s>e-20||10*a>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&s&&1&a?1&t^1&n?0:255:1&s^1&a?0:128)}const s=new K.R(e);s.samplingMode=9728,this._passParameters.texture=new Y.g(this._rctx,s,r)}get test(){}};(0,i.Cg)([(0,u.MZ)()],wt.prototype,"hasHighlights",void 0),(0,i.Cg)([(0,u.MZ)()],wt.prototype,"renderOccludedFlags",void 0),(0,i.Cg)([(0,u.MZ)()],wt.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,i.Cg)([(0,u.MZ)({constructOnly:!0})],wt.prototype,"parent",void 0),(0,i.Cg)([(0,u.MZ)({readOnly:!0})],wt.prototype,"_techniques",null),(0,i.Cg)([(0,u.MZ)({type:Boolean,readOnly:!0})],wt.prototype,"updating",null),(0,i.Cg)([(0,u.MZ)()],wt.prototype,"isEmpty",null),wt=(0,i.Cg)([(0,g.$)("esri.views.3d.terrain.OverlayRenderer")],wt);class bt{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const Ct=[[1,.5,.5],[.5,.5,1]],Tt=-2,St=4,Ot=new ft;Ot.hasAlpha=!0},47233:(e,t,r)=>{r.d(t,{Q:()=>u});var i=r(19555),s=r(72745),n=r(86955),a=r(87003);class o extends a.n{constructor(e,t){super(e,"ivec2",1,((r,i,s)=>r.setUniform2iv(e,t(i,s))))}}var h=r(72790),l=r(70571),c=r(21019);function u(e){const{vertex:t}=e;t.uniforms.add(new l.R("coverageTexture",(e=>e.coverageTexture)),new o("highlightRenderCellCount",(e=>(0,i.hZ)(d,e.horizontalCellCount,e.verticalCellCount))),new o("highlightTextureResolution",(({highlightTexture:e})=>(0,i.hZ)(d,e.descriptor.width,e.descriptor.height))),new h.c("highlightLevel",(e=>e.highlightLevel))).constants.add("cellSize","int",c.g),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(n.H`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),t.main.add(n.H`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
uvec2 covTexel = texelFetch(coverageTexture, cellPos, 0).rg;
int channelIndex = (highlightLevel >> 2) & 3;
uint channelValue = covTexel[channelIndex];
int highlightIndex = (highlightLevel & 3) << 1;
bool covered = ((channelValue >> highlightIndex) & 1u) == 1u;
if (!covered) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}const d=(0,s.vt)()},70571:(e,t,r)=>{r.d(t,{R:()=>s});var i=r(87003);class s extends i.n{constructor(e,t){super(e,"usampler2D",1,((r,i,s)=>r.bindTexture(e,t(i,s))))}}},60586:(e,t,r)=>{r.d(t,{Cc:()=>o,RW:()=>a});var i=r(91967);const s={required:[]};class n extends i.A{precompile(e){return!!this.acquireTechniques(e)}consumes(){return s}get usedMemory(){return 0}get renderOccludedFlags(){return 1}get isDecoration(){return!1}get readyToRun(){return!1}modify(e,t){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}}class a extends n{}class o extends n{}},442:(e,t,r)=>{r.d(t,{$:()=>l});var i=r(90632),s=r(34761),n=r(13191),a=r(20664),o=r(78315),h=r(94966);class l{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,n.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerViewUid=t.layerViewUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,s.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,n.vt)(),(0,s.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,o.c)(),(0,a.t)((0,o.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,h.hG)(this.shaderTransformation)),this._boundingSphere):o.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},69008:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(36911);class s extends i.Z{}},76956:(e,t,r)=>{r.d(t,{v:()=>S});var i=r(55855),s=r(34981),n=r(59696),a=r(60322),o=r(82809),h=r(63928),l=r(93684),c=r(48549),u=r(16506),d=r(59246),g=r(61785),p=r(96643),_=r(37923),f=r(57162);l.S;class v extends d.w{constructor(e,t){super(e,t,new u.$(_.C,(()=>r.e(35837).then(r.bind(r,35837)))),y(t).locations)}_createPipeline(e,t){const{oitPass:r,output:i,transparent:n,cullFace:o,draped:h,hasOccludees:l,polygonOffset:c}=e,u=0===r;return(0,f.Ey)({blending:(0,s.RN)(i)&&n?(0,a.Yf)(r):null,culling:(0,f.Xt)(o),depthTest:h?null:{func:(0,a.K_)(r)},depthWrite:(0,a.z5)(e),drawBuffers:(0,d.L)(i,(0,a.m6)(r,i)),colorWrite:f.kn,stencilWrite:l?p.v0:null,stencilTest:l?t?p.a9:p.qh:null,polygonOffset:u?c?m:null:(0,a.mE)(e)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const m={factor:1,units:1};function y(e){const t=(0,c.BP)().vec3f("position");return(0,g.E)()&&t.vec4u8("olidColor"),e.hasVVColor?t.f32("colorFeatureAttribute"):t.vec4u8("color"),t.freeze()}var x=r(6326),w=r(6485),b=r(92656);class C extends b.E{constructor(){super(...arguments),this.cullFace=0,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasVVColor=!1,this.draped=!1,this.textureCoordinateType=0,this.emissionSource=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.hasVVInstancing=!1,this.hasVVSize=!1,this.hasVVOpacity=!1,this.snowCover=!1}}(0,x.Cg)([(0,w.W)({count:3})],C.prototype,"cullFace",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"hasVertexColors",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"transparent",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"discardInvisibleFragments",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"polygonOffset",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"enableOffset",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"writeDepth",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"hasOccludees",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"terrainDepthTest",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"cullAboveTerrain",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"hasVVColor",void 0),(0,x.Cg)([(0,w.W)()],C.prototype,"draped",void 0);var T=r(75569);class S extends h.W{constructor(e){super(e,P),this._configuration=new C,this.supportsEdges=!0,this.produces=new Map([[2,e=>this._isOpaqueMaterialPass(e)],[3,e=>this._isOpaqueNoSSAODepthPass(e)],[4,e=>(0,s.QG)(e)&&this._transparent&&this.parameters.writeDepth],[5,e=>(0,s.eh)(e)&&this._transparent&&this.parameters.writeDepth],[7,e=>(0,s.QG)(e)&&this._transparent&&!this.parameters.writeDepth],[17,e=>(0,s.i3)(e)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<a.xt,this._configuration.terrainDepthTest=t.terrainDepthTest&&(0,s.RN)(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=T.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return 8===e||(0,s.QG)(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return(0,s.eh)(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new O(e)}createBufferWriter(){return new o.Z(y(this.parameters))}}class O extends n.A{beginSlot(e){return this.getTechnique(v,e)}}class P extends l.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=0,this.draped=!1,this.discardInvisibleFragments=!1}}},86401:(e,t,r)=>{r.d(t,{Ci:()=>s,KL:()=>o,dB:()=>a,l5:()=>n,wB:()=>h});var i=r(48549);const s=(0,i.BP)().vec3f("position").freeze(),n=(0,i.BP)().vec3f("position").vec2f16("uv0").freeze(),a=(0,i.BP)().vec3f("position").vec4u8("color").freeze(),o=((0,i.BP)().vec3f("position").vec2f16("uv0").vec4u8("olidColor").freeze(),(0,i.BP)().vec3f("position").vec2f("uv0").freeze()),h=(0,i.BP)().vec3f("position").vec2f("uv0").vec4u8("olidColor").freeze()},63928:(e,t,r)=>{r.d(t,{W:()=>a});var i=r(9392),s=r(45463),n=r(48168);class a extends s.i{constructor(){super(...arguments),this._pp0=(0,i.fA)(0,0,1),this._pp1=(0,i.fA)(0,0,0)}intersect(e,t,r,i,s,a){return(0,n.Uy)(e,r,i,s,void 0,a)}intersectDraped(e,t,r,i){return this._pp0[0]=this._pp1[0]=r[0],this._pp0[1]=this._pp1[1]=r[1],(0,n.Uy)(e,t,this._pp0,this._pp1,void 0,i)}}},35925:(e,t,r)=>{r.d(t,{Xq:()=>o,wk:()=>a});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},n=8;function a(e){return{pattern:[e,e],pixelRatio:2}}function o(e){return"style"===e?.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(s[e],n):null}(e.style):null}}}]);
//# sourceMappingURL=86887.86aad57e.chunk.js.map